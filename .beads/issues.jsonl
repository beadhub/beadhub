{"id":"beadhub-00q0","title":"Lock metadata missing alias, human_name, project_slug, repo_id - breaks dashboard filtering","description":"Location: routes/reservations.py. When acquiring locks, the ACQUIRE_IF_FREE_SCRIPT stores limited fields. Per architecture doc (Lock Metadata Requirements), locks MUST store:\n\nRequired fields:\n- lock_id, path, workspace_id, alias (not agent_name)\n- project_id (for tenant isolation)\n- project_slug (for display)\n- human_name (for display)\n- repo_id, bead_id, reason, exclusive\n- acquired_at, expires_at\n\nFix: Add alias, human_name, project_slug, and repo_id to the lock hash when acquiring.\n\nUpdated 2025-12-12: agent_name renamed to alias, added repo_id per data model.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-09T19:54:41.84706+01:00","updated_at":"2025-12-12T17:33:49.039746+01:00","closed_at":"2025-12-12T17:33:49.039746+01:00"}
{"id":"beadhub-01xq","title":"UX: Chat page lacks entry point for new conversations","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-13T21:26:07.863777+01:00","updated_at":"2025-12-13T21:34:19.389388+01:00","closed_at":"2025-12-13T21:34:19.389388+01:00"}
{"id":"beadhub-02a","title":"Cloud: ensure_workspace MCP tool needs auth bridge integration","description":"For cloud multi-tenant deployment, ensure_workspace MCP tool needs to be restricted. Currently it can look up/create workspaces without tenant authentication. In OSS single-tenant this is fine (self-registration). For cloud: derive project context from API key auth or restrict to admin scope.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T00:31:32.33157+01:00","updated_at":"2025-12-08T08:35:08.069445+01:00","closed_at":"2025-12-08T08:35:08.069445+01:00","dependencies":[{"issue_id":"beadhub-02a","depends_on_id":"beadhub-kpn","type":"discovered-from","created_at":"2025-12-08T00:31:32.33257+01:00","created_by":"juanre"}]}
{"id":"beadhub-039u","title":"Add messages_waiting to /v1/chat/pending response","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-13T12:42:42.280634+01:00","updated_at":"2025-12-13T12:46:00.309596+01:00","closed_at":"2025-12-13T12:46:00.309596+01:00"}
{"id":"beadhub-089o","title":"Update registration endpoint to accept role","description":"Accept optional role field in POST /v1/agents/register and POST /v1/bdh/command. Store role in Postgres (workspaces table) and Redis (presence). The /v1/bdh/command endpoint is the primary path since it's called on every bdh command.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-14T09:06:35.503974+01:00","updated_at":"2025-12-14T09:32:34.740496+01:00","closed_at":"2025-12-14T09:32:34.740496+01:00","dependencies":[{"issue_id":"beadhub-089o","depends_on_id":"beadhub-r64t","type":"blocks","created_at":"2025-12-14T09:06:55.398339+01:00","created_by":"juanre"},{"issue_id":"beadhub-089o","depends_on_id":"beadhub-6s8f","type":"blocks","created_at":"2025-12-14T09:06:55.480609+01:00","created_by":"juanre"},{"issue_id":"beadhub-089o","depends_on_id":"beadhub-161u","type":"parent-child","created_at":"2025-12-14T09:24:11.048846+01:00","created_by":"juanre"}]}
{"id":"beadhub-08uu","title":"Inconsistent error response formats across API","description":"Location: multiple route files. Some endpoints return {detail: error}, others return {error: {code, message, details}}, some return plain text. Makes it difficult to build reliable client error handling, parse/display errors, log/monitor consistently. Fix: standardize on single error format, use FastAPI exception handlers.","status":"open","priority":3,"issue_type":"bug","created_at":"2025-12-08T18:25:00.30455+01:00","updated_at":"2026-01-13T22:42:14.933392+01:00"}
{"id":"beadhub-0ari","title":"Show pending chat requests in bdh command output","description":"Show pending chat requests prominently in bdh command output.\n\nWhen an agent has pending chat requests, display them at the TOP of every bdh command output:\n\nðŸ”´ CHAT REQUEST from agent-p1 (45s remaining)\n   \"Is project_id nullable?\"\n   â†’ Join: bdh :chat agent-p1\n\n[normal command output follows]\n\nRequires calling GET /v1/chat/pending in the bdh wrapper before displaying normal output.\n\nSee spec: beadhub-sot/source-of-truth/beadhub-chat-spec.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T20:33:23.184487+01:00","updated_at":"2025-12-11T08:53:10.350551+01:00","closed_at":"2025-12-11T08:53:10.350551+01:00","dependencies":[{"issue_id":"beadhub-0ari","depends_on_id":"beadhub-w143","type":"blocks","created_at":"2025-12-10T20:37:28.927929+01:00","created_by":"juanre"}]}
{"id":"beadhub-0bv4","title":"bdh SSE client: add line/event size caps to prevent memory DoS","description":"SSE client reads lines with bufio.Reader.ReadString('\\n') without any maximum line/event size. A malicious/buggy server can send extremely long lines and cause unbounded memory growth. Add caps (max line length / max event bytes) using bufio.Scanner with an explicit buffer limit or a bounded reader.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T12:52:10.115236+01:00","updated_at":"2025-12-13T16:43:56.966913+01:00","closed_at":"2025-12-13T16:43:56.966913+01:00","dependencies":[{"issue_id":"beadhub-0bv4","depends_on_id":"beadhub-t265","type":"discovered-from","created_at":"2025-12-13T12:52:10.1163+01:00","created_by":"juanre"}]}
{"id":"beadhub-0db","title":"Add getting started guide with two user paths","description":"Quick start guide with two paths: 1) Users WITH beads already installed - explain how BeadHub adds coordination on top, reference existing bd workflow, 2) Users WITHOUT beads - explain you need beads first (link to beads repo), or can use BeadHub for just file locking if not using beads issue tracking. Include: first-time setup, registering agents, acquiring first lock, checking project status","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-03T20:52:38.598759+01:00","updated_at":"2025-12-03T21:23:38.092629+01:00","closed_at":"2025-12-03T21:23:38.092629+01:00","dependencies":[{"issue_id":"beadhub-0db","depends_on_id":"beadhub-17q","type":"blocks","created_at":"2025-12-03T20:53:23.112667+01:00","created_by":"juanre"}]}
{"id":"beadhub-0gg","title":"Add real health checks to /health endpoint (Redis ping, DB query)","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-03T09:46:20.737114+01:00","updated_at":"2025-12-03T12:07:13.064879+01:00","closed_at":"2025-12-03T12:07:13.064879+01:00"}
{"id":"beadhub-0gif","title":"Fix pgdbm fixture misuse causing 500+ orphaned test databases","description":"## Problem\n\nEvery test run creates orphaned test_* databases that are never cleaned up. We currently have 500+ stale test databases accumulating.\n\n## Root Cause Analysis (from pgdbm team)\n\nThe beadhub-dave tests don't use pgdbm fixtures properly. Instead of using `@pytest_asyncio.fixture` which guarantees cleanup, they manually manage databases inside test functions with try/finally blocks.\n\n### Problem 1: Silent cleanup failures\n\nAll cleanup code swallows exceptions:\n\n```python\n# helpers_app.py:83-86\nfinally:\n    try:\n        asyncio.run(test_db.drop_test_database())\n    except Exception:\n        pass  # Silently ignored!\n\n# conftest.py:218-219 (beadhub_server fixture)\nexcept Exception as e:\n    logger.warning(f\"Failed to drop test database {db_name}: {e}\")\n    # Continues without cleanup!\n```\n\n### Problem 2: 35+ tests create databases manually\n\nInstead of using the test_db fixture from pgdbm, they do:\n\n```python\n# In every test function\ntest_db = AsyncTestDatabase(test_config)\ndb_name = await test_db.create_test_database()\ntry:\n    # ... test code ...\nfinally:\n    await test_db.drop_test_database()\n```\n\nThis pattern fails when:\n- Tests are interrupted (Ctrl+C)\n- pytest crashes or is killed\n- Cleanup itself fails (connection issues, active connections, etc.)\n\n### Problem 3: beadhub_server fixture uses separate event loops\n\n```python\n# Create in one event loop\nloop = asyncio.new_event_loop()\ntest_db, db_name, database_url = loop.run_until_complete(_create_test_database())\nloop.close()\n\n# Drop in ANOTHER event loop at session end\nloop = asyncio.new_event_loop()\nloop.run_until_complete(_drop_test_database(db_name))\nloop.close()\n```\n\nThis is fragile - if the session is interrupted, cleanup never runs.\n\n## Required Fix\n\nReplace ALL manual database management with proper pgdbm fixture usage:\n\n```python\n# BAD - current pattern (must be eliminated everywhere)\nasync def test_something(redis_url):\n    test_db = AsyncTestDatabase(test_config)\n    db_name = await test_db.create_test_database()\n    try:\n        ...\n    finally:\n        await test_db.drop_test_database()\n\n# GOOD - correct pattern\nasync def test_something(db_infra, redis_client):\n    # db_infra fixture handles creation/cleanup automatically\n    ...\n```\n\nThe `db_infra` fixture already exists and works correctly - we need to use it consistently everywhere.\n\n## Scope\n\n1. Audit ALL test files for manual AsyncTestDatabase usage\n2. Refactor every test to use `db_infra` fixture instead\n3. Remove manual try/finally database cleanup blocks\n4. Fix or remove the problematic beadhub_server fixture\n5. Ensure no exception swallowing in any remaining cleanup code\n6. Verify cleanup works even on Ctrl+C interruption\n\n## Requirements\n\n- **NO SHORTCUTS**: This must be done completely and correctly\n- **NO TECH DEBT**: Do not leave any manual database management code\n- **NO WORKAROUNDS**: Fix the root cause, don't add more cleanup scripts\n- Even if this is a long edit task touching 35+ tests, it must be done right\n- Test the fix by running tests and verifying no orphaned databases remain","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-10T10:50:26.38191+01:00","created_by":"juanre","updated_at":"2026-01-10T11:11:52.219548+01:00","closed_at":"2026-01-10T11:11:52.219548+01:00","close_reason":"Analysis complete, work structured as epic beadhub-7wpr with 29 subtasks"}
{"id":"beadhub-0p2b","title":"Chat: make Postgres primary for messages (no Redis message list)","description":"beadhub-chat-spec.md v2.1: messages persist in Postgres; Redis is only for SSE pub/sub. Current implementation stores messages in Redis lists with TTL and only best-effort persists to Postgres (POST /v1/chat/sessions/{id}/messages), which can lose history if Postgres insert fails.\n\nFix:\n- Persist message to chat_messages in Postgres as the primary write (ideally in a transaction)\n- Publish SSE ChatMessageEvent after commit\n- Remove chat:messages:{session_id} list usage and TTL semantics\n- Ensure GET history endpoints read from Postgres only","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T23:11:52.353812+01:00","updated_at":"2025-12-13T23:31:57.523166+01:00","closed_at":"2025-12-13T23:31:57.523166+01:00","dependencies":[{"issue_id":"beadhub-0p2b","depends_on_id":"beadhub-ixss","type":"discovered-from","created_at":"2025-12-13T23:11:52.35506+01:00","created_by":"juanre"}]}
{"id":"beadhub-0pc","title":"Add MIT LICENSE file","description":"Add MIT license to project root as promised in SOT.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-02T22:19:45.386923+01:00","updated_at":"2025-12-02T22:23:09.591596+01:00","closed_at":"2025-12-02T22:23:09.591596+01:00","close_reason":"Added MIT LICENSE file"}
{"id":"beadhub-0q4","title":"Add project_repos table in BeadHub Cloud","description":"Edit existing migration beadhub-cloud/001_initial.sql to add project_repos table with columns: id, project_id (FK to projects), repo_name, branch (nullable), created_at, updated_at. Unique constraint on (project_id, repo_name, branch). No new migration needed since DB hasn't been deployed.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T22:52:34.112205+01:00","updated_at":"2025-12-07T08:52:06.367468+01:00","closed_at":"2025-12-07T08:52:06.367468+01:00"}
{"id":"beadhub-0q7","title":"Update routes/beads.py endpoints to filter by project_id","description":"Add project_id dependency to upload, upload-jsonl, issues, ready endpoints. Filter all queries by project_id.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T22:29:08.864465+01:00","updated_at":"2025-12-08T01:04:08.734577+01:00","closed_at":"2025-12-08T01:04:08.734577+01:00","dependencies":[{"issue_id":"beadhub-0q7","depends_on_id":"beadhub-4mj","type":"discovered-from","created_at":"2025-12-07T22:29:08.865381+01:00","created_by":"juanre"}]}
{"id":"beadhub-0syy","title":":chat cannot resolve agents from other projects despite :who showing them","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-11T19:27:02.278608+01:00","updated_at":"2025-12-11T19:30:29.49973+01:00","closed_at":"2025-12-11T19:30:29.49973+01:00"}
{"id":"beadhub-0u1","title":"Make CLI API base URL configurable","description":"**Problem**: cli.py:86-87 hardcodes http://localhost:8000, making CLI unusable for remote deployments.\n\n**File**: cli.py:86-87\n\n**Current code**:\n```python\ndef _get_api_base():\n    return 'http://localhost:8000'\n```\n\n**Fix**: Add environment variable and CLI option:\n```python\ndef _get_api_base():\n    return os.getenv('BEADHUB_API_URL', 'http://localhost:8000')\n```\n\nAlso add --api-url option to CLI commands.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-02T19:48:04.760559+01:00","updated_at":"2025-12-02T22:06:18.360041+01:00","closed_at":"2025-12-02T22:06:18.360041+01:00","close_reason":"Added BEADHUB_API_URL environment variable support in cli.py. Defaults to http://localhost:8000."}
{"id":"beadhub-0u8","title":"Add auth bridge middleware for multi-tenant request scoping","description":"Port APIKeyToProjectMiddleware from llmring: extract X-API-Key header, validate via AuthService, inject X-Project-ID header for downstream routes. Strip incoming X-User-ID/X-Project-ID headers from clients (security).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-03T08:09:21.860286+01:00","updated_at":"2025-12-03T08:41:44.733889+01:00","closed_at":"2025-12-03T08:41:44.733889+01:00","close_reason":"Already exists from llmring-api template","dependencies":[{"issue_id":"beadhub-0u8","depends_on_id":"beadhub-acd","type":"blocks","created_at":"2025-12-03T08:09:27.717288+01:00","created_by":"juanre"}]}
{"id":"beadhub-0u8l","title":"Add pytest fixture to start/stop BeadHub server for CLI tests","description":"test_cli_init.py tests fail when BeadHub server isn't running. Create a conftest fixture that starts the server before tests and stops it after, so the full test suite can run without manual server setup.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T18:34:16.937767+01:00","updated_at":"2025-12-13T18:41:30.677193+01:00","closed_at":"2025-12-13T18:41:30.677193+01:00"}
{"id":"beadhub-0x8n","title":"Disable action buttons during pending mutations to prevent race conditions","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-08T15:32:34.231232+01:00","updated_at":"2025-12-08T15:32:34.231232+01:00","dependencies":[{"issue_id":"beadhub-0x8n","depends_on_id":"beadhub-7r4","type":"discovered-from","created_at":"2025-12-08T15:32:34.232001+01:00","created_by":"juanre"}]}
{"id":"beadhub-0xe","title":"Code duplication: _build_database_url in conftest.py and helpers_app.py","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-03T15:38:52.232051+01:00","updated_at":"2025-12-03T19:41:59.09212+01:00","closed_at":"2025-12-03T19:41:59.09212+01:00"}
{"id":"beadhub-0z8q","title":"bdh: timeouts + remove project_id from pending","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T00:29:53.732377+01:00","updated_at":"2025-12-22T01:10:31.377975+01:00","closed_at":"2025-12-22T01:10:31.377975+01:00","close_reason":"Duplicate of beadhub-caw5 (already merged)"}
{"id":"beadhub-103j","title":"bdh :ack reports stale unread count","description":"When acknowledging a message with 'bdh :ack', the unread count shown is calculated before the ack takes effect. Example: after acking message 1 of 2, it says 'You have 2 unread messages' instead of 'You have 1 unread message'. The count should be calculated after the acknowledgment.","status":"closed","priority":3,"issue_type":"bug","created_at":"2025-12-21T14:42:03.925372+01:00","updated_at":"2025-12-22T00:39:19.25683+01:00","closed_at":"2025-12-22T00:39:19.25683+01:00","close_reason":"Moved ShowServerContext call to after acknowledgment so unread count reflects the completed ack"}
{"id":"beadhub-11e","title":"Create bd-wrapper script for automatic BeadHub sync","description":"Epic for bd-wrapper integration with BeadHub. Split into: beadhub-1fl (inbox/count endpoint), beadhub-dny (upload-jsonl endpoint), beadhub-8bd (shell script). Solves both issue sync and the interruption problem (agents check inbox on every bd command).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T22:53:07.237394+01:00","updated_at":"2025-12-07T18:09:11.936519+01:00","closed_at":"2025-12-07T18:09:11.936519+01:00","dependencies":[{"issue_id":"beadhub-11e","depends_on_id":"beadhub-go0","type":"blocks","created_at":"2025-12-06T22:54:28.346401+01:00","created_by":"juanre"},{"issue_id":"beadhub-11e","depends_on_id":"beadhub-8bd","type":"blocks","created_at":"2025-12-07T12:04:40.675209+01:00","created_by":"juanre"}]}
{"id":"beadhub-137j","title":"Add dependency vulnerability scanning to CI","description":"## Problem\n\nNo automated dependency vulnerability scanning in CI pipeline.\n\n### Current State\n\nDependencies are:\n- **Python**: FastAPI, httpx, uvicorn, redis, pgdbm, aiofiles (pyproject.toml)\n- **Go**: uuid, godotenv, cobra, yaml.v3 (go.mod)\n- **JS/TS**: React 19, Vite, Tailwind, etc. (package.json)\n\nNo automated scanning for known CVEs.\n\n### Risk\n\n- Vulnerable dependencies may be used unknowingly\n- No alerts when new CVEs are published\n- Manual checking is error-prone and infrequent\n\n### Solution\n\nAdd vulnerability scanning to CI:\n\n**Python (pip-audit or safety):**\n```yaml\n# .github/workflows/ci.yml\n- name: Scan Python dependencies\n  run: |\n    uv add --dev pip-audit\n    uv run pip-audit\n```\n\n**Go (govulncheck):**\n```yaml\n- name: Scan Go dependencies\n  run: |\n    go install golang.org/x/vuln/cmd/govulncheck@latest\n    govulncheck ./...\n```\n\n**JavaScript (npm audit):**\n```yaml\n- name: Scan JS dependencies\n  run: |\n    cd frontend\n    pnpm audit\n```\n\n**Dependabot (automated updates):**\n```yaml\n# .github/dependabot.yml\nversion: 2\nupdates:\n  - package-ecosystem: \"pip\"\n    directory: \"/\"\n    schedule:\n      interval: \"weekly\"\n  - package-ecosystem: \"gomod\"\n    directory: \"/bdh\"\n    schedule:\n      interval: \"weekly\"\n  - package-ecosystem: \"npm\"\n    directory: \"/frontend\"\n    schedule:\n      interval: \"weekly\"\n```\n\n### Acceptance Criteria\n\n- [ ] CI runs vulnerability scans for all ecosystems\n- [ ] Build fails on high-severity vulnerabilities\n- [ ] Dependabot enabled for automated updates\n- [ ] Process documented for handling vulnerability reports","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-09T08:32:11.781427+01:00","created_by":"juanre","updated_at":"2026-01-09T08:32:11.781427+01:00"}
{"id":"beadhub-15qn","title":"Clear apex from .role when work completes","description":"When closing a bead that is tracked in .role apex line: 1) If it's the only apex, clear line 2 entirely, 2) If multiple apexes, remove just this one from the comma-separated list. Also clear when apex epic is closed. This keeps .role clean and prevents stale apex references.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T21:59:19.368362+01:00","updated_at":"2025-12-20T10:41:34.920257+01:00","closed_at":"2025-12-20T10:41:34.920257+01:00","close_reason":"Implemented clearClosedApex() function that removes closed beads from the apex list in .role. Called after successful close commands. If only apex is removed, clears line entirely. If multiple apexes, removes only the closed one. All tests pass.","dependencies":[{"issue_id":"beadhub-15qn","depends_on_id":"beadhub-npuh","type":"parent-child","created_at":"2025-12-17T21:59:33.270124+01:00","created_by":"juanre"},{"issue_id":"beadhub-15qn","depends_on_id":"beadhub-vvon","type":"blocks","created_at":"2025-12-17T21:59:41.213719+01:00","created_by":"juanre"}]}
{"id":"beadhub-161u","title":"Workspace roles for agent coordination","description":"Add workspace roles - brief descriptions of each workspace's purpose - to improve agent coordination. Roles are stored in .role files, sent on registration, and displayed in status queries, rejections, and dashboard. See beadhub-sot/source-of-truth/beadhub-workspace-roles.md","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-14T09:06:13.65855+01:00","updated_at":"2026-01-09T19:09:57.998531+01:00","closed_at":"2026-01-09T19:09:57.998531+01:00","close_reason":"All subtasks completed - workspace roles feature fully implemented"}
{"id":"beadhub-161u.1","title":"bdh: Update :who to display roles","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-14T21:28:43.109683+01:00","updated_at":"2025-12-15T15:18:04.280383+01:00","closed_at":"2025-12-15T15:18:04.280383+01:00","dependencies":[{"issue_id":"beadhub-161u.1","depends_on_id":"beadhub-161u","type":"parent-child","created_at":"2025-12-14T21:28:43.110174+01:00","created_by":"juanre"}]}
{"id":"beadhub-16d6","title":"bdh close: Prompt for related work notification","description":"When closing a bead, show related work in progress and suggest notifying those agents:\n\n```\n$ bdh close bd-42 --reason \"JWT validation complete\"\n\nClosed bd-42.\n\nRELATED WORK IN PROGRESS:\n  bd-45 â€” claude-test â€” \"Add integration tests for auth\"\n\nConsider notifying related agents:\n  â†’ bdh :send claude-test \"Finished bd-42 (JWT). Ready for testing.\"\n```\n\nDetection of 'related work':\n- Same labels/tags\n- Dependency relationships (blockers/blocked-by)\n- Same parent epic\n- Similar titles (optional, fuzzy match)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-15T18:23:22.427284+01:00","updated_at":"2025-12-15T19:02:40.359357+01:00","closed_at":"2025-12-15T19:02:40.359357+01:00","dependencies":[{"issue_id":"beadhub-16d6","depends_on_id":"beadhub-fei6","type":"blocks","created_at":"2025-12-15T18:23:28.961323+01:00","created_by":"juanre"}]}
{"id":"beadhub-175","title":"SQL Injection risk in beads_sync.py blocked_by parsing","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-07T22:08:20.402164+01:00","updated_at":"2025-12-08T08:44:06.452797+01:00","closed_at":"2025-12-08T08:44:06.452797+01:00"}
{"id":"beadhub-17m","title":"Update beads_sync.py to require and store project_id","description":"Add project_id parameter to _sync_issues_to_db(), include in INSERT/UPSERT, update ON CONFLICT clause","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T22:29:08.683586+01:00","updated_at":"2025-12-08T01:04:08.570732+01:00","closed_at":"2025-12-08T01:04:08.570732+01:00","dependencies":[{"issue_id":"beadhub-17m","depends_on_id":"beadhub-4mj","type":"discovered-from","created_at":"2025-12-07T22:29:08.684344+01:00","created_by":"juanre"}]}
{"id":"beadhub-17q","title":"Rewrite README.md - explain multi-repo coordination, beads integration, two user paths","description":"README must be self-contained since source-of-truth docs are not in beadhub repo. Must explain: 1) BeadHub is coordination layer for orgs using Beads across multiple repos, 2) One BeadHub serves ALL repos with namespaced bead IDs (frontend:fd-123, backend:bd-456), 3) Cross-repo dependencies and subscriptions, 4) Two user paths: with beads installed / without beads, 5) Beads sync branch pattern requirement, 6) Complete setup instructions","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-03T20:51:49.071459+01:00","updated_at":"2025-12-03T21:20:12.091922+01:00","closed_at":"2025-12-03T21:20:12.091922+01:00"}
{"id":"beadhub-185k","title":"Add --read flag to view chat messages without engaging","description":"Add bdh :chat \u003cagent\u003e --read to view message history without triggering engagement. For messages from non-waiting senders.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-14T17:07:19.079974+01:00","updated_at":"2025-12-14T17:23:23.27921+01:00","closed_at":"2025-12-14T17:23:23.27921+01:00","dependencies":[{"issue_id":"beadhub-185k","depends_on_id":"beadhub-2s14","type":"blocks","created_at":"2025-12-14T17:07:26.927965+01:00","created_by":"juanre"}]}
{"id":"beadhub-18d5","title":"Add keyboard shortcuts for top sidebar nav items","status":"open","priority":3,"issue_type":"feature","created_at":"2026-01-09T22:46:46.328701+01:00","created_by":"juanre","updated_at":"2026-01-09T22:46:46.328701+01:00"}
{"id":"beadhub-193y","title":"Fix race condition: SendMessageDialog opens before identity loads","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-13T20:34:54.785158+01:00","updated_at":"2025-12-13T20:45:03.58735+01:00","closed_at":"2025-12-13T20:45:03.58735+01:00"}
{"id":"beadhub-196m","title":"Move chat termination signal to server-side metadata","description":"Current implementation appends \\n.[bdh-signing-off] to message body, which can be spoofed by message content.\n\nFix:\n1. Sender: include 'leaving': true in POST /v1/chat/sessions body when --no-wait\n2. Backend (chat.py): store leaving flag, include in SSE event as 'sender_leaving': true\n3. Receiver (chat.go): check event.SenderLeaving instead of parsing message body for termination signal\n4. Remove TerminationSignal constant and body manipulation\n\nThis eliminates the spoofing vulnerability entirely.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-14T11:38:41.95141+01:00","updated_at":"2025-12-14T11:46:27.344244+01:00","closed_at":"2025-12-14T11:46:27.344244+01:00"}
{"id":"beadhub-1b04","title":"Schema migration: add workspace_type, make repo_id nullable","description":"Add workspace_type column ('agent'|'dashboard') to workspaces table. Make repo_id nullable with constraint that agent workspaces require repo_id, dashboard workspaces have NULL. Add index for dashboard workspace lookup by project_id + human_name.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T19:27:03.555397+01:00","updated_at":"2025-12-13T20:15:24.275953+01:00","closed_at":"2025-12-13T19:40:58.049122+01:00","dependencies":[{"issue_id":"beadhub-1b04","depends_on_id":"beadhub-g9l6","type":"parent-child","created_at":"2025-12-13T19:27:52.026642+01:00","created_by":"juanre"}]}
{"id":"beadhub-1bad","title":"Include role in /v1/workspaces response","description":"GET /v1/workspaces should include role field in workspace listings","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-14T09:06:35.840187+01:00","updated_at":"2025-12-15T15:35:00.599179+01:00","closed_at":"2025-12-15T15:18:04.279881+01:00","dependencies":[{"issue_id":"beadhub-1bad","depends_on_id":"beadhub-089o","type":"blocks","created_at":"2025-12-14T09:06:55.668828+01:00","created_by":"juanre"},{"issue_id":"beadhub-1bad","depends_on_id":"beadhub-161u","type":"parent-child","created_at":"2025-12-14T09:24:11.110888+01:00","created_by":"juanre"}]}
{"id":"beadhub-1c05","title":"Session status updates (join/end) not persisted to Postgres","description":"join_session() and end_session() update session status in Redis but not Postgres. This causes list_sessions() to return incorrect status values since it queries Postgres. Fix: Add UPDATE statements to Postgres after Redis updates in join_session() (line 458) and end_session() (line 591).","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T14:58:40.633175+01:00","updated_at":"2025-12-13T15:10:52.020986+01:00","closed_at":"2025-12-13T15:10:52.020986+01:00"}
{"id":"beadhub-1dka","title":"Add issue title to claims listing","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-13T18:23:41.050618+01:00","updated_at":"2025-12-13T18:27:23.072409+01:00","closed_at":"2025-12-13T18:27:23.072409+01:00"}
{"id":"beadhub-1fl","title":"Add GET /v1/messages/inbox/count endpoint returning plain text unread count","description":"Simple endpoint that returns plain text integer count of unread messages for an agent. Query params: project_key, agent_name, repo (optional). Returns just the number (e.g., '3'), not JSON. Enables shell script to check inbox without jq.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T12:03:42.206385+01:00","updated_at":"2025-12-07T17:40:15.364826+01:00","closed_at":"2025-12-07T17:40:15.364826+01:00"}
{"id":"beadhub-1gv4","title":"Document mail vs chat distinction in source of truth","description":"Create/update a sot doc explaining when to use mail vs chat. Mail: async-first, detailed communication with subject/body/priority/threads/ack. Chat: real-time Q\u0026A, quick exchanges. Include decision matrix and examples.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-15T17:40:07.969533+01:00","updated_at":"2025-12-15T17:53:04.875924+01:00","closed_at":"2025-12-15T17:53:04.875924+01:00"}
{"id":"beadhub-1ho","title":"Add agent_name validation (max length, allowed characters)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T19:59:50.711579+01:00","updated_at":"2025-12-08T09:17:24.839676+01:00","closed_at":"2025-12-08T09:17:24.839676+01:00"}
{"id":"beadhub-1i1r","title":"Cloud-safe actor identity \u0026 attribution (aweb protocol)","description":"We must prevent within-project impersonation/incorrect attribution when the OSS core is mounted behind a Cloud wrapper (proxy-header mode).\n\nThis epic defines and implements a consistent actor-identity model across:\n- direct Bearer API-key mode (default OSS/agent clients)\n- proxy-header mode (cloud dashboards/JWT/cookie), where the wrapper chooses project scope and must also convey actor identity.\n\nNon-goal: preventing same-OS-user access to another agent's credentials; that boundary is OS permissions. Goal: server-side correctness even when the caller does NOT possess another agent's API key.","status":"closed","priority":1,"issue_type":"epic","owner":"juan@juanreyero.com","created_at":"2026-01-24T17:53:17.667366+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T23:01:26.444022+01:00","closed_at":"2026-01-25T23:01:26.444022+01:00","close_reason":"Implemented cloud-safe actor identity binding and documented OS boundary; all child tasks complete","labels":["area:security","component:auth","component:aweb","component:cloud"]}
{"id":"beadhub-1i1r.1","title":"SOT: clarify identity boundary (OS vs server) + proxy actor contract","description":"Update SOT to be explicit that:\n- Worktree stores only a non-secret pointer (.aw/context). Secrets live in ~/.config/aw/config.yaml.\n- If an attacker can read that file, they can impersonate the agent; this is an OS-level trust boundary.\n- Server-side must still enforce actor binding to prevent impersonation without the victim's API key.\n- In proxy-header mode, the wrapper must provide a signed actor identity (e.g., X-Aweb-Actor-ID + type/name) to the OSS core for endpoints that require actor attribution.","acceptance_criteria":"SOT documents direct-vs-proxy modes, lists required proxy actor headers, and states enforcement rules for endpoints that accept actor ids.","status":"closed","priority":0,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-24T17:53:28.066074+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T19:00:58.876664+01:00","closed_at":"2026-01-25T19:00:58.876664+01:00","close_reason":"Completed via SOT updates to security-patterns/integration docs","labels":["area:docs","area:security","component:auth","component:cloud"],"dependencies":[{"issue_id":"beadhub-1i1r.1","depends_on_id":"beadhub-1i1r","type":"parent-child","created_at":"2026-01-24T17:53:28.067254+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-1i1r.1.1","title":"Update SOT: identity storage (.aw/context pointer + global accounts)","description":"Ensure SOT is explicit about:\n- what is stored in worktrees vs global config\n- what is secret vs non-secret\n- recommended ignore strategy (.aw/)\n- how bdh and aw share the same account model","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-24T17:55:26.427524+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T18:40:06.449388+01:00","closed_at":"2026-01-24T18:40:06.449392+01:00","labels":["area:docs","area:security"],"dependencies":[{"issue_id":"beadhub-1i1r.1.1","depends_on_id":"beadhub-1i1r.1","type":"parent-child","created_at":"2026-01-24T17:55:26.428718+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-1i1r.1.2","title":"Update SOT: proxy-mode actor headers (required vs optional)","description":"Define the normative proxy contract:\n- exact header names (X-Project-ID, X-Aweb-Actor-ID, etc.)\n- which endpoints require actor identity\n- expected error semantics when actor headers are missing","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-24T17:55:36.75104+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T18:40:31.540604+01:00","closed_at":"2026-01-24T18:40:31.540605+01:00","labels":["area:docs","area:security","component:cloud"],"dependencies":[{"issue_id":"beadhub-1i1r.1.2","depends_on_id":"beadhub-1i1r.1","type":"parent-child","created_at":"2026-01-24T17:55:36.752304+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-1i1r.1.3","title":"Update SOT: explain server-side spoofing vs local OS impersonation","description":"Add a short section explaining:\n- why server must bind actor identity (spoofing without keys)\n- why local credential theft is out of scope (OS boundary)\n- recommended isolation patterns","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-24T17:55:47.066649+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T18:40:58.459945+01:00","closed_at":"2026-01-24T18:40:58.459946+01:00","labels":["area:docs","area:security"],"dependencies":[{"issue_id":"beadhub-1i1r.1.3","depends_on_id":"beadhub-1i1r.1","type":"parent-child","created_at":"2026-01-24T17:55:47.067729+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-1i1r.2","title":"beadhub-cloud: sign + inject actor identity into OSS core requests","description":"Extend internal auth context so the cloud wrapper can securely convey actor identity to the embedded OSS core.\n\nWork includes:\n- decide canonical internal fields (actor_id, actor_type, actor_name?)\n- include them in the signed X-BH-Auth payload\n- inject X-Aweb-Actor-* headers when proxying to /api\n- ensure backward compatibility is NOT required (clean slate), so version the internal signature format if needed.","acceptance_criteria":"All proxied requests have a verifiable project scope and (when applicable) an actor identity; tampering is rejected.","status":"closed","priority":0,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-24T17:53:38.470979+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T19:01:09.276546+01:00","closed_at":"2026-01-25T19:01:09.276546+01:00","close_reason":"Implemented signed actor identity injection/verification in Cloud wrapper","labels":["area:security","component:auth","component:beadhub-cloud"],"dependencies":[{"issue_id":"beadhub-1i1r.2","depends_on_id":"beadhub-1i1r","type":"parent-child","created_at":"2026-01-24T17:53:38.472019+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-1i1r.2.1","title":"Design internal auth v2: include signed actor identity","description":"Specify the signed payload format for X-BH-Auth (v2):\n- required: project_id\n- principal identity (existing)\n- actor identity fields (actor_id/type/name)\n- versioning strategy (clean slate OK)","status":"closed","priority":0,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-24T17:55:57.387623+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T18:34:12.638715+01:00","closed_at":"2026-01-24T18:34:12.638716+01:00","labels":["area:design","area:security","component:beadhub-cloud"],"dependencies":[{"issue_id":"beadhub-1i1r.2.1","depends_on_id":"beadhub-1i1r.2","type":"parent-child","created_at":"2026-01-24T17:55:57.38859+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-1i1r.2.2","title":"Implement auth_bridge: compute actor identity and inject X-Aweb-Actor-*","description":"Update beadhub-cloud middleware to:\n- derive actor identity for agent API-key principals\n- derive actor identity for dashboard (human/JWT) principals\n- inject X-Project-ID + X-Aweb-Actor-* to OSS core subapp","status":"closed","priority":0,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-24T17:56:07.73432+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T18:34:44.273475+01:00","closed_at":"2026-01-24T18:34:44.273477+01:00","labels":["area:security","component:beadhub-cloud"],"dependencies":[{"issue_id":"beadhub-1i1r.2.2","depends_on_id":"beadhub-1i1r.2","type":"parent-child","created_at":"2026-01-24T17:56:07.735388+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-1i1r.2.3","title":"Implement oss_auth: verify signed actor identity and expose to OSS core","description":"Update verification middleware to validate new signature format and propagate actor headers to the mounted OSS app.","status":"closed","priority":0,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-24T17:56:18.051943+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T18:37:12.39302+01:00","closed_at":"2026-01-24T18:37:12.393021+01:00","labels":["area:security","component:beadhub-cloud"],"dependencies":[{"issue_id":"beadhub-1i1r.2.3","depends_on_id":"beadhub-1i1r.2","type":"parent-child","created_at":"2026-01-24T17:56:18.052964+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-1i1r.3","title":"beadhub OSS core: enforce actor binding in proxy-header mode","description":"In proxy-header mode, enforce that endpoints needing actor attribution use the injected actor identity, and reject caller-supplied actor ids.\n\nExamples:\n- mail send: from_agent_id must match actor\n- chat: agent_id/from_agent_id must match actor\n- reservations: agent_id must match actor\n- beadhub endpoints that accept workspace_id as actor must match actor\n\nIf actor identity is missing for an endpoint that requires it, reject (401/403) rather than silently attributing to a project-only principal.","acceptance_criteria":"Cloud proxy-mode tests demonstrate you cannot spoof another agent within the same project via request body/query.","status":"closed","priority":0,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-24T17:53:48.850338+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T19:02:08.463797+01:00","closed_at":"2026-01-25T19:02:08.463797+01:00","close_reason":"Completed (actor binding enforced in aweb routes and beadhub workspace access)","labels":["area:security","component:auth","component:aweb"],"dependencies":[{"issue_id":"beadhub-1i1r.3","depends_on_id":"beadhub-1i1r","type":"parent-child","created_at":"2026-01-24T17:53:48.851449+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-1i1r.3","depends_on_id":"beadhub-1i1r","type":"blocks","created_at":"2026-01-24T17:53:48.85516+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-1i1r.3.1","title":"Core auth context: parse/validate proxy actor identity","description":"Extend core request identity resolver to surface actor_id in proxy-header mode (only when signature validates).","status":"closed","priority":0,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-24T17:56:28.372214+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T18:37:41.192552+01:00","closed_at":"2026-01-24T18:37:41.192553+01:00","labels":["area:security","component:auth"],"dependencies":[{"issue_id":"beadhub-1i1r.3.1","depends_on_id":"beadhub-1i1r.3","type":"parent-child","created_at":"2026-01-24T17:56:28.373403+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-1i1r.3.2","title":"Enforce actor binding for aweb routes in proxy-header mode","description":"For mail/chat/reservations (and any other actor-attributed writes), require proxy actor identity and reject mismatches.","acceptance_criteria":"Spoof attempts via from_agent_id/agent_id are rejected in proxy mode.","status":"closed","priority":0,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-24T17:56:38.689049+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T18:38:08.25214+01:00","closed_at":"2026-01-24T18:38:08.252141+01:00","labels":["area:security","component:aweb"],"dependencies":[{"issue_id":"beadhub-1i1r.3.2","depends_on_id":"beadhub-1i1r.3","type":"parent-child","created_at":"2026-01-24T17:56:38.690361+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-1i1r.3.3","title":"Enforce actor binding for beadhub routes in proxy-header mode","description":"For bead/workspace/escalation/policy writes that accept workspace_id, require proxy actor identity and reject mismatches.","acceptance_criteria":"Cloud-mode requests cannot perform actions as a different workspace_id.","status":"closed","priority":0,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-24T17:56:49.017923+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T18:38:39.490742+01:00","closed_at":"2026-01-24T18:38:39.490743+01:00","labels":["area:security","component:beadhub"],"dependencies":[{"issue_id":"beadhub-1i1r.3.3","depends_on_id":"beadhub-1i1r.3","type":"parent-child","created_at":"2026-01-24T17:56:49.019019+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-1i1r.4","title":"beadhub-cloud tests: demonstrate spoofing is blocked for aweb surfaces","description":"Add regression tests in beadhub-cloud that:\n- authenticate as one principal in a project\n- attempt to send mail/chat/reservations as a different agent_id in that same project\n- assert 403 (or equivalent) and that no rows/events are written.\n\nTests should cover both:\n- direct Bearer aw_sk_* forwarded through cloud\n- proxy-header (dashboard) mode with signed actor headers.","acceptance_criteria":"Test suite fails on the old behavior (spoof succeeds) and passes with actor-binding enforcement.","status":"closed","priority":0,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-24T17:53:59.185072+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T19:02:23.215475+01:00","closed_at":"2026-01-25T19:02:23.215475+01:00","close_reason":"Completed (cloud tests assert mail/chat/reservations spoofing rejected)","labels":["area:security","area:tests","component:aweb","component:beadhub-cloud"],"dependencies":[{"issue_id":"beadhub-1i1r.4","depends_on_id":"beadhub-1i1r","type":"parent-child","created_at":"2026-01-24T17:53:59.186104+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-1i1r.4","depends_on_id":"beadhub-1i1r","type":"blocks","created_at":"2026-01-24T17:53:59.190047+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-1i1r.4.1","title":"Add cloud test fixture: authenticated project + two agents","description":"Create a test fixture that can:\n- create a project\n- create two agent identities + keys\n- authenticate through the cloud wrapper","acceptance_criteria":"Reusable fixture for spoofing regression tests.","status":"closed","priority":0,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-24T17:56:59.329953+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T18:39:07.444813+01:00","closed_at":"2026-01-24T18:39:07.444815+01:00","labels":["area:tests","component:beadhub-cloud"],"dependencies":[{"issue_id":"beadhub-1i1r.4.1","depends_on_id":"beadhub-1i1r.4","type":"parent-child","created_at":"2026-01-24T17:56:59.331069+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-1i1r.4.2","title":"Cloud regression tests: mail/chat/reservations cannot spoof actor","description":"Implement the concrete regression tests using the fixture.","acceptance_criteria":"403 on spoof + no side effects.","status":"closed","priority":0,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-24T17:57:09.654889+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T23:18:55.262888+01:00","closed_at":"2026-01-24T23:18:55.262888+01:00","close_reason":"Implemented and ran beadhub-cloud regression tests; suite green (uv run pytest tests/test_auth_bridge_oss.py).","labels":["area:security","area:tests","component:beadhub-cloud"],"dependencies":[{"issue_id":"beadhub-1i1r.4.2","depends_on_id":"beadhub-1i1r.4","type":"parent-child","created_at":"2026-01-24T17:57:09.655937+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-1i1r.5","title":"Audit: remove/ignore actor ids from public request schemas where possible","description":"Inventory endpoints that currently accept workspace_id/agent_id/from_agent_id as request parameters.\n\nFor each endpoint:\n- If the id represents the caller/actor, remove it from the public schema or ignore client-supplied values.\n- If it represents a *target* (recipient), keep it but enforce same-project constraints.\n- Ensure Go/Python clients do not require the user to provide actor ids.","acceptance_criteria":"All actor-attributed writes derive actor identity server-side; clients no longer pass actor ids for 'self' operations.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-24T17:54:09.525381+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T21:14:47.809934+01:00","closed_at":"2026-01-25T21:14:47.809934+01:00","close_reason":"Actor identity now derived server-side for aweb; clients updated; cloud + oss tests green","labels":["area:security","component:api","component:aweb"]}
{"id":"beadhub-1i1r.5.1","title":"Inventory all endpoints that accept actor ids","description":"Ripgrep for workspace_id/agent_id/from_agent_id in request schemas and route params; classify each usage as actor vs target.","acceptance_criteria":"Checklist of endpoints + recommended change (remove/ignore/validate).","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-24T17:57:19.963453+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T21:12:14.31094+01:00","closed_at":"2026-01-25T21:12:14.31094+01:00","close_reason":"Completed endpoint inventory; changes implemented and tests green","labels":["area:refactor","area:security"],"dependencies":[{"issue_id":"beadhub-1i1r.5.1","depends_on_id":"beadhub-1i1r.5","type":"parent-child","created_at":"2026-01-24T17:57:19.964599+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-1i1r.5.2","title":"Update Go/Python clients to stop sending actor ids where not needed","description":"After server-side changes, ensure clients do not require actor ids for self-attributed actions.","acceptance_criteria":"CLI UX does not ask for workspace_id for self actions.","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-24T17:57:30.286383+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T21:12:27.508435+01:00","closed_at":"2026-01-25T21:12:27.508435+01:00","close_reason":"Updated aweb server + clients to derive actor identity; full test suites green","labels":["area:refactor","component:cli"],"dependencies":[{"issue_id":"beadhub-1i1r.5.2","depends_on_id":"beadhub-1i1r.5","type":"parent-child","created_at":"2026-01-24T17:57:30.287494+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-1i1r.6","title":"Ops hardening: document recommended OS isolation for untrusted agents","description":"Document recommended practices for running untrusted agents:\n- separate OS users / containers\n- keep ~/.config/aw/config.yaml mode 0600\n- avoid sharing home directories between agents\n\nGoal is to set expectations: the server prevents network/API spoofing, while local credential theft is an OS concern.","acceptance_criteria":"Docs clearly explain the local trust boundary and recommended isolation patterns.","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-24T17:54:19.841488+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T23:00:15.596156+01:00","closed_at":"2026-01-25T23:00:15.596156+01:00","close_reason":"Documented OS/container isolation boundary for untrusted agents; linked from integration doc","labels":["area:docs","area:security"]}
{"id":"beadhub-1i1r.6.1","title":"Doc: recommended OS isolation patterns for running many agents","description":"Write ops guidance for running multiple agents/worktrees safely (separate users/containers, file perms, etc.).","status":"closed","priority":2,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-24T17:57:40.597251+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T22:59:47.891202+01:00","closed_at":"2026-01-25T22:59:47.891202+01:00","close_reason":"Added OS isolation guidance and file-permission hardening to SOT","labels":["area:docs","area:security"],"dependencies":[{"issue_id":"beadhub-1i1r.6.1","depends_on_id":"beadhub-1i1r.6","type":"parent-child","created_at":"2026-01-24T17:57:40.598381+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-1ij4","title":"Add tests for incremental sync","description":"Comprehensive tests for incremental sync:\n\nServer-side (Python):\n- Test incremental sync with changed issues only\n- Test incremental sync with deletions\n- Test fallback to full sync\n- Test edge cases (empty sync, all new, all deleted)\n\nClient-side (Go):\n- Test hash computation determinism\n- Test sync state file handling\n- Test delta computation (added/modified/deleted)\n- Test full sync fallback\n\nFiles: tests/test_beads_sync.py, bdh/internal/sync/*_test.go","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T10:31:45.910433+01:00","updated_at":"2025-12-22T12:08:50.272249+01:00","closed_at":"2025-12-22T12:08:50.272249+01:00","close_reason":"Added TestIncrementalSync class with 7 tests: changed issues, deletions, combined changes/deletions, validation (requires data), sync_mode validation, full sync requires issues_jsonl, full sync returns stats. All Go tests already comprehensive (hash and state).","dependencies":[{"issue_id":"beadhub-1ij4","depends_on_id":"beadhub-9v3g","type":"blocks","created_at":"2025-12-22T10:34:52.400949+01:00","created_by":"juanre"},{"issue_id":"beadhub-1ij4","depends_on_id":"beadhub-sj9x","type":"blocks","created_at":"2025-12-22T10:38:12.6956+01:00","created_by":"juanre"},{"issue_id":"beadhub-1ij4","depends_on_id":"beadhub-fuql","type":"blocks","created_at":"2025-12-22T10:38:12.857993+01:00","created_by":"juanre"}]}
{"id":"beadhub-1lih","title":"Add Claims page with navigation","description":"Create ClaimsPage component showing active bead claims. Add Claims to sidebar navigation.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T12:15:53.597217+01:00","updated_at":"2025-12-13T12:16:07.558629+01:00","closed_at":"2025-12-13T12:16:07.558629+01:00"}
{"id":"beadhub-1mi","title":"Improve DatabaseInfra.get_manager() error messages","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-03T09:46:20.343548+01:00","updated_at":"2025-12-03T12:06:19.406942+01:00","closed_at":"2025-12-03T12:06:19.406942+01:00"}
{"id":"beadhub-1of2","title":"Add error logging for SSE message parse failures","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T14:55:38.134548+01:00","updated_at":"2026-01-09T19:16:00.246031+01:00","closed_at":"2026-01-09T19:16:00.246031+01:00","close_reason":"Added stderr logging for SSE errors: scanner failures, oversized events, and JSON parse failures in Go CLI"}
{"id":"beadhub-1og","title":"Add panic button CLI command","description":"beadhub panic --agent=X or --all to revoke all locks. Critical for human oversight when agents go off rails.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-02T22:19:55.987876+01:00","updated_at":"2025-12-02T22:24:30.31296+01:00","closed_at":"2025-12-02T22:24:30.31296+01:00","close_reason":"Added beadhub panic command with --agent and --force options"}
{"id":"beadhub-1ol7","title":"Client: Smart default wait - skip if all targets left","description":"In default mode (no --start-conversation, no --no-wait), check targets_left from server response.\n\nIf all targets are in targets_left:\n- Print \"All participants have left the conversation\"\n- Exit without waiting/connecting to SSE\n\nOtherwise:\n- Connect to SSE and wait normally (60s)\n\nThis prevents waiting for nothing when everyone has left, while still allowing --start-conversation to override.\n\nParent: beadhub-bwpi\nDepends on: beadhub-62gm (server must return targets_left)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T21:32:33.17277+01:00","updated_at":"2025-12-17T18:57:15.556761+01:00","closed_at":"2025-12-17T18:57:15.556761+01:00","close_reason":"Already implemented - tests exist in chat_test.go","dependencies":[{"issue_id":"beadhub-1ol7","depends_on_id":"beadhub-62gm","type":"blocks","created_at":"2025-12-16T21:32:55.893445+01:00","created_by":"juanre"}]}
{"id":"beadhub-1pua","title":"Improve error handling in chat session creation cleanup","description":"In chat.py create_session(), the Redis pair_key cleanup on Postgres failure could itself fail silently:\n\n```python\nexcept Exception as e:\n    await redis.delete(pair_key)  # This could fail!\n    logger.error(...)\n    raise HTTPException(...)\n```\n\nShould wrap cleanup in try/except and log failures separately to prevent silent failures that leave stale pair_key locks.\n\nDiscovered during code review of beadhub-xthe.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-13T21:14:41.761733+01:00","updated_at":"2025-12-13T21:14:41.761733+01:00"}
{"id":"beadhub-1rlh","title":"chat SSE: treat 'expired' sessions like ended in /stream","description":"src/beadhub/routes/chat.py stream_session() blocks status=='ended' but allows status=='expired' (set when initiator disconnects while waiting). Consider returning 410 for expired sessions too, and/or ensuring expired sessions can't be joined/streamed.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-13T15:36:54.862344+01:00","updated_at":"2025-12-13T16:15:02.460538+01:00","closed_at":"2025-12-13T16:15:02.460538+01:00","dependencies":[{"issue_id":"beadhub-1rlh","depends_on_id":"beadhub-xpr0","type":"discovered-from","created_at":"2025-12-13T15:36:54.863855+01:00","created_by":"juanre"}]}
{"id":"beadhub-1ten","title":"Improve bdh ready output: move personal info to end, show team focus","description":"Issues with current bdh ready output:\n\n1. Order: Personal info (INBOX, RECENT CONTEXT, TEAM STATUS) shows BEFORE bd output - should be AFTER so agents see ready issues first\n\n2. 'RECENT CONTEXT' is confusing - should be 'YOUR FOCUS' or 'WORKING ON'\n\n3. TEAM STATUS:\n   - Only shows agents with claims (onlyWithClaims=true)\n   - Should show agents active in last several hours\n   - Should show their focus apex (what epic they're working on), not just claims\n   - Currently shows nothing if agent has focus but no claims\n\nChanges needed in passthrough.go:\n- Move coordination context after bd output in formatPassthroughOutput\n- Rename RECENT CONTEXT to YOUR FOCUS\n- Set onlyWithClaims=false, filter client-side for has_focus OR has_claims\n- Add time-based filter (e.g., last 4-6 hours)\n- Display focus apex for team members","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T22:26:07.129741+01:00","updated_at":"2025-12-21T23:00:16.662801+01:00","closed_at":"2025-12-21T23:00:16.662801+01:00","close_reason":"Merged to main - ready output now shows personal info after issues list, renamed to YOUR FOCUS, team status shows focus apex"}
{"id":"beadhub-1thq","title":"Project and Repo Management","description":"# Overview\n\nBeadHub currently lacks proper project and repo management capabilities. Projects and repos can only be created implicitly via bdh :init, and there is no way to:\n- List projects\n- Delete projects\n- List repos in a project\n- Remove a repo from a project\n- See the project/repo/workspace hierarchy\n\nThis causes problems in OSS mode like the beadhub-cloud incident: running bdh :init without --project created a new project instead of adding the repo to the existing beadhub project.\n\n# Architecture Context\n\n## Two Flows: OSS vs Cloud\n\n**OSS Flow (self-hosted):**\n1. Run bdh :init against localhost or self-hosted server\n2. Prompted for project slug - can CREATE new projects\n3. Server creates project via /v1/projects/ensure\n4. Risk: Accidental new project creation\n\n**Cloud Flow (beadhub.cloud):**\n1. Create project in Cloud dashboard (or be invited)\n2. Create API key for that project\n3. Put BEADHUB_API_KEY in .env\n4. Run bdh :init - API key determines project\n5. NO risk of accidental project creation (API key is scoped)\n\n## Two Projects Tables (Same UUID)\n\n- OSS server.projects: Simple (id, tenant_id, slug, name)\n- Cloud beadhub_cloud.projects: Full (id, user_id, name, members, billing...)\n\nThe project_id UUID is SHARED - Cloud creates it, OSS uses it for tenant isolation.\n\n# Design Decisions\n\n## 1. Soft-delete for repos and workspaces\n\nWhen a repo is deleted:\n- Set deleted_at timestamp on repo\n- Cascade soft-delete all workspaces in that repo\n- Release all bead claims for those workspaces\n- Clear Redis presence\n\nRationale: Preserves history, allows recovery, maintains audit trail.\n\n## 2. No moving repos between projects\n\nImmutability principle applies to repo-to-project relationship.\nTo move a repo: delete from wrong project, re-register via bdh :init.\n\n## 3. Better bdh :init UX (OSS mode only)\n\nWhen repo not found in OSS mode, show existing projects:\n\n    $ bdh :init\n    Looking up repo github.com/org/repo...\n    Repo not found.\n\n    Existing projects:\n      [1] beadhub\n      [2] other-project\n      [n] Create new project\n\n    Select [1]: \n\nPrevents accidental new project creation in OSS mode.\n\n## 4. Full cascade from Cloud to OSS\n\nWhen Cloud project is deleted:\n- Cloud DELETE /api/v1/projects/{id}\n- Cascades to OSS DELETE /v1/projects/{id}\n- Which cascades: delete repos -\u003e soft-delete workspaces\n\n## 5. No admin features in OSS dashboard\n\nOSS dashboard is for monitoring/coordination only.\nUse CLI (bdh) or direct API for admin tasks.\nKeep dashboard simple and read-only.\n\n## 6. Cloud dashboard gets project/repo tree view\n\nProject detail page shows:\n- Project info\n- Repos (with workspace counts)\n- Drill-down to workspaces per repo\n- Delete actions for owner/admin\n\n# Permission Model\n\n| Operation | OSS (no auth) | Cloud Owner | Cloud Admin | Cloud Editor/Viewer |\n|-----------|---------------|-------------|-------------|---------------------|\n| List projects | Yes | Yes | Accessible only | Accessible only |\n| Delete project | Yes | Yes | No | No |\n| List repos | Yes | Yes | Yes | Yes |\n| Delete repo | Yes | Yes | Yes | No |\n\nOSS has no auth - everything allowed (single-tenant trust model).\nCloud enforces ownership: only owner can delete project, owner+admin can delete repos.\n\n# API Changes\n\n## OSS Endpoints (new)\n\nNo authorization - caller is trusted:\n\n    GET    /v1/projects              - List projects\n    GET    /v1/projects/{id}         - Get project details\n    DELETE /v1/projects/{id}         - Delete project (cascade)\n\n    GET    /v1/repos                 - List repos (filter by project_id)\n    GET    /v1/repos/{id}            - Get repo details\n    DELETE /v1/repos/{id}            - Soft-delete repo (cascade)\n\n## Cloud Endpoints (new)\n\nAuthorization before calling OSS:\n\n    GET    /api/v1/projects/{id}/repos      - List repos (any member)\n    DELETE /api/v1/projects/{id}/repos/{id} - Delete repo (owner/admin)\n\nCloud DELETE /api/v1/projects/{id} already exists - needs to cascade to OSS.\n\n# Database Changes\n\n## OSS Migration: repos table\n\n    ALTER TABLE repos ADD COLUMN deleted_at TIMESTAMPTZ;\n    CREATE INDEX idx_repos_deleted ON repos(deleted_at) WHERE deleted_at IS NULL;\n\n## Cascade Logic\n\n- repos FK to projects: ON DELETE CASCADE (hard delete repos when project deleted)\n- workspaces: App logic soft-deletes when repo deleted\n- All repo queries: Add WHERE deleted_at IS NULL\n\n# CLI Changes\n\n## bdh :init improvements (OSS mode)\n\n1. When repo not found, list existing projects\n2. Allow selection by number or slug\n3. Only create new project if explicitly chosen\n\nNote: In Cloud mode, project is determined by API key - no selection needed.\n\n# Dashboard Changes\n\n## OSS Dashboard\n\nNo changes. No admin features. Monitoring only.\n\n## Cloud Dashboard\n\nAdd to project detail page:\n- Repos tab with list of repos\n- Each repo shows: canonical_origin, name, workspace_count, created_at\n- Delete button (owner/admin only)\n- Confirmation: \"This will soft-delete N workspaces\"\n\nUI structure (tree view):\n    Project: beadhub\n    â”œâ”€â”€ Repos\n    â”‚   â”œâ”€â”€ github.com/org/beadhub (3 workspaces)\n    â”‚   â””â”€â”€ github.com/org/beadhub-cloud (1 workspace)\n    â””â”€â”€ Settings / Members / Billing\n\n# What happens to users on deletion\n\n## When repo is deleted\n1. Workspace soft-deleted, Redis presence cleared\n2. Next bdh command: \"Workspace deleted. Re-run bdh :init\"\n3. User runs bdh :init to re-register\n\n## When project is deleted\n1. All repos hard-deleted (CASCADE)\n2. All workspaces soft-deleted\n3. All .beadhub files become invalid\n4. Users must re-register (Cloud: need invite to new project)\n\n# Testing\n\nUse the beadhub-cloud mistake as test case:\n1. Implement delete endpoints\n2. Delete the beadhub-cloud project via API\n3. Re-run bdh :init --project beadhub in beadhub-cloud repo\n4. Verify repo now in correct project","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-21T15:24:32.709831+01:00","updated_at":"2025-12-21T19:28:32.821995+01:00","closed_at":"2025-12-21T19:28:32.821995+01:00","close_reason":"All OSS work complete. Cloud dashboard tracked as beadhub-cloud-6sl. Code review passed with minor race condition notes (response counts only, not correctness)."}
{"id":"beadhub-1tqa","title":"Server-backed project policy and role playbooks","description":"Problem\n- Repo-local instruction files (e.g., `AGENTS.md`) are shared and static, but agent behavior is often workspace-specific (coordinator vs implementer vs reviewer) and worktree checkouts are ephemeral.\n- Teams want consistent coordination norms (mail-first, no duplicate trackers, etc.) without per-role/per-tool docs that inevitably go stale.\n\nSolution\nIntroduce a server-backed \"Project Policy\" system with a workspace-local selector:\n- **Policy lives on the server** (per project) and is versioned.\n- **Workspace role lives in `.beadhub`** (`role:`) and selects which role playbook to display.\n\nPolicy bundle contents (v1)\n- Global invariants (apply to all workspaces)\n- Role playbooks (per role)\n- Optional tool adapters (e.g., snippets/templates to help users keep repo files minimal and avoid staleness)\n\nNon-goals (v1)\n- Hard enforcement (e.g., rejecting claims based on role). Start with guidance + discoverability.\n- Agent-runner lock-in; policy must be consumable outside Codex/Claude.\n\nDeliverables\n- SOT design/spec for the policy system and role playbooks.\n- Backend storage + API endpoints (read + admin write) with versioning + activation.\n- bdh CLI command(s) to view active policy and role playbook.\n- Dashboard UI to view/edit policy and role playbooks (admin).\n- Tests.\n","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-02T13:37:07.933412Z","created_by":"juanre","updated_at":"2026-01-02T18:19:19.734761Z","closed_at":"2026-01-02T18:19:19.734761Z","close_reason":"All child beads completed (policy backend+API, bdh :policy + cache, dashboard page, AGENTS dispatcher, tests)"}
{"id":"beadhub-1tqa.1","title":"Policy backend: store policy versions + active pointer","description":"Implement backend storage for server-backed Project Policy bundles.\n\nScope\n- Add Postgres migrations for versioned policy storage.\n- Add an â€œactive policyâ€ pointer on the project.\n- Ensure every project has an active policy (default bootstrap) so `bdh :policy` can always show something.\n\nData model (per SOT: ../beadhub-sot/source-of-truth/beadhub-project-policy.md)\n- New table: `project_policies`\n  - policy_id UUID PK\n  - project_id UUID FK (tenant boundary)\n  - version INT (monotonic per project)\n  - bundle_json JSONB (policy bundle)\n  - created_by_workspace_id UUID nullable\n  - created_at / updated_at\n- New field: `projects.active_policy_id` UUID nullable FK â†’ project_policies.policy_id\n\nBackend behavior\n- On project creation (or first policy read), create a default policy bundle if none exists and set it active.\n  - Default roles should include at least: `coordinator`, `implementer`, `reviewer`.\n  - Default invariants should include: â€œuse bdh for trackingâ€, â€œmail-firstâ€, â€œdonâ€™t impersonate other workspacesâ€.\n- Policy bundles MUST NOT contain secrets; treat content as visible to all project members.\n\nImplementation notes\n- Version allocation must be race-safe (transaction/locking).\n- Expose helpers that later endpoints can use:\n  - `get_active_policy(project_id)`\n  - `create_policy_version(project_id, base_policy_id, bundle, created_by)`\n  - `activate_policy(project_id, policy_id)`\n\nReferences\n- ../beadhub-sot/source-of-truth/beadhub-project-policy.md\n- ../beadhub-sot/source-of-truth/data-model.md\n","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-02T13:41:35.915559Z","created_by":"juanre","updated_at":"2026-01-02T17:16:25.693113Z","closed_at":"2026-01-02T17:16:25.693113Z","close_reason":"Implemented policy backend storage: migration, helper functions, default bootstrap, and tests","dependencies":[{"issue_id":"beadhub-1tqa.1","depends_on_id":"beadhub-1tqa","type":"parent-child","created_at":"2026-01-02T13:41:35.916289Z","created_by":"juanre"}]}
{"id":"beadhub-1tqa.2","title":"Policy API: GET /v1/policies/active","description":"Implement the policy read endpoint used by bdh and the dashboard.\n\nEndpoint\n- `GET /v1/policies/active`\n\nRequest / params\n- Project scoping must be derived from the existing auth model (OSS: project_id from headers/body; SaaS: project_id derived from API key).\n- Query params:\n  - `role` (optional): role key to select (bdh will default to `.beadhub.role`)\n  - `only_selected` (optional, default false): if true, return only invariants + selected role playbook\n\nResponse\n- Return the active policy bundle including:\n  - policy_id, project_id, version, updated_at\n  - invariants[] (id, title, body_md)\n  - roles{} (role -\u003e {title, playbook_md, ...})\n  - selected_role{} when role is provided\n  - adapters{} (optional)\n\nBehavior\n- If the project has no active policy, bootstrap a default policy (see beadhub-1tqa.1) and return it.\n- Validate that selected role exists; if not, return a clear 404/400 and include the list of available roles.\n\nCaching / transport\n- Include a stable cache validator:\n  - Either `ETag` derived from policy_id+updated_at (preferred), or `Last-Modified`.\n- Support conditional requests (`If-None-Match` / `If-Modified-Since`) for bdh polling.\n\nTests\n- Integration tests validating:\n  - Happy path (active policy returned)\n  - Bootstrap when none exists\n  - Role selection + only_selected behavior\n  - Conditional GET returns 304\n\nReferences\n- ../beadhub-sot/source-of-truth/beadhub-project-policy.md\n- ../beadhub-sot/source-of-truth/beadhub-specifications.md\n","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-02T13:42:16.571993Z","created_by":"juanre","updated_at":"2026-01-02T17:25:03.910006Z","closed_at":"2026-01-02T17:25:03.910006Z","close_reason":"Implemented GET /v1/policies/active with role selection, ETag/304 support, and 8 integration tests","dependencies":[{"issue_id":"beadhub-1tqa.2","depends_on_id":"beadhub-1tqa","type":"parent-child","created_at":"2026-01-02T13:42:16.572766Z","created_by":"juanre"},{"issue_id":"beadhub-1tqa.2","depends_on_id":"beadhub-1tqa.1","type":"blocks","created_at":"2026-01-02T13:42:16.575088Z","created_by":"juanre"}]}
{"id":"beadhub-1tqa.3","title":"Policy API: create + activate policy versions","description":"Implement admin endpoints for creating and activating policy versions.\n\nEndpoints (per SOT + specifications)\n- `POST /v1/policies` (admin)\n  - Creates a new policy version for a project.\n- `POST /v1/policies/{policy_id}/activate` (admin)\n  - Sets the projectâ€™s active_policy_id.\n\nBehavior\n- Create endpoint must:\n  - Validate bundle schema at least structurally (presence/shape of invariants + roles).\n  - Allocate the next `version` atomically.\n  - Record `created_by_workspace_id` (from request workspace identity) when available.\n- Activate endpoint must:\n  - Verify `policy_id` belongs to the project.\n  - Update `projects.active_policy_id`.\n\nAuth / permissions\n- Cloud: require project admin/owner.\n- OSS:\n  - If API key auth is enabled, require API key.\n  - If API key auth is disabled, still restrict policy writes to â€œhuman/adminâ€ mode (define a clear rule and test it).\n\nAuditability\n- Add an audit log entry for create + activate (if an audit system exists).\n\nTests\n- Integration tests for:\n  - Permission failures\n  - Creating a new version\n  - Activating it\n  - Project scoping / cross-project rejection\n\nReferences\n- ../beadhub-sot/source-of-truth/beadhub-project-policy.md\n- ../beadhub-sot/source-of-truth/beadhub-specifications.md\n","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-02T13:42:27.650232Z","created_by":"juanre","updated_at":"2026-01-02T17:29:28.109368Z","closed_at":"2026-01-02T17:29:28.109368Z","close_reason":"Implemented admin endpoints POST /v1/policies and POST /v1/policies/{id}/activate with API key gating, audit logging, and 7 integration tests","dependencies":[{"issue_id":"beadhub-1tqa.3","depends_on_id":"beadhub-1tqa","type":"parent-child","created_at":"2026-01-02T13:42:27.650928Z","created_by":"juanre"},{"issue_id":"beadhub-1tqa.3","depends_on_id":"beadhub-1tqa.1","type":"blocks","created_at":"2026-01-02T13:42:27.652708Z","created_by":"juanre"}]}
{"id":"beadhub-1tqa.4","title":"bdh CLI: add :policy command (fetch + display policy)","description":"Add a new bdh coordination command `:policy` that fetches and displays the projectâ€™s active policy and this workspaceâ€™s role playbook.\n\nCLI\n- `bdh :policy`\n- Flags:\n  - `--json` (structured output)\n  - `--role \u003crole\u003e` (preview another role)\n  - `--only-selected` (request only invariants + selected role playbook)\n  - `--format markdown|plain` (optional)\n\nBehavior\n- Load `.beadhub` config; derive role from `.beadhub.role` unless overridden by `--role`.\n- Call `GET /v1/policies/active` (role + only_selected params).\n- Print a human-friendly summary:\n  - policy version + updated_at\n  - role name\n  - invariants (titles + short bodies)\n  - selected role playbook body\n\nError handling\n- If role is unknown, show available roles.\n- If server is unreachable, exit non-zero (cache/offline fallback is handled in a separate bead).\n\nImplementation notes\n- Add a client method for the policy endpoint.\n- Keep output stable/deterministic for copy/paste and automation.\n\nReferences\n- ../beadhub-sot/source-of-truth/beadhub-project-policy.md\n- ../beadhub-sot/source-of-truth/beadhub-bdh-design.md\n","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-02T13:42:39.154688Z","created_by":"juanre","updated_at":"2026-01-02T17:13:37.733713Z","closed_at":"2026-01-02T17:13:37.733713Z","close_reason":"Implemented :policy command (client+output+tests)","dependencies":[{"issue_id":"beadhub-1tqa.4","depends_on_id":"beadhub-1tqa","type":"parent-child","created_at":"2026-01-02T13:42:39.160453Z","created_by":"juanre"},{"issue_id":"beadhub-1tqa.4","depends_on_id":"beadhub-1tqa.2","type":"blocks","created_at":"2026-01-02T13:42:39.169525Z","created_by":"juanre"}]}
{"id":"beadhub-1tqa.5","title":"bdh CLI: policy caching + offline fallback","description":"Add caching + offline fallback for `bdh :policy`.\n\nCache requirements\n- Cache policy bundle per workspace (workspace-local, gitignored), e.g. under `.beadhub-cache/`.\n- Cache key should include `policy_id` + `updated_at` (or ETag) to avoid ambiguity.\n- Default TTL ~60s (configurable later).\n\nBehavior\n- If server is reachable:\n  - Use conditional GET (If-None-Match/If-Modified-Since) when possible.\n  - Update cache on 200.\n- If server is unreachable:\n  - If cache exists, print cached policy with a clear â€œCACHEDâ€ / â€œSTALEâ€ banner including timestamp.\n  - If no cache exists, error out.\n\nSecurity\n- Cache contents are not secrets but must still be protected from accidental commit.\n  - Ensure cache directory is gitignored by default when created.\n\nTests\n- Unit tests for cache read/write.\n- CLI tests (mock server) for 304 behavior and offline fallback.\n\nReferences\n- ../beadhub-sot/source-of-truth/beadhub-project-policy.md (bdh client behavior)\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T13:42:50.502977Z","created_by":"juanre","updated_at":"2026-01-02T17:21:21.645966Z","closed_at":"2026-01-02T17:21:21.645966Z","close_reason":"Added workspace-local policy cache, conditional GET (ETag/304), offline fallback with CACHED/STALE banner, and tests","dependencies":[{"issue_id":"beadhub-1tqa.5","depends_on_id":"beadhub-1tqa","type":"parent-child","created_at":"2026-01-02T13:42:50.503645Z","created_by":"juanre"},{"issue_id":"beadhub-1tqa.5","depends_on_id":"beadhub-1tqa.4","type":"blocks","created_at":"2026-01-02T13:42:50.50548Z","created_by":"juanre"}]}
{"id":"beadhub-1tqa.6","title":"Dashboard: policy page (view/edit/activate role playbooks)","description":"Add a dashboard UI for Project Policy \u0026 role playbooks.\n\nScope\n- View active policy bundle:\n  - version, updated_at\n  - invariants list\n  - roles list (role key, title)\n- Edit policy (admin-only):\n  - Create a new draft version derived from active\n  - Edit invariants and role playbook markdown\n  - Save (POST /v1/policies)\n  - Activate (POST /v1/policies/{policy_id}/activate)\n- View policy history (basic): list recent versions with updated_at and who created it (if available).\n\nUX notes\n- Treat playbooks as markdown; render preview.\n- Make it hard to accidentally include secrets: include a warning banner in the editor.\n- Keep policy edits explicit and versioned; never â€œedit in placeâ€ of an active policy.\n\nPermissions\n- Non-admin users: read-only view.\n- Admins: edit/create/activate.\n\nTests\n- Frontend component tests as appropriate for this repo.\n- Minimal integration test for policy page load (if a pattern exists).\n\nReferences\n- ../beadhub-sot/source-of-truth/beadhub-project-policy.md\n","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-02T13:43:01.469802Z","created_by":"juanre","updated_at":"2026-01-02T18:14:21.222455Z","closed_at":"2026-01-02T18:14:21.222455Z","close_reason":"Implemented dashboard Policies page; merged to main as f4daa98","dependencies":[{"issue_id":"beadhub-1tqa.6","depends_on_id":"beadhub-1tqa","type":"parent-child","created_at":"2026-01-02T13:43:01.470424Z","created_by":"juanre"},{"issue_id":"beadhub-1tqa.6","depends_on_id":"beadhub-1tqa.2","type":"blocks","created_at":"2026-01-02T13:43:01.472152Z","created_by":"juanre"},{"issue_id":"beadhub-1tqa.6","depends_on_id":"beadhub-1tqa.3","type":"blocks","created_at":"2026-01-02T13:43:01.473282Z","created_by":"juanre"}]}
{"id":"beadhub-1tqa.7","title":"Tests: policy endpoints + bdh :policy","description":"Add coverage for the policy system across backend + bdh.\n\nBackend tests\n- Add integration tests (pytest) covering:\n  - GET /v1/policies/active (bootstrap, selection, conditional GET)\n  - POST /v1/policies and activation permissions\n  - Cross-project scoping\n\nbdh tests\n- Add Go tests (mock HTTP server) covering:\n  - :policy output formatting and ordering\n  - --role selection\n  - --json output shape\n  - offline behavior (if cache bead is implemented)\n\nNotes\n- Prefer deterministic ordering in all JSON and human output so tests are stable.\n\nReferences\n- ../beadhub-sot/source-of-truth/beadhub-project-policy.md\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T13:43:12.043768Z","created_by":"juanre","updated_at":"2026-01-02T17:48:00.834912Z","closed_at":"2026-01-02T17:48:00.834912Z","close_reason":"Policy endpoints + bdh :policy now have tests","dependencies":[{"issue_id":"beadhub-1tqa.7","depends_on_id":"beadhub-1tqa","type":"parent-child","created_at":"2026-01-02T13:43:12.044407Z","created_by":"juanre"},{"issue_id":"beadhub-1tqa.7","depends_on_id":"beadhub-1tqa.2","type":"blocks","created_at":"2026-01-02T13:43:12.046334Z","created_by":"juanre"},{"issue_id":"beadhub-1tqa.7","depends_on_id":"beadhub-1tqa.3","type":"blocks","created_at":"2026-01-02T13:43:12.047541Z","created_by":"juanre"},{"issue_id":"beadhub-1tqa.7","depends_on_id":"beadhub-1tqa.4","type":"blocks","created_at":"2026-01-02T13:43:12.048754Z","created_by":"juanre"}]}
{"id":"beadhub-1tqa.8","title":"Repo: make AGENTS.md a dispatcher to bdh :policy","description":"Update repo-level agent instructions to avoid stale role-specific guidance.\n\nProblem\n- Repo instruction files are shared + git-tracked; embedding role playbooks there becomes stale and conflicts with ephemeral worktrees.\n\nChange\n- Convert `AGENTS.md` (or equivalent agent instruction file) into a stable, minimal dispatcher that:\n  - States evergreen invariants (use bdh, mail-first, donâ€™t impersonate other workspaces, etc.)\n  - Instructs agents to run `bdh :status` to learn alias/role\n  - Instructs agents to run `bdh :policy` for role playbook and current project policy\n  - Avoids embedding role playbooks directly in the repo\n\nNotes\n- Keep the content tool-agnostic as much as possible.\n- If the repo needs tool-specific blocks, keep them minimal and refer to server policy.\n\nReferences\n- ../beadhub-sot/source-of-truth/beadhub-project-policy.md\n","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T13:43:25.473855Z","created_by":"juanre","updated_at":"2026-01-02T18:16:03.845344Z","closed_at":"2026-01-02T18:16:03.845344Z","close_reason":"Merged AGENTS dispatcher change to main as 89a81da","dependencies":[{"issue_id":"beadhub-1tqa.8","depends_on_id":"beadhub-1tqa","type":"parent-child","created_at":"2026-01-02T13:43:25.474545Z","created_by":"juanre"},{"issue_id":"beadhub-1tqa.8","depends_on_id":"beadhub-1tqa.4","type":"blocks","created_at":"2026-01-02T13:43:25.476555Z","created_by":"juanre"}]}
{"id":"beadhub-1tty","title":"Design: Storage model and identity mapping for file reservations","description":"Design the storage model and identity mapping strategy for file reservations.\n\n## Status: COMPLETE\n\nThis design task is complete. The sections below document the architectural decisions.\n\n## DEPENDENCY: Identity Resolution (beadhub-ki7v in beadhub-be) âœ…\n\nIdentity resolution is complete (confirmed by claude-be). Interface:\n```python\nfrom beadhub.agent_mail_compat import resolve_project, resolve_agent\n\nresolve_project(db, project_key, tenant_id=None) -\u003e project_id\nresolve_agent(db, project_id, agent_name) -\u003e ResolvedAgent(workspace_id, alias, created)\n```\n\n## ADR-001: Redis + Lua for Atomic Lock Operations\n\n**Decision:** Use Redis with Lua scripts for file lock management.\n\n**Context:** File reservations need atomic acquire/extend/release operations with TTL support. Multiple agents may attempt concurrent operations.\n\n**Rationale:**\n- Lua scripts execute atomically in Redis (no race conditions)\n- Redis EXPIRE provides automatic cleanup of abandoned locks\n- Single round-trip per operation (efficient)\n- Previous implementation (1abe435) proven to work\n\n**Alternatives considered:**\n- PostgreSQL advisory locks: Cross-process coordination complex\n- PostgreSQL row locks: Requires cleanup on process death\n- Distributed lock managers (etcd, Consul): Additional infrastructure\n\n**Scripts:**\n1. ACQUIRE_IF_FREE_SCRIPT - Only acquires if key doesn't exist\n2. EXTEND_IF_OWNED_SCRIPT - Only extends TTL if caller owns lock\n3. RELEASE_IF_OWNED_SCRIPT - Only releases if caller owns lock\n\n**TTL constraints:**\n- Minimum: 60 seconds (prevent churn)\n- Default: 300 seconds (5 minutes)\n- Maximum: 3600 seconds (1 hour, prevent indefinite holds)\n\n**Expiration behavior:**\n- Redis EXPIRE automatically deletes key after TTL\n- List endpoint returns only non-expired locks (Redis handles cleanup atomically)\n\n## ADR-002: Lock Key Schema\n\n**Decision:** Lock keys use pattern `lock:{project_id}:{path_hash}`\n\n**Key components:**\n- `lock:` - Namespace prefix (distinguishes from presence:, session:, etc.)\n- `{project_id}` - UUID, provides tenant isolation\n- `{path_hash}` - SHA256 of path, truncated to 16 hex chars (64 bits)\n\n**Why project_id not workspace_id?**\n- Locks must be visible across all workspaces in a project\n- Workspace A reserving src/foo.py must block Workspace B from same file\n- project_id is the isolation boundary for multi-agent coordination\n\n**Why hash the path?**\n- Consistent key length regardless of path length\n- Avoids Redis key issues with special characters in paths\n- 64-bit hash provides sufficient collision resistance for typical repos\n\n**Collision handling:**\n- Probability is low (~1 in 4 billion) for typical repos\n- Original path stored in lock value data\n- On acquire: if key exists, compare stored path to requested path\n- If paths differ (collision): append disambiguator to key (e.g., `lock:{project_id}:{path_hash}:2`)\n\n**Storage fields:**\n```\nlock_id: str          # Unique ID (lk_xxxx)\npath: str             # Canonical path or pattern (stored for collision detection)\nalias: str            # Holding agent alias\nworkspace_id: str     # Holding workspace\nproject_id: str       # Stored in BOTH key (scoping) and value (querying)\nbead_id: str | None   # Associated bead\nreason: str | None    # Why reserved\nexclusive: bool       # Exclusive vs shared\nacquired_at: str      # ISO timestamp\nexpires_at: str       # ISO timestamp\n```\n\n**Cloud vs OSS Mode:**\n| Mode  | project_id Source                        | project_key Behavior                   |\n|-------|------------------------------------------|----------------------------------------|\n| OSS   | resolve_project(project_key)             | Global project selector                |\n| Cloud | API key auth (tenant's project)         | Namespace within tenant (not for authz)|\n\n**Cloud mode security:**\n- project_id derived from API key authentication ONLY\n- project_key from Agent Mail clients is IGNORED for authorization\n- project_key may be used for display/logging purposes only\n- NEVER allow project_key to select arbitrary projects in Cloud mode\n\n## ADR-003: Glob Pattern Conflict Detection\n\n**Decision:** Lazy glob evaluation with fnmatch semantics.\n\n**Conflict rules:**\n1. **Exact match:** `src/foo.py` conflicts with `src/foo.py`\n2. **Glob match:** `src/*.py` conflicts with `src/foo.py` (pattern covers path)\n3. **Reverse glob:** `src/foo.py` conflicts with existing `src/*.py` (path covered by pattern)\n4. **Directory prefix:** `src/` conflicts with `src/foo.py` (implicit glob)\n\n**Directory handling:**\n- Path ending in `/` â†’ implicit `**` recursive glob\n- `src/` == `src/**` (matches all descendants)\n- `src` (no slash) â†’ exact file match only\n- Normalization: strip trailing slashes before hashing, store original for semantics\n\n**Glob expansion strategy (lazy):**\n- Store pattern in lock data (NOT expanded paths)\n- On conflict check: use fnmatch comparison, NOT filesystem enumeration\n- No filesystem walk required - pure string pattern matching\n- If pattern is pathological (e.g., `**`), reject with error (limit scope)\n\n**Glob semantics (fnmatch):**\n- `*` matches any characters except `/`\n- `**` matches any path segments (including `/`)\n- `?` matches single character\n- `[abc]` matches character class\n\n**Conflict response format:**\n```json\n{\n  \"path\": \"src/foo.py\",\n  \"held_by\": \"claude-be\",\n  \"workspace_id\": \"ws_789\",\n  \"bead_id\": \"beadhub-xyz\",\n  \"reason\": \"Fixing auth bug\",\n  \"exclusive\": true,\n  \"expires_at\": \"2025-12-16T20:05:00Z\"\n}\n```\n\n## Implementation Notes for beadhub-sgup\n\n1. Import identity resolution: `from beadhub.agent_mail_compat import resolve_project, resolve_agent`\n2. Extract project_id early in request handling (before lock operations)\n3. Pass project_id to _lock_key() function\n4. Keep existing Lua scripts unchanged - they're proven to work\n5. Store original path in value, hash in key (for collision detection)\n6. Use fnmatch for glob comparison, never enumerate filesystem\n\n## Deliverables Summary\n\nâœ… ADR-001: Redis + Lua confirmed (atomic operations, TTL, single round-trip)\nâœ… ADR-002: Key schema `lock:{project_id}:{path_hash}` (tenant isolation, collision handling)\nâœ… ADR-003: Glob conflict algorithm (fnmatch semantics, lazy evaluation, both directions)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-15T21:39:14.794486+01:00","updated_at":"2025-12-16T20:21:27.302533+01:00","closed_at":"2025-12-16T20:21:27.302533+01:00"}
{"id":"beadhub-1ui1","title":"IssuesPage: duplicate React keys when same bead_id exists across projects","description":"## Problem\n\nThe IssuesPage shows duplicate entries for each issue (3-4x per issue). Console shows React key collision errors:\n`Encountered two children with the same key`\n\n## Root Cause\n\n**Frontend (IssuesPage.tsx:242):**\n```tsx\n\u003cIssueCard key={\\`${issue.bead_id}-${issue.repo}\\`} ... /\u003e\n```\n\n**Backend (/v1/beads/issues/all):**\nReturns issues from ALL projects without deduplication. Same bead_id can exist in multiple projects (e.g., beadhub and beadhub-cloud both have beadhub-cloud-487).\n\n**Result:** When same bead exists in multiple projects with same repo name, the key `bead_id-repo` collides.\n\n## Fix Options\n\n1. **Frontend fix (recommended):** Include project_id in key:\n   ```tsx\n   key={\\`${issue.bead_id}-${issue.project_id}\\`}\n   ```\n\n2. **Backend fix:** Add DISTINCT or GROUP BY to deduplicate (but loses multi-project visibility)\n\n## Reproduction\n\n1. Have beads synced from multiple projects (beadhub + beadhub-cloud)  \n2. Navigate to http://localhost:5173/issues\n3. Observe duplicate entries and console errors\n\n## Files\n\n- frontend/src/pages/IssuesPage.tsx:242 (key generation)\n- src/beadhub/routes/beads.py:432 (beads_issues_all endpoint)","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-04T16:48:25.625376Z","created_by":"juanre","updated_at":"2026-01-04T17:04:11.718517Z","closed_at":"2026-01-04T17:04:11.718517Z","close_reason":"Fixed: key now uses project_id instead of repo"}
{"id":"beadhub-1uv","title":"rsync llmring-api to beadhub-cloud directory","description":"Copy llmring-api to ../beadhub-cloud excluding .git, .venv, node_modules, __pycache__. This gives us the multi-tenancy auth infrastructure as starting point.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-03T08:20:36.647045+01:00","updated_at":"2025-12-03T08:22:25.488189+01:00","closed_at":"2025-12-03T08:22:25.488189+01:00","close_reason":"rsync completed - 171 files copied to /Users/juanre/prj/beadhub-cloud","dependencies":[{"issue_id":"beadhub-1uv","depends_on_id":"beadhub-esm","type":"blocks","created_at":"2025-12-03T08:20:42.144356+01:00","created_by":"juanre"}]}
{"id":"beadhub-1vrz","title":"Fix SSE cleanup race condition with mounted ref","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T14:55:37.552715+01:00","updated_at":"2025-12-13T17:08:11.695906+01:00","closed_at":"2025-12-13T17:08:11.695906+01:00"}
{"id":"beadhub-1wf","title":"Fix lock expiry race: return explicit retry status when lock expires between conflict check and re-read","status":"closed","priority":3,"issue_type":"bug","created_at":"2025-12-06T21:34:30.222411+01:00","updated_at":"2025-12-08T09:46:24.709276+01:00","closed_at":"2025-12-08T09:46:24.709276+01:00"}
{"id":"beadhub-1wqx","title":"Simplify notification system: one fetch, one format, main.go handles all","description":"## Goal\n\nSimplify the notification system so that main.go is the single point responsible for printing notifications at the end of every bdh command.\n\n## Problem\n\nThe current system has accumulated complexity:\n- Passthrough commands handle notifications inline in formatPassthroughOutput\n- Colon commands use DeferServerNotifications/PrintDeferredServerNotifications pattern\n- Two different data sources (Command API, GetPendingChats)\n- Two different formatters (formatPassthroughNotifications, FormatServerNotifications)\n- ServerContextDisplayOptions with flags that are always true in practice\n- Gone workspace detection only runs on :status\n- InboxMessages fetched but only len() used\n\n## Solution\n\n1. main.go loads config and calls PrintNotifications() at the end of every command\n2. One FetchNotifications() that gets chats + mail + gone workspaces\n3. One FormatNotifications() that formats the output\n4. Commands do their work and output, notifications handled uniformly\n\n## Subtasks\n\n1. beadhub-bt5h: Create simple PrintNotifications entry point in main.go\n2. beadhub-mmox: Migrate passthrough to use main.go notifications\n3. beadhub-swnj: Migrate colon commands to use main.go notifications\n4. beadhub-cquk: Remove dead notification code\n\n## Result\n\n- Less code, less complexity\n- Consistent notification behavior across all commands\n- Gone workspace detection on every command\n- Single source of truth for notification logic","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-10T10:05:19.130142+01:00","created_by":"juanre","updated_at":"2026-01-10T10:55:24.108161+01:00","closed_at":"2026-01-10T10:55:24.108161+01:00","close_reason":"All subtasks complete: notifications now handled uniformly by main.go"}
{"id":"beadhub-21ha","title":"Clear form state when target workspace changes","description":"In the dashboard Workspaces page, the Send Message dialog keeps its form state (subject/body/error/success) even if the target workspace changes while the dialog remains open.\n\nThis is confusing because the user may click â€œMessageâ€ on another workspace and see the previous draft/error.\n\nFix:\n- When `targetWorkspaceId` changes while the dialog is open, reset the form state (subject/body/priority/error/success).\n- Keep the existing behavior of preserving draft while editing the same target.\n\nRelevant files:\n- `frontend/src/pages/WorkspacesPage.tsx`\n- `frontend/src/components/SendMessageDialog.tsx`\n","acceptance_criteria":"- Switching message target resets the form state while dialog stays open\n- Existing send flow and close behavior unchanged","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T20:35:32.225151+01:00","updated_at":"2026-01-04T17:13:06.327374Z","closed_at":"2026-01-04T17:13:06.327374Z","close_reason":"Added useEffect to reset form when targetWorkspaceId changes while dialog is open"}
{"id":"beadhub-21z4","title":"Backend: Remove current_bead from Redis presence","description":"Remove vestigial current_bead field from Redis presence.\n\nChanges to beadhub/src/beadhub/presence.py:\n1. Remove current_bead parameter from update_agent_presence()\n2. Remove current_bead from fields dict\n\nChanges to routes that call update_agent_presence:\n1. Remove current_bead argument from all call sites\n\nThis is a cleanup task - the field was never populated with real data.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T10:28:38.792532+01:00","updated_at":"2025-12-20T10:42:03.405165+01:00","closed_at":"2025-12-20T10:42:03.405165+01:00","close_reason":"Removed current_bead parameter from update_agent_presence() and fields dict. All 497 tests pass.","dependencies":[{"issue_id":"beadhub-21z4","depends_on_id":"beadhub-94uw","type":"parent-child","created_at":"2025-12-20T10:28:46.429162+01:00","created_by":"juanre"}]}
{"id":"beadhub-22c","title":"Change blocked_by from TEXT[] to JSONB in migration","description":"Edit beads/002_repo_id.sql to change blocked_by column from TEXT[] to JSONB. Each blocker is {repo, branch, bead_id} object. Update parent_id similarly if needed.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T08:15:33.04516+01:00","updated_at":"2025-12-07T08:16:28.757209+01:00","closed_at":"2025-12-07T08:16:28.757209+01:00","dependencies":[{"issue_id":"beadhub-22c","depends_on_id":"beadhub-vmx","type":"blocks","created_at":"2025-12-07T08:15:33.046235+01:00","created_by":"juanre"}]}
{"id":"beadhub-233p","title":"Replace Circle status icons with non-checkbox-like icons","description":"The empty Circle icon for open issues looks like an unchecked checkbox. Use a different icon (e.g., CircleDashed, Dot, or custom) that clearly indicates 'open' status.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T12:14:57.521943+01:00","updated_at":"2025-12-13T12:48:01.426759+01:00","closed_at":"2025-12-13T12:48:01.426759+01:00"}
{"id":"beadhub-2397","title":"Bug: sync endpoint creates spurious claims for in_progress beads","description":"When /v1/bdh/sync sees a status change to in_progress, it creates a claim for the syncing workspace - even if another workspace originally set that status.\n\n**Scenario:**\n1. Agent A runs `bdh update bd-42 --status in_progress` â†’ creates claim for A\n2. issues.jsonl is committed/shared via git\n3. Agent B syncs (e.g., after closing their own bead)\n4. Sync sees bd-42 going openâ†’in_progress in DB â†’ creates spurious claim for B\n5. `:who` now shows B working on bd-42 (wrong)\n\n**Root cause:** bdh.py lines 962-973 create claims on ANY status change to in_progress during sync.\n\n**Fix:** Remove claim creation from sync endpoint. Claims should only be created via /command endpoint which has intent verification. Sync should only update issue data, not manage claims.\n\n**Affected code:**\n- src/beadhub/routes/bdh.py: sync_issues() lines 962-973","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-16T22:34:03.397435+01:00","updated_at":"2025-12-16T22:35:47.372937+01:00","closed_at":"2025-12-16T22:35:47.372937+01:00"}
{"id":"beadhub-23wo","title":"Improve bdh output to be explicit that coordination info is for the agent","description":"## Problem\n\nAgents often interpret bdh output (ready, status, reservations) as information being displayed to the human user rather than actionable context for themselves. This causes agents to:\n\n- Ignore TEAM STATUS when claiming work (leading to conflicts)\n- Not check NOTIFICATIONS thinking they're for the human\n- Edit reserved files because they don't realize reservations apply to them\n\n## Solution\n\nReformat bdh output to make it explicit that coordination info is FOR the agent, using:\n\n### 1. Explicit section headers with agent identity\n\n```\n# Coordination Info for dave-coordinator (you, the agent)\n```\n\n### 2. Second person language throughout\n\nInstead of:\n```\nNOTIFICATIONS:\n  MAILS: 31 unread for dave-coordinator â€” Run \"bdh :mail --inbox\"\n```\n\nUse:\n```\n## Your Notifications\n- **MAIL**: You have 31 unread messages\n  â†’ Check now: `bdh :mail --inbox`\n```\n\n### 3. Explain WHY each section matters\n\n```\n## Team Status\nBefore claiming work, check what others are doing to avoid conflicts:\n- frank-implementer â€” working on beadhub-cloud-ohv\n```\n\n### 4. Make reservations imperative\n\n```\n## File Reservations\nThese files are locked by other agents. Do not edit them:\n- src/foo.py â€” reserved by eve-implementer\n```\n\n## Affected Commands\n\n- `bdh ready` - add coordination header, reformat notifications\n- `bdh :status` - same treatment\n- `bdh :reserve --list` - make it clear these apply to the agent\n- Any other command showing team/coordination info\n\n## Key Principles\n\n- Use \"you\" and \"your\" consistently\n- Use imperative language for actions (\"Check now\", \"Do not edit\")\n- Briefly explain the purpose of each section\n- Use markdown headers for clear structure","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-15T17:25:59.618771+01:00","created_by":"Juan Reyero","updated_at":"2026-01-15T17:44:40.041374+01:00","closed_at":"2026-01-15T17:44:40.041374+01:00","close_reason":"Implemented coordination header and second-person language for agent-facing output"}
{"id":"beadhub-2417","title":"No client-side validation of SSE event types","description":"Location: frontend/src/hooks/useSSE.ts:39-41. Hook accepts arbitrary eventTypes and passes to API without validation. Invalid types only caught by server, creating poor UX with cryptic errors. Fix: add client-side validation matching server's valid types: lock, message, escalation, bead.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-08T18:25:31.77576+01:00","updated_at":"2025-12-08T18:25:31.77576+01:00"}
{"id":"beadhub-257s","title":"Fix SSE cleanup race condition in ChatPage","description":"ChatPage.tsx SSE cleanup has race condition: mountedRef is set false before EventSource closes, allowing events to arrive in the gap. Close EventSource BEFORE setting mountedRef.current = false.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-14T21:49:20.691099+01:00","updated_at":"2025-12-14T21:50:57.570674+01:00","closed_at":"2025-12-14T21:50:57.570674+01:00"}
{"id":"beadhub-26gf","title":"UX: Issues page should show assignee/claimant on cards","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-13T21:26:08.484582+01:00","updated_at":"2025-12-13T23:19:13.453697+01:00","closed_at":"2025-12-13T23:19:13.453697+01:00"}
{"id":"beadhub-271","title":"Modify all routes to use validated project_id from middleware","description":"Update reservations, messages, escalations, agents, beads routes: read project_id from X-Project-ID header (injected by auth bridge), filter all queries by project_id. This replaces freeform project_key with validated tenant isolation.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-03T08:09:34.687996+01:00","updated_at":"2025-12-03T08:41:45.859894+01:00","closed_at":"2025-12-03T08:41:45.859894+01:00","close_reason":"Already exists from llmring-api template","dependencies":[{"issue_id":"beadhub-271","depends_on_id":"beadhub-0u8","type":"blocks","created_at":"2025-12-03T08:09:40.397011+01:00","created_by":"juanre"}]}
{"id":"beadhub-2bry","title":"Test claim verification - henry","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-05T12:30:59.86484Z","created_by":"juanre","updated_at":"2026-01-05T17:00:47.62667Z","closed_at":"2026-01-05T17:00:47.62667Z","close_reason":"Fixed: parse_status_change now detects --claim flag"}
{"id":"beadhub-2csz","title":"Migrate test_dashboard.py to db_infra fixture","description":"Convert from app_with_test_db to async tests using db_infra fixture.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-10T10:55:17.477668+01:00","created_by":"juanre","updated_at":"2026-01-10T12:58:24.931436+01:00","closed_at":"2026-01-10T12:58:24.931436+01:00","close_reason":"Migrated 14 tests to async db_infra + redis_client_async fixtures. All tests pass.","dependencies":[{"issue_id":"beadhub-2csz","depends_on_id":"beadhub-7wpr","type":"parent-child","created_at":"2026-01-10T10:55:50.329988+01:00","created_by":"juanre"}]}
{"id":"beadhub-2g2","title":"Fix race condition in reservation renewal","description":"**Problem**: When the same agent re-acquires a reservation, the code checks agent name and extends TTL in separate operations. Race between check and update can cause unexpected lock expiration.\n\n**File**: `routes/reservations.py:149-166`\n\n**Current code**:\n```python\nexisting_agent = existing.get(\"agent_name\")\nif existing_agent == payload.agent_name:\n    # Race window here!\n    expires_at = now + timedelta(seconds=ttl)\n    await run_in_threadpool(redis.hset, key, mapping={\"expires_at\": expires_iso})\n    await run_in_threadpool(redis.expire, key, ttl)\n```\n\n**Problem scenario**:\n1. Agent A checks if it owns the lock (it does)\n2. Lock expires between check and update\n3. Agent B acquires the lock\n4. Agent A's update overwrites Agent B's lock\n\n**Fix**: Use Redis transaction or Lua script to make check-and-extend atomic:\n```python\n# Lua script approach\nEXTEND_LOCK_SCRIPT = \"\"\"\nif redis.call('hget', KEYS[1], 'agent_name') == ARGV[1] then\n    redis.call('hset', KEYS[1], 'expires_at', ARGV[2])\n    redis.call('expire', KEYS[1], ARGV[3])\n    return 1\nend\nreturn 0\n\"\"\"\n```","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-02T19:45:38.967466+01:00","updated_at":"2025-12-02T21:45:14.476913+01:00","closed_at":"2025-12-02T21:45:14.476913+01:00","close_reason":"Added atomic Lua script EXTEND_IF_OWNED_SCRIPT for check-and-extend. Applied to both acquire and renew endpoints. Re-reads lock data on conflict for accurate info.","dependencies":[{"issue_id":"beadhub-2g2","depends_on_id":"beadhub-9i0","type":"blocks","created_at":"2025-12-02T19:45:38.968191+01:00","created_by":"juanre"}]}
{"id":"beadhub-2gn","title":"Add tests for concurrent lock acquisition, transaction rollback, auth edge cases","description":"Add targeted tests for correctness under concurrency and auth edge-cases.\n\nProposed test list (only add what we can reliably run):\n- Concurrent lock acquisition: two clients try to acquire same path; only one succeeds, other gets retry_after.\n- Transaction rollback: ensure partial failures don't leave inconsistent DB state (if applicable).\n- Auth edge cases: when BEADHUB_API_KEY is set, verify X-Project-ID is required where expected and project_slug selectors are rejected.\n\nDecision gate:\n- If these tests are flaky in CI, reduce scope to deterministic unit tests.","acceptance_criteria":"- New tests cover at least one concurrency scenario deterministically\n- New tests cover one auth edge case with BEADHUB_API_KEY enabled\n- No flaky tests introduced","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-03T15:39:16.485668+01:00","updated_at":"2026-01-03T16:43:02.861249Z"}
{"id":"beadhub-2ia2","title":"Add sync state storage for tracking last-synced hashes","description":"Store sync state in .beads/sync-state.json:\n\nFormat:\n{\n  \"last_sync\": \"2025-01-01T00:00:00Z\",\n  \"issue_hashes\": {\n    \"beadhub-abc1\": \"sha256...\",\n    \"beadhub-def2\": \"sha256...\"\n  }\n}\n\n- Load sync state on startup\n- Update after successful sync\n- Handle missing/corrupt state file (full sync fallback)\n\nFiles: bdh/internal/sync/","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T10:31:30.20801+01:00","updated_at":"2025-12-22T11:22:07.643635+01:00","closed_at":"2025-12-22T11:22:07.643635+01:00","close_reason":"Implemented sync state storage with load/save/update functions and comprehensive tests","dependencies":[{"issue_id":"beadhub-2ia2","depends_on_id":"beadhub-9v3g","type":"blocks","created_at":"2025-12-22T10:34:51.726296+01:00","created_by":"juanre"},{"issue_id":"beadhub-2ia2","depends_on_id":"beadhub-zs5n","type":"blocks","created_at":"2025-12-22T10:38:12.040427+01:00","created_by":"juanre"}]}
{"id":"beadhub-2jg","title":"Initialize fresh git repo in beadhub-cloud","description":"Remove .git directory from rsync copy and initialize fresh git repo. Create initial commit with template files.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-03T08:20:42.20613+01:00","updated_at":"2025-12-03T08:22:56.776645+01:00","closed_at":"2025-12-03T08:22:56.776645+01:00","close_reason":"Fresh git repo initialized in beadhub-cloud","dependencies":[{"issue_id":"beadhub-2jg","depends_on_id":"beadhub-1uv","type":"blocks","created_at":"2025-12-03T08:20:48.325368+01:00","created_by":"juanre"}]}
{"id":"beadhub-2jxb","title":"Frontend - Update Status Page for Claims","description":"Change Active Locks to Active Claims. Show claimed beads instead of locked files.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T17:56:46.011862+01:00","updated_at":"2025-12-12T18:31:11.835822+01:00","closed_at":"2025-12-12T18:31:11.835822+01:00","dependencies":[{"issue_id":"beadhub-2jxb","depends_on_id":"beadhub-bpyn","type":"blocks","created_at":"2025-12-12T17:57:22.389993+01:00","created_by":"juanre"},{"issue_id":"beadhub-2jxb","depends_on_id":"beadhub-lcrf","type":"blocks","created_at":"2025-12-12T17:57:22.464127+01:00","created_by":"juanre"}]}
{"id":"beadhub-2jy3","title":"Pre-existing test failure: test_sync_uses_repo_name_from_origin queries non-existent column","status":"closed","priority":2,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-01-16T10:52:22.975067+01:00","created_by":"Juan Reyero","updated_at":"2026-01-16T10:54:22.582126+01:00","closed_at":"2026-01-16T10:54:22.582126+01:00","close_reason":"Fixed. Test was using wrong column name 'repo_name' instead of 'repo'.","dependencies":[{"issue_id":"beadhub-2jy3","depends_on_id":"beadhub-oqag","type":"discovered-from","created_at":"2026-01-16T10:52:22.976195+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-2k6","title":"Document cloud beads sync setup for customers","description":"Update docs/agents-template.md and README with: 1) How to configure BeadHub Cloud beads sync, 2) bd-wrapper installation, 3) CI/CD integration example (GitHub Actions), 4) Environment variable reference. Include troubleshooting section.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T22:53:10.355734+01:00","updated_at":"2025-12-08T08:35:18.812142+01:00","closed_at":"2025-12-08T08:35:18.812142+01:00","dependencies":[{"issue_id":"beadhub-2k6","depends_on_id":"beadhub-11e","type":"blocks","created_at":"2025-12-06T22:54:28.399554+01:00","created_by":"juanre"}]}
{"id":"beadhub-2krs","title":"Implement gone workspace detection on bdh :status","description":"On bdh :status, fetch workspaces for current hostname, check if workspace_path exists for each. If path missing, call DELETE endpoint to mark as gone. Show summary of cleaned workspaces.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T19:07:01.443577+01:00","updated_at":"2025-12-21T21:40:25.171063+01:00","closed_at":"2025-12-21T21:40:25.171063+01:00","close_reason":"Implemented gone workspace detection on bdh :status","dependencies":[{"issue_id":"beadhub-2krs","depends_on_id":"beadhub-5wir","type":"parent-child","created_at":"2025-12-17T19:07:01.445156+01:00","created_by":"juanre"},{"issue_id":"beadhub-2krs","depends_on_id":"beadhub-5thx","type":"blocks","created_at":"2025-12-17T19:07:07.259046+01:00","created_by":"juanre"}]}
{"id":"beadhub-2mpt","title":"Missing transaction rollback on notification failures","description":"Location: src/beadhub/routes/beads.py:161-194. DB changes commit in transaction but notifications sent AFTER commit. If notifications fail partway, some subscribers notified, others not, but DB already committed. Creates inconsistent state. Fix: outbox pattern, notification queue with retry, or record attempts for retry.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-08T18:24:16.00148+01:00","updated_at":"2025-12-21T17:14:33.862515+01:00","closed_at":"2025-12-21T17:14:33.862515+01:00","close_reason":"Implemented outbox pattern for reliable notification delivery. Notifications are now recorded in a database table before being processed, enabling retry on failure and full visibility into what was sent/failed."}
{"id":"beadhub-2nq","title":"Write README.md with quickstart guide","description":"Document: what BeadHub is, quickstart (Docker Compose), CLI usage, MCP tool reference, link to SOT.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-02T22:19:45.800496+01:00","updated_at":"2025-12-02T22:25:19.340985+01:00","closed_at":"2025-12-02T22:25:19.340985+01:00","close_reason":"Added README.md with quickstart, CLI usage, MCP tools reference, and env vars"}
{"id":"beadhub-2owa","title":"mcp.py: _get_workspace_project_id missing deleted_at filter","description":"Line 91: _get_workspace_project_id queries workspaces without deleted_at IS NULL filter. Deleted workspaces can still use MCP tools.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-21T20:47:00.502552+01:00","updated_at":"2025-12-21T21:39:04.182656+01:00","closed_at":"2025-12-21T21:39:04.182656+01:00","close_reason":"Added deleted_at IS NULL filter to _get_workspace_project_id"}
{"id":"beadhub-2p6","title":"blocked_by silently ignores structured dict format","description":"**Problem**: When uploading beads issues with blocked_by as structured dicts like `[{\"repo\": \"my-project\", \"branch\": \"main\", \"bead_id\": \"bd-auth-001\"}]`, they are silently ignored. No warning, no error - the data is simply discarded.\n\n**Root cause**: In beads_sync.py:160-161, parse_blocked_by_array() checks `isinstance(item, str)` and silently continues if it's not a string.\n\n**Expected**: Either (1) accept structured dicts as valid input, or (2) log a warning/raise an error when receiving unexpected format.\n\n**Impact**: Users think their dependencies are saved but they're actually lost. Found during E2E testing when blocked_by dependencies weren't being respected in the ready endpoint.\n\n**Fix options**:\n1. Add support for structured dicts in parse_blocked_by_array()\n2. Add a warning log for non-string items\n3. Validate the input format at the API layer and return 422 for invalid formats","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-07T10:18:04.185315+01:00","updated_at":"2025-12-07T10:56:34.97552+01:00","closed_at":"2025-12-07T10:56:34.97552+01:00"}
{"id":"beadhub-2q2d","title":"Backend: accept hostname/cwd in /v1/bdh/command endpoint","description":"Add hostname and cwd fields to CommandRequest pydantic model.\n\nFile: src/beadhub/routes/bdh.py\n\nAdd to CommandRequest class:\n```python\nhostname: Optional[str] = Field(None, max_length=255, description=\"Machine hostname\")\ncwd: Optional[str] = Field(None, max_length=1024, description=\"Current working directory\")\n```\n\nThese fields are optional for backward compatibility with older bdh clients.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-13T21:09:53.300834+01:00","updated_at":"2025-12-13T21:09:53.300834+01:00","dependencies":[{"issue_id":"beadhub-2q2d","depends_on_id":"beadhub-o6hu","type":"blocks","created_at":"2025-12-13T21:10:02.731053+01:00","created_by":"juanre","metadata":"{}"}]}
{"id":"beadhub-2r09","title":"Fix test_bdh.py tests - need rewrite for new bdh design","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T10:00:24.534088+01:00","updated_at":"2026-01-03T18:38:39.198911Z","closed_at":"2026-01-03T18:38:39.198911Z","close_reason":"Obsolete: tests named test_bdh.py are no longer present; bdh behavior is covered by tests/test_bdh_command.py and Go integration tests.","dependencies":[{"issue_id":"beadhub-2r09","depends_on_id":"beadhub-6gfo","type":"discovered-from","created_at":"2025-12-10T10:00:24.535068+01:00","created_by":"juanre"}]}
{"id":"beadhub-2s14","title":"Track chat waiting state - distinguish 'agent waiting' vs 'messages available'","description":"Track SSE connections to know if sender is still waiting for reply.\n\nCurrent state: server only knows about --no-wait (sender_leaving=true). When sender times out or receives reply, SSE just closes silently.\n\nSolution:\n1. On SSE connect: SADD chat:waiting:{session_id} {workspace_id}\n2. On SSE disconnect: SREM chat:waiting:{session_id} {workspace_id}\n3. Pending endpoint checks SISMEMBER to return sender_waiting: bool\n4. bdh shows different notifications:\n   - WAITING: claude-be is waiting for you\n   - MESSAGES: 2 from claude-fe (not waiting)\n5. Add --read flag to view messages without engaging\n6. Deprecate inbox in favor of unified chat\n\nThis enables agents to prioritize responses appropriately.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-14T17:07:03.400843+01:00","updated_at":"2025-12-14T17:33:36.656735+01:00","closed_at":"2025-12-14T17:33:36.656735+01:00"}
{"id":"beadhub-2v8i","title":"aweb onboarding: alias auto-assignment + aw init parity with legacy bdh","description":"Goal: replicate the best parts of the original bdh :init UX (../beadhub-main) for the new aweb protocol + aw CLI.\n\nKey UX we want:\n- Server can allocate classic aliases (alice/bob/...) safely and atomically.\n- Client defaults are ergonomic: flags \u003e env \u003e dotenv \u003e TTY prompts \u003e defaults.\n- If a default alias collides, retry by asking the server to assign the next available.\n- On success, print copy/paste exports and optionally persist a profile.\n\nReference implementation to mirror:\n- ../beadhub-main/bdh/internal/commands/init.go\n- ../beadhub-main/src/beadhub/routes/init.py\n- ../beadhub-main/src/beadhub/routes/workspaces.py (/suggest-name-prefix)\n","acceptance_criteria":"- aweb  supports alias omitted with server allocation\n- aweb has a non-allocating alias-prefix suggestion endpoint\n-  supports TTY + non-TTY flows (no curl) and retries on alias collision\n- Minimal test coverage exists for allocator + suggestion + CLI request shapes","status":"closed","priority":1,"issue_type":"epic","owner":"juan@juanreyero.com","created_at":"2026-01-23T16:31:04.55275+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T22:51:24.385568+01:00","closed_at":"2026-01-23T22:51:24.385568+01:00","close_reason":"All onboarding tasks complete"}
{"id":"beadhub-2v8i.1","title":"aweb: /v1/init supports alias omission + classic alias allocator","description":"Implement the same alias allocation strategy that existed in beadhub-main's unified init:\n- Classic names list (alice/bob/charlie/...)\n- Numbered suffixes when base names are exhausted\n- Allocation is performed within a transaction and is concurrency-safe.\n\nScope: ../aweb server implementation (Python).\nReference: ../beadhub-main/src/beadhub/routes/init.py\n","acceptance_criteria":"- POST /v1/init accepts alias optional\n- When alias omitted, server allocates next free classic alias in-project (alice,bob,... then alice-01, etc) atomically\n- Allocation is safe under concurrency (unique constraint + retry)\n- Unit test covers allocator and race/uniqueness behavior","notes":"Implemented in ../aweb: /v1/init accepts missing alias and allocates classic aliases (alice/bob/... plus numbered). Added created flag and tests. Commit: ../aweb@187280b.","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-23T16:31:50.264157+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T19:23:26.664433+01:00","closed_at":"2026-01-23T19:23:00.117021+01:00","close_reason":"Alias auto-allocation implemented and tested in ../aweb","dependencies":[{"issue_id":"beadhub-2v8i.1","depends_on_id":"beadhub-2v8i","type":"parent-child","created_at":"2026-01-23T16:31:50.265274+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-2v8i.2","title":"aweb: add non-allocating alias-prefix suggestion endpoint","description":"Add an endpoint analogous to beadhub-main's /v1/workspaces/suggest-name-prefix, but for aweb projects.\n\nProposed shape (final choice up to implementation):\n- GET /v1/agents/suggest-alias-prefix?project_slug=...\nor\n- POST /v1/projects/suggest-alias-prefix {project_slug: ...}\n\nThe key property: it must NOT allocate anything; it only suggests.\n\nScope: ../aweb server implementation (Python).\nReference: ../beadhub-main/src/beadhub/routes/workspaces.py\n","acceptance_criteria":"- New endpoint returns next available alias prefix for a project without creating agents or keys\n- Uses same prefix extraction rules as legacy beadhub (alice vs alice-01)\n- Works without requiring an API key (OSS clean-start UX)\n- Has tests covering empty project and non-empty project","notes":"Implemented in ../aweb: added /v1/agents/suggest-alias-prefix (no auth, no allocation) using shared classic-prefix logic; added tests. Commit: ../aweb@610636a.","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-23T16:32:12.427119+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T19:30:55.972529+01:00","closed_at":"2026-01-23T19:30:55.972529+01:00","close_reason":"Suggestion endpoint implemented and tested in ../aweb","dependencies":[{"issue_id":"beadhub-2v8i.2","depends_on_id":"beadhub-2v8i","type":"parent-child","created_at":"2026-01-23T16:32:12.428238+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-2v8i.3","title":"aweb-go: aw init UX parity (flags/env/dotenv/TTY + collision retry)","description":"Update ../aweb-go so aw init matches the mature UX patterns from bdh :init:\n- Config priority: flags \u003e env \u003e dotenv \u003e TTY prompts \u003e defaults\n- Default human name from $USER\n- Suggested alias uses server suggestion endpoint if available, otherwise falls back to alice/role defaults\n- On alias collision: if alias was not explicitly chosen by the user, retry with alias omitted.\n\nReference: ../beadhub-main/bdh/internal/commands/init.go\n","acceptance_criteria":"- aw init can run with only AWEB_URL + project slug (alias optional)\n- In TTY mode, aw init prompts with a suggested alias and lets user override\n- If default alias collides, aw init retries by omitting alias (server allocates)\n- aw init prints copy/paste exports (AWEB_API_KEY, AWEB_AGENT_ID, etc)\n- Go tests cover request shapes and retry behavior (as feasible)","notes":"Implemented in ../aweb-go: aw init now loads dotenv, supports flags/env defaults, uses /v1/agents/suggest-alias-prefix, and retries /v1/init without alias when default suggestion already exists (created=false). Added CLI test. Commit: ../aweb-go@a996f9f.","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-23T16:32:29.364284+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T19:45:00.187845+01:00","closed_at":"2026-01-23T19:45:00.187845+01:00","close_reason":"aw init onboarding UX parity implemented","dependencies":[{"issue_id":"beadhub-2v8i.3","depends_on_id":"beadhub-2v8i","type":"parent-child","created_at":"2026-01-23T16:32:29.365459+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-2v8i.3","depends_on_id":"beadhub-2v8i.1","type":"blocks","created_at":"2026-01-23T16:33:19.724542+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-2v8i.3","depends_on_id":"beadhub-2v8i.2","type":"blocks","created_at":"2026-01-23T16:33:30.052123+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-2v8i.4","title":"beadhub: reuse aweb alias allocator/suggestion where applicable","description":"Ensure beadhub-oss (this repo) stays aligned with the improved aweb onboarding semantics:\n- It embeds the aweb protocol routers, so new aweb endpoints should be reachable from beadhub.\n- beadhub overrides /v1/init; it should either (a) call the shared allocator logic when it needs to auto-pick an alias, or (b) otherwise guarantee parity with aweb allocation rules.\n\nScope: this repo (beadhub).\n","acceptance_criteria":"- beadhub continues to embed aweb and expose the new suggestion endpoint\n- beadhub /v1/init behavior stays consistent with SOT, but uses shared allocator logic (no drift from aweb)\n- Tests cover that beadhub exposes the protocol endpoint and that allocation behavior matches","notes":"Implemented beadhub parity: added /v1/agents/suggest-alias-prefix; updated /v1/init to be aweb-protocol compatible (created_at, agent_id, created=agent_created, workspace_created added) and now allows alias omission for aweb-only onboarding. Tightened aweb import-surface enforcement and allowed aweb.alias_allocator. Updated bdh client/UX and tests; updated pyproject to install ../aweb as editable for dev.","status":"closed","priority":2,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-23T16:32:47.126072+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T20:41:27.193096+01:00","closed_at":"2026-01-23T20:41:27.193096+01:00","close_reason":"beadhub protocol parity for onboarding implemented","dependencies":[{"issue_id":"beadhub-2v8i.4","depends_on_id":"beadhub-2v8i","type":"parent-child","created_at":"2026-01-23T16:32:47.12719+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-2v8i.4","depends_on_id":"beadhub-2v8i.2","type":"blocks","created_at":"2026-01-23T16:34:01.052986+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-2v8i.4","depends_on_id":"beadhub-2v8i.1","type":"blocks","created_at":"2026-01-23T16:34:24.43324+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-2v8i.5","title":"Docs: aweb/aw onboarding (no curl)","description":"Update docs (likely in ../aweb-go/README.md and/or ../aweb/README.md) to reflect the intended onboarding flow:\n- Start server\n- Run aw init (no curl)\n- Use aw chat/mail\n\nReference: ../beadhub-main docs + bdh :init UX patterns.\n","acceptance_criteria":"- Docs show clean-start flow for running an aweb-compatible server and onboarding 2 agents using aw init\n- Docs mention alias auto-assignment and how to override\n- Docs show minimal commands to send chat/mail after init","notes":"Updated onboarding docs: ../aweb/README.md now documents aw init flow (no curl); ../aweb-go/README.md updated to reflect new aw init defaults + .env.aweb usage. Commits: ../aweb@4e634f6, ../aweb-go@0559e4b.","status":"closed","priority":2,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-23T16:33:04.09178+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T22:51:09.782776+01:00","closed_at":"2026-01-23T22:51:09.782776+01:00","close_reason":"Docs updated for aw init onboarding","dependencies":[{"issue_id":"beadhub-2v8i.5","depends_on_id":"beadhub-2v8i","type":"parent-child","created_at":"2026-01-23T16:33:04.092678+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-2v8i.5","depends_on_id":"beadhub-2v8i.3","type":"blocks","created_at":"2026-01-23T16:33:40.382308+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-2v8i.5","depends_on_id":"beadhub-2v8i.2","type":"blocks","created_at":"2026-01-23T16:33:50.717191+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-2w64","title":"Add chat message API and SSE streaming","description":"Implement message sending and real-time streaming:\n- POST /v1/chat/sessions/{id}/messages - Send message to session\n- GET /v1/chat/sessions/{id}/stream - SSE stream for real-time messages\n\nSSE events: joined, message, ended, timeout\n\nStore messages in Redis list: chat:messages:{session_id}\n\nPart of epic beadhub-dtcl","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T20:29:57.383107+01:00","updated_at":"2025-12-10T20:35:03.960665+01:00","closed_at":"2025-12-10T20:35:03.960665+01:00","dependencies":[{"issue_id":"beadhub-2w64","depends_on_id":"beadhub-r0d0","type":"blocks","created_at":"2025-12-10T20:30:43.598809+01:00","created_by":"juanre"}]}
{"id":"beadhub-2xfu","title":"Add user feedback on chat send failure","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T14:55:38.423185+01:00","updated_at":"2025-12-13T19:07:50.078927+01:00","closed_at":"2025-12-13T17:31:07.97341+01:00"}
{"id":"beadhub-2xp","title":"Documentation overhaul - make repo self-contained","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-03T20:51:42.035951+01:00","updated_at":"2025-12-06T21:43:25.569488+01:00","closed_at":"2025-12-06T21:43:25.569488+01:00","dependencies":[{"issue_id":"beadhub-2xp","depends_on_id":"beadhub-17q","type":"blocks","created_at":"2025-12-03T20:52:09.013205+01:00","created_by":"juanre"},{"issue_id":"beadhub-2xp","depends_on_id":"beadhub-714","type":"blocks","created_at":"2025-12-03T20:52:18.022928+01:00","created_by":"juanre"},{"issue_id":"beadhub-2xp","depends_on_id":"beadhub-jm3","type":"blocks","created_at":"2025-12-03T20:52:28.239247+01:00","created_by":"juanre"},{"issue_id":"beadhub-2xp","depends_on_id":"beadhub-9p3","type":"blocks","created_at":"2025-12-03T20:52:38.18279+01:00","created_by":"juanre"},{"issue_id":"beadhub-2xp","depends_on_id":"beadhub-0db","type":"blocks","created_at":"2025-12-03T20:52:46.513997+01:00","created_by":"juanre"},{"issue_id":"beadhub-2xp","depends_on_id":"beadhub-bga","type":"blocks","created_at":"2025-12-03T20:52:53.44693+01:00","created_by":"juanre"},{"issue_id":"beadhub-2xp","depends_on_id":"beadhub-b5j","type":"blocks","created_at":"2025-12-03T20:53:00.718288+01:00","created_by":"juanre"}]}
{"id":"beadhub-2yvp","title":"Fix cleanup goroutine lifecycle - add proper cancellation","description":"Cleanup runs as fire-and-forget goroutine in passthrough.go:295 without cancellation. Process can exit mid-cleanup leaving orphaned HTTP requests and database connections. Options: (1) Use context with cancellation and WaitGroup, (2) Move to dedicated background process, (3) Add graceful shutdown handling.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-17T08:01:36.676458+01:00","updated_at":"2025-12-17T18:57:57.240405+01:00","closed_at":"2025-12-17T18:57:57.240405+01:00","close_reason":"Won't fix: auto-cleanup feature removed - worktree-based detection doesn't work across machines","dependencies":[{"issue_id":"beadhub-2yvp","depends_on_id":"beadhub-lmtj","type":"discovered-from","created_at":"2025-12-17T08:01:36.677615+01:00","created_by":"juanre"}]}
{"id":"beadhub-31jy","title":"Cloud: avoid leaking user_id/api_key_id in actor aliases","description":"Replace Cloud deterministic actor aliases 'cowork-\u003cuser_id\u003e' and 'svc-\u003capi_key_id\u003e' with stable, non-reversible identifiers (e.g., HMAC(project_id, principal_id) truncated) so internal UUIDs are not exposed if aliases surface.","acceptance_criteria":"Cloud actor aliases no longer embed raw UUIDs; mapping remains stable per project; beadhub-cloud tests updated and green.","status":"closed","priority":2,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-26T18:48:14.856584+01:00","created_by":"Juan Reyero","updated_at":"2026-01-26T20:39:19.674341+01:00","closed_at":"2026-01-26T20:39:19.674341+01:00","close_reason":"Cloud actor aliases now use stable HMAC-based identifiers (no raw UUID leakage); tests updated and green","labels":["area:security","component:aweb","component:cloud"]}
{"id":"beadhub-31ue","title":"Chat UX: clarify one-shot request-reply model in docs and output","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-11T19:39:17.135041+01:00","updated_at":"2025-12-11T19:42:20.328146+01:00","closed_at":"2025-12-11T19:42:20.328146+01:00"}
{"id":"beadhub-321n","title":"UX: Chat conversation bubbles should show timestamps","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-13T21:26:17.741983+01:00","updated_at":"2025-12-13T23:32:05.489525+01:00","closed_at":"2025-12-13T23:32:05.489525+01:00"}
{"id":"beadhub-339","title":"Redis HGETALL/TTL race in reservation listings (reservations.py:331-341)","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-03T15:38:50.470669+01:00","updated_at":"2025-12-03T19:18:57.858295+01:00","closed_at":"2025-12-03T19:18:57.858295+01:00"}
{"id":"beadhub-36p","title":"Add API key management routes","description":"Routes for project owners to manage API keys: POST /api/v1/projects/{id}/api-keys (create), GET /api/v1/projects/{id}/api-keys (list with masked display), POST /api/v1/api-keys/{id}/revoke. Require JWT auth, verify project ownership.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-03T08:09:28.100008+01:00","updated_at":"2025-12-03T08:41:44.366247+01:00","closed_at":"2025-12-03T08:41:44.366247+01:00","close_reason":"Already exists from llmring-api template","dependencies":[{"issue_id":"beadhub-36p","depends_on_id":"beadhub-acd","type":"blocks","created_at":"2025-12-03T08:09:34.308598+01:00","created_by":"juanre"}]}
{"id":"beadhub-37yb","title":"Migrate mail/inbox from Redis to Postgres","description":"# Migrate Mail from Redis to Postgres\n\n## Problem\n\nMail (inbox messaging via `bdh :send`, `bdh :inbox`, `bdh :ack`) is currently stored in Redis with a 7-day TTL. This is wrong for two reasons:\n\n### 1. Data Loss (Transience)\n- Messages disappear after 7 days due to TTL\n- Mail is the **main communication channel**, not ephemeral coordination data\n- Should be permanent audit trail like chat messages\n\n### 2. Security (No Tenant Isolation) ðŸ”´\n- Current implementation has **zero project_id scoping**\n- Redis key is just `inbox:{workspace_id}` with no tenant boundary\n- Any agent who knows a workspace_id can send messages to that inbox\n- `from_workspace` is trusted from request, not validated server-side\n- **Compare with chat.py** which correctly:\n  - Derives project_id server-side via `_get_workspace_project_id()`\n  - Filters all queries by `WHERE s.project_id = $1`\n  - Validates sender/recipient are in same project\n\n## Source of Truth Inconsistencies\n\n**beadhub-architecture.md** is contradictory:\n- Lines 374-390: Says inbox is in Redis with 7-day TTL\n- Lines 799-801: Says 'all queries filtered by project_id' for data isolation\n- These cannot both be true for messages (Redis impl has no project_id)\n\n**data-model.md** (lines 245-254):\n- Documents Redis inbox with TTL - needs to move to Postgres section\n\n**beadhub-mail-vs-chat.md** (line 105):\n- Says 'stored in BeadHub's database' - ambiguous, should say Postgres explicitly\n\n## Current Implementation\n\n```\nFile: src/beadhub/routes/messages.py\nStorage: Redis hash `inbox:{workspace_id}`\nTTL: 7 days (INBOX_TTL_SECONDS = 7 * 24 * 3600)\nProject isolation: NONE âŒ\n```\n\n## Required Changes\n\n### 1. Database Schema (Postgres)\n\nCreate `server.messages` table with tenant isolation:\n```sql\nCREATE TABLE server.messages (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    project_id UUID NOT NULL REFERENCES server.projects(id),  -- TENANT ISOLATION\n    from_workspace_id UUID NOT NULL REFERENCES server.workspaces(workspace_id),\n    to_workspace_id UUID NOT NULL REFERENCES server.workspaces(workspace_id),\n    from_alias TEXT NOT NULL,\n    subject TEXT NOT NULL DEFAULT '',\n    body TEXT NOT NULL,\n    priority TEXT NOT NULL DEFAULT 'normal',\n    thread_id UUID,\n    read BOOLEAN NOT NULL DEFAULT false,\n    created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n    read_at TIMESTAMPTZ,\n    \n    -- Ensure sender and recipient are in same project\n    CONSTRAINT messages_same_project CHECK (true)  -- enforced via FK + app logic\n);\n\n-- Indexes for tenant-scoped queries\nCREATE INDEX idx_messages_inbox ON server.messages(project_id, to_workspace_id, read, created_at DESC);\nCREATE INDEX idx_messages_sent ON server.messages(project_id, from_workspace_id, created_at DESC);\n```\n\n### 2. Update routes/messages.py\n\n- Derive project_id server-side from workspace (like chat.py does)\n- Add `_get_workspace_project_id()` helper or reuse from chat\n- Validate sender workspace exists and get its project_id\n- Validate recipient workspace is in same project\n- All queries must filter by project_id\n- Remove Redis, use Postgres via pgdbm\n\n### 3. Source of Truth Updates\n\n**beadhub-architecture.md:**\n- Remove Redis inbox section (lines 374-390)\n- Add messages to Postgres section\n- Ensure data isolation claim (lines 799-801) is accurate\n\n**data-model.md:**\n- Remove Redis inbox section (lines 245-254)\n- Add messages table to Postgres schema\n\n**beadhub-mail-vs-chat.md:**\n- Line 105: Change to 'Messages are stored permanently in Postgres'\n\n## Security Model (Must Match Chat)\n\nFollow the pattern from chat.py:\n1. **Server-side project derivation**: Get project_id from workspace table, don't trust client\n2. **Same-project validation**: Sender and recipient must be in same project\n3. **All queries scoped**: WHERE project_id = $1 on all SELECTs\n4. **Audit trail**: Messages are permanent, not ephemeral\n","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-20T09:43:52.123068+01:00","updated_at":"2025-12-20T11:53:54.241512+01:00","closed_at":"2025-12-20T11:53:54.241512+01:00","close_reason":"Completed","dependencies":[{"issue_id":"beadhub-37yb","depends_on_id":"beadhub-8a5d","type":"blocks","created_at":"2025-12-20T09:44:21.625002+01:00","created_by":"juanre"},{"issue_id":"beadhub-37yb","depends_on_id":"beadhub-f0kk","type":"blocks","created_at":"2025-12-20T09:44:21.725243+01:00","created_by":"juanre"},{"issue_id":"beadhub-37yb","depends_on_id":"beadhub-jj00","type":"blocks","created_at":"2025-12-20T09:44:21.826344+01:00","created_by":"juanre"},{"issue_id":"beadhub-37yb","depends_on_id":"beadhub-d7c7","type":"blocks","created_at":"2025-12-20T09:44:21.928363+01:00","created_by":"juanre"},{"issue_id":"beadhub-37yb","depends_on_id":"beadhub-dcjm","type":"blocks","created_at":"2025-12-20T09:44:22.029951+01:00","created_by":"juanre"},{"issue_id":"beadhub-37yb","depends_on_id":"beadhub-inyh","type":"blocks","created_at":"2025-12-20T09:53:21.972101+01:00","created_by":"juanre"}]}
{"id":"beadhub-3840","title":"Update routes/messages.py: from_agent_name to from_alias","description":"Update src/beadhub/routes/messages.py for new data model.\n\nPydantic model changes:\n- SendMessageRequest: from_agent_name â†’ from_alias\n- InboxMessage: from_agent_name â†’ from_alias\n\nFunction changes:\n- _validate_agent_name_field() â†’ _validate_alias_field()\n- Message payload stored in Redis: from_agent_name â†’ from_alias\n\nEvent changes:\n- MessageDeliveredEvent: from_agent_name â†’ from_alias\n\nDepends on: events.py update","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T12:50:54.894411+01:00","updated_at":"2025-12-12T16:01:54.130189+01:00","closed_at":"2025-12-12T16:01:54.130189+01:00","dependencies":[{"issue_id":"beadhub-3840","depends_on_id":"beadhub-i8qj","type":"blocks","created_at":"2025-12-12T14:52:29.314883+01:00","created_by":"juanre"}]}
{"id":"beadhub-3a2k","title":"Migrate test_suggest_name_prefix.py to db_infra fixture","description":"Convert from app_with_test_db to async tests using db_infra fixture.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-10T10:54:59.194098+01:00","created_by":"juanre","updated_at":"2026-01-10T12:08:53.225581+01:00","closed_at":"2026-01-10T12:08:53.225581+01:00","close_reason":"Migrated test_suggest_name_prefix.py to async pattern. All 9 tests pass.","dependencies":[{"issue_id":"beadhub-3a2k","depends_on_id":"beadhub-7wpr","type":"parent-child","created_at":"2026-01-10T10:55:49.334038+01:00","created_by":"juanre"}]}
{"id":"beadhub-3cnc","title":"Group chat replies go to wrong session - recipients reply 1-1 instead of to group","description":"When sending a group chat (bdh :chat a]l,bob 'message'), the 3-way session is created correctly. But when recipients reply with 'bdh :chat alice \"reply\"', they create a new 2-party session instead of replying to the group.\n\nRoot cause: Recipients don't know they're in a group chat. The pending/inbox output only suggests replying to the sender, not to all participants.\n\nFix needed:\n1. Show ALL participants in pending output (not just last sender)\n2. Suggest reply command that includes all participants: 'bdh :chat alice,bob \"reply\"'\n3. Or add --reply-to-session flag to reply to the same session\n\nAlso found: formatPendingOutput has dead code - comment says 'Filter out self' but code doesn't filter.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-21T19:34:41.385616+01:00","updated_at":"2025-12-21T19:43:59.381759+01:00","closed_at":"2025-12-21T19:43:59.381759+01:00","close_reason":"Fixed group chat reply issue: formatPendingOutput now filters self and includes all other participants in reply suggestion"}
{"id":"beadhub-3dk8","title":"Dashboard: Design project/repo management UI","description":"Design and implement project/repo tree view in Cloud dashboard. Project detail page shows: Repos tab with list (canonical_origin, workspace_count, created_at), delete button for owner/admin with confirmation dialog. UI structure: Project -\u003e Repos -\u003e Workspaces drill-down. This is Cloud-only - OSS dashboard remains monitoring-only with no admin features.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T15:27:16.970356+01:00","updated_at":"2025-12-21T19:19:34.284695+01:00","closed_at":"2025-12-21T19:19:34.284695+01:00","close_reason":"Moved to beadhub-cloud as beadhub-cloud-6sl - this is Cloud dashboard work","dependencies":[{"issue_id":"beadhub-3dk8","depends_on_id":"beadhub-1thq","type":"blocks","created_at":"2025-12-21T15:27:41.366451+01:00","created_by":"juanre"},{"issue_id":"beadhub-3dk8","depends_on_id":"beadhub-ufw9","type":"blocks","created_at":"2025-12-21T15:58:36.531962+01:00","created_by":"juanre"}]}
{"id":"beadhub-3dvj","title":"Fix priority badge contrast in Issues page","description":"P0/P1 badges use text-destructive/text-warning on dark variant background, making text nearly invisible. Use outline variant with colored border instead.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T12:14:57.257707+01:00","updated_at":"2025-12-13T12:48:01.426099+01:00","closed_at":"2025-12-13T12:48:01.426099+01:00"}
{"id":"beadhub-3efj","title":"Update workspace_config.py and beads_sync.py validation","description":"Update Python config and validation files.\n\nworkspace_config.py:\n- WorkspaceConfig dataclass: agent_name â†’ alias\n- WorkspaceConfig dataclass: project_key â†’ project_slug (align with .beadhub file format)\n- Add repo_origin field\n- Update .beadhub file parsing to read alias (with agent_name fallback for migration)\n\nbeads_sync.py:\n- AGENT_NAME_PATTERN â†’ ALIAS_PATTERN\n- is_valid_agent_name() â†’ is_valid_alias()\n- Update pattern to: ^[a-zA-Z0-9][a-zA-Z0-9_-]{0,63}$\n\nAdd new validation pattern for human_name:\n- ^[a-zA-Z][a-zA-Z '-]{0,63}$ (allows apostrophes like O'Brien)\n\nDepends on: DB migrations complete","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T12:51:30.07559+01:00","updated_at":"2025-12-12T16:16:49.445892+01:00","closed_at":"2025-12-12T16:16:49.445892+01:00"}
{"id":"beadhub-3fot","title":"Fix state coupling between identity query and Zustand store","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T20:35:30.983371+01:00","updated_at":"2026-01-03T18:39:02.466836Z","closed_at":"2026-01-03T18:39:02.466836Z","close_reason":"No concrete repro/spec captured; current dashboard identity initialization is stable. Reopen with a specific failing scenario if it recurs."}
{"id":"beadhub-3gnq","title":"OSS dashboard: add /getting-started route + auto-redirect on empty DB","description":"## Context\nWeâ€™re preparing to publish the full `beadhub` repo OSS. A common first-run flow is:\n1) `docker compose up`\n2) open `http://localhost:8000`\n3) *then* run `bdh :init` from a repo checkout\n\nWe recently fixed the OSS-first-run confusion via a banner/empty-state (`beadhub-9po0`), but we want a **dedicated guide entry** thatâ€™s even clearer and can become the canonical first-run landing.\n\n## Problem\nOn a fresh OSS install (empty DB), the dashboard has no workspaces/projects yet. Users should see an explicit â€œwhat to do nextâ€ guide instead of landing on normal dashboard chrome with empty lists.\n\n## Goals\n- Make first-run OSS experience idiot-proof: a clear guided page that explains exactly what to run.\n- Auto-land new users on the guide when `workspaces.length === 0`.\n- Auto-return to the normal dashboard after a workspace is registered.\n- Keep changes **OSS-only** (do not affect Cloud frontend or Cloud routing).\n\n## Non-goals\n- Adding project/repo creation from the web UI.\n- Changing backend APIs.\n- Cloud onboarding changes (tracked separately).\n\n## Proposed UX\n### New route\n- Add an OSS-only route: `GET /getting-started` (SPA route, not a server route).\n\n### Auto-navigation rules\n- If `GET /v1/workspaces` succeeds and returns `0` workspaces:\n  - redirect to `/getting-started` (unless already there).\n- If `GET /v1/workspaces` succeeds and returns `\u003e0` workspaces:\n  - if currently at `/getting-started`, redirect to `/`.\n- If `GET /v1/workspaces` errors:\n  - do not redirect (avoid loops); show troubleshooting on the guide if user navigates there.\n\n### Page content (draft)\nTitle: â€œWelcome to BeadHubâ€\nSections:\n1) â€œStart the serverâ€ (brief, link to README)\n2) â€œRegister your first workspaceâ€ with a copyable snippet:\n   - `bdh :init`\n   - optional expanded example with flags\n3) â€œRefresh dashboardâ€ button\n4) Link to `docs/deployment.md` for security/trusted-network note\n\n## Implementation Outline\n- `frontend/src/pages/GettingStartedPage.tsx`: new page component.\n- `frontend/src/App.tsx`: add `\u003cRoute path=\"getting-started\" element={\u003cGettingStartedPage /\u003e} /\u003e`.\n- `frontend/src/components/Layout.tsx`:\n  - use `useNavigate()` + `useLocation()` to implement auto-redirect logic based on the existing `listWorkspaces()` query results.\n  - suppress/avoid duplicate global banner when on `/getting-started` (guide page becomes the primary UI).\n\n## Acceptance Criteria\n- Fresh DB (`docker compose down -v` then up) + opening `http://localhost:8000` lands on `/getting-started` automatically.\n- `/getting-started` shows a clear â€œrun `bdh :init`â€ instruction.\n- After running `bdh :init` in any repo and refreshing the browser, the app redirects to `/` automatically.\n- No redirect loops when API is unreachable.\n- `pnpm -C frontend build` and `pnpm -C frontend test:run` pass.\n- Cloud is unaffected (Cloud has its own frontend repo; shared package not modified).\n\n## Test Plan\nManual:\n1) `docker compose down -v \u0026\u0026 POSTGRES_PASSWORD=demo docker compose up -d`\n2) Visit `http://localhost:8000` â†’ should land on `/getting-started`.\n3) Run `bdh :init` in a repo checkout.\n4) Refresh â†’ should land on `/`.\n\nAutomated:\n- Add a small Vitest test that asserts the guide page renders the `bdh :init` snippet.\n\n## Notes\n- This is OSS-only; Cloud routing lives in `../beadhub-cloud/frontend`.\n- Related: `beadhub-9po0` (banner/empty-state improvements).\n","acceptance_criteria":"Fresh OSS install lands on /getting-started with clear steps; after first bdh :init it redirects to dashboard; no Cloud impact","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-17T11:11:36.453656+01:00","created_by":"Juan Reyero","updated_at":"2026-01-17T14:00:59.374661+01:00","closed_at":"2026-01-17T14:00:59.374661+01:00","close_reason":"Already implemented in commit ec576cb - getting-started page, auto-redirect, and empty-state handling all done","labels":["dashboard","onboarding","oss"]}
{"id":"beadhub-3hki","title":"Create chat_sessions and chat_messages tables migration","description":"Add Postgres tables for chat persistence","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T14:22:18.695538+01:00","updated_at":"2025-12-13T14:45:14.678915+01:00","closed_at":"2025-12-13T14:45:14.678915+01:00","dependencies":[{"issue_id":"beadhub-3hki","depends_on_id":"beadhub-n80a","type":"blocks","created_at":"2025-12-13T14:22:18.696522+01:00","created_by":"juanre"}]}
{"id":"beadhub-3k4","title":"Add projects and api_keys tables with migrations","description":"Create Postgres tables: projects (id, user_id, name, created_at), api_keys (id, project_id, key_hash, display_suffix, tier, is_active, created_at, last_used_at), project_members (project_id, user_id, role). Follow llmring pattern for key storage (SHA256 hash, never plaintext).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-03T08:09:07.919973+01:00","updated_at":"2025-12-03T08:41:45.48098+01:00","closed_at":"2025-12-03T08:41:45.48098+01:00","close_reason":"Already exists from llmring-api template","dependencies":[{"issue_id":"beadhub-3k4","depends_on_id":"beadhub-w9h","type":"blocks","created_at":"2025-12-03T08:09:14.716514+01:00","created_by":"juanre"},{"issue_id":"beadhub-3k4","depends_on_id":"beadhub-yzx","type":"blocks","created_at":"2025-12-03T08:10:02.0024+01:00","created_by":"juanre"}]}
{"id":"beadhub-3lbt","title":"Remove unnecessary redirect from create-worktree.sh","description":"Remove the .beads/redirect file creation from scripts/create-worktree.sh.\n\nThe redirect file is unnecessary because:\n1. bd has native worktree support via GetMainRepoRoot()\n2. bd automatically finds the main repo's .beads/ when in a worktree\n3. The redirect mechanism is for external beads repos, not worktree sharing","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-02T12:04:28.584621Z","created_by":"juanre","updated_at":"2026-01-02T12:14:22.100999Z","closed_at":"2026-01-02T12:14:22.100999Z","close_reason":"Removed redirect file creation from create-worktree.sh - not needed since both bd and bdh now have native worktree support.","dependencies":[{"issue_id":"beadhub-3lbt","depends_on_id":"beadhub-nkjm","type":"blocks","created_at":"2026-01-02T12:04:35.337254Z","created_by":"juanre"}]}
{"id":"beadhub-3lx","title":"Hardcoded member_email unknown@example.com in escalations.py:100","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-03T15:38:50.906675+01:00","updated_at":"2025-12-03T18:01:28.096282+01:00","closed_at":"2025-12-03T18:01:28.096282+01:00"}
{"id":"beadhub-3nz4","title":"Add reset-to-default policy button in dashboard","description":"Wire the new backend endpoint POST /v1/policies/reset into the Policies dashboard UI with a confirmation dialog, reuse existing admin gating/read-only mode behavior.","notes":"Added api.resetPolicyToDefault and a Reset-to-Defaults button + confirmation dialog on Policies page; disabled in read-only mode and reuses admin-forbidden detection.","status":"closed","priority":3,"issue_type":"task","assignee":"juanre","created_at":"2026-01-03T12:13:04.349434Z","created_by":"juanre","updated_at":"2026-01-03T12:13:26.936294Z","closed_at":"2026-01-03T12:13:26.936294Z","close_reason":"done"}
{"id":"beadhub-3p5","title":"Add Dockerfile for BeadHub API","description":"Multi-stage Dockerfile using uv for dependency management. Include health check endpoint.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-02T22:19:44.976549+01:00","updated_at":"2025-12-02T22:22:14.141832+01:00","closed_at":"2025-12-02T22:22:14.141832+01:00","close_reason":"Added multi-stage Dockerfile with non-root user, curl health check, and uv dependency management"}
{"id":"beadhub-3r30","title":"Improve bdh claim rejection and multi-agent coordination","description":"Improve how bdh handles claim conflicts and agent coordination. Currently bdh runs bd even when claims are rejected, and notifications are inconsistent. Goals: 1) Stop on rejection unless explicitly overridden 2) Enable coordinated multi-agent work on same bead 3) Consistent notification display across all commands.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-13T11:27:17.407301+01:00","updated_at":"2025-12-13T12:15:57.839233+01:00","closed_at":"2025-12-13T12:15:57.839233+01:00"}
{"id":"beadhub-3rwv","title":"Timestamp-based message IDs may cause issues","description":"Location: src/beadhub/routes/messages.py:138-140. Generates IDs from timestamps with float precision limits. Replace operation creates very long numeric strings. Could cause Redis key length limits, sorting issues, display problems. Fix: use UUIDs or proper ID generation (ULID, nanoid).","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-08T18:25:31.954242+01:00","updated_at":"2025-12-08T18:25:31.954242+01:00"}
{"id":"beadhub-3sa","title":"Move Phase 2 SaaS beads to beadhub-cloud repo","description":"Close or move the Phase 2 beads (beadhub-w9h epic and subtasks) from beadhub repo to beadhub-cloud repo. These are now handled by the llmring-api template code.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-03T08:21:27.155435+01:00","updated_at":"2025-12-03T08:43:27.024077+01:00","closed_at":"2025-12-03T08:43:27.024077+01:00","close_reason":"Initialized beads in beadhub-cloud repo","dependencies":[{"issue_id":"beadhub-3sa","depends_on_id":"beadhub-83t","type":"blocks","created_at":"2025-12-03T08:21:33.834995+01:00","created_by":"juanre"}]}
{"id":"beadhub-3sl6","title":"Squash and reconcile Postgres migrations (pre-release)","status":"closed","priority":2,"issue_type":"epic","assignee":"juanre","created_at":"2026-01-07T06:26:49.971403Z","created_by":"juanre","updated_at":"2026-01-09T19:22:54.594701+01:00","closed_at":"2026-01-09T19:22:54.594701+01:00","close_reason":"All 13 subtasks verified and closed. Migrations squashed to clean baselines (001_initial.sql), schema matches SOT concepts, DDL is idempotent","labels":["area:migrations","component:db","phase:pre-release"]}
{"id":"beadhub-3sl6.1","title":"Squash migrations into clean baselines (server + beads)","status":"closed","priority":2,"issue_type":"task","assignee":"juanre","created_at":"2026-01-07T06:27:50.574914Z","created_by":"juanre","updated_at":"2026-01-09T19:21:12.378185+01:00","closed_at":"2026-01-09T19:21:12.378185+01:00","close_reason":"Verified complete in squashed baseline (001_initial.sql)","labels":["area:migrations","component:db"],"dependencies":[{"issue_id":"beadhub-3sl6.1","depends_on_id":"beadhub-3sl6","type":"parent-child","created_at":"2026-01-08T20:14:49.972851+01:00","created_by":"juanre"}]}
{"id":"beadhub-3sl6.10","title":"Repos uniqueness/soft-delete semantics differ from SOT","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T06:28:13.778401Z","created_by":"juanre","updated_at":"2026-01-09T19:22:30.428063+01:00","closed_at":"2026-01-09T19:22:30.428063+01:00","close_reason":"Verified: repos schema matches SOT (UNIQUE on project_id+canonical_origin, soft-delete support)","labels":["area:migrations","component:db"],"dependencies":[{"issue_id":"beadhub-3sl6.10","depends_on_id":"beadhub-3sl6","type":"parent-child","created_at":"2026-01-08T20:14:53.103732+01:00","created_by":"juanre"}]}
{"id":"beadhub-3sl6.11","title":"Agent Mail compatibility tables: decide baseline + SOT coverage","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T06:28:13.944135Z","created_by":"juanre","updated_at":"2026-01-09T19:22:30.805728+01:00","closed_at":"2026-01-09T19:22:30.805728+01:00","close_reason":"Verified: agent_mail_projects/agents/messages/recipients tables present with correct schema","labels":["area:migrations","component:agent-mail","component:db"],"dependencies":[{"issue_id":"beadhub-3sl6.11","depends_on_id":"beadhub-3sl6","type":"parent-child","created_at":"2026-01-08T20:14:53.426419+01:00","created_by":"juanre"}]}
{"id":"beadhub-3sl6.12","title":"Baseline DDL hygiene: extensions, idempotency, and cross-schema dependencies","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T06:28:14.109837Z","created_by":"juanre","updated_at":"2026-01-09T19:22:31.183541+01:00","closed_at":"2026-01-09T19:22:31.183541+01:00","close_reason":"Verified: all DDL uses IF NOT EXISTS/IF EXISTS for idempotency, pgcrypto extension handled correctly","labels":["area:migrations","component:db"],"dependencies":[{"issue_id":"beadhub-3sl6.12","depends_on_id":"beadhub-3sl6","type":"parent-child","created_at":"2026-01-08T20:14:53.741281+01:00","created_by":"juanre"}]}
{"id":"beadhub-3sl6.13","title":"Project policies: schema supports created_by_workspace_id but API currently writes NULL","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T06:28:26.741983Z","created_by":"juanre","updated_at":"2026-01-09T19:21:12.387113+01:00","closed_at":"2026-01-09T19:21:12.387113+01:00","close_reason":"Verified complete in squashed baseline (001_initial.sql)","labels":["component:db","component:policies"],"dependencies":[{"issue_id":"beadhub-3sl6.13","depends_on_id":"beadhub-3sl6","type":"parent-child","created_at":"2026-01-08T20:14:54.065089+01:00","created_by":"juanre"}]}
{"id":"beadhub-3sl6.2","title":"Subscriptions schema is inconsistent with code and SOT (workspace_id vs project_slug/alias)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T06:27:50.739294Z","created_by":"juanre","updated_at":"2026-01-09T19:21:12.381012+01:00","closed_at":"2026-01-09T19:21:12.381012+01:00","close_reason":"Verified complete in squashed baseline (001_initial.sql)","labels":["area:migrations","component:db","component:notifications"],"dependencies":[{"issue_id":"beadhub-3sl6.2","depends_on_id":"beadhub-3sl6","type":"parent-child","created_at":"2026-01-08T20:14:50.313681+01:00","created_by":"juanre"}]}
{"id":"beadhub-3sl6.3","title":"Audit log schema does not match SOT tenant-scoping model","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T06:27:50.909097Z","created_by":"juanre","updated_at":"2026-01-09T19:21:12.383094+01:00","closed_at":"2026-01-09T19:21:12.383094+01:00","close_reason":"Verified complete in squashed baseline (001_initial.sql)","labels":["area:migrations","component:db","component:security"],"dependencies":[{"issue_id":"beadhub-3sl6.3","depends_on_id":"beadhub-3sl6","type":"parent-child","created_at":"2026-01-08T20:14:50.654771+01:00","created_by":"juanre"}]}
{"id":"beadhub-3sl6.4","title":"Escalations schema diverges from SOT and scoping expectations","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T06:27:51.0677Z","created_by":"juanre","updated_at":"2026-01-09T19:21:12.385145+01:00","closed_at":"2026-01-09T19:21:12.385145+01:00","close_reason":"Verified complete in squashed baseline (001_initial.sql)","labels":["area:migrations","component:db","component:security"],"dependencies":[{"issue_id":"beadhub-3sl6.4","depends_on_id":"beadhub-3sl6","type":"parent-child","created_at":"2026-01-08T20:14:50.99942+01:00","created_by":"juanre"}]}
{"id":"beadhub-3sl6.5","title":"beads.beads_issues uses repo_name text; SOT expects repo_id FK","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T06:27:51.238029Z","created_by":"juanre","updated_at":"2026-01-09T19:21:12.776315+01:00","closed_at":"2026-01-09T19:21:12.776315+01:00","close_reason":"By design: SOT explicitly says 'Keep repo_name (TEXT) as the repo identity for synced issues'","labels":["area:migrations","component:db"],"dependencies":[{"issue_id":"beadhub-3sl6.5","depends_on_id":"beadhub-3sl6","type":"parent-child","created_at":"2026-01-08T20:14:51.360677+01:00","created_by":"juanre"}]}
{"id":"beadhub-3sl6.6","title":"Chat persistence schema and SOT chat spec diverge (columns + naming)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T06:27:51.405596Z","created_by":"juanre","updated_at":"2026-01-09T18:53:03.098501+01:00","closed_at":"2026-01-09T18:53:03.098501+01:00","close_reason":"Schema matches SOT exactly. All four chat tables (chat_sessions, chat_session_participants, chat_messages, chat_read_receipts) align with beadhub-chat-spec.md lines 430-499.","labels":["area:migrations","component:chat","component:db"],"dependencies":[{"issue_id":"beadhub-3sl6.6","depends_on_id":"beadhub-3sl6","type":"parent-child","created_at":"2026-01-08T20:14:51.723213+01:00","created_by":"juanre"}]}
{"id":"beadhub-3sl6.7","title":"Workspaces schema/immutability rules diverge from SOT (hostname/path, repo_id, workspace_type)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T06:27:51.572337Z","created_by":"juanre","updated_at":"2026-01-09T19:22:29.669048+01:00","closed_at":"2026-01-09T19:22:29.669048+01:00","close_reason":"Verified: schema matches SOT including all fields and immutability trigger","labels":["area:migrations","component:db"],"dependencies":[{"issue_id":"beadhub-3sl6.7","depends_on_id":"beadhub-3sl6","type":"parent-child","created_at":"2026-01-08T20:14:52.063087+01:00","created_by":"juanre"}]}
{"id":"beadhub-3sl6.8","title":"Reset scripts and cross-schema FK ordering are inconsistent","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T06:27:51.735609Z","created_by":"juanre","updated_at":"2026-01-09T19:22:30.050637+01:00","closed_at":"2026-01-09T19:22:30.050637+01:00","close_reason":"Verified: no reset scripts needed; cross-schema FK ordering correct (server runs before beads in db.py)","labels":["area:tooling","component:db"],"dependencies":[{"issue_id":"beadhub-3sl6.8","depends_on_id":"beadhub-3sl6","type":"parent-child","created_at":"2026-01-08T20:14:52.403424+01:00","created_by":"juanre"}]}
{"id":"beadhub-3sl6.9","title":"Reconcile SOT DDL sections with actual schema (post-squash)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T06:27:51.904309Z","created_by":"juanre","updated_at":"2026-01-09T19:22:47.277995+01:00","closed_at":"2026-01-09T19:22:47.277995+01:00","close_reason":"Verified: SOT focuses on concepts not DDL; actual schema matches SOT design decisions; DDL correctly lives in migrations","labels":["area:docs","component:db"],"dependencies":[{"issue_id":"beadhub-3sl6.9","depends_on_id":"beadhub-3sl6","type":"parent-child","created_at":"2026-01-08T20:14:52.762071+01:00","created_by":"juanre"}]}
{"id":"beadhub-3t0s","title":"Test issue - delete me","status":"closed","priority":4,"issue_type":"task","created_at":"2025-12-22T12:48:28.664086+01:00","updated_at":"2025-12-22T12:48:35.929366+01:00","closed_at":"2025-12-22T12:48:35.929366+01:00","close_reason":"Test issue"}
{"id":"beadhub-3uyz","title":"Server: compute/store apex for each claim on write path (no recursive CTE on reads)","description":"Populate per-claim apex fields (from beadhub-7re8) when claims are created/updated so apex is not computed in `/v1/workspaces` via recursion.\n\nImplementation outline (Python server):\n1) Identify claim lifecycle points:\n   - Claim creation: `POST /v1/bdh/command` when approving `update \u003cid\u003e --status in_progress`.\n   - Claim release: close command (may not need apex update).\n2) On claim creation (and on `--:jump-in` secondary claims), compute apex:\n   - Use the current beadâ€™s `parent_id` chain in `beads.beads_issues` (bounded depth, e.g., 20).\n   - If bead not present in beads_issues yet, leave apex fields NULL and optionally backfill on the next `/v1/bdh/sync`.\n3) Store `apex_bead_id` (and repo/branch if chosen) on the `bead_claims` row.\n4) Add tests for:\n   - standalone bead (apex is itself)\n   - parent-child chain (apex is root)\n   - malformed/missing parent_id stops at current bead\n   - bead not in beads_issues (apex remains NULL until backfilled)\n\nPerformance goal:\n- Apex work happens once per claim mutation, not per `/v1/workspaces` call.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-20T13:55:33.948728+01:00","updated_at":"2025-12-20T14:54:38.065737+01:00","closed_at":"2025-12-20T14:54:38.065737+01:00","close_reason":"Store claim apex on write path and backfill after sync","dependencies":[{"issue_id":"beadhub-3uyz","depends_on_id":"beadhub-o9h7","type":"parent-child","created_at":"2025-12-20T13:55:33.950547+01:00","created_by":"juanre"},{"issue_id":"beadhub-3uyz","depends_on_id":"beadhub-bcdk","type":"blocks","created_at":"2025-12-20T13:55:33.951307+01:00","created_by":"juanre"},{"issue_id":"beadhub-3uyz","depends_on_id":"beadhub-7re8","type":"blocks","created_at":"2025-12-20T13:55:33.951769+01:00","created_by":"juanre"}]}
{"id":"beadhub-3ve","title":"Add logging for JSONL parsing errors in beads_sync","description":"**Problem**: JSON decode errors in beads_sync.py:42-49 are silently skipped. Corrupted JSONL files will lose records without any warning.\n\n**File**: beads_sync.py:42-49\n\n**Current code**:\n```python\ntry:\n    record = json.loads(line)\nexcept json.JSONDecodeError:\n    continue  # Silent failure\n```\n\n**Fix**: Log warning with line number:\n```python\nimport logging\nlogger = logging.getLogger(__name__)\n\nfor line_num, line in enumerate(f, 1):\n    try:\n        record = json.loads(line)\n    except json.JSONDecodeError as e:\n        logger.warning(f'Skipping malformed JSON at line {line_num}: {e}')\n        continue\n```","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-02T19:47:08.978416+01:00","updated_at":"2025-12-02T21:46:35.247812+01:00","closed_at":"2025-12-02T21:46:35.247812+01:00","close_reason":"Added logging for JSONL parsing errors with line numbers. Also logs records without 'id' field."}
{"id":"beadhub-3vrt","title":"Add presence check before initiating chat","description":"Before starting chat, check target agent presence. Warn if not recently active. Part of epic beadhub-dtcl","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T20:30:31.763215+01:00","updated_at":"2025-12-15T18:12:48.128232+01:00","closed_at":"2025-12-15T18:12:48.128232+01:00","dependencies":[{"issue_id":"beadhub-3vrt","depends_on_id":"beadhub-r0d0","type":"blocks","created_at":"2025-12-10T20:30:43.86232+01:00","created_by":"juanre"},{"issue_id":"beadhub-3vrt","depends_on_id":"beadhub-q7c5","type":"blocks","created_at":"2025-12-10T20:37:28.982208+01:00","created_by":"juanre"}]}
{"id":"beadhub-3wc0","title":"Update remaining Python routes: agents, escalations, subscriptions, status, workspaces, beads, mcp","description":"Update remaining Python route files for new data model.\n\nFiles to update:\n\n1. routes/agents.py: \n   - RegisterAgentRequest.name (keep as \"name\" for API compat?), AgentInfo.name\n   - project_key â†’ project_slug in any presence data access\n\n2. routes/escalations.py: \n   - CreateEscalationRequest.agent_name â†’ alias\n   - EscalationSummary/Detail.agent_name â†’ alias\n\n3. routes/subscriptions.py: \n   - SubscribeRequest.agent_name â†’ alias, project_key â†’ project_slug\n   - SubscribeResponse.agent_name â†’ alias, project_key â†’ project_slug\n\n4. routes/status.py: \n   - presence data access: agent_name â†’ alias, project_key â†’ project_slug\n\n5. routes/workspaces.py: \n   - WorkspacePresence.agent_name â†’ alias, project_key â†’ project_slug\n\n6. routes/beads.py: \n   - notification messages use alias instead of agent_name\n\n7. routes/mcp.py: \n   - all tool functions that use agent_name parameter â†’ alias\n   - project_key â†’ project_slug\n\n8. routes/reservations.py:\n   - project_key â†’ project_slug in lock metadata\n\nValidation changes in each file:\n- _validate_agent_name_field() â†’ _validate_alias_field()\n\nAlso rename project_key â†’ project_slug everywhere (it's the human-readable slug, not a key/UUID).\n\nThis is mostly mechanical renames across these files.\n\nDepends on: events.py update, presence.py update","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T12:51:20.400852+01:00","updated_at":"2025-12-12T16:14:41.076205+01:00","closed_at":"2025-12-12T16:14:41.076205+01:00","dependencies":[{"issue_id":"beadhub-3wc0","depends_on_id":"beadhub-i8qj","type":"blocks","created_at":"2025-12-12T12:51:29.832847+01:00","created_by":"juanre"},{"issue_id":"beadhub-3wc0","depends_on_id":"beadhub-47mi","type":"blocks","created_at":"2025-12-12T12:51:29.896564+01:00","created_by":"juanre"}]}
{"id":"beadhub-3xi","title":"Fix Pydantic V1 deprecation warnings","description":"**Problem**: Using deprecated Pydantic V1 syntax that will break in future versions.\n\n**File**: routes/reservations.py:24, 29, 41, 47\n\n**Warnings**:\n- `min_items` is deprecated, use `min_length`\n- `@validator` is deprecated, use `@field_validator`\n\n**Current code**:\n```python\npaths: List[str] = Field(..., min_items=1)\n\n@validator('paths')\ndef non_empty_paths(cls, v):\n    ...\n```\n\n**Fix**:\n```python\nfrom pydantic import field_validator\n\npaths: List[str] = Field(..., min_length=1)\n\n@field_validator('paths')\n@classmethod\ndef non_empty_paths(cls, v):\n    ...\n```","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-02T19:47:17.255169+01:00","updated_at":"2025-12-02T21:38:38.587423+01:00","closed_at":"2025-12-02T21:38:38.587423+01:00","close_reason":"Fixed Pydantic V1 deprecation warnings: min_itemsâ†’min_length, @validatorâ†’@field_validator with @classmethod"}
{"id":"beadhub-3z79","title":"Display hostname and directory in workspace cards","description":"Show hostname and working directory for each workspace in the dashboard. Directory should shorten home paths (/Users/[username]/ or /home/[username]/) to ~.\n\nCurrent state: These fields don't exist anywhere in the stack - needs end-to-end implementation from bdh CLI through backend to frontend.\n\nAcceptance criteria:\n- Workspace cards show hostname (e.g., 'MacBook-Pro.local')\n- Workspace cards show directory with shortened home path (e.g., '~/prj/beadhub')\n- Fields come from live presence data (online workspaces only)\n- Offline workspaces show no hostname/directory (data not persisted)","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-13T21:09:13.020471+01:00","updated_at":"2025-12-13T21:09:21.577025+01:00","dependencies":[{"issue_id":"beadhub-3z79","depends_on_id":"beadhub-o6hu","type":"blocks","created_at":"2025-12-13T21:10:08.826461+01:00","created_by":"juanre","metadata":"{}"},{"issue_id":"beadhub-3z79","depends_on_id":"beadhub-2q2d","type":"blocks","created_at":"2025-12-13T21:10:08.904496+01:00","created_by":"juanre","metadata":"{}"},{"issue_id":"beadhub-3z79","depends_on_id":"beadhub-dadn","type":"blocks","created_at":"2025-12-13T21:10:08.981111+01:00","created_by":"juanre","metadata":"{}"},{"issue_id":"beadhub-3z79","depends_on_id":"beadhub-qx14","type":"blocks","created_at":"2025-12-13T21:10:09.059314+01:00","created_by":"juanre","metadata":"{}"},{"issue_id":"beadhub-3z79","depends_on_id":"beadhub-ilzf","type":"blocks","created_at":"2025-12-13T21:10:09.136019+01:00","created_by":"juanre","metadata":"{}"},{"issue_id":"beadhub-3z79","depends_on_id":"beadhub-vf4x","type":"blocks","created_at":"2025-12-13T21:10:09.212347+01:00","created_by":"juanre","metadata":"{}"}]}
{"id":"beadhub-3zsl","title":"Duplicate aliases in to_aliases should be validated","description":"A user could send to_aliases: ['agent-1', 'agent-1'] and we'd try to insert the same participant twice. Add field_validator to reject duplicate aliases in the to_aliases list.","status":"open","priority":3,"issue_type":"bug","created_at":"2025-12-13T22:59:14.135059+01:00","updated_at":"2025-12-13T22:59:14.135059+01:00","dependencies":[{"issue_id":"beadhub-3zsl","depends_on_id":"beadhub-ixss","type":"discovered-from","created_at":"2025-12-13T22:59:14.135987+01:00","created_by":"juanre"}]}
{"id":"beadhub-415","title":"Create cloud beads query endpoints with tenant scoping","description":"Add GET /api/v1/cloud/repos/{repo}/beads/issues and /ready endpoints. Filter OSS queries by project-scoped repo_key prefix. Return only issues belonging to authenticated project.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T22:52:40.292341+01:00","updated_at":"2025-12-07T08:54:56.913829+01:00","closed_at":"2025-12-07T08:54:56.913829+01:00","dependencies":[{"issue_id":"beadhub-415","depends_on_id":"beadhub-zta","type":"blocks","created_at":"2025-12-06T22:54:28.241526+01:00","created_by":"juanre"},{"issue_id":"beadhub-415","depends_on_id":"beadhub-0q4","type":"blocks","created_at":"2025-12-06T22:54:28.293083+01:00","created_by":"juanre"}]}
{"id":"beadhub-41rc","title":"Migrate test_escalation_events.py to db_infra fixture","description":"Convert from app_with_test_db to async tests using db_infra fixture.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-10T10:55:08.700658+01:00","created_by":"juanre","updated_at":"2026-01-10T12:44:03.707847+01:00","closed_at":"2026-01-10T12:44:03.707847+01:00","close_reason":"Migrated test_escalation_events.py to async fixtures. 3 tests pass.","dependencies":[{"issue_id":"beadhub-41rc","depends_on_id":"beadhub-7wpr","type":"parent-child","created_at":"2026-01-10T10:55:49.962963+01:00","created_by":"juanre"}]}
{"id":"beadhub-428u","title":"TECH DEBT: Expand mypy to entire codebase","description":"## Problem\n\nType checking is only enabled for ONE file out of 30+ Python files.\n\n### Current Behavior\n\nIn `pyproject.toml:76`:\n```toml\n[tool.mypy]\nfiles = [\"src/beadhub/beads_sync.py\"]  # Only ONE file!\n```\n\nThis means:\n- 29/30 Python source files have no type checking\n- Type annotations exist but are not validated\n- Type errors silently pass CI\n\n### Impact\n\n- Type annotations may be incorrect (never validated)\n- Bugs that mypy would catch go unnoticed\n- False sense of security from having type hints\n- Inconsistent code quality\n\n### Solution\n\nExpand mypy to entire codebase:\n\n```toml\n[tool.mypy]\nfiles = [\"src\", \"tests\"]\npython_version = \"3.12\"\nstrict = false  # Start permissive, tighten later\nwarn_return_any = true\nwarn_unused_ignores = true\ndisallow_untyped_defs = false  # Enable gradually\n```\n\n### Migration Strategy\n\n1. First, run mypy on all files to see current errors:\n   ```bash\n   uv run mypy src tests\n   ```\n\n2. Fix or ignore critical errors\n\n3. Gradually enable stricter settings:\n   - `disallow_untyped_defs = true` (after adding missing annotations)\n   - `strict = true` (final goal)\n\n### Acceptance Criteria\n\n- [ ] mypy runs on all Python files in src/ and tests/\n- [ ] CI fails on type errors\n- [ ] Document any intentional `# type: ignore` comments\n- [ ] Create follow-up issue to enable strict mode","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-08T12:42:59.881754+01:00","created_by":"juanre","updated_at":"2026-01-09T19:47:24.873179+01:00","closed_at":"2026-01-09T19:47:24.873179+01:00","close_reason":"Expanded mypy to entire codebase. Fixed 34 type errors across 17 files. All 829 tests pass. Files: config.py, db.py, api.py, routes/*.py, tests/*.py, pyproject.toml"}
{"id":"beadhub-45k2","title":"Add file reservation commands: bdh :lock / :unlock","description":"Implement file reservation (locking) in bdh CLI. The MCP Agent Mail protocol supports this.\n\nCommands:\n- bdh :lock \u003cfile\u003e [--reason \"working on bd-42\"] [--ttl 300]\n- bdh :unlock \u003cfile\u003e\n- bdh :locks (list current locks)\n\nServer endpoints already exist:\n- POST /v1/reservations\n- DELETE /v1/reservations\n- GET /v1/reservations\n\nUse cases:\n- Prevent two agents from editing the same file\n- Auto-lock files when claiming a bead (future enhancement)\n- Show lock holder in rejection messages","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T18:23:23.394197+01:00","updated_at":"2025-12-15T21:38:31.843178+01:00","closed_at":"2025-12-15T21:38:31.843178+01:00","dependencies":[{"issue_id":"beadhub-45k2","depends_on_id":"beadhub-fei6","type":"blocks","created_at":"2025-12-15T18:23:29.193116+01:00","created_by":"juanre"}]}
{"id":"beadhub-45vh","title":"Inject bdh instructions into CLAUDE.md/AGENTS.md during :init","description":"## Summary\n\nDuring `bdh :init`, automatically inject minimal bdh instructions into CLAUDE.md and/or AGENTS.md to guide AI agents. The instructions should be kept short since `bdh :policy` now provides comprehensive guidance.\n\n## Background\n\n- Projects using beads (bd) have CLAUDE.md/AGENTS.md with bd instructions\n- When adopting bdh, agents need to know to use `bdh` instead of `bd`\n- The injection must be idempotent (don't duplicate if already present)\n- Both files might be symlinks to the same target (like in beadhub repo)\n\n## Detection Logic\n\n**Check for existing instructions:**\n\n1. Look for bdh instructions (already present):\n   - Markers: `bdh :status`, `bdh :policy`, `BeadHub`\n   - If found â†’ skip injection (idempotent)\n\n2. Look for bd instructions (need upgrade notice):\n   - Markers: `bd ready`, `bd create`, `bd prime`, `bd sync`\n   - If found â†’ inject with prominent \"use bdh instead of bd\" notice\n\n3. Neither present â†’ inject standard bdh instructions\n\n## File Handling\n\n1. Check for both CLAUDE.md and AGENTS.md in repo root\n2. For each file that exists:\n   - Resolve symlinks to get actual target path\n   - Track resolved paths to avoid writing same file twice\n3. For files that don't exist:\n   - Option: create them (configurable via flag?)\n   - Default: only modify existing files\n\n## Content to Inject\n\n**Standard injection (no bd instructions):**\n```markdown\n## BeadHub Coordination\n\nThis project uses `bdh` for multi-agent coordination and issue tracking.\n\n**Start every session:**\n```bash\nbdh :status    # your identity + team status\nbdh :inbox     # check mail\nbdh :policy    # invariants + your role playbook\nbdh ready      # find unblocked work\n```\n\n**Key rules:**\n- Use `bdh` (not `bd`) so work is coordinated\n- Default to mail (`bdh :send`); use chat (`bdh :chat`) when blocked\n- Respond immediately to WAITING notifications\n```\n\n**Upgrade injection (when bd instructions exist):**\nPrepend with:\n```markdown\n\u003e **IMPORTANT**: This project has migrated to `bdh` (BeadHub). Always use `bdh` commands instead of `bd`. The `bdh` wrapper coordinates work across agents and syncs with the BeadHub server.\n```\n\n## Implementation Details\n\n**Location:** `bdh/internal/commands/init.go` (extend existing :init command)\n\n**New function:** `injectAgentInstructions(repoRoot string) error`\n\n**Steps:**\n1. Find CLAUDE.md and AGENTS.md in repo root\n2. For each file:\n   a. Resolve symlink if applicable\n   b. Read content\n   c. Check for existing bdh markers â†’ skip if found\n   d. Check for existing bd markers â†’ set upgradeMode=true\n   e. Inject appropriate content\n3. Track resolved paths to avoid duplicate writes\n4. Report what was modified\n\n**Edge cases:**\n- Symlink to same file: only write once\n- Read-only file: warn and skip\n- File doesn't exist: skip (or create if --create-agent-docs flag)\n- Binary/non-text file: skip with warning\n\n## Markers for Detection\n\n**bdh present (skip):**\n- `bdh :status`\n- `bdh :policy`\n- `bdh :inbox`\n- `BeadHub` (case-insensitive)\n\n**bd present (upgrade mode):**\n- `bd ready`\n- `bd create`\n- `bd prime`\n- `bd sync`\n- `bd close`\n- Regex: `\\bbd\\s+(ready|create|prime|sync|close|update)\\b`\n\n## Output\n\n```\n$ bdh :init\n...existing output...\n\nAgent instructions:\n  âœ“ Injected bdh instructions into CLAUDE.md\n  âœ“ Injected bdh instructions into AGENTS.md (upgrade notice added)\n  - Skipped COPILOT.md (bdh instructions already present)\n```\n\n## Testing\n\n1. Test with no CLAUDE.md/AGENTS.md â†’ no injection, no error\n2. Test with empty CLAUDE.md â†’ inject standard\n3. Test with bd instructions â†’ inject with upgrade notice\n4. Test with bdh instructions â†’ skip (idempotent)\n5. Test with symlinks to same file â†’ only one write\n6. Test with read-only file â†’ skip with warning","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-08T21:06:21.464839+01:00","created_by":"juanre","updated_at":"2026-01-08T21:11:44.785767+01:00","closed_at":"2026-01-08T21:11:44.785767+01:00","close_reason":"Implemented in commit 741db42"}
{"id":"beadhub-47mi","title":"Update presence.py: rename fields, add repo_id, implement secondary indexes","description":"Update src/beadhub/presence.py for new data model.\n\nField renames in Redis hash:\n- agent_name â†’ alias\n- project_key â†’ project_slug  (was incorrectly named, should match .beadhub file)\n\nAdd new fields:\n- repo_id (UUID string)\n\nImplement secondary indexes (per beadhub-8qqk, data-model.md):\n- idx:project_workspaces:{project_id} - Set of workspace_ids\n- idx:repo_workspaces:{repo_id} - Set of workspace_ids  \n- idx:branch_workspaces:{repo_id}:{branch} - Set of workspace_ids\n\nUpdate when presence is set/cleared:\n- On update_agent_presence: SADD to relevant indexes\n- On TTL expiry: use keyspace notifications or lazy cleanup\n- On explicit clear: SREM from indexes\n\nUpdate query functions:\n- get_workspace_ids_by_project_key â†’ get_workspace_ids_by_project_slug\n- Add get_workspace_ids_by_repo_id\n- Add get_workspace_ids_by_branch\n\nIMPORTANT: This task closes beadhub-8qqk (O(all workspaces) lookup issue).\nWhen completing this bead, also close beadhub-8qqk.\n\nDepends on: all DB migrations complete","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T12:50:27.173316+01:00","updated_at":"2025-12-12T15:55:52.961173+01:00","closed_at":"2025-12-12T15:55:52.961173+01:00","dependencies":[{"issue_id":"beadhub-47mi","depends_on_id":"beadhub-wvj6","type":"blocks","created_at":"2025-12-12T12:50:38.901888+01:00","created_by":"juanre"}]}
{"id":"beadhub-47xz","title":"Inconsistent naming: project_id vs project_key","description":"Location: multiple files, esp subscriptions.py:115-119. Codebase uses both project_id (UUID) and project_key (human-readable) inconsistently. DB column project_key actually stores workspace_id values. Very confusing and error-prone. Fix: rename DB column to match actual purpose or refactor for consistent naming.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-08T18:26:00.528188+01:00","updated_at":"2025-12-10T12:27:28.6322+01:00","closed_at":"2025-12-10T12:27:28.6322+01:00"}
{"id":"beadhub-4ae7","title":"bdh create crashes with SIGSEGV in bd/create.go:325","description":"Reported by frank-agent. bdh create command crashes when trying to create a bead. Stack trace shows SIGSEGV in bd/create.go line 325. Need to investigate null pointer or invalid memory access.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-22T12:47:04.692377+01:00","updated_at":"2025-12-22T12:48:35.651974+01:00","closed_at":"2025-12-22T12:48:35.651974+01:00","close_reason":"Not a bug - crash was due to corrupted .beads/issues.jsonl in Frank's worktree"}
{"id":"beadhub-4alq","title":"Add worktree count limit to prevent DoS in auto-cleanup","description":"getWorktreePaths() in passthrough.go has no limit on worktrees scanned. Repos with many worktrees (1000+) would slow every bdh command. Fix: Add max worktree limit (e.g., 50) and skip cleanup if exceeded.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-17T08:01:36.967211+01:00","updated_at":"2025-12-17T18:57:57.2412+01:00","closed_at":"2025-12-17T18:57:57.2412+01:00","close_reason":"Won't fix: auto-cleanup feature removed - worktree-based detection doesn't work across machines","dependencies":[{"issue_id":"beadhub-4alq","depends_on_id":"beadhub-lmtj","type":"discovered-from","created_at":"2025-12-17T08:01:36.968386+01:00","created_by":"juanre"}]}
{"id":"beadhub-4b31","title":"Unify proxy auth header: use X-BH-Auth only","description":"Remove X-AW-Auth support from aweb proxy-header auth. Standardize on X-BH-Auth across beadhub-oss, aweb-oss, beadhub-cloud, and future aweb-cloud to avoid header precedence/poisoning issues. Update docs/tests and strip X-AW-Auth in cloud middleware for hygiene.","acceptance_criteria":"aweb proxy-header mode accepts only X-BH-Auth; tests green across aweb/beadhub/beadhub-cloud; SOT updated to reference single header name.","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-26T16:49:41.112093+01:00","created_by":"Juan Reyero","updated_at":"2026-01-26T17:01:52.479347+01:00","closed_at":"2026-01-26T17:01:52.479347+01:00","close_reason":"Standardized proxy-header auth to X-BH-Auth only; removed X-AW-Auth support; tests green","labels":["area:security","component:aweb","component:cloud"]}
{"id":"beadhub-4bc4","title":"Update all repo queries to filter deleted_at IS NULL","description":"Audit and update all queries touching repos table to exclude soft-deleted repos. Includes routes/repos.py, routes/workspaces.py, and any joins.\n\nIMPORTANT: Also update ON CONFLICT queries in ensure_repo (routes/repos.py:268, routes/bdh.py:116) to clear deleted_at when upserting, so that re-registering a soft-deleted repo undeletes it instead of failing.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T15:25:36.101748+01:00","updated_at":"2025-12-21T16:25:07.905283+01:00","closed_at":"2025-12-21T16:25:07.905283+01:00","close_reason":"Updated all repo queries to filter deleted_at IS NULL. ON CONFLICT queries now clear deleted_at to support re-registering soft-deleted repos.","dependencies":[{"issue_id":"beadhub-4bc4","depends_on_id":"beadhub-1thq","type":"blocks","created_at":"2025-12-21T15:26:55.223881+01:00","created_by":"juanre"},{"issue_id":"beadhub-4bc4","depends_on_id":"beadhub-9w1n","type":"blocks","created_at":"2025-12-21T15:27:04.38104+01:00","created_by":"juanre"}]}
{"id":"beadhub-4exs","title":"Improve pagination on GET /v1/messages with cursor support","description":"Update messages.py pagination:\n\nCurrent: Has limit + has_more, but no cursor\nTarget:\n- Add cursor query param for stable pagination\n- Keep limit param (default 50, max 200)  \n- Return {items: [...], has_more: bool, next_cursor: str}\n- Order by created_at DESC\n\nUse the pagination helper module.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T10:30:56.537288+01:00","updated_at":"2025-12-22T12:16:30.335271+01:00","closed_at":"2025-12-22T12:16:30.335271+01:00","close_reason":"Added cursor-based pagination to GET /v1/messages/inbox endpoint with limit/cursor params, has_more/next_cursor response fields, and comprehensive tests including multi-page pagination","dependencies":[{"issue_id":"beadhub-4exs","depends_on_id":"beadhub-v9wr","type":"blocks","created_at":"2025-12-22T10:32:21.502668+01:00","created_by":"juanre"},{"issue_id":"beadhub-4exs","depends_on_id":"beadhub-94q9","type":"blocks","created_at":"2025-12-22T10:36:52.328212+01:00","created_by":"juanre"}]}
{"id":"beadhub-4f36","title":"Pin pnpm and uv versions in Dockerfile for reproducible builds","description":"Docker rebuilds are currently not reproducible because the Dockerfile pulls floating tool versions:\n- Stage 1 uses corepack prepare pnpm@latest\n- Stage 2 copies uv from ghcr.io/astral-sh/uv:latest\n\nImpact\n- Rebuilding the same commit can start failing unpredictably when upstream releases introduce breaking changes or regressions.\n- Makes OSS distribution harder to support/debug (\"it worked yesterday\" rebuild failures).\n\nNote\n- This is not about end-users running CI in the wild; it is about deterministic container builds for releases and private deployments.","design":"Where\n- Dockerfile: use pinned pnpm and uv versions (either hardcode or ARGs).\n\nSuggested approach\n- Add build args, e.g. PNPM_VERSION=9.x.y and UV_IMAGE_TAG=0.x.y, and use those instead of latest.\n- Prefer pinning to a specific uv image digest (sha256) for maximum determinism.\n- Document the update procedure (where to bump versions) in Dockerfile comments or docs/deployment.md.","acceptance_criteria":"- Dockerfile no longer uses pnpm@latest or uv:latest; versions/tags are pinned.\n- Docker rebuild of the same git commit is deterministic (no upstream tool drift).\n- Documentation explains how to bump pinned versions safely.","status":"tombstone","priority":2,"issue_type":"chore","owner":"juan@juanreyero.com","created_at":"2026-01-18T07:23:20.556062+01:00","created_by":"Juan Reyero","updated_at":"2026-01-18T07:30:11.3826+01:00","close_reason":"Duplicate of beadhub-nimv (existing Docker pinning issue)","labels":["build","docker","oss"],"deleted_at":"2026-01-18T07:30:11.3826+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"chore"}
{"id":"beadhub-4fnz","title":"Add pagination to beads/issues endpoint","description":"Eve needs pagination support for the beads/issues endpoint. Currently returns all issues at once with no cursor.\n\nPattern to follow (from fetchInbox):\n- Add cursor parameter\n- Fetch limit+1 to detect has_more\n- Encode cursor with sort key state (bead_id, updated_at, priority)\n- Return { issues, count, has_more, next_cursor, synced_at }\n\nRequested by eve-frontend for IssuesPage pagination component.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-09T23:30:37.583866+01:00","created_by":"juanre","updated_at":"2026-01-09T23:35:55.661862+01:00","closed_at":"2026-01-09T23:35:55.661862+01:00","close_reason":"Implemented cursor-based pagination for GET /v1/beads/issues"}
{"id":"beadhub-4ggo","title":"Fix SSE timeout error message in bdh :chat","description":"Current behavior shows Go internal error:\n  SSE: connection error: context deadline exceeded\n\nThis is implementation detail leaking to user. Should show human-readable message:\n  Waited 10s â€” no reply\n\nThe timeout is expected behavior, not an error. Message should reflect that the system worked correctly: message delivered, wait period elapsed, no response received.\n\nLocation: bdh/internal/commands/chat.go - SSE error handling","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-09T22:54:20.328608+01:00","created_by":"juanre","updated_at":"2026-01-09T23:04:13.188766+01:00","closed_at":"2026-01-09T23:04:13.188766+01:00","close_reason":"Implemented: --leave-conversation flag added, SSE timeout message now shows 'Waited Xs â€” no reply'"}
{"id":"beadhub-4gli","title":"Add cursor-based pagination to GET /v1/escalations","description":"Update escalations.py to use cursor-based pagination:\n\nCurrent: Returns ALL escalations with no pagination\nTarget:\n- Add limit and cursor query params\n- Order by created_at DESC for stable ordering\n- Return {items: [...], has_more: bool, next_cursor: str}\n- Default limit 50, max 200\n\nUse the pagination helper module.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T10:30:40.689899+01:00","updated_at":"2025-12-22T11:31:15.686552+01:00","closed_at":"2025-12-22T11:31:15.686552+01:00","close_reason":"Added cursor-based pagination to GET /v1/escalations endpoint with limit/cursor params, updated response schema, 4 pagination tests added","dependencies":[{"issue_id":"beadhub-4gli","depends_on_id":"beadhub-v9wr","type":"blocks","created_at":"2025-12-22T10:32:21.01225+01:00","created_by":"juanre"},{"issue_id":"beadhub-4gli","depends_on_id":"beadhub-94q9","type":"blocks","created_at":"2025-12-22T10:36:51.84359+01:00","created_by":"juanre"}]}
{"id":"beadhub-4gu","title":"Incomplete path traversal protection in repos.py:42 and beads.py:34 - use Path.resolve()","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-03T15:38:30.985822+01:00","updated_at":"2025-12-03T17:20:19.589806+01:00","closed_at":"2025-12-03T17:20:19.589806+01:00"}
{"id":"beadhub-4jzg","title":"Add bdh :read command for reading mail message","description":"Implement bdh :read command that calls GET /v1/messages/inbox with message_id filter. Args: \u003cmessage-id\u003e. Shows full message details (subject, body, from, timestamp, priority, thread_id). Optionally marks as read.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-15T17:40:09.472394+01:00","updated_at":"2025-12-15T17:40:59.878831+01:00","closed_at":"2025-12-15T17:40:59.878831+01:00"}
{"id":"beadhub-4lf","title":"CRITICAL: get_subscribers_for_bead() missing project_id filter - cross-tenant notification leak","description":"**Vulnerability**: get_subscribers_for_bead() in subscriptions.py:198-236 does NOT filter by project_id.\n\n**Attack scenario**:\n1. Project A uploads issue bd-123 with status 'open'\n2. Project B subscribes to notifications for bd-123 (same bead_id)\n3. Project A updates bd-123 to status 'closed'\n4. Project B receives notification about Project A's issue (title, status leak)\n\n**Fix**: Add project_id parameter to get_subscribers_for_bead() and filter subscriptions by project_id. Update caller in beads.py:58 to pass project_id.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-07T22:42:24.135967+01:00","updated_at":"2025-12-07T22:57:32.148784+01:00","closed_at":"2025-12-07T22:57:32.148784+01:00"}
{"id":"beadhub-4mj","title":"CRITICAL: Add tenant isolation to beads_issues table - data leakage between tenants","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-07T22:17:08.46537+01:00","updated_at":"2025-12-07T22:39:01.974474+01:00","closed_at":"2025-12-07T22:39:01.974474+01:00"}
{"id":"beadhub-4pl","title":"Add projects CRUD routes","description":"Routes for project management: POST /api/v1/projects (create), GET /api/v1/projects (list user's projects), GET /api/v1/projects/{id} (get single), DELETE /api/v1/projects/{id} (delete). Require JWT auth.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-03T08:09:40.767526+01:00","updated_at":"2025-12-03T08:41:43.999062+01:00","closed_at":"2025-12-03T08:41:43.999062+01:00","close_reason":"Already exists from llmring-api template","dependencies":[{"issue_id":"beadhub-4pl","depends_on_id":"beadhub-3k4","type":"blocks","created_at":"2025-12-03T08:09:47.089903+01:00","created_by":"juanre"}]}
{"id":"beadhub-4qkt","title":"Enforce unique agent names within a project","description":"Agent names must be unique per project for bdh :send to work correctly. Check on first interaction (bdh init or first command) and reject if name collision.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-10T19:44:01.711807+01:00","updated_at":"2025-12-10T19:46:43.67211+01:00","closed_at":"2025-12-10T19:46:43.67211+01:00"}
{"id":"beadhub-4rpq","title":"Extraction: split OSS cores into ../aweb + ../beadhub (+ ../aweb-go)","description":"Execute the SOT extraction checklist to split the current monorepo state into separate OSS repos.\n\nSource of truth:\n- ../beadhub-sot/source-of-truth/aweb-beadhub-extraction-checklist.md\n- ../beadhub-sot/source-of-truth/aweb-beadhub-integration.md\n- ../beadhub-sot/source-of-truth/beadhub-aweb-split.md\n- ../beadhub-sot/source-of-truth/pgdbm-multi-app-migrations.md\n\nKey invariant: aweb is a protocol; BeadHub implements it (embedded aweb routes in-process).","acceptance_criteria":"- New epics/tasks exist covering all extraction steps\n- Dependencies reflect correct execution order\n- Engineers can follow beads without additional context","status":"closed","priority":1,"issue_type":"epic","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-22T17:48:22.047763+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T12:12:32.057784+01:00","closed_at":"2026-01-23T12:12:32.057784+01:00","close_reason":"Extraction complete across ../aweb + ../aweb-go + in-place beadhub","labels":["area:extraction"]}
{"id":"beadhub-4rpq.1","title":"Extract Python aweb OSS repo (../aweb)","description":"Create ../aweb repo and move the aweb Python server/package + migrations + aweb-owned tests.","acceptance_criteria":"- ../aweb contains installable aweb package (uv)\n- aweb migrations live with aweb\n- aweb tests moved and pass","status":"closed","priority":1,"issue_type":"epic","owner":"juan@juanreyero.com","created_at":"2026-01-22T17:48:59.195704+01:00","created_by":"Juan Reyero","updated_at":"2026-01-22T19:05:26.862729+01:00","closed_at":"2026-01-22T19:05:26.862729+01:00","close_reason":"Closed","labels":["area:extraction","component:aweb"],"dependencies":[{"issue_id":"beadhub-4rpq.1","depends_on_id":"beadhub-4rpq","type":"parent-child","created_at":"2026-01-22T17:48:59.196731+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-4rpq.1.1","title":"Create ../aweb repo skeleton (uv, docs, CI placeholders)","description":"Initialize `../aweb` as a git repo with a minimal `uv`-based Python package layout.\n\nSteps\n- Create `../aweb` git repo (initial commit).\n- Create `../aweb/pyproject.toml` with an installable package named `aweb`.\n- Add a server entrypoint so devs can run the standalone server (e.g., `uv run aweb serve`).\n- Add a minimal `../aweb/README.md` with:\n  - prereqs\n  - `DATABASE_URL` / `AWEB_DATABASE_URL`\n  - `REDIS_URL`\n  - run server\n  - run tests\n","acceptance_criteria":"- ../aweb is a git repo with uv pyproject and a minimal README\\n- Importing aweb works once code is moved\\n- Docs mention local PG/Redis (no Docker fixtures)","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-22T17:50:48.516584+01:00","created_by":"Juan Reyero","updated_at":"2026-01-22T18:38:13.018142+01:00","closed_at":"2026-01-22T18:38:13.018142+01:00","close_reason":"Closed","labels":["area:extraction","component:aweb","subsystem:packaging"],"dependencies":[{"issue_id":"beadhub-4rpq.1.1","depends_on_id":"beadhub-4rpq.1","type":"parent-child","created_at":"2026-01-22T17:50:48.51771+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-4rpq.1.2","title":"Move aweb Python source tree into ../aweb","description":"Move the `src/aweb/` Python package from this repo into `../aweb/src/aweb/`.\n\nConstraints\n- Keep the public API stable:\n  - `aweb.api:create_app`\n  - `aweb.db.DatabaseInfra`\n  - `aweb.auth` (auth helpers)\n  - aweb protocol routes under `/v1/*`\n- Ensure package data (migrations) will be included in the distribution (wheel/sdist).\n\nNotes\n- This bead is only about the move + packaging integrity; test moves are covered separately.\n","acceptance_criteria":"- ../aweb/src/aweb contains the moved package\\n- Public imports remain stable (aweb.api, aweb.auth, aweb.db)\\n- aweb CLI/help works","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-22T17:50:58.875691+01:00","created_by":"Juan Reyero","updated_at":"2026-01-22T19:03:30.542733+01:00","closed_at":"2026-01-22T19:03:30.542733+01:00","close_reason":"Closed","labels":["area:extraction","component:aweb"],"dependencies":[{"issue_id":"beadhub-4rpq.1.2","depends_on_id":"beadhub-4rpq.1","type":"parent-child","created_at":"2026-01-22T17:50:58.876837+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-4rpq.1.2","depends_on_id":"beadhub-4rpq.1.1","type":"blocks","created_at":"2026-01-22T18:05:35.399489+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-4rpq.1.3","title":"Move aweb migrations and verify standalone migration apply","description":"Ensure aweb migrations are moved and can be applied in standalone mode.\n\nRequirements\n- Migrations live in: `../aweb/src/aweb/migrations/aweb/*.sql`\n- `aweb.db.DatabaseInfra` applies migrations with `module_name=\"aweb-aweb\"`\n- Migrations are shipped as package data (not only present in git)\n\nVerification\n- `cd ../aweb \u0026\u0026 uv run pytest -q tests/test_aweb_db_migrations.py`\n- Optional: verify `aweb.schema_migrations` contains entries with module_name `aweb-aweb`\n","acceptance_criteria":"- aweb migrations live under ../aweb/src/aweb/migrations/aweb\\n- Standalone migrations apply with module_name aweb-aweb\\n- aweb migration tests pass","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-22T17:51:09.224068+01:00","created_by":"Juan Reyero","updated_at":"2026-01-22T19:03:51.277396+01:00","closed_at":"2026-01-22T19:03:51.277396+01:00","close_reason":"Closed","labels":["area:extraction","component:aweb","component:db"],"dependencies":[{"issue_id":"beadhub-4rpq.1.3","depends_on_id":"beadhub-4rpq.1","type":"parent-child","created_at":"2026-01-22T17:51:09.225218+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-4rpq.1.3","depends_on_id":"beadhub-4rpq.1.2","type":"blocks","created_at":"2026-01-22T18:05:45.754712+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-4rpq.1.4","title":"Move aweb-owned tests + conformance harness into ../aweb","description":"Move aweb-owned test suites from the beadhub repo into the new `../aweb` repo.\n\nMove\n- `tests/test_aweb_*.py` â†’ `../aweb/tests/`\n- `tests/aweb_conformance/` â†’ `../aweb/tests/`\n\nConstraints\n- Preserve existing test patterns: local Postgres + Redis, no Docker-based fixtures.\n- Conformance tests remain opt-in (skipped unless env flags are set), same as today.\n\nVerification\n- `cd ../aweb \u0026\u0026 uv run pytest`\n","acceptance_criteria":"- aweb unit/integration tests live in ../aweb and pass\\n- aweb_conformance suite moves with aweb and remains opt-in\\n- Tests continue to use local PG/Redis fixtures (no Docker)","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-22T17:51:19.568016+01:00","created_by":"Juan Reyero","updated_at":"2026-01-22T19:04:12.022163+01:00","closed_at":"2026-01-22T19:04:12.022163+01:00","close_reason":"Closed","labels":["area:extraction","area:tests","component:aweb"],"dependencies":[{"issue_id":"beadhub-4rpq.1.4","depends_on_id":"beadhub-4rpq.1","type":"parent-child","created_at":"2026-01-22T17:51:19.568952+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-4rpq.1.4","depends_on_id":"beadhub-4rpq.1.3","type":"blocks","created_at":"2026-01-22T18:06:14.720457+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-4rpq.1.5","title":"Document aweb OSS usage (README + minimal examples)","description":"Document aweb OSS usage in `../aweb`.\n\nDocument\n- Running the server (`uv run aweb serve`)\n- Required env vars (`AWEB_DATABASE_URL`/`DATABASE_URL`, `REDIS_URL`)\n- Seeding identities for local dev/conformance\n- Running the test suite\n- (Optional) using the Go `aw` CLI against an aweb-compatible server\n\nConstraint\n- Do not present BeadHub concepts (beads/repos/workspaces) as aweb first-class entities.\n","acceptance_criteria":"- ../aweb README/docs are copy-paste runnable\\n- aweb docs do not describe beads/repos/workspaces as first-class entities","status":"closed","priority":2,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-22T17:51:29.922433+01:00","created_by":"Juan Reyero","updated_at":"2026-01-22T19:04:47.634001+01:00","closed_at":"2026-01-22T19:04:47.634001+01:00","close_reason":"Closed","labels":["area:docs","area:extraction","component:aweb"],"dependencies":[{"issue_id":"beadhub-4rpq.1.5","depends_on_id":"beadhub-4rpq.1","type":"parent-child","created_at":"2026-01-22T17:51:29.923623+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-4rpq.1.5","depends_on_id":"beadhub-4rpq.1.4","type":"blocks","created_at":"2026-01-22T18:06:25.011986+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-4rpq.2","title":"Extract Go aweb client + aw CLI repo (../aweb-go)","description":"Create ../aweb-go repo and move the Go client library + aw CLI with stable module path.","acceptance_criteria":"- ../aweb-go builds and tests pass\n- Module path remains github.com/beadhub/aweb-go\n- go install instructions are correct","status":"closed","priority":2,"issue_type":"epic","owner":"juan@juanreyero.com","created_at":"2026-01-22T17:49:15.588366+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T09:46:34.443929+01:00","closed_at":"2026-01-23T09:46:34.443929+01:00","close_reason":"Closed","labels":["area:extraction","component:aweb-go"],"dependencies":[{"issue_id":"beadhub-4rpq.2","depends_on_id":"beadhub-4rpq","type":"parent-child","created_at":"2026-01-22T17:49:15.589288+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-4rpq.2.1","title":"Create ../aweb-go repo and move Go client + aw CLI","description":"Initialize ../aweb-go as a git repo and move the aweb-go module contents into it.\n\nScope:\n- Move Go client library and cmd/aw CLI.\n- Keep existing package layout and tests.\n\nVerification (post-move):\n- cd ../aweb-go \u0026\u0026 go test ./...","acceptance_criteria":"- ../aweb-go exists as a standalone repo\n- go test passes in ../aweb-go","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-22T17:54:55.791516+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T09:12:53.091767+01:00","closed_at":"2026-01-23T09:12:53.091767+01:00","close_reason":"Closed","labels":["area:extraction","component:aweb-go"],"dependencies":[{"issue_id":"beadhub-4rpq.2.1","depends_on_id":"beadhub-4rpq.2","type":"parent-child","created_at":"2026-01-22T17:54:55.792549+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-4rpq.2.2","title":"Keep Go module path stable and document installation","description":"Ensure go.mod remains: module github.com/beadhub/aweb-go.\n\nAdd/verify docs:\n- go install github.com/beadhub/aweb-go/cmd/aw@latest\n\nVerification:\n- aw --help builds and runs","acceptance_criteria":"- go.mod module path unchanged\n- aw install instructions verified","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-22T17:55:11.452849+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T09:15:32.703483+01:00","closed_at":"2026-01-23T09:15:32.703483+01:00","close_reason":"Closed","labels":["area:docs","area:extraction","component:aweb-go"],"dependencies":[{"issue_id":"beadhub-4rpq.2.2","depends_on_id":"beadhub-4rpq.2","type":"parent-child","created_at":"2026-01-22T17:55:11.45397+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-4rpq.2.2","depends_on_id":"beadhub-4rpq.2.1","type":"blocks","created_at":"2026-01-22T18:06:41.810885+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-4rpq.2.3","title":"Update bdh module to consume aweb-go from ../aweb-go","description":"After extracting aweb-go, ensure the BeadHub CLI (bdh) builds in the new ../beadhub repo while depending on github.com/beadhub/aweb-go.\n\nLikely work:\n- Keep a local development replace to ../aweb-go.\n- Ensure no import paths rely on monorepo-relative locations.\n\nVerification:\n- cd ../beadhub/bdh \u0026\u0026 go test ./...\n- make bdh works","acceptance_criteria":"- bdh builds and tests pass with aweb-go as a dependency","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-22T17:55:27.884542+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T09:46:24.10834+01:00","closed_at":"2026-01-23T09:46:24.10834+01:00","close_reason":"Closed","labels":["area:extraction","component:aweb-go","component:bdh"],"dependencies":[{"issue_id":"beadhub-4rpq.2.3","depends_on_id":"beadhub-4rpq.2","type":"parent-child","created_at":"2026-01-22T17:55:27.886341+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-4rpq.2.3","depends_on_id":"beadhub-4rpq.2.2","type":"blocks","created_at":"2026-01-22T18:06:52.163693+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-4rpq.2.3","depends_on_id":"beadhub-4rpq.2.4","type":"blocks","created_at":"2026-01-23T09:16:42.080846+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-4rpq.2.4","title":"Decide release/versioning approach for aweb-go","description":"Decide and document how beadhub pins aweb-go:\n- local dev: replace ../aweb-go\n- releases: semver tags vs pseudo-versions\n\nAcceptance:\n- Decision recorded in docs (either aweb-go or beadhub) and used consistently.","acceptance_criteria":"- Versioning decision documented and used","notes":"Decision: aweb-go uses SemVer tags (e.g., v0.1.0). BeadHub pins to tags for releases; local dev uses a Go replace to sibling checkout. Documented in ../aweb-go/README.md.","status":"closed","priority":2,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-22T17:55:44.076974+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T09:16:52.379189+01:00","closed_at":"2026-01-23T09:16:52.379189+01:00","close_reason":"Closed","labels":["area:extraction","area:release","component:aweb-go"],"dependencies":[{"issue_id":"beadhub-4rpq.2.4","depends_on_id":"beadhub-4rpq.2","type":"parent-child","created_at":"2026-01-22T17:55:44.078304+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-4rpq.3","title":"Extract BeadHub OSS repo (../beadhub)","description":"Create ../beadhub repo and move beadhub + bdh, remove embedded src/aweb, and depend on aweb as an external package while keeping embedded mode behavior.","acceptance_criteria":"- ../beadhub contains beadhub server + bdh CLI\n- ../beadhub no longer contains src/aweb\n- beadhub still serves aweb protocol routes and validates API keys locally\n- uv tests pass","status":"closed","priority":1,"issue_type":"epic","owner":"juan@juanreyero.com","created_at":"2026-01-22T17:49:32.273499+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T09:49:57.069684+01:00","closed_at":"2026-01-23T09:49:57.069684+01:00","close_reason":"Closed","labels":["area:extraction","component:beadhub"],"dependencies":[{"issue_id":"beadhub-4rpq.3","depends_on_id":"beadhub-4rpq","type":"parent-child","created_at":"2026-01-22T17:49:32.274507+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-4rpq.3","depends_on_id":"beadhub-4rpq.1","type":"blocks","created_at":"2026-01-22T18:05:04.330319+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-4rpq.3","depends_on_id":"beadhub-4rpq.2","type":"blocks","created_at":"2026-01-22T18:05:14.677374+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-4rpq.3.1","title":"Create ../beadhub repo skeleton (uv, docs)","description":"Initialize ../beadhub as a git repo with uv-based Python packaging.\n\nRequirements:\n- Installable package named beadhub.\n- Server entrypoint for uv (uv run beadhub).\n- README with local PG/Redis env vars and test instructions.\n\nVerification:\n- cd ../beadhub \u0026\u0026 uv run python -c 'import beadhub'","acceptance_criteria":"- ../beadhub exists and is uv-installable\n- Basic import and server entrypoint work","notes":"N/A for this workspace: the current repo is already the BeadHub OSS repo. Extraction proceeds in-place by removing src/aweb and aweb-go and pointing to sibling repos.","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-22T17:56:18.915915+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T09:18:16.633807+01:00","closed_at":"2026-01-23T09:18:16.633807+01:00","close_reason":"Closed","labels":["area:extraction","component:beadhub","subsystem:packaging"],"dependencies":[{"issue_id":"beadhub-4rpq.3.1","depends_on_id":"beadhub-4rpq.3","type":"parent-child","created_at":"2026-01-22T17:56:18.917022+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-4rpq.3.2","title":"Move BeadHub Python source tree into ../beadhub","description":"Move src/beadhub into ../beadhub/src/beadhub and keep the server runnable.\n\nScope:\n- Move the Python package and beadhub-owned migrations (server, beads).\n- Ensure imports and entrypoints work in the new repo.\n\nVerification:\n- cd ../beadhub \u0026\u0026 uv run pytest (after test split bead)\n- cd ../beadhub \u0026\u0026 uv run beadhub (server starts)","acceptance_criteria":"- ../beadhub/src/beadhub contains moved code\n- beadhub server can start in standalone mode","notes":"N/A: BeadHub Python package already lives in this repo. Extraction work here removes embedded aweb source and updates dependencies.","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-22T17:56:35.465647+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T09:18:37.389942+01:00","closed_at":"2026-01-23T09:18:37.389942+01:00","close_reason":"Closed","labels":["area:extraction","component:beadhub"],"dependencies":[{"issue_id":"beadhub-4rpq.3.2","depends_on_id":"beadhub-4rpq.3","type":"parent-child","created_at":"2026-01-22T17:56:35.467381+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-4rpq.3.2","depends_on_id":"beadhub-4rpq.3.1","type":"blocks","created_at":"2026-01-22T18:07:20.312051+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-4rpq.3.3","title":"Move bdh CLI into ../beadhub and keep builds working","description":"Move the bdh/ Go CLI directory into ../beadhub/bdh.\n\nRequirements:\n- make bdh works from ../beadhub (or documented equivalent).\n- bdh continues to provide: bdh init, bead commands, and bdh :aweb escape hatch.\n\nVerification:\n- cd ../beadhub/bdh \u0026\u0026 go test ./...\n- ../beadhub: build the bdh binary","acceptance_criteria":"- bdh builds and go tests pass in the extracted repo","notes":"N/A: bdh CLI already lives in this repo under bdh/. Extraction work updates go.mod replace to point to sibling ../aweb-go.","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-22T17:56:52.748231+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T09:19:12.997437+01:00","closed_at":"2026-01-23T09:19:12.997437+01:00","close_reason":"Closed","labels":["area:extraction","component:bdh"],"dependencies":[{"issue_id":"beadhub-4rpq.3.3","depends_on_id":"beadhub-4rpq.3","type":"parent-child","created_at":"2026-01-22T17:56:52.74924+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-4rpq.3.3","depends_on_id":"beadhub-4rpq.3.2","type":"blocks","created_at":"2026-01-22T18:07:30.671299+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-4rpq.3.4","title":"Remove embedded src/aweb from ../beadhub and depend on external aweb package","description":"After extraction, ../beadhub MUST NOT contain src/aweb.\n\nWork:\n- Remove src/aweb from the beadhub repo.\n- Add Python dependency on aweb (during development, use a path or git dependency to ../aweb).\n- Ensure beadhub still embeds aweb routes in-process and validates API keys locally.\n\nVerification:\n- Imports like aweb.routes.* resolve from the installed aweb package.\n- uv run pytest passes in ../beadhub.","acceptance_criteria":"- ../beadhub contains no src/aweb\n- beadhub embeds aweb routes and validates bearer keys locally using aweb schema","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-22T17:57:17.676748+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T09:46:44.760402+01:00","closed_at":"2026-01-23T09:46:44.760402+01:00","close_reason":"Closed","labels":["area:extraction","component:aweb","component:beadhub"],"dependencies":[{"issue_id":"beadhub-4rpq.3.4","depends_on_id":"beadhub-4rpq.3","type":"parent-child","created_at":"2026-01-22T17:57:17.677879+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-4rpq.3.4","depends_on_id":"beadhub-4rpq.3.3","type":"blocks","created_at":"2026-01-22T18:07:41.02032+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-4rpq.3.5","title":"Split tests between ../aweb and ../beadhub","description":"After moving aweb-owned tests into ../aweb, prune the beadhub test suite to only beadhub-owned tests.\n\nRules:\n- aweb tests live in ../aweb/tests\n- beadhub tests live in ../beadhub/tests\n- keep local Postgres/Redis fixture pattern (no Docker).\n\nVerification:\n- cd ../aweb \u0026\u0026 uv run pytest\n- cd ../beadhub \u0026\u0026 uv run pytest","acceptance_criteria":"- Test ownership is cleanly split; both repos pass their own suites","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-22T17:57:38.080107+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T09:46:55.079949+01:00","closed_at":"2026-01-23T09:46:55.079949+01:00","close_reason":"Closed","labels":["area:extraction","area:tests","component:aweb","component:beadhub"],"dependencies":[{"issue_id":"beadhub-4rpq.3.5","depends_on_id":"beadhub-4rpq.3","type":"parent-child","created_at":"2026-01-22T17:57:38.08111+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-4rpq.3.5","depends_on_id":"beadhub-4rpq.3.4","type":"blocks","created_at":"2026-01-22T18:07:51.364686+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-4rpq.3.6","title":"Verify embedded-mode behavior in extracted beadhub","description":"In the extracted ../beadhub repo, confirm embedded mode is still the default runtime behavior:\n- beadhub serves aweb protocol endpoints under /v1/*\n- beadhub validates Authorization: Bearer aw_sk_* locally against aweb schema\n\nMinimum end-to-end check:\n- init a project (POST /v1/init)\n- register workspace\n- send mail and chat\n- acquire a reservation\n\nAcceptance:\n- End-to-end embedded coordination works in extracted repo.","acceptance_criteria":"- Embedded aweb routes and auth work end-to-end in ../beadhub","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-22T17:57:54.962638+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T09:48:50.315849+01:00","closed_at":"2026-01-23T09:48:50.315849+01:00","close_reason":"Closed","labels":["area:extraction","component:aweb","component:beadhub"],"dependencies":[{"issue_id":"beadhub-4rpq.3.6","depends_on_id":"beadhub-4rpq.3","type":"parent-child","created_at":"2026-01-22T17:57:54.963721+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-4rpq.3.6","depends_on_id":"beadhub-4rpq.3.5","type":"blocks","created_at":"2026-01-22T18:08:01.74112+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-4rpq.3.7","title":"Ensure pgdbm migration discovery works post-split","description":"Confirm the pgdbm multi-app pattern continues to work in the split:\n- aweb migrations are discovered from the installed aweb package\n- beadhub DatabaseInfra applies aweb migrations with module_name aweb-aweb\n- beadhub applies its own migrations with module_name beadhub-server and beadhub-beads\n\nVerification:\n- Fresh DB: start beadhub, verify schema_migrations tables contain expected module_name entries.","acceptance_criteria":"- Migration module_name conventions are preserved after split","status":"closed","priority":2,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-22T17:58:12.424352+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T09:49:46.736039+01:00","closed_at":"2026-01-23T09:49:46.736039+01:00","close_reason":"Closed","labels":["area:extraction","component:db"],"dependencies":[{"issue_id":"beadhub-4rpq.3.7","depends_on_id":"beadhub-4rpq.3","type":"parent-child","created_at":"2026-01-22T17:58:12.425456+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-4rpq.3.7","depends_on_id":"beadhub-4rpq.3.6","type":"blocks","created_at":"2026-01-22T18:08:25.892947+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-4rpq.4","title":"Boundary enforcement + verification","description":"Add guardrails and run full verification after extraction (no hidden coupling; pgdbm pattern preserved; docs updated).","acceptance_criteria":"- Import boundaries are enforced (tests/linters)\n- pgdbm schemas/migrations behave identically standalone vs embedded\n- Full test suites pass in all repos","status":"closed","priority":1,"issue_type":"epic","owner":"juan@juanreyero.com","created_at":"2026-01-22T17:49:48.417426+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T12:12:21.784399+01:00","closed_at":"2026-01-23T12:12:21.784399+01:00","close_reason":"Boundary guardrails added; docs updated; full test verification complete","labels":["area:extraction","component:boundaries"],"dependencies":[{"issue_id":"beadhub-4rpq.4","depends_on_id":"beadhub-4rpq","type":"parent-child","created_at":"2026-01-22T17:49:48.418519+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-4rpq.4","depends_on_id":"beadhub-4rpq.3","type":"blocks","created_at":"2026-01-22T18:05:25.063464+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-4rpq.4.1","title":"Define allowed import surface between beadhub and aweb","description":"Define and enforce the allowed Python import surface from beadhub -\u003e aweb.\n\nGoal: beadhub should depend only on stable, intentional aweb APIs.\n\nWork:\n- Decide which aweb modules are public for embedding (e.g., aweb.api, aweb.routes.*, aweb.auth).\n- Decide which aweb modules are considered internal and should not be imported by beadhub.\n- Update SOT/doc and add an automated check (tests or lint) to enforce.\n\nAcceptance:\n- Clear allowlist exists and beadhub code conforms.","acceptance_criteria":"- Allowed import surface documented and enforced","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-22T17:58:35.853872+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T11:57:37.423731+01:00","closed_at":"2026-01-23T11:57:37.423731+01:00","close_reason":"Closed","labels":["area:extraction","component:boundaries","component:python"],"dependencies":[{"issue_id":"beadhub-4rpq.4.1","depends_on_id":"beadhub-4rpq.4","type":"parent-child","created_at":"2026-01-22T17:58:35.855042+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-4rpq.4.2","title":"Port boundary tests to split repos (migrations, cross-schema, forbidden strings)","description":"Ensure boundary guardrails remain after extraction.\n\nWork (post-split):\n- In ../beadhub: keep a test that beadhub migrations do not reference aweb schema-qualified objects.\n- In ../aweb: keep a test that aweb migrations do not reference beadhub schema-qualified objects.\n- Add an explicit check for cross-schema foreign keys (if desired, by parsing migrations).\n\nAcceptance:\n- Boundary tests exist in both repos and fail on forbidden coupling.","acceptance_criteria":"- Boundary tests run and enforce split-friendly constraints","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-22T17:58:52.146128+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T11:59:43.145668+01:00","closed_at":"2026-01-23T11:59:43.145668+01:00","close_reason":"Closed","labels":["area:extraction","component:boundaries","component:db"],"dependencies":[{"issue_id":"beadhub-4rpq.4.2","depends_on_id":"beadhub-4rpq.4","type":"parent-child","created_at":"2026-01-22T17:58:52.147074+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-4rpq.4.2","depends_on_id":"beadhub-4rpq.4.1","type":"blocks","created_at":"2026-01-22T18:08:41.902421+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-4rpq.4.3","title":"Update docs to reflect multi-repo dev workflow","description":"After extraction, document how to develop locally across 2-3 repos:\n- ../aweb (Python)\n- ../beadhub (Python + bdh Go CLI)\n- ../aweb-go (Go client + aw CLI)\n\nInclude:\n- uv workflow for both repos\n- recommended aweb dependency approach in beadhub during development (path or git)\n- go replace approach for aweb-go in bdh\n- env var setup for local Postgres/Redis\n\nAcceptance:\n- A new developer can follow docs without tribal knowledge.","acceptance_criteria":"- Dev workflow doc exists and is copy-paste runnable","notes":"Updated docs/development.md to document post-extraction multi-repo workflow (beadhub + aweb + aweb-go), including uv/go commands and local Postgres/Redis expectations.","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-22T17:59:11.523606+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T12:11:51.113684+01:00","closed_at":"2026-01-23T12:11:51.113684+01:00","close_reason":"Docs updated for multi-repo workflow","labels":["area:docs","area:extraction"],"dependencies":[{"issue_id":"beadhub-4rpq.4.3","depends_on_id":"beadhub-4rpq.4","type":"parent-child","created_at":"2026-01-22T17:59:11.524658+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-4rpq.4.3","depends_on_id":"beadhub-4rpq.4.2","type":"blocks","created_at":"2026-01-22T18:08:52.27289+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-4rpq.4.4","title":"Full verification pass across repos (uv + go)","description":"Run full test suites after extraction:\n\n- ../aweb:\n  - uv run pytest\n- ../beadhub:\n  - uv run pytest\n  - cd bdh \u0026\u0026 go test ./...\n- ../aweb-go:\n  - go test ./...\n\nAcceptance:\n- All suites pass with local Postgres/Redis fixtures.","acceptance_criteria":"- All test suites pass post-split","notes":"Verification run: (1) beadhub: uv run pytest (312 passed); (2) aweb: uv run pytest (12 passed, 19 skipped); (3) aweb-go: go test ./...; (4) bdh: go test ./...","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-22T18:04:15.775775+01:00","created_by":"Juan Reyero","updated_at":"2026-01-23T12:12:11.586421+01:00","closed_at":"2026-01-23T12:12:11.586421+01:00","close_reason":"All repo test suites passing","labels":["area:extraction","area:tests"],"dependencies":[{"issue_id":"beadhub-4rpq.4.4","depends_on_id":"beadhub-4rpq.4","type":"parent-child","created_at":"2026-01-22T18:04:15.776961+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-4rpq.4.4","depends_on_id":"beadhub-4rpq.4.3","type":"blocks","created_at":"2026-01-22T18:09:02.6221+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-4rpq.4.4","depends_on_id":"beadhub-4rpq.4.5","type":"blocks","created_at":"2026-01-22T18:31:59.521865+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-4rpq.4.5","title":"Decide extraction method (history-preserving vs snapshot)","description":"Decide whether each extracted repo should preserve git history.\n\nOptions:\n- Snapshot: create new repos with a single initial commit containing the extracted state.\n- History-preserving: use git filter-repo (or similar) to extract folder history.\n\nAcceptance:\n- Decision recorded and used for ../aweb, ../beadhub, ../aweb-go.","acceptance_criteria":"- Extraction method decision recorded","notes":"Decision: snapshot extraction (new repos start with clean initial commit). Rationale: clean-slate OSS cores, minimal tooling complexity; preserves simplicity and avoids filter-repo pitfalls. If we later need history, we can re-extract with git filter-repo.","status":"closed","priority":2,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-22T18:04:31.802607+01:00","created_by":"Juan Reyero","updated_at":"2026-01-22T18:32:14.689883+01:00","closed_at":"2026-01-22T18:32:14.689883+01:00","close_reason":"Closed","labels":["area:extraction","area:release"],"dependencies":[{"issue_id":"beadhub-4rpq.4.5","depends_on_id":"beadhub-4rpq.4","type":"parent-child","created_at":"2026-01-22T18:04:31.803836+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-4trs","title":"Epic: Redesign bdh as bead-level coordination wrapper","description":"Redesign bdh to be a thin wrapper around bd with bead-level coordination.\n\n## Architectural Decision (2025-12-10)\n\n**project_id (UUID) is the partition key everywhere:**\n- Renamed: `project_key` â†’ `project_slug` (human-readable slug for display)\n- OSS: `.beadhub` stores `project_id` (UUID), obtained via `bdh init`\n- SaaS: `.beadhub` stores `project_slug` only; `project_id` derived from API key\n- All tables use `project_id` (UUID) for tenant isolation\n\n**Key changes from original design:**\n- Backend gates all commands (approve/reject before bd runs)\n- Coordination at bead level (who is working on which bead), not file level\n- Auto-registration on first contact\n- Auto-claim when status changes to in_progress\n- Auto-release when bead is closed\n\n**Prerequisites:**\n- OSS needs `server.projects` table\n- OSS needs `/v1/projects/ensure` endpoint\n\nNOTE: This is a greenfield implementation. No production data exists. Databases can be deleted and migrations rewritten from scratch.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-10T09:31:55.802219+01:00","updated_at":"2025-12-20T09:56:18.787436+01:00","closed_at":"2025-12-20T09:56:18.787436+01:00","close_reason":"Completed: all child tasks closed; bdh redesign implemented"}
{"id":"beadhub-4wzo","title":"Dashboard: add button to mark workspace as deleted","description":"Add a delete button to workspace cards in the dashboard. When clicked, calls DELETE /v1/workspaces/{id}. Show confirmation dialog. After deletion, workspace should disappear from the list (or show as deleted with strikethrough if showing deleted workspaces).","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-16T20:40:56.557282+01:00","updated_at":"2025-12-16T23:12:10.799264+01:00","closed_at":"2025-12-16T23:12:10.799264+01:00","dependencies":[{"issue_id":"beadhub-4wzo","depends_on_id":"beadhub-psfv","type":"blocks","created_at":"2025-12-16T20:41:05.309855+01:00","created_by":"juanre"},{"issue_id":"beadhub-4wzo","depends_on_id":"beadhub-lmtj","type":"blocks","created_at":"2025-12-16T20:41:17.950548+01:00","created_by":"juanre"}]}
{"id":"beadhub-4z7m","title":"Ship hardening: accounts/.aw/context + cleanup","description":"Fix remaining UX/spec mismatches for the accounts + .aw/context model; remove stale legacy paths; ensure bdh commands work without manual exports; align client contracts with server.","status":"closed","priority":1,"issue_type":"epic","owner":"juan@juanreyero.com","created_at":"2026-01-24T11:37:29.784309+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T16:17:51.511172+01:00","closed_at":"2026-01-24T16:17:51.511172+01:00","close_reason":"All ship-hardening tasks complete; tests passing"}
{"id":"beadhub-4z7m.1","title":"bdh :dashboard uses accounts + .aw/context","description":"Make bdh :dashboard obtain the API key via accounts+worktree context (and fall back to BEADHUB_API_KEY env override) so users never need to copy/paste exports after bdh :init.","acceptance_criteria":"- bdh :dashboard works after bdh :init with no BEADHUB_API_KEY exported\n- Uses selected account from .aw/context unless BEADHUB_API_KEY is set\n- Includes a unit test for URL construction","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-24T11:38:16.052694+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T11:55:34.314875+01:00","closed_at":"2026-01-24T11:55:34.314875+01:00","close_reason":"Use resolveBeadhubAuth for API key; add unit test","dependencies":[{"issue_id":"beadhub-4z7m.1","depends_on_id":"beadhub-4z7m","type":"parent-child","created_at":"2026-01-24T11:39:41.347982+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-4z7m.2","title":"bdh :policy works without manual exports","description":"Remove any gating that requires BEADHUB_API_KEY env for policy fetch; use accounts+context via resolveBeadhubAuth, with offline cache fallback.","acceptance_criteria":"- bdh :policy fetches policy when an account is selected via .aw/context\n- No BEADHUB_API_KEY env required for normal operation\n- Adds/updates tests to cover accounts-based auth path","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-24T11:38:34.010872+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T12:03:13.946628+01:00","closed_at":"2026-01-24T12:03:13.946628+01:00","close_reason":"Remove env gating; require account selection with cache fallback; add test","dependencies":[{"issue_id":"beadhub-4z7m.2","depends_on_id":"beadhub-4z7m","type":"parent-child","created_at":"2026-01-24T11:39:51.5629+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-4z7m.3","title":"Clean init/update: use /v1/workspaces/register; remove heartbeat/legacy","description":"Make bdh :init --update use the OSS /v1/workspaces/register endpoint and align the Go client with the server contract; remove stale WorkspaceHeartbeat and legacy init flows that violate the clean-slate model.","acceptance_criteria":"- bdh :init --update works against OSS server\n- Go client RegisterWorkspace matches server request/response\n- No references to /v1/workspaces/heartbeat remain\n- Tests updated accordingly","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-24T11:38:50.968728+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T16:05:45.633091+01:00","closed_at":"2026-01-24T16:05:45.633091+01:00","close_reason":"Update uses /v1/workspaces/register; align client; remove WorkspaceHeartbeat and legacy init paths","dependencies":[{"issue_id":"beadhub-4z7m.3","depends_on_id":"beadhub-4z7m","type":"parent-child","created_at":"2026-01-24T11:40:01.775983+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-4z7m.4","title":"Align alias validation with server + validate add-worktree --alias early","description":"Unify .beadhub alias validation with the server alias rules (must start with alnum, max 64). Ensure bdh :add-worktree validates explicit --alias before using it as a branch/worktree path.","acceptance_criteria":"- config validation matches server alias rules\n- bdh :add-worktree rejects invalid --alias with a clear error before creating worktree\n- Tests cover the updated validation","status":"closed","priority":2,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-24T11:39:07.255184+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T16:11:02.344897+01:00","closed_at":"2026-01-24T16:11:02.344897+01:00","close_reason":"Align alias rules with server; hyphenate role-\u003ealias; validate add-worktree --alias","dependencies":[{"issue_id":"beadhub-4z7m.4","depends_on_id":"beadhub-4z7m","type":"parent-child","created_at":"2026-01-24T11:40:12.075506+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-4z7m.5","title":"awconfig: implement Windows file locking for global config","description":"Replace the Windows stub lock implementation in aweb-go/awconfig so UpdateGlobalAt works on Windows too (safe concurrent writers).","acceptance_criteria":"- awconfig.LockExclusive works on Windows\n- UpdateGlobalAt passes tests on Windows (or has an OS-specific unit test)\n- No hard failure on Windows for normal aw/bdh usage","status":"closed","priority":2,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-24T11:39:25.176898+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T16:13:08.887503+01:00","closed_at":"2026-01-24T16:13:08.887503+01:00","close_reason":"Implement Windows file locking in awconfig","dependencies":[{"issue_id":"beadhub-4z7m.5","depends_on_id":"beadhub-4z7m","type":"parent-child","created_at":"2026-01-24T11:40:22.378857+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-53ns","title":"Dashboard layout: Move top nav to sidebar for cloud integration","description":"Current layout has horizontal nav in header (Status, Workspaces, Locks, Escalations, Issues). When embedded in beadhub-cloud, the cloud app will need the top header area for its own navigation/branding.\n\nProposed change:\n- Move nav items to a collapsible left sidebar\n- Keep minimal header with just logo + theme toggle\n- This leaves top area free for cloud to inject its header\n- Consider: full sidebar vs icon-only collapsed sidebar","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T17:17:35.758671+01:00","updated_at":"2025-12-08T17:25:44.471287+01:00","closed_at":"2025-12-08T17:25:44.471287+01:00"}
{"id":"beadhub-53w5","title":"Add hostname and directory fields to workspace model","description":"Workspaces page should show on which hostname and directory each workspace is located. Requires backend schema migration and bdh CLI changes.","status":"open","priority":2,"issue_type":"feature","created_at":"2025-12-13T18:40:13.733709+01:00","updated_at":"2025-12-13T18:40:13.733709+01:00"}
{"id":"beadhub-54p2","title":"Move heartbeat endpoint from Cloud to OSS","description":"P1: Route conflict causing 405 errors on POST /api/v1/workspaces/heartbeat.\n\nRoot cause: OSS has DELETE /{workspace_id} which matches 'heartbeat' as workspace_id before Cloud's POST /heartbeat route.\n\nFix: Move heartbeat endpoint from Cloud to OSS (beadhub/routes/workspaces.py).\n\nRelated: beadhub-cloud-wac (Cloud-side tracking)","status":"closed","priority":1,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-01-17T13:32:24.54483+01:00","created_by":"Juan Reyero","updated_at":"2026-01-17T14:00:14.816621+01:00","closed_at":"2026-01-17T14:00:14.816621+01:00","close_reason":"Already fixed - heartbeat endpoint exists in OSS workspaces.py:514, defined before /{workspace_id} route"}
{"id":"beadhub-558s","title":"Add sync statistics to response","description":"Update sync response to include statistics:\n\nResponse format:\n{\n  \"success\": true,\n  \"stats\": {\n    \"received\": 5,\n    \"inserted\": 2,\n    \"updated\": 3,\n    \"deleted\": 0,\n    \"skipped\": 995  // unchanged\n  }\n}\n\nClient (bdh) should display these stats after sync.\n\nFiles: src/beadhub/beads_sync.py, bdh/internal/commands/passthrough.go","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T10:31:45.477727+01:00","updated_at":"2025-12-22T12:03:35.560166+01:00","closed_at":"2025-12-22T12:03:35.560166+01:00","close_reason":"Added SyncStats model with received/inserted/updated/deleted counters. Server populates stats from sync results. Go client displays stats after mutation commands.","dependencies":[{"issue_id":"beadhub-558s","depends_on_id":"beadhub-9v3g","type":"blocks","created_at":"2025-12-22T10:34:52.233406+01:00","created_by":"juanre"},{"issue_id":"beadhub-558s","depends_on_id":"beadhub-fuql","type":"blocks","created_at":"2025-12-22T10:38:12.371867+01:00","created_by":"juanre"},{"issue_id":"beadhub-558s","depends_on_id":"beadhub-sj9x","type":"blocks","created_at":"2025-12-22T10:38:12.52965+01:00","created_by":"juanre"}]}
{"id":"beadhub-563","title":"Improve SQL parameter placeholder construction","description":"**Problem**: Using Python string formatting (`%` operator) to build SQL parameter placeholders. While not directly exploitable here (values are parameterized), this pattern is error-prone and makes code review harder.\n\n**Files affected**:\n- `routes/beads.py:90-97`\n- `routes/escalations.py:124-138`\n\n**Current code**:\n```python\nif status:\n    conditions.append(\"status = $%d\" % (len(params) + 1))\n    params.append(status)\n```\n\n**Fix**: Use cleaner parameter indexing:\n```python\nparam_idx = 1\nif status:\n    conditions.append(f\"status = ${param_idx}\")\n    params.append(status)\n    param_idx += 1\n```\n\nOr use a helper function:\n```python\ndef add_condition(conditions, params, field, value):\n    conditions.append(f\"{field} = ${len(params) + 1}\")\n    params.append(value)\n```","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-02T19:47:01.339772+01:00","updated_at":"2025-12-02T21:46:35.593608+01:00","closed_at":"2025-12-02T21:46:35.593608+01:00","close_reason":"Replaced % string formatting with f-strings and explicit param_idx counter in beads.py and escalations.py"}
{"id":"beadhub-5bji","title":"Update Go bdh command files: passthrough, chat, send, status, who, escalate, inbox","description":"Update all Go command files for new data model.\n\nFiles to update:\n1. passthrough.go: AgentName â†’ Alias in CommandRequest, SyncRequest, add RepoOrigin\n2. chat.go: all agent name references â†’ alias\n3. send.go: FromAgentName â†’ FromAlias, variable renames\n4. status.go: agent_name output field â†’ alias\n5. who.go: AgentName field â†’ Alias in struct and output\n6. escalate.go: AgentName â†’ Alias in request\n7. inbox.go: FromAgentName â†’ FromAlias in message display\n\nAll changes follow the pattern:\n- cfg.AgentName â†’ cfg.Alias\n- AgentName: in structs â†’ Alias:\n- JSON tags agent_name â†’ alias\n- Output displays\n\nDepends on: config.go, client.go changes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T12:52:06.801656+01:00","updated_at":"2025-12-12T18:33:53.358907+01:00","closed_at":"2025-12-12T18:33:53.358907+01:00","dependencies":[{"issue_id":"beadhub-5bji","depends_on_id":"beadhub-je0h","type":"blocks","created_at":"2025-12-12T12:52:13.831904+01:00","created_by":"juanre"},{"issue_id":"beadhub-5bji","depends_on_id":"beadhub-lhx4","type":"blocks","created_at":"2025-12-12T12:52:13.894089+01:00","created_by":"juanre"}]}
{"id":"beadhub-5gd8","title":"bdh: Update :status to display roles","description":"bdh :status output should show roles for all workspaces","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-14T09:06:37.529331+01:00","updated_at":"2025-12-15T15:35:00.599568+01:00","closed_at":"2025-12-15T15:18:04.280677+01:00","dependencies":[{"issue_id":"beadhub-5gd8","depends_on_id":"beadhub-hxlv","type":"blocks","created_at":"2025-12-14T09:06:56.090835+01:00","created_by":"juanre"},{"issue_id":"beadhub-5gd8","depends_on_id":"beadhub-hukz","type":"blocks","created_at":"2025-12-14T09:06:56.175733+01:00","created_by":"juanre"},{"issue_id":"beadhub-5gd8","depends_on_id":"beadhub-161u","type":"parent-child","created_at":"2025-12-14T09:24:11.496117+01:00","created_by":"juanre"}]}
{"id":"beadhub-5gz","title":"Multi-repo beads sync with namespaced IDs","description":"Sync beads from all registered repos.\nPrefix bead IDs with repo name: beadhub:beadhub-m03.\nAdd repo_id foreign key to beads_issues table.\nUpdate /v1/beads/ready to return cross-repo results.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-03T09:15:07.795072+01:00","updated_at":"2025-12-03T12:47:03.14188+01:00","closed_at":"2025-12-03T12:47:03.14188+01:00","dependencies":[{"issue_id":"beadhub-5gz","depends_on_id":"beadhub-9su","type":"blocks","created_at":"2025-12-03T09:15:17.035586+01:00","created_by":"juanre"}]}
{"id":"beadhub-5hch","title":"aweb: OSS core + Cloud wrapper (auth/tenancy)","description":"Define and implement the aweb OSS/core + aweb-cloud wrapper architecture (tenancy isolation, auth trust boundaries, SSE constraints) aligned with the BeadHub OSS/Cloud security patterns.\\n\\nSource of truth: ../beadhub-sot/source-of-truth/aweb-architecture.md","acceptance_criteria":"Architecture and security model is specified in SOT; core supports proxy-header mode for Cloud; aweb-cloud can mount/proxy core including SSE; Cloud schema separation via aweb_cloud is defined and scaffolded.","status":"closed","priority":3,"issue_type":"epic","owner":"juan@juanreyero.com","created_at":"2026-01-21T09:23:41.609935+01:00","created_by":"Juan Reyero","updated_at":"2026-01-21T11:06:50.614896+01:00","closed_at":"2026-01-21T11:06:50.614896+01:00","close_reason":"Completed P3 scaffolding: SOT doc, proxy-header auth mode (X-AW-Auth), cloud-aware core schema fields (tenant_id/user_id), aweb_cloud schema+migrations, and wrapper skeleton (isolated for future repo split)."}
{"id":"beadhub-5hch.1","title":"SOT: aweb OSS/Cloud auth + tenancy architecture","description":"Write a standalone source-of-truth document describing aweb OSS core vs aweb-cloud wrapper, including:\\n- tenancy isolation rules (project_id partitioning)\\n- auth modes (direct Bearer API key vs Cloud proxy headers)\\n- SSE constraints + proxy strategy\\n- schema separation strategy (aweb vs aweb_cloud)\\n\\nTarget: ../beadhub-sot/source-of-truth/aweb-architecture.md","acceptance_criteria":"Doc exists at ../beadhub-sot/source-of-truth/aweb-architecture.md and is implementable without prior context.","status":"closed","priority":3,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-21T09:23:59.005257+01:00","created_by":"Juan Reyero","updated_at":"2026-01-21T09:24:12.473277+01:00","closed_at":"2026-01-21T09:24:12.473277+01:00","close_reason":"Document created at ../beadhub-sot/source-of-truth/aweb-architecture.md","dependencies":[{"issue_id":"beadhub-5hch.1","depends_on_id":"beadhub-5hch","type":"parent-child","created_at":"2026-01-21T09:23:59.006238+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-5hch.2","title":"aweb-oss: Add proxy-header auth mode (Cloud wrapper support)","description":"Implement the proxy-header auth mode described in ../beadhub-sot/source-of-truth/aweb-architecture.md:\\n- New config flag (e.g., AWEB_TRUST_PROXY_HEADERS=1)\\n- Central scope resolver that selects either:\\n  (A) Authorization: Bearer \u003cproject_api_key\u003e OR\\n  (B) X-Project-ID (+ optional actor headers)\\n- Reject project selector injection in body/query\\n- Add unit tests for both modes\\n- Document security hardening (proxy secret / network allowlist)","acceptance_criteria":"With proxy mode enabled, core trusts wrapper-injected headers and ignores client project selectors; with proxy mode disabled, core requires Bearer API keys; tests cover both modes and reject confused-deputy cases.","status":"closed","priority":3,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-21T09:24:38.250115+01:00","created_by":"Juan Reyero","updated_at":"2026-01-21T10:44:55.730214+01:00","closed_at":"2026-01-21T10:44:55.730214+01:00","close_reason":"Implemented aweb proxy header auth support (X-AW-Auth gated by AWEB_TRUST_PROXY_HEADERS) while preserving legacy X-BH-Auth behavior; added unit tests.","dependencies":[{"issue_id":"beadhub-5hch.2","depends_on_id":"beadhub-5hch","type":"parent-child","created_at":"2026-01-21T09:24:38.251577+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-5hch.3","title":"aweb-oss: Plan/implement core tables for Cloud (tenant_id/user_id fields)","description":"Decide and implement Cloud-aware nullable fields in core tables (without making core depend on Cloud):\\n- aweb.projects.tenant_id (nullable)\\n- aweb.api_keys.user_id (nullable)\\n- optional: api_keys.name, scopes, revoked_at\\n\\nAdd migrations and tests. This enables aweb-cloud to use the same DB and reference core tables via cross-schema FKs.","acceptance_criteria":"Core schema supports Cloud wrapper without forks: tenant_id/user_id are available but optional; migrations + tests land; OSS behavior unchanged.","status":"closed","priority":3,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-21T09:24:54.169835+01:00","created_by":"Juan Reyero","updated_at":"2026-01-21T10:45:10.455798+01:00","closed_at":"2026-01-21T10:45:10.455798+01:00","close_reason":"Added cloud-aware optional fields to aweb core schema (projects.tenant_id + slug uniqueness indexes; api_keys.user_id + index) via migration 005; extended migration tests.","dependencies":[{"issue_id":"beadhub-5hch.3","depends_on_id":"beadhub-5hch","type":"parent-child","created_at":"2026-01-21T09:24:54.17099+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-5hch.4","title":"aweb-cloud: Define aweb_cloud schema + migrations scaffold","description":"Create the aweb-cloud schema plan described in ../beadhub-sot/source-of-truth/aweb-architecture.md:\\n- New Postgres schema aweb_cloud\\n- Initial Cloud-only tables (users, orgs, project_members, project_billing, oauth_accounts)\\n- Cross-schema FK strategy to aweb.projects and (optionally) aweb.api_keys\\n- Decide minimal RBAC model for v0 (owner/admin/editor/viewer)\\n\\nThis is scaffolding only; no full product UX required.","acceptance_criteria":"aweb_cloud migrations exist; schema is isolated; cross-schema references are explicit; fixtures/tests validate migrations apply cleanly alongside aweb core.","status":"closed","priority":3,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-21T09:25:10.857981+01:00","created_by":"Juan Reyero","updated_at":"2026-01-21T10:49:09.234449+01:00","closed_at":"2026-01-21T10:49:09.234449+01:00","close_reason":"Added aweb_cloud schema manager + initial migrations (users/orgs/project_members/project_billing/oauth_accounts) with cross-schema FK to aweb.projects; added migration test verifying both schemas apply cleanly.","dependencies":[{"issue_id":"beadhub-5hch.4","depends_on_id":"beadhub-5hch","type":"parent-child","created_at":"2026-01-21T09:25:10.858937+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-5hch.5","title":"aweb-cloud: Wrapper skeleton mounting/proxying aweb-oss","description":"Implement a minimal aweb-cloud wrapper service that can mount/proxy the aweb-oss core:\\n- Authenticate humans (JWT/cookie stub is fine initially)\\n- Select project context + inject X-Project-ID (and actor headers)\\n- Mount core at /api (or proxy HTTP requests)\\n- Provide an SSE proxy path for aweb chat streams (EventSource-safe)\\n\\nGoal is to validate the core+wrapper boundary and header-injection trust model.","acceptance_criteria":"Wrapper can serve as the sole public entrypoint; core runs behind it with proxy-header mode enabled; SSE works from browser constraints via wrapper; no client can choose project_id directly.","status":"closed","priority":3,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-21T09:25:26.98495+01:00","created_by":"Juan Reyero","updated_at":"2026-01-21T11:06:16.230802+01:00","closed_at":"2026-01-21T11:06:16.230802+01:00","close_reason":"Added minimal aweb-cloud wrapper skeleton under src/aweb_cloud (isolated for future repo split) that mounts aweb-oss at /api with ASGI header injection (X-AW-Auth/X-Project-ID/X-User-ID), including a test validating project scoping without Bearer auth.","dependencies":[{"issue_id":"beadhub-5hch.5","depends_on_id":"beadhub-5hch","type":"parent-child","created_at":"2026-01-21T09:25:26.986012+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-5isf","title":"P0 sync gap repro 2","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T16:56:30.832995+01:00","created_by":"juanre","updated_at":"2026-01-07T18:02:47.46124+01:00","deleted_at":"2026-01-07T18:02:47.46124+01:00","deleted_by":"juanre","delete_reason":"delete","original_type":"task"}
{"id":"beadhub-5ja8","title":"Missing TTL validation in presence.py function","description":"Location: src/beadhub/presence.py:17-65. update_agent_presence accepts arbitrary ttl_seconds without validation. API route validates (max 86400) but function itself doesn't. Direct callers could pass invalid values causing: extremely long TTLs exhausting Redis, very short TTLs causing thrashing, negative TTLs. Fix: add validation in function, not just API boundary.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-08T18:25:31.427534+01:00","updated_at":"2025-12-08T18:25:31.427534+01:00"}
{"id":"beadhub-5m0f","title":"MCP get_issue fetches all issues instead of direct query","description":"Location: routes/mcp.py:476-485. The _tool_get_issue function fetches up to 1000 issues via http_beads_issues then filters client-side to find one by bead_id. With thousands of customers and millions of issues, this is catastrophic for performance - O(N) when it should be O(1) with an indexed query. Fix: Add a direct GET /v1/beads/issues/{bead_id} endpoint or query parameter, then use it in MCP.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-09T19:54:24.091845+01:00","updated_at":"2025-12-09T20:23:58.671552+01:00","closed_at":"2025-12-09T20:23:58.671552+01:00"}
{"id":"beadhub-5m35","title":"Extract duplicate audit log and notification patterns in beads.py","description":"## Problem\n\nAudit logging and notification processing code is duplicated in `beads_upload` and `beads_upload_jsonl` endpoints.\n\n### Current Behavior\n\n**Audit log duplication** (lines 89-111, 260-282):\n```python\nawait server_db.execute(\n    \"\"\"\n    INSERT INTO {{tables.audit_log}} (\n        project_id,\n        event_type,\n        details\n    )\n    VALUES ($1, $2, $3::jsonb)\n    \"\"\",\n    project_id,\n    \"beads_uploaded\",\n    json.dumps({\n        \"project_id\": project_id,\n        \"repo\": ...,\n        \"branch\": ...,\n        # ...\n    }),\n)\n```\n\n**Notification duplication** (lines 113-121, 284-292):\n```python\nnotifications_sent = 0\nnotifications_failed = 0\nif result.status_changes:\n    await record_notification_intents(result.status_changes, project_id, db_infra)\n    notifications_sent, notifications_failed = await process_notification_outbox(\n        project_id, db_infra, redis\n    )\n```\n\n### Solution\n\nExtract to helper functions:\n\n```python\n# beads.py or new audit.py\n\nasync def record_beads_upload_audit(\n    db: DatabaseInfra,\n    project_id: str,\n    repo: str,\n    branch: str,\n    result: BeadsSyncResult,\n    source: str,  # \"json\" or \"jsonl\"\n) -\u003e None:\n    \"\"\"Record audit log entry for beads upload.\"\"\"\n    server_db = db.get_manager(\"server\")\n    await server_db.execute(\n        \"\"\"\n        INSERT INTO {{tables.audit_log}} (project_id, event_type, details)\n        VALUES ($1, $2, $3::jsonb)\n        \"\"\",\n        project_id,\n        \"beads_uploaded\",\n        json.dumps({\n            \"project_id\": project_id,\n            \"repo\": repo,\n            \"branch\": branch,\n            \"source\": source,\n            \"stats\": {\n                \"inserted\": result.stats.inserted,\n                \"updated\": result.stats.updated,\n                \"deleted\": result.stats.deleted,\n                \"unchanged\": result.stats.unchanged,\n            },\n        }),\n    )\n\nasync def process_status_change_notifications(\n    result: BeadsSyncResult,\n    project_id: str,\n    db_infra: DatabaseInfra,\n    redis: Redis,\n) -\u003e tuple[int, int]:\n    \"\"\"Process notifications for status changes, return (sent, failed) counts.\"\"\"\n    if not result.status_changes:\n        return 0, 0\n    \n    await record_notification_intents(result.status_changes, project_id, db_infra)\n    return await process_notification_outbox(project_id, db_infra, redis)\n```\n\n### Files to Update\n\n- `src/beadhub/routes/beads.py`\n\n### Acceptance Criteria\n\n- [ ] Audit logging extracted to single helper\n- [ ] Notification processing extracted to single helper\n- [ ] Both upload endpoints use shared helpers\n- [ ] All existing tests pass","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-08T12:40:19.796285+01:00","created_by":"juanre","updated_at":"2026-01-08T12:40:19.796285+01:00"}
{"id":"beadhub-5o21","title":"bdh :send/:who: scope alias/workspace listing to project to avoid cross-project collisions","description":"Commands like :send resolve alias by calling GET /v1/workspaces without any project filter, then matching by Alias. If aliases are only unique per project, this can select the wrong workspace across projects (and :who can leak broader info). Use project-scoped filtering (e.g., WorkspacesRequest.ProjectSlug=cfg.ProjectSlug or add ProjectID support) and have server enforce project scoping.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T12:52:10.307681+01:00","updated_at":"2025-12-13T16:51:02.571931+01:00","closed_at":"2025-12-13T16:51:02.571931+01:00","dependencies":[{"issue_id":"beadhub-5o21","depends_on_id":"beadhub-t265","type":"discovered-from","created_at":"2025-12-13T12:52:10.309266+01:00","created_by":"juanre"}]}
{"id":"beadhub-5ot7","title":"Add --subject flag to bdh :send command","description":"The :send command currently only takes \u003ctarget\u003e \u003cmessage\u003e. The backend messages table has a subject field (TEXT NOT NULL DEFAULT ''), but the CLI doesn't expose it. Add --subject flag to allow setting email subjects.\n\nChanges needed:\n- bdh/internal/commands/send.go: add --subject flag\n- bdh/internal/client/client.go: update SendMessage request struct\n- docs/AGENTS.md.template: update send_message example to show subject parameter","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-20T14:11:30.895778+01:00","updated_at":"2025-12-20T14:22:56.059873+01:00","closed_at":"2025-12-20T14:22:56.059873+01:00","close_reason":"Implemented --subject flag for bdh :send command. Added validation (max 255 chars, no newlines), tests, and updated docs."}
{"id":"beadhub-5qf","title":"bdh CLI wrapper","description":"CLI wrapper around bd that syncs to BeadHub server automatically.\n\nCommands:\n- bdh init: Generate .beadhub file with new workspace_id, prompt for server URL\n- bdh sync: Manual sync of .beads/issues.jsonl to BeadHub server\n- bdh ready: bd ready + show unread BeadHub messages\n- bdh \u003cany\u003e: Pass through to bd, then auto-sync if issues changed\n\nFeatures:\n- Read .beadhub config for server URL and workspace_id\n- Show unread message count in prompt\n- Handle offline gracefully (queue syncs)\n\nImplementation:\n- Python CLI using Typer (same as beadhub CLI)\n- Subprocess wrapper for bd commands\n- HTTP client to BeadHub API","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-08T11:51:41.49605+01:00","updated_at":"2025-12-20T09:59:49.89968+01:00","closed_at":"2025-12-20T09:59:49.89968+01:00","close_reason":"Obsolete - superseded by beadhub-t265 (Go rewrite). Original vision was a simple Python/Typer wrapper; actual implementation is a full Go CLI with chat, mail, escalations, and file locking."}
{"id":"beadhub-5qm3","title":"Chat: notify sender when recipient reads message + extend timeout","description":"## Summary\n\nWhen Alice starts a chat with `--start-conversation` and waits, she currently has no visibility into whether Bob has seen her message. She waits up to 5 minutes in the dark, then times out.\n\nThis feature adds **read receipts**: when Bob opens the conversation (`bdh :chat --open alice`), Alice receives a notification via SSE and her timeout is extended, giving Bob time to formulate a response.\n\n## Motivation\n\n- Alice invests time waiting for a response\n- Without feedback, she does not know if Bob is ignoring her, busy, or simply has not seen the message yet\n- A read receipt provides meaningful signal: \"Bob actively engaged with your message\"\n- Extending the timeout after a read gives Bob reasonable time to respond\n\n## Design\n\n### Event Flow\n\n1. Alice: `bdh :chat --reply bob \"Question?\" --start-conversation`\n   - Message stored, Alice connects to SSE, waits up to 5 minutes\n\n2. Bob: `bdh ready` (or any command)\n   - Sees: `WAITING: alice â€” Run \"bdh :chat --open alice\"`\n\n3. Bob: `bdh :chat --open alice`\n   - Fetches unread messages\n   - Calls `POST /v1/chat/sessions/{id}/read` (existing)\n   - **NEW**: Server publishes `read_receipt` event to Redis `chat:{session_id}`\n   - **NEW**: Server returns `wait_extended_seconds` in response so Bob knows Alice has more time\n\n4. Alice (via SSE):\n   - Receives: `{\"type\": \"read_receipt\", \"reader\": \"bob\", \"reader_alias\": \"bob\", \"timestamp\": \"...\"}`\n   - CLI displays: `[chat] bob opened the conversation`\n   - Timeout extended by 3 minutes (capped at 10 minutes total wait)\n\n5. Bob sees confirmation:\n   - `[14:32:05] alice: Question?`\n   - `Note: alice's wait extended by 3 min â€” you have time to respond`\n   - `Next: Run \"bdh :chat --reply alice \\\"your reply\\\"\" or --hang-on for more time`\n\n6. Bob: `bdh :chat --reply alice \"Sure, what is up?\"`\n   - Normal reply flow, Alice receives message and exits\n\n### Server Changes (Python)\n\n**`routes/chat.py`:**\n- In `mark_read()` endpoint, after updating `chat_read_receipts`:\n  ```python\n  await publish_chat_event(\n      redis,\n      session_id,\n      ChatReadReceiptEvent(\n          reader=workspace_id,\n          reader_alias=alias,\n          up_to_message_id=up_to_message_id,\n      )\n  )\n  ```\n- Return `wait_extended_seconds` in response (if sender was waiting)\n\n**`events.py`:**\n- Add `ChatReadReceiptEvent` dataclass\n- Update `stream_chat_events()` to yield read receipt events\n\n### CLI Changes (Go)\n\n**`bdh/internal/commands/chat.go`:**\n- In `runChatWait()` SSE handler, handle `read_receipt` event type:\n  ```go\n  case \"read_receipt\":\n      var receipt ReadReceiptEvent\n      json.Unmarshal(data, \u0026receipt)\n      fmt.Printf(\"[chat] %s opened the conversation\\n\", receipt.ReaderAlias)\n      // Extend deadline by 3 minutes, cap at 10 minutes total\n      newDeadline := time.Now().Add(3 * time.Minute)\n      maxDeadline := startTime.Add(10 * time.Minute)\n      if newDeadline.After(maxDeadline) {\n          newDeadline = maxDeadline\n      }\n      deadline = newDeadline\n  ```\n\n- In `runChatOpen()`, after marking read:\n  ```go\n  if resp.WaitExtendedSeconds \u003e 0 {\n      fmt.Printf(\"Note: %s's wait extended by %d min â€” you have time to respond\\n\",\n          senderAlias, resp.WaitExtendedSeconds/60)\n      fmt.Printf(\"Next: Run \\\"bdh :chat --reply %s \\\\\\\"your reply\\\\\\\"\\\" or --hang-on for more time\\n\",\n          senderAlias)\n  }\n  ```\n\n**`bdh/internal/client/client.go`:**\n- Add `ReadReceiptEvent` struct (if needed for typed handling)\n- Add `WaitExtendedSeconds` to `MarkReadResponse`\n\n### Edge Cases\n\n1. **Multiple readers**: In N-party chats, each reader triggers a separate event. Alice sees notifications for each.\n\n2. **Repeated reads**: Bob running `--open` multiple times should only notify Alice once per \"unread period\". The server should track this (e.g., only publish if there were actually unread messages marked as read).\n\n3. **Timeout cap**: Total wait time capped at 10 minutes regardless of how many read receipts. Prevents infinite waiting.\n\n4. **Bob reads but never replies**: Alice eventually times out at 10 minutes max. This is acceptable â€” she got feedback that Bob saw it.\n\n5. **Alice disconnects before read receipt**: Event is lost (SSE is fire-and-forget). This is fine â€” read receipts are informational, not critical.\n\n6. **Alice not waiting**: If Alice sent with `--no-wait` or already timed out, `wait_extended_seconds` is 0 and Bob does not see the extension note.\n\n## Related Features\n\n- **beadhub-yysg**: Urgent time display (\u003c 1 min left)\n- **beadhub-bnyk**: --hang-on command for requesting more time\n\n## Out of Scope\n\n- \"Notified\" events (when Bob sees WAITING notification) â€” too fuzzy, less meaningful than read receipts\n- Typing indicators â€” different feature, higher complexity\n- Persistent read receipt history â€” not needed for this use case\n\n## Testing\n\n1. Unit test: `mark_read()` publishes `read_receipt` event\n2. Unit test: `mark_read()` returns `wait_extended_seconds` when sender waiting\n3. Integration test: Alice SSE receives event when Bob calls `--open`\n4. Integration test: Bob sees extension note when Alice was waiting\n5. CLI test: Timeout extension logic with cap\n\n## Acceptance Criteria\n\n- [ ] When Bob runs `bdh :chat --open alice`, Alice sees `[chat] bob opened the conversation`\n- [ ] Alice's timeout is extended by 3 minutes (capped at 10 min total)\n- [ ] Bob sees \"Note: alice's wait extended by 3 min\" when Alice was waiting\n- [ ] Read receipt only sent if there were actually unread messages\n- [ ] Works correctly in N-party chats (each reader notifies)","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-09T19:36:40.157616+01:00","created_by":"juanre","updated_at":"2026-01-09T20:04:38.781533+01:00","closed_at":"2026-01-09T20:04:38.781533+01:00","close_reason":"Implemented in commit 9a27b48"}
{"id":"beadhub-5t7p","title":"Chat mark_read should validate up_to_message_id and set last_read_at from message","description":"POST /v1/chat/sessions/{session_id}/read currently sets last_read_at = NOW() and does not verify that up_to_message_id belongs to this session. GET /v1/chat/pending computes unread_count via m.created_at \u003e last_read_at, so using NOW() can incorrectly mark as read messages that arrived before the call but after the client\\x27s last seen message (race), and accepting arbitrary message_ids can corrupt read state.\n\nFix: lookup (up_to_message_id, created_at) in chat_messages WHERE session_id=$1 AND message_id=$2; set last_read_message_id to that id and last_read_at to that message\\x27s created_at. Return 400/404 if message_id not in session.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-14T08:51:06.99087+01:00","updated_at":"2025-12-14T09:14:50.750132+01:00","closed_at":"2025-12-14T09:14:50.750132+01:00"}
{"id":"beadhub-5t8","title":"Add project_id to workspace config and auth dependency","description":"Add project_id field to BeadhubConfig, get_project_id() function to workspace_config.py, and get_project_id FastAPI dependency to auth.py","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T22:29:08.500314+01:00","updated_at":"2025-12-08T01:04:08.421312+01:00","closed_at":"2025-12-08T01:04:08.421312+01:00","dependencies":[{"issue_id":"beadhub-5t8","depends_on_id":"beadhub-4mj","type":"discovered-from","created_at":"2025-12-07T22:29:08.501339+01:00","created_by":"juanre"}]}
{"id":"beadhub-5thx","title":"Go client: send hostname and path on init/commands","description":"Update bdh init and command requests to include os.Hostname() and os.Getwd(). Store in .beadhub config if needed.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T19:07:01.060689+01:00","updated_at":"2025-12-21T21:00:01.472064+01:00","closed_at":"2025-12-21T21:00:01.472064+01:00","close_reason":"Implemented hostname and workspace_path in Go client for gone workspace detection","dependencies":[{"issue_id":"beadhub-5thx","depends_on_id":"beadhub-5wir","type":"parent-child","created_at":"2025-12-17T19:07:01.062254+01:00","created_by":"juanre"},{"issue_id":"beadhub-5thx","depends_on_id":"beadhub-nyjx","type":"blocks","created_at":"2025-12-17T19:07:07.096535+01:00","created_by":"juanre"}]}
{"id":"beadhub-5ulu","title":"beadhub-cloud: require internal auth secret, unify retention, prod Redis required","description":"## Context\nalice-implementerâ€™s OSS/cloud review surfaced a few remaining cloud-wrapper correctness/security items:\n- `BEADHUB_INTERNAL_AUTH_SECRET` currently falls back to `SESSION_SECRET_KEY` in multiple places (cloud + aweb auth). aweb side is being fixed separately.\n- Retention configuration values are inconsistent (comments/expectations: 7/90 days; config values: 30/365 etc).\n- Rate limiter falls back to in-memory when Redis is unavailable (fine for dev, not for horizontally scaled production).\n\n## Goals\n- Cloud trust-boundary secrets are explicit and fail fast in production.\n- Retention is defined in one place and consistent with billing tier limits.\n- Production startup fails if Redis is not available for rate limiting.\n\n## Proposed Changes\n### 1) Internal auth secret\n- In beadhub-cloud production (`ENVIRONMENT=prod|production`), require `BEADHUB_INTERNAL_AUTH_SECRET` (no fallback).\n- In dev, allow fallback but log loudly.\n\n### 2) Retention config consolidation\n- Make billing tier limits canonical: free=7, pro=90, business=365, oss=90 (per `beadhub_cloud/models/billing.py:TIER_LIMITS`).\n- Remove/avoid conflicting duplicated retention settings in config.\n\n### 3) Redis requirement for rate limiting\n- In production, if Redis init fails, abort startup.\n- In development, allow in-memory fallback with warning.\n\n## Tests\n- Add/adjust tests in beadhub-cloud to lock:\n  - prod requires internal auth secret\n  - prod requires Redis\n  - retention values are consistent and come from the canonical source\n\n## Done When\n- beadhub-cloud backend tests pass.\n- No silent fallback for internal secrets in production.\n- Retention values are unambiguous and consistent.\n","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-03T14:18:09.293198Z","created_by":"Juan Reyero","updated_at":"2026-02-03T15:44:35.554235Z","closed_at":"2026-02-03T15:44:35.554235Z","close_reason":"Implemented beadhub-cloud hardening (17d1c47) + aweb protocol fixes (552b76e). Tests: beadhub-cloud 588 passed, aweb 28 passed.","labels":["cloud","rate-limit","retention","security","tenant-isolation"]}
{"id":"beadhub-5v39","title":"SSE: Unify filter parameters with /v1/workspaces endpoint","description":"## Problem\n\nFilter parameter names differ between endpoints, causing confusion:\n\n| Parameter | /v1/status/stream | /v1/workspaces |\n|-----------|-------------------|----------------|\n| project | project_slug | project_slug |\n| repo | repo_id (UUID) | repo (canonical_origin string) |\n| owner | âŒ missing | human_name |\n\nThis inconsistency means:\n1. Frontend needs different filter logic for different endpoints\n2. Dashboard can't easily filter SSE by repo name (only by UUID)\n3. human_name filter is missing from SSE\n\n## Location\n\n`src/beadhub/routes/status.py:192-228`\n\n## Fix Required\n\n1. SSE should accept `repo` (canonical_origin) in addition to `repo_id`\n2. Add `human_name` filter to SSE endpoint\n3. Consider deprecating `repo_id` in favor of `repo` for consistency\n\n## Related\n\n- beadhub-qmp0: project_slug uses Redis\n- beadhub-sgjk: repo_id uses Redis","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T09:48:56.248393+01:00","updated_at":"2025-12-21T13:16:57.776264+01:00","closed_at":"2025-12-21T13:16:57.776264+01:00","close_reason":"Unified SSE filter parameters with /v1/workspaces. Replaced repo_id (UUID) with repo (canonical_origin), added human_name filter, updated all 3 frontends (beadhub, beadhub-tester, beadhub-coord).","dependencies":[{"issue_id":"beadhub-5v39","depends_on_id":"beadhub-qmp0","type":"blocks","created_at":"2025-12-21T09:49:05.086912+01:00","created_by":"juanre"},{"issue_id":"beadhub-5v39","depends_on_id":"beadhub-sgjk","type":"blocks","created_at":"2025-12-21T09:49:05.323737+01:00","created_by":"juanre"}]}
{"id":"beadhub-5vr6","title":"Add parameter validation to chat API methods","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-13T14:55:38.714128+01:00","updated_at":"2025-12-13T14:55:38.714128+01:00"}
{"id":"beadhub-5wez","title":"Stop bd execution on claim rejection (unless --:jump-in)","description":"Currently bdh runs bd even when server rejects a claim. Change to: exit with error on rejection, show rejection info. Only run bd if --:jump-in flag is present.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T11:27:32.972069+01:00","updated_at":"2025-12-13T12:04:30.509431+01:00","closed_at":"2025-12-13T12:04:30.509431+01:00","dependencies":[{"issue_id":"beadhub-5wez","depends_on_id":"beadhub-3r30","type":"parent-child","created_at":"2025-12-13T11:28:12.915101+01:00","created_by":"juanre"}]}
{"id":"beadhub-5wir","title":"Auto-detect gone workspaces using hostname + path","description":"Store hostname and full path for each workspace in DB. On commands like 'bdh :status', check if directories for workspaces on THIS hostname still exist. If not, mark as gone.\n\nImplementation:\n1. DB migration: add hostname and workspace_path columns to workspaces\n2. bdh init: send hostname (os.Hostname()) and cwd when registering\n3. bdh :status (or similar): fetch workspaces for this hostname, check if paths exist, mark missing as gone\n4. API: update workspace registration to accept hostname/path\n\nKey insight: only check workspaces matching current hostname - avoids cross-machine false positives.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-17T19:05:41.613897+01:00","updated_at":"2025-12-21T21:40:58.618664+01:00","closed_at":"2025-12-21T21:40:58.618664+01:00","close_reason":"All subtasks completed - gone workspace detection fully implemented"}
{"id":"beadhub-5y0","title":"Path traversal validation logic is flawed - resolved==normalized always true","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-03T17:25:20.003293+01:00","updated_at":"2025-12-03T17:27:00.690315+01:00","closed_at":"2025-12-03T17:27:00.690315+01:00"}
{"id":"beadhub-5zjr","title":"Message ID uses timestamp - collision risk under high load","description":"Location: routes/messages.py:138-140. Message IDs are generated as msg_{timestamp} with microsecond precision. Under high load with thousands of concurrent customers, two messages in the same microsecond get the same ID. Redis HSET would overwrite one silently. Fix: Add UUID suffix or use full UUID for message_id.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-09T19:54:24.25752+01:00","updated_at":"2025-12-09T19:55:38.548357+01:00","closed_at":"2025-12-09T19:55:38.548357+01:00"}
{"id":"beadhub-61bu","title":"Magic string event types instead of enum","description":"Location: src/beadhub/events.py:25-32 and frontend API types. Event types defined as strings in dataclasses but also checked as enum values. Using string literals throughout makes refactoring error-prone. Fix: use EventCategory enum consistently everywhere including frontend types.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-08T18:26:00.159214+01:00","updated_at":"2025-12-08T18:26:00.159214+01:00"}
{"id":"beadhub-62gm","title":"Server: Add targets_left to chat session response","description":"Add targets_left field to POST /v1/chat/sessions response.\n\nFor each target alias in to_aliases, query their last message in the session. If sender_leaving is true, include them in targets_left.\n\nResponse change:\n{\n  ...existing fields...\n  \"targets_left\": [\"agent-p2\"]  // aliases whose last msg had sender_leaving\n}\n\nParent: beadhub-bwpi","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T21:32:14.860574+01:00","updated_at":"2025-12-17T18:57:02.782611+01:00","closed_at":"2025-12-17T18:57:02.782611+01:00","close_reason":"Already implemented in commit a6345ab (feat(chat): add v2.5 targets_left support for smart wait logic)"}
{"id":"beadhub-6am","title":"Implement workspace_id architecture","description":"Replace project_key with workspace_id as the universal identifier for BeadHub coordination. See source-of-truth/workspace-identity-architecture.md for full specification.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-07T19:09:44.884134+01:00","updated_at":"2025-12-07T20:00:25.877791+01:00","closed_at":"2025-12-07T20:00:25.877791+01:00"}
{"id":"beadhub-6bl","title":"Add offset/cursor pagination to list endpoints","description":"Add cursor-based pagination to remaining list endpoints that can grow unbounded.\n\nCurrent state:\n- Cursor pagination already exists for: messages inbox, escalations list, claims list, workspaces list, chat admin session list.\n- Remaining list endpoints without cursor pagination: GET /v1/projects and GET /v1/repos (currently return all rows).\n\nChange:\n- Add limit+cursor params with next_cursor+has_more responses to /v1/projects and /v1/repos, using the same validate_pagination_params/encode_cursor utilities.\n- Keep ordering deterministic (e.g., by created_at then id).\n\nNon-goals:\n- Do not change existing paginated endpoints.","acceptance_criteria":"- GET /v1/projects supports limit+cursor and returns has_more/next_cursor\n- GET /v1/repos supports limit+cursor and returns has_more/next_cursor\n- Cursor is stable and deterministic across inserts\n- Backwards compatible: omitting cursor returns first page","notes":"Assigned for implementation. Add cursor pagination to GET /v1/projects and GET /v1/repos (deterministic ordering + stable cursor), keep backwards compatibility when cursor omitted.","status":"closed","priority":3,"issue_type":"feature","assignee":"frank-agent","created_at":"2025-12-03T15:39:13.399789+01:00","updated_at":"2026-01-03T19:30:30.243304Z","closed_at":"2026-01-03T19:30:30.243304Z","close_reason":"Implemented cursor pagination for GET /v1/projects and GET /v1/repos with stable (created_at, id) cursor; added tests."}
{"id":"beadhub-6d4m","title":"Update escalations and audit_log tables: rename agent_name to alias","description":"Edit server/001_initial.sql to rename agent_name â†’ alias in:\n\n1. escalations table:\n   - agent_name column â†’ alias\n   - idx_escalations_workspace stays same\n\n2. audit_log table:\n   - agent_name column â†’ alias\n   - idx_audit_log_agent â†’ idx_audit_log_alias\n\nThese are simple renames with no structural changes.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T12:50:07.307286+01:00","updated_at":"2025-12-12T15:18:40.953256+01:00","closed_at":"2025-12-12T15:18:40.953256+01:00"}
{"id":"beadhub-6egu","title":"Show loading state in SendMessageDialog when identity not ready","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T20:35:05.362604+01:00","updated_at":"2025-12-13T20:45:14.416325+01:00","closed_at":"2025-12-13T20:45:14.416325+01:00"}
{"id":"beadhub-6eyw","title":"Deprecate inbox system in favor of unified chat","description":"Remove inbox references from AGENTS-template.md and remove :inbox/:send/:ack commands from bdh CLI. Keep the server-side inbox API for now (potential mcp-agent-mail compatibility).","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-14T17:07:19.409589+01:00","updated_at":"2025-12-14T17:33:01.765579+01:00","closed_at":"2025-12-14T17:33:01.765579+01:00","dependencies":[{"issue_id":"beadhub-6eyw","depends_on_id":"beadhub-2s14","type":"blocks","created_at":"2025-12-14T17:07:27.000862+01:00","created_by":"juanre"}]}
{"id":"beadhub-6gfo","title":"Add bead_claims table for tracking who is working on which bead","description":"Create new database table to track bead claims:\n\nCREATE TABLE bead_claims (\n    id UUID PRIMARY KEY,\n    workspace_id TEXT NOT NULL,\n    agent_name TEXT NOT NULL,\n    human_name TEXT NOT NULL,\n    project_key TEXT NOT NULL,\n    bead_id TEXT NOT NULL,\n    claimed_at TIMESTAMPTZ NOT NULL,\n    UNIQUE(project_key, bead_id)\n);\n\nThis replaces file-level locking. One claim per bead per project.\n\nNOTE: No production data. Can delete existing migrations and start fresh.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T09:34:02.591158+01:00","updated_at":"2025-12-10T10:04:51.155707+01:00","closed_at":"2025-12-10T10:04:51.155707+01:00","dependencies":[{"issue_id":"beadhub-6gfo","depends_on_id":"beadhub-4trs","type":"parent-child","created_at":"2025-12-10T09:36:05.35319+01:00","created_by":"juanre"}]}
{"id":"beadhub-6gix","title":"Focus apex shows stale closed bead when agent works without claiming","description":"Problem: Frank is actively working in beadhub-cloud (claiming beads, running bdh), but in beadhub's :who output:\n- Shows 'Recent focus' instead of active claims\n- Earlier showed as 'offline â€” 46 min ago' despite active work\n\nExpected: Agents working in sibling projects (same human/tenant) should show their claims in :who regardless of which project the :who command is run from.\n\nInvestigation needed:\n1. How does :who fetch claims? Does it filter by project?\n2. Should claims be visible across projects in same tenant?\n3. Is the presence update working correctly for cross-project workspaces?\n4. Check /v1/workspaces/team endpoint - does it include cross-project claims?\n\nThis affects coordination - coordinator can't see what agents are working on if they're in a different project.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-22T00:09:41.814414+01:00","updated_at":"2025-12-22T00:29:07.762897+01:00","closed_at":"2025-12-22T00:29:07.762897+01:00","close_reason":"Not a bug - showing 'Recent focus' for agents without active claims is intended behavior. Frank's visibility issue was transient."}
{"id":"beadhub-6lcm","title":"Fix pre-existing test failures in test_cli_init, test_error_paths, test_subscriptions","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-21T16:13:55.59893+01:00","updated_at":"2025-12-21T18:29:48.971115+01:00","closed_at":"2025-12-21T18:29:48.971115+01:00","close_reason":"Tests now pass after merge from main - 36/36 passing"}
{"id":"beadhub-6lj6","title":"Remove redundant Agents/Workspaces stat card from Status page","description":"The Status page shows workspace count in two places:\n1. 'WORKSPACES' stat card with count\n2. 'Active Workspaces' detail card with list\n\nWhen count is 0, this shows '0' + 'No workspaces connected' - redundant.\n\nRemove the stat card since the detail card already shows the count implicitly via its list. Keep only the detail card.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-14T00:11:31.869168+01:00","updated_at":"2025-12-14T18:17:29.032915+01:00","closed_at":"2025-12-14T00:21:23.266594+01:00"}
{"id":"beadhub-6mfl","title":"Remove :lock and :unlock commands from bdh","description":"With auto-reserve handling file reservations automatically, manual :reserve/:release commands are unnecessary overhead. Remove them from:\n- bdh Go CLI (reserve.go, release.go, root.go registration)\n- docs/AGENTS-template.md (File Locks/Reservations section)\n- Keep :reservations command for checking active reservations\n\nNote: Commands were renamed from :lock/:unlock to :reserve/:release in beadhub-c5r.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-22T01:16:50.706727+01:00","updated_at":"2025-12-22T16:10:03.139354+01:00","closed_at":"2025-12-22T16:10:03.139354+01:00","close_reason":"Merged to main - :reserve/:release removed"}
{"id":"beadhub-6nsh","title":"Add explicit edge case handling for empty Events/FromAgent in chat pending display","description":"In formatChatOutput() pending case (chat.go:578-598), if Events is empty or FromAgent is empty, we default to 'Pending message from X' which may be incorrect.\n\nCurrent code:\n```go\nlastFrom := result.TargetAgent\nif len(result.Events) \u003e 0 \u0026\u0026 result.Events[0].FromAgent != \"\" {\n    lastFrom = result.Events[0].FromAgent\n}\n```\n\nIn practice, showPendingMessage() always populates Events[0].FromAgent, so this is unlikely to happen. But for defensive programming, consider:\n1. Adding explicit else clause with appropriate message\n2. Adding test coverage for these edge cases\n\nLow priority since the common path works correctly.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-16T09:16:26.106305+01:00","updated_at":"2025-12-16T09:16:26.106305+01:00"}
{"id":"beadhub-6o79","title":"Add BEADHUB_REQUIRE_PROJECT_HEADER flag for Cloud integration security","description":"CRITICAL SECURITY: When OSS is embedded in Cloud, agent-tier endpoints (reservations, messages, escalations) are completely open. If attacker bypasses Cloud layer or OSS port is exposed, they have full access. Add BEADHUB_REQUIRE_PROJECT_HEADER=true flag that rejects all requests without X-Project-ID header. This makes OSS safe-by-default when embedded, without depending on network configuration. Location: src/beadhub/auth.py. Implementation: add middleware or dependency that checks for X-Project-ID on all agent endpoints when flag is set.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-08T18:33:49.283697+01:00","updated_at":"2026-01-09T18:47:38.552891+01:00","closed_at":"2026-01-09T18:47:38.552891+01:00","close_reason":"Already addressed: Cloud's OssAuthMiddleware requires X-BH-Auth header (HMAC-signed attestation) on all OSS requests. Attackers bypassing Cloud can't forge this without session_secret_key. See beadhub-cloud/backend/src/beadhub_cloud/middleware/oss_auth.py."}
{"id":"beadhub-6q5s","title":"Add error handling for identity fetch failure in Layout","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T20:35:05.062613+01:00","updated_at":"2025-12-13T20:45:14.141393+01:00","closed_at":"2025-12-13T20:45:14.141393+01:00"}
{"id":"beadhub-6qe","title":"Add workspace discovery endpoint","description":"Add GET /v1/workspaces endpoint to list registered workspaces. Returns workspace_id, agent_name, repo, branch, user, last_seen. Supports filtering by repo. For Cloud: scoped to project via API key.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T19:10:10.150446+01:00","updated_at":"2025-12-07T21:00:44.351048+01:00","closed_at":"2025-12-07T21:00:44.351048+01:00","dependencies":[{"issue_id":"beadhub-6qe","depends_on_id":"beadhub-6am","type":"blocks","created_at":"2025-12-07T19:10:10.151517+01:00","created_by":"juanre"}]}
{"id":"beadhub-6qlj","title":"Refactor get_pending to use read receipts","description":"Modify GET /v1/chat/pending to:\n\n1. Query sessions where workspace is a participant\n2. Join with chat_read_receipts to find unread messages\n3. Return sessions with unread_count \u003e 0\n4. Include last_message, other_alias, last_activity\n\nRemove: Redis pending set lookups, expires_at checks","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T20:25:32.717816+01:00","updated_at":"2025-12-14T00:39:10.789058+01:00","closed_at":"2025-12-14T00:39:10.789058+01:00","dependencies":[{"issue_id":"beadhub-6qlj","depends_on_id":"beadhub-6t7d","type":"blocks","created_at":"2025-12-13T20:26:14.866697+01:00","created_by":"juanre"}]}
{"id":"beadhub-6qya","title":"Chat alias resolution returns deleted workspaces","description":"In chat.py _resolve_alias_to_workspace(), the query doesn't filter by deleted_at IS NULL. When a workspace is deleted and recreated with the same alias, chat messages can be routed to the deleted workspace instead of the active one. Fix: add 'AND deleted_at IS NULL' to the query at line 50.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-21T20:27:40.03559+01:00","updated_at":"2025-12-21T20:28:25.654802+01:00","closed_at":"2025-12-21T20:28:25.654802+01:00","close_reason":"Added deleted_at IS NULL filter to _resolve_alias_to_workspace query"}
{"id":"beadhub-6s1f","title":"CLAUDE.md missing chat documentation - agents use :inbox instead of :chat --pending","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-11T19:27:02.043166+01:00","updated_at":"2025-12-11T19:30:29.500826+01:00","closed_at":"2025-12-11T19:30:29.500826+01:00"}
{"id":"beadhub-6s8f","title":"Add role field to Redis presence schema","description":"Update presence:{workspace_id} hash to include role field. Update presence refresh logic.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-14T09:06:35.170128+01:00","updated_at":"2025-12-14T09:30:22.694582+01:00","closed_at":"2025-12-14T09:30:22.694582+01:00","dependencies":[{"issue_id":"beadhub-6s8f","depends_on_id":"beadhub-161u","type":"parent-child","created_at":"2025-12-14T09:24:10.985698+01:00","created_by":"juanre"}]}
{"id":"beadhub-6srg","title":"Hardcoded magic numbers for TTLs and limits","description":"Location: reservations.py:23 LOCK_MAX_TTL_SECONDS=3600, messages.py:18 INBOX_TTL_SECONDS=7*24*3600, reservations.py:26 PATH_HASH_LENGTH=16, beads.py:230 MAX_JSONL_SIZE=10MB. Makes tuning for different environments difficult. Fix: make configurable via environment variables or settings.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-08T18:25:31.078835+01:00","updated_at":"2025-12-08T18:25:31.078835+01:00"}
{"id":"beadhub-6sy6","title":"Separate sender_leaving display logic from message body","description":"When sender_leaving is true, we append '[agent has left]' to message body, mixing presentation with data. Store sender_leaving separately and render in UI layer instead.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-14T21:49:20.981944+01:00","updated_at":"2025-12-14T21:50:57.57149+01:00","closed_at":"2025-12-14T21:50:57.57149+01:00"}
{"id":"beadhub-6t7d","title":"Add chat_read_receipts table migration","description":"Create Postgres migration to add chat_read_receipts table:\n\nCREATE TABLE chat_read_receipts (\n    workspace_id UUID NOT NULL,\n    session_id TEXT NOT NULL REFERENCES chat_sessions(session_id),\n    last_read_message_id TEXT,\n    last_read_at TIMESTAMPTZ,\n    PRIMARY KEY (workspace_id, session_id)\n);\n\nThis enables tracking unread messages per workspace per session.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T20:25:31.207291+01:00","updated_at":"2025-12-13T20:35:59.649921+01:00","closed_at":"2025-12-13T20:35:59.649921+01:00"}
{"id":"beadhub-6ue","title":"Bead subscriptions and notifications","description":"New table: subscriptions(agent_id, bead_id, event_type).\nAPI: POST /v1/subscribe to watch a bead.\nWhen bead status changes, notify subscribed agents via inbox.\nMCP tool: subscribe_to_bead.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-03T09:15:09.379889+01:00","updated_at":"2025-12-03T19:07:13.59701+01:00","closed_at":"2025-12-03T19:07:13.59701+01:00","dependencies":[{"issue_id":"beadhub-6ue","depends_on_id":"beadhub-5gz","type":"blocks","created_at":"2025-12-03T09:15:17.234082+01:00","created_by":"juanre"}]}
{"id":"beadhub-6uuq","title":"Migrate test_beads_upload.py to db_infra fixture","description":"Convert from app_with_test_db to async tests using db_infra fixture.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-10T10:54:38.740825+01:00","created_by":"juanre","updated_at":"2026-01-10T12:55:36.732702+01:00","closed_at":"2026-01-10T12:55:36.732702+01:00","close_reason":"Converted 63 tests from sync/app_with_test_db to async/db_infra fixture","dependencies":[{"issue_id":"beadhub-6uuq","depends_on_id":"beadhub-7wpr","type":"parent-child","created_at":"2026-01-10T10:55:48.192896+01:00","created_by":"juanre"}]}
{"id":"beadhub-6v70","title":"SECURITY: Fix Redis key collision vulnerability","description":"## Problem\n\nRedis key format allows collision attacks due to colon separator in keys.\n\n### Current Behavior\n\nIn `src/beadhub/presence.py:13-49`:\n```python\ndef _presence_key(workspace_id: str) -\u003e str:\n    return f\"presence:{workspace_id}\"\n\ndef _alias_index_key(project_id: str, alias: str) -\u003e str:\n    return f\"idx:alias:{project_id}:{alias}\"  # Colon separator\n```\n\n### Attack Vector\n\nIf `alias` or `project_id` contains colons, keys can collide:\n- Project `abc`, alias `xyz:def` â†’ `idx:alias:abc:xyz:def`\n- Project `abc:xyz`, alias `def` â†’ `idx:alias:abc:xyz:def` (SAME KEY!)\n\nThis allows:\n- Tenant isolation bypass via key collision\n- Workspace alias collision across projects\n- Potential privilege escalation\n\n### Files Affected\n\n- `src/beadhub/presence.py` (all key-building functions)\n\n### Solution\n\n**Option A: Use delimiter that cannot appear in inputs**\n```python\ndef _alias_index_key(project_id: str, alias: str) -\u003e str:\n    return f\"idx:alias:{project_id}\\x00{alias}\"  # NULL byte delimiter\n```\n\n**Option B: URL-encode components**\n```python\nimport urllib.parse\n\ndef _alias_index_key(project_id: str, alias: str) -\u003e str:\n    safe_project = urllib.parse.quote(project_id, safe='')\n    safe_alias = urllib.parse.quote(alias, safe='')\n    return f\"idx:alias:{safe_project}:{safe_alias}\"\n```\n\n**Option C: Use hash-based keys**\n```python\nimport hashlib\n\ndef _alias_index_key(project_id: str, alias: str) -\u003e str:\n    key_data = f\"{project_id}:{alias}\".encode()\n    hash_suffix = hashlib.sha256(key_data).hexdigest()[:16]\n    return f\"idx:alias:{hash_suffix}\"\n```\n\n### Acceptance Criteria\n\n- [ ] Redis keys cannot collide even with malicious input\n- [ ] All key-building functions updated consistently\n- [ ] Migration plan for existing keys (if any data in production)\n- [ ] Unit tests verify no collision with edge-case inputs","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-08T12:36:57.454125+01:00","created_by":"juanre","updated_at":"2026-01-09T19:29:15.428954+01:00","closed_at":"2026-01-09T19:29:15.428954+01:00","close_reason":"Fixed by URL-encoding user-controlled components in Redis keys. Added _safe_key_component() helper and 4 collision resistance tests."}
{"id":"beadhub-6vye","title":"Weak path hash collision resistance (64 bits)","description":"Location: src/beadhub/routes/reservations.py:197-199. Uses only 16 hex chars (64 bits) of SHA256 for path hashing. Birthday paradox makes collisions likely after ~2^32 locks. Can cause lock conflicts on unrelated files, deadlocks, data corruption in large deployments. Fix: increase PATH_HASH_LENGTH to 32 (128 bits) or use full hash.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-08T18:25:31.251422+01:00","updated_at":"2025-12-08T18:25:31.251422+01:00"}
{"id":"beadhub-6wj4","title":"bdh :who: show recent focus apex for workspaces without claims","description":"Improve inter-agent awareness: when a workspace has no active claims, :who should still show what they were most recently focused on.\n\nBehavior:\n- For workspaces with active claims: show current apex/claims as today.\n- For workspaces without claims but with focus apex: show a line like 'Recent focus: \u003capex_id\u003e \u003ctitle\u003e' (or similar).\n- Must not mislead by implying the workspace currently holds a claim.\n\nTests:\n- Update who.go tests to cover focus display.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T19:38:48.621037+01:00","updated_at":"2025-12-21T20:03:55.639552+01:00","closed_at":"2025-12-21T20:03:55.639552+01:00","close_reason":"Show recent focus in bdh :who","dependencies":[{"issue_id":"beadhub-6wj4","depends_on_id":"beadhub-s35l","type":"parent-child","created_at":"2025-12-21T19:38:48.622886+01:00","created_by":"juanre"}]}
{"id":"beadhub-70jv","title":"bdh.py: get_unread_message_count missing deleted_at filter","description":"Line 524: get_unread_message_count looks up project_id without checking deleted_at. Should return 0 for deleted workspaces.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-21T20:46:58.318853+01:00","updated_at":"2025-12-21T21:50:51.935411+01:00","closed_at":"2025-12-21T21:50:51.935411+01:00","close_reason":"get_unread_message_count now ignores deleted workspaces; added regression test for deleted workspace counts."}
{"id":"beadhub-714","title":"Update AGENTS.md.template - complement beads, focus on BeadHub-specific coordination","description":"Template should: 1) Reference beads' bd onboard content (don't duplicate), 2) Focus on BeadHub-specific: file locking, agent messaging, escalations, subscriptions, 3) Clear separation: 'Use bd for issue tracking, BeadHub for real-time coordination', 4) Show lock-to-issue pattern with reason=bead:bd-a1b2","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-03T20:52:09.436836+01:00","updated_at":"2025-12-03T21:43:28.434644+01:00","closed_at":"2025-12-03T21:43:28.434644+01:00"}
{"id":"beadhub-71he","title":"Backend: Restore SSE events for lock changes","description":"Restore SSE events for lock lifecycle so the dashboard can show real-time lock status.\n\n## Events to Restore\n\nReference: git show 1abe435^:src/beadhub/events.py\n\n### LockAcquiredEvent\n- lock_id, path, workspace_id, alias\n- bead_id, reason, exclusive\n- acquired_at, expires_at\n\n### LockReleasedEvent  \n- lock_id, path, workspace_id, alias\n- released_at\n\n### LockRenewedEvent\n- lock_id, path, workspace_id, alias\n- new_expires_at\n\n## Implementation\n\n1. Define event types in src/beadhub/events.py\n2. Publish events from reservations router after successful operations\n3. Subscribe in SSE endpoint for dashboard updates\n\n## Frontend Integration\n\nDashboard should show:\n- Active locks per project\n- Who holds what\n- Expiry countdown\n- Lock/unlock actions (if admin)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T21:40:05.239167+01:00","updated_at":"2025-12-17T19:08:04.382639+01:00","closed_at":"2025-12-17T19:08:04.382639+01:00","close_reason":"Added SSE events for lock changes: LockAcquiredEvent, LockReleasedEvent, LockRenewedEvent. Events published after acquire/release/renew operations. 10 tests.","dependencies":[{"issue_id":"beadhub-71he","depends_on_id":"beadhub-1tty","type":"blocks","created_at":"2025-12-15T21:42:52.67679+01:00","created_by":"juanre"}]}
{"id":"beadhub-71w4","title":"Update chat to use workspaces table for agent resolution","description":"Replace _resolve_agent_to_workspace (presence lookup) with database query:\n- SELECT workspace_id FROM workspaces WHERE agent_name = ?\n- Falls back to presence if not in table (backward compat)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T21:01:56.072386+01:00","updated_at":"2025-12-11T21:07:40.090454+01:00","closed_at":"2025-12-11T21:07:40.090454+01:00","dependencies":[{"issue_id":"beadhub-71w4","depends_on_id":"beadhub-r178","type":"blocks","created_at":"2025-12-11T21:02:03.047393+01:00","created_by":"juanre"}]}
{"id":"beadhub-75bi","title":"Add coordination commands to bdh CLI","description":"Extend bdh with BeadHub coordination commands so agents don't need curl:\n- bdh register: Register workspace with BeadHub (reads from .beadhub)\n- bdh lock \u003cfiles\u003e: Acquire file locks\n- bdh unlock \u003cfiles\u003e: Release file locks  \n- bdh inbox: Check messages\n- bdh send \u003cworkspace-id\u003e \u003cmessage\u003e: Send message to another agent\n\nThis simplifies agent interaction - one tool for issues AND coordination.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-08T19:03:28.125319+01:00","updated_at":"2025-12-08T19:24:04.407988+01:00","closed_at":"2025-12-08T19:24:04.407988+01:00"}
{"id":"beadhub-779a","title":"Fix chat termination signal protocol - only append \\n. when sender is leaving","description":"Implement chat termination signal protocol using .[bdh-signing-off] marker.\n\nSENDER (--no-wait):\n- When --no-wait flag is set, append \\n.[bdh-signing-off] to message\n- Exit immediately after sending\n\nRECEIVER:\n- If message ends with \\n.[bdh-signing-off]:\n  1. Strip signal for display\n  2. Print '[alias] has left the exchange'\n- Otherwise: display message normally\n\nAgents don't know about the protocol - they just use --no-wait to leave.\nFiles affected: bdh/internal/commands/chat.go","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-14T11:08:27.330719+01:00","updated_at":"2025-12-14T16:14:37.863651+01:00","closed_at":"2025-12-14T16:14:37.863651+01:00","dependencies":[{"issue_id":"beadhub-779a","depends_on_id":"beadhub-hi0g","type":"blocks","created_at":"2025-12-14T11:08:46.002522+01:00","created_by":"juanre"},{"issue_id":"beadhub-779a","depends_on_id":"beadhub-bbvw","type":"blocks","created_at":"2025-12-14T11:08:46.075818+01:00","created_by":"juanre"},{"issue_id":"beadhub-779a","depends_on_id":"beadhub-8im2","type":"blocks","created_at":"2025-12-14T11:08:46.149429+01:00","created_by":"juanre"},{"issue_id":"beadhub-779a","depends_on_id":"beadhub-196m","type":"blocks","created_at":"2025-12-14T11:38:53.346962+01:00","created_by":"juanre"}]}
{"id":"beadhub-77cc","title":"Chat pending participants ordering is nondeterministic","description":"GET /v1/chat/pending aggregates participants via array_agg(alias ORDER BY joined_at). In create_session, all participants are inserted with the same joined_at timestamp, so ordering is not guaranteed and can be flaky (tests currently assert [\"agent-p1\", \"agent-p2\"]). Fix: make ordering deterministic (e.g., ORDER BY alias or workspace_id) and/or store an explicit participant_sort key.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-14T00:46:50.304828+01:00","updated_at":"2025-12-14T00:48:07.99416+01:00","closed_at":"2025-12-14T00:48:07.99416+01:00","dependencies":[{"issue_id":"beadhub-77cc","depends_on_id":"beadhub-6qlj","type":"discovered-from","created_at":"2025-12-14T00:46:50.306026+01:00","created_by":"juanre"}]}
{"id":"beadhub-79ks","title":"TECH DEBT: Create .env.example with all environment variables","description":"## Problem\n\nNo .env.example file exists to document available environment variables.\n\n### Current Behavior\n\nEnvironment variables are scattered across multiple files with no single reference:\n- `BEADHUB_DATABASE_URL` / `DATABASE_URL` (config.py)\n- `BEADHUB_REDIS_URL` / `REDIS_URL` (config.py)\n- `BEADHUB_API_KEY` (auth.py)\n- `BEADHUB_PORT` (cli.py)\n- `BEADHUB_HOST` (cli.py)\n- `BEADHUB_LOG_LEVEL` (logging.py)\n- `BEADHUB_LOG_JSON` (logging.py)\n- `BEADHUB_RELOAD` (cli.py)\n- `BEADHUB_PRESENCE_TTL_SECONDS` (presence.py)\n- `BEADHUB_DASHBOARD_HUMAN` (routes)\n- `BEADHUB_API_URL` (bdh CLI)\n\n### Impact\n\n- New developers don't know what's configurable\n- Production deployments may miss required settings\n- No documentation of default values\n- Environment-specific config is trial-and-error\n\n### Solution\n\nCreate `.env.example`:\n\n```bash\n# .env.example - Copy to .env and customize\n\n# Database (required)\nBEADHUB_DATABASE_URL=postgresql://user:password@localhost:5432/beadhub\n# Or use standard name:\n# DATABASE_URL=postgresql://user:password@localhost:5432/beadhub\n\n# Redis (optional, defaults to localhost)\nBEADHUB_REDIS_URL=redis://localhost:6379/0\n# Or use standard name:\n# REDIS_URL=redis://localhost:6379/0\n\n# Server\nBEADHUB_HOST=0.0.0.0\nBEADHUB_PORT=8000\nBEADHUB_RELOAD=false  # Enable for development\n\n# Authentication (optional, enables tenant isolation)\n# BEADHUB_API_KEY=your-secret-api-key\n\n# Logging\nBEADHUB_LOG_LEVEL=INFO  # DEBUG, INFO, WARNING, ERROR\nBEADHUB_LOG_JSON=false  # Set true for production\n\n# Presence\nBEADHUB_PRESENCE_TTL_SECONDS=1800  # 30 minutes\n\n# Dashboard\n# BEADHUB_DASHBOARD_HUMAN=admin@example.com\n\n# Client (bdh CLI)\n# BEADHUB_API_URL=https://beadhub.example.com\n```\n\n### Files to Create/Update\n\n- Create `.env.example` in project root\n- Add to .gitignore: `.env` (actual config)\n- Reference in README.md\n\n### Acceptance Criteria\n\n- [ ] .env.example exists with all variables\n- [ ] Each variable has comment explaining purpose\n- [ ] Default values documented\n- [ ] Required vs optional clearly marked\n- [ ] README references .env.example","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T08:31:48.547109+01:00","created_by":"juanre","updated_at":"2026-01-09T21:20:23.192146+01:00","closed_at":"2026-01-09T21:20:23.192146+01:00","close_reason":"Created .env.example with all 18 environment variables organized by category. Updated README Environment Variables section to reference .env.example and added missing variables (LOG_LEVEL, LOG_JSON, RELOAD, PRESENCE_TTL_SECONDS)."}
{"id":"beadhub-79uv","title":"Update routes/reservations.py: agent_name to alias, add metadata fields","description":"Update src/beadhub/routes/reservations.py for new data model.\n\nPydantic model changes:\n- ReservationRequest: agent_name â†’ alias\n\nRedis Lua scripts changes:\n- Lock metadata stored in Redis hash: agent_name â†’ alias\n- Add fields per beadhub-00q0: project_id, project_slug, human_name, repo_id\n\nEvent changes (in events.py):\n- LockAcquiredEvent: agent_name â†’ alias\n- LockReleasedEvent: agent_name â†’ alias\n- LockRenewedEvent: agent_name â†’ alias\n\nValidation changes:\n- _validate_agent_name_field() â†’ _validate_alias_field()\n\nThis partially addresses beadhub-00q0 (lock metadata missing fields).\n\nDepends on: events.py update","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T12:51:03.152459+01:00","updated_at":"2025-12-12T17:33:49.040043+01:00","closed_at":"2025-12-12T17:33:49.040043+01:00","dependencies":[{"issue_id":"beadhub-79uv","depends_on_id":"beadhub-i8qj","type":"blocks","created_at":"2025-12-12T14:51:22.538356+01:00","created_by":"juanre"}]}
{"id":"beadhub-7bgc","title":"Tests: Comprehensive test suite for file reservations","description":"Write comprehensive tests for the file reservation system.\n\n## Test Coverage Required\n\n### Unit Tests\n- Reservation model validation\n- Identity mapping (project_key â†” project_slug, agent_name â†” alias)\n- Lock acquisition/release logic\n- TTL expiration handling\n\n### Integration Tests\n- Redis lock atomicity (test concurrent acquisitions)\n- API endpoint behavior (acquire, release, renew, revoke)\n- SSE event emission on lock changes\n- MCP tool compatibility\n\n### E2E Tests\n- Multi-agent lock coordination scenario\n- Lock expiration and auto-release\n- Conflict resolution flows\n\n## Reference Implementation\n- Old tests may have existed alongside the deleted reservations.py\n- See commit 1abe435 for context on original implementation\n- mcp_agent_mail tests at ../other/mcp_agent_mail/ for compatibility verification\n\n## Acceptance Criteria\n- All lock operations have unit tests\n- Concurrent lock tests verify atomicity\n- MCP tool responses match mcp_agent_mail format exactly","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-15T21:41:38.619241+01:00","updated_at":"2025-12-16T22:58:30.592882+01:00","closed_at":"2025-12-16T22:58:30.592882+01:00","dependencies":[{"issue_id":"beadhub-7bgc","depends_on_id":"beadhub-sgup","type":"blocks","created_at":"2025-12-15T21:42:52.87824+01:00","created_by":"juanre"},{"issue_id":"beadhub-7bgc","depends_on_id":"beadhub-tslb","type":"blocks","created_at":"2025-12-15T21:42:52.941532+01:00","created_by":"juanre"},{"issue_id":"beadhub-7bgc","depends_on_id":"beadhub-xy2n","type":"blocks","created_at":"2025-12-15T21:42:53.005275+01:00","created_by":"juanre"}]}
{"id":"beadhub-7hlq","title":"Rename initiator_agent/target_agent to initiator_alias/target_alias throughout chat API","description":"For consistency with alias naming convention, rename: initiator_agent â†’ initiator_alias, target_agent â†’ target_alias in chat.py models, Redis keys, Postgres columns (needs migration), Go client structs, and tests. Currently the API uses 'agent' naming but contains alias values.","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-13T15:07:42.269065+01:00","updated_at":"2025-12-13T15:07:42.269065+01:00"}
{"id":"beadhub-7hs","title":"Add JWT auth service and login/register routes","description":"Implement JWTService for dashboard auth: issue tokens, verify tokens, refresh tokens. Routes: POST /api/v1/auth/register, POST /api/v1/auth/login, POST /api/v1/auth/refresh. Store users in users table with bcrypt password hashes.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-03T08:09:47.468456+01:00","updated_at":"2025-12-03T08:41:43.627122+01:00","closed_at":"2025-12-03T08:41:43.627122+01:00","close_reason":"Already exists from llmring-api template","dependencies":[{"issue_id":"beadhub-7hs","depends_on_id":"beadhub-3k4","type":"blocks","created_at":"2025-12-03T08:09:53.617715+01:00","created_by":"juanre"},{"issue_id":"beadhub-7hs","depends_on_id":"beadhub-yzx","type":"blocks","created_at":"2025-12-03T08:10:02.053121+01:00","created_by":"juanre"}]}
{"id":"beadhub-7i46","title":"bdh :projects list silently falls back to localhost on config error","description":"SECURITY: In bdh/internal/commands/projects.go:79-86, :projects list silently falls back to localhost:8000 if .beadhub config is missing/invalid.\n\n```go\ncfg, err := config.Load()\nbeadhubURL := \"http://localhost:8000\" // default\nif err == nil {\n    beadhubURL = cfg.BeadhubURL\n}\n```\n\nRisk: In misconfigured environment, operations could execute against wrong server (potentially wrong tenant/project).\n\nPer security-patterns.md: All operations should be properly scoped to project_id.\n\nFix:\n1. For :projects list (exploratory): Show warning about using default URL\n2. For :projects delete (destructive): Require valid config, fail if missing\n3. Add explicit error message explaining why config is needed","notes":"Track under beadhub-oy60 epic","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-06T09:20:33.395676Z","created_by":"juanre","updated_at":"2026-01-06T10:05:38.794868Z","closed_at":"2026-01-06T10:05:38.794868Z","close_reason":"Fixed - delete requires config, list shows warning when using default URL","dependencies":[{"issue_id":"beadhub-7i46","depends_on_id":"beadhub-oy60","type":"parent-child","created_at":"2026-01-06T10:02:34.556144Z","created_by":"juanre"}]}
{"id":"beadhub-7j9k","title":"Frontend API: add sendMessage method to API client","description":"Add sendMessage(toWorkspace, subject, body, priority) method to api.ts. Uses dashboardIdentity from store for from_workspace and from_alias. Calls POST /v1/messages.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T19:27:04.785647+01:00","updated_at":"2025-12-14T08:53:08.270472+01:00","closed_at":"2025-12-13T20:15:26.540204+01:00","dependencies":[{"issue_id":"beadhub-7j9k","depends_on_id":"beadhub-sczz","type":"blocks","created_at":"2025-12-13T19:27:37.315737+01:00","created_by":"juanre"},{"issue_id":"beadhub-7j9k","depends_on_id":"beadhub-g9l6","type":"parent-child","created_at":"2025-12-13T19:27:52.756236+01:00","created_by":"juanre"}]}
{"id":"beadhub-7jb2","title":"bdh init creates local project_id instead of fetching from server","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-11T19:27:02.529781+01:00","updated_at":"2025-12-11T19:30:29.501108+01:00","closed_at":"2025-12-11T19:30:29.501108+01:00"}
{"id":"beadhub-7m7","title":"Add error path test coverage","description":"**Problem**: Tests only cover happy paths. No tests for error scenarios.\n\n**Missing test coverage**:\n- Invalid JSON in MCP requests\n- Expired escalations\n- Lock conflicts with multiple agents\n- Malformed JSONL in beads sync\n- Database connection failures\n- Redis connection failures\n- Invalid/missing auth tokens\n- Rate limiting scenarios\n\n**Files**: tests/*.py\n\n**Implementation**: Add negative test cases for each route and error condition.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-02T19:48:12.039145+01:00","updated_at":"2025-12-02T22:14:30.762364+01:00","closed_at":"2025-12-02T22:14:30.762364+01:00","close_reason":"Added 10 error path tests covering MCP errors, escalation not found, reservation conflicts, beads sync errors, and validation failures"}
{"id":"beadhub-7n8w","title":"UX: Status page information hierarchy - prioritize escalations and conflicts","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T21:26:08.17402+01:00","updated_at":"2025-12-13T23:19:13.638101+01:00","closed_at":"2025-12-13T23:19:13.638101+01:00"}
{"id":"beadhub-7n9w","title":"Filter deleted workspaces from API responses by default","description":"Update GET /v1/workspaces to filter out deleted workspaces (WHERE deleted_at IS NULL) by default. Add optional query param ?include_deleted=true to show all. Update /v1/status and bdh :who similarly.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-16T20:40:56.75479+01:00","updated_at":"2025-12-16T22:56:28.035885+01:00","closed_at":"2025-12-16T22:56:28.035885+01:00","dependencies":[{"issue_id":"beadhub-7n9w","depends_on_id":"beadhub-9aq9","type":"blocks","created_at":"2025-12-16T20:41:05.377163+01:00","created_by":"juanre"},{"issue_id":"beadhub-7n9w","depends_on_id":"beadhub-lmtj","type":"blocks","created_at":"2025-12-16T20:41:18.021573+01:00","created_by":"juanre"}]}
{"id":"beadhub-7o1s","title":"Migrate test_status.py to db_infra fixture","description":"Convert from app_with_test_db to async tests using db_infra fixture. Also has 3 async tests with manual try/finally.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-10T10:54:58.404298+01:00","created_by":"juanre","updated_at":"2026-01-10T12:08:02.303841+01:00","closed_at":"2026-01-10T12:08:02.303841+01:00","close_reason":"Migrated test_status.py to async pattern using db_infra and redis_client_async fixtures. All 4 tests pass.","dependencies":[{"issue_id":"beadhub-7o1s","depends_on_id":"beadhub-7wpr","type":"parent-child","created_at":"2026-01-10T10:55:49.146336+01:00","created_by":"juanre"}]}
{"id":"beadhub-7ofe","title":"Migrate test_workspace_registration.py to db_infra fixture","description":"Convert from app_with_test_db to async tests using db_infra fixture.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-10T10:54:48.916686+01:00","created_by":"juanre","updated_at":"2026-01-10T11:58:25.256547+01:00","closed_at":"2026-01-10T11:58:25.256547+01:00","close_reason":"Migrated test_workspace_registration.py to async pattern using db_infra and redis_client_async fixtures. All 59 tests pass. Code review confirmed correct implementation with no blocking issues.","dependencies":[{"issue_id":"beadhub-7ofe","depends_on_id":"beadhub-7wpr","type":"parent-child","created_at":"2026-01-10T10:55:48.645551+01:00","created_by":"juanre"}]}
{"id":"beadhub-7p4t","title":"SECURITY: Enforce X-Project-ID validation at middleware level","description":"## Problem\n\nMulti-tenant isolation can be bypassed because X-Project-ID header validation is inconsistent across endpoints.\n\n### Current Behavior\n\n1. Some endpoints check `is_auth_enabled()` and require the header\n2. Others use `get_optional_project_id()` which returns `None` if header is missing\n3. The auth check only validates API key existence, not tenant isolation\n\n### Vulnerable Code Pattern\n\nIn `src/beadhub/routes/workspaces.py:43-65`:\n```python\ndef get_optional_project_id(request: Request) -\u003e Optional[str]:\n    project_id = request.headers.get(\"X-Project-ID\")\n    if not project_id:\n        return None  # No enforcement - allows cross-tenant access\n```\n\nIn `src/beadhub/routes/workspaces.py:856-871`:\n```python\nif is_auth_enabled():\n    if not header_project_id:\n        raise HTTPException(...)  # Only enforced when auth enabled\n```\n\n### Attack Vector\n\nIn environments where `BEADHUB_API_KEY` is not set (OSS mode) OR when middleware doesn't enforce project context:\n1. Attacker omits `X-Project-ID` header to access data across all projects\n2. Attacker forges `X-Project-ID` to access other tenants' data\n\n### Files Affected\n\n- `src/beadhub/routes/workspaces.py`\n- `src/beadhub/routes/messages.py`\n- `src/beadhub/routes/status.py`\n- `src/beadhub/routes/claims.py`\n- `src/beadhub/routes/escalations.py`\n- Any other route using `get_optional_project_id()`\n\n### Solution\n\n1. Create middleware that enforces X-Project-ID validation BEFORE routes are called\n2. Never allow `None` project_id when listing/modifying sensitive resources\n3. Remove `get_optional_project_id()` pattern - always require project context\n4. Add integration tests specifically for tenant isolation\n\n### Acceptance Criteria\n\n- [ ] Middleware enforces X-Project-ID on all protected endpoints\n- [ ] No endpoint can return data from other projects\n- [ ] Integration tests verify tenant isolation\n- [ ] Existing tests pass","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-08T12:36:56.932865+01:00","created_by":"juanre","updated_at":"2026-01-09T18:48:29.491076+01:00","closed_at":"2026-01-09T18:48:29.491076+01:00","close_reason":"Already addressed: In Cloud, OssAuthMiddleware requires X-BH-Auth (HMAC-signed). In OSS, project is derived from workspace_id and cross-project ops are explicitly blocked. The 'trusted network' model for OSS standalone is intentional per SOT security-patterns.md."}
{"id":"beadhub-7r4","title":"Web dashboard (single-tenant)","description":"React-based web dashboard for BeadHub OSS. Designed to work standalone AND be embedded by Cloud.\n\nDEPENDS ON: beadhub-w4p (SSE streaming)\n\n## Architecture for Cloud Integration\n\nThe OSS dashboard must be designed for embedding:\n- Accept project_id as URL parameter or context\n- No built-in auth (Cloud shell handles login)\n- No project switching UI (Cloud shell handles this)\n- Expose components/routes that Cloud can wrap\n- API calls should accept auth headers from parent frame\n\n## Views (OSS provides these, Cloud wraps them)\n- Status overview (workspaces, active locks, pending escalations)\n- Workspace list with filtering by repo\n- Lock management (list, release, panic button)\n- Escalation list and response UI\n- Beads issues view (ready work, blocked work, dependencies)\n\n## Features\n- Real-time updates via SSE\n- Responsive design\n- Dark/light mode\n- Works standalone at localhost:8000 for self-hosters\n- Embeddable in Cloud dashboard shell\n\n## Tech\n- React + TypeScript\n- Tailwind CSS\n- SSE client for real-time\n- Serves from FastAPI static files (OSS) or embedded in Cloud\n\n## What Cloud Adds (NOT in this epic)\n- Auth pages (login, register, OAuth) \n- Project picker/switcher\n- Team management UI\n- Billing UI\n- Tenant context injection","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-08T11:51:27.346385+01:00","updated_at":"2025-12-08T15:28:01.280023+01:00","closed_at":"2025-12-08T15:28:01.280023+01:00"}
{"id":"beadhub-7re8","title":"DB: add apex reference fields to bead_claims for fast workspaces listing","description":"Add persistent apex fields to `server.bead_claims` so apex does not need to be computed via recursive CTE at read time.\n\nSchema proposal (exact fields depend on design decision):\n- Minimum: `apex_bead_id TEXT NULL` (apex bead id for this claim).\n- Consider also storing apex repo/branch reference if bead IDs are not globally unique: `apex_repo_name TEXT`, `apex_branch TEXT`.\n- Do NOT store apex title/type unless we have a clear staleness/backfill strategy (prefer joining to beads_issues for latest).\n\nImplementation outline:\n1) Add a new server migration under `src/beadhub/migrations/server/` to ALTER `bead_claims`.\n2) Add any supporting indexes needed for joining/filtering (e.g., `(project_id, apex_bead_id)` if used).\n3) Backfill strategy (optional): set apex fields to NULL initially; theyâ€™ll be populated on next claim refresh, or provide a backfill script.\n4) Update migration tests to assert the new columns exist.\n\nCorrectness checks:\n- Migration applies cleanly on empty DB and on DBs with existing claims.\n- Existing claim invariants remain (UNIQUE(project_id, bead_id), FK constraints).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T13:55:16.302725+01:00","updated_at":"2025-12-20T14:20:19.973529+01:00","closed_at":"2025-12-20T14:20:19.973529+01:00","close_reason":"Added bead_claims apex columns via migration and updated migration tests/data-model.","dependencies":[{"issue_id":"beadhub-7re8","depends_on_id":"beadhub-o9h7","type":"parent-child","created_at":"2025-12-20T13:55:16.304461+01:00","created_by":"juanre"},{"issue_id":"beadhub-7re8","depends_on_id":"beadhub-bcdk","type":"blocks","created_at":"2025-12-20T13:55:16.305233+01:00","created_by":"juanre"}]}
{"id":"beadhub-7ry6","title":"Fix from vs from_alias type inconsistency in ChatPage","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-13T14:55:37.844318+01:00","updated_at":"2025-12-14T08:53:08.271419+01:00","closed_at":"2025-12-13T23:48:50.457636+01:00"}
{"id":"beadhub-7szl","title":"Backend: Add claims[] to WorkspaceInfo response","description":"Replace single current_bead/current_bead_title with claims array in /v1/workspaces response.\n\nChanges to beadhub/src/beadhub/routes/workspaces.py:\n1. Add Claim model: {bead_id, title, claimed_at}\n2. Change WorkspaceInfo: remove current_bead/current_bead_title, add claims: List[Claim]\n3. Update list_workspaces query: return ALL claims per workspace (remove DISTINCT ON)\n4. Build claims list per workspace instead of single claim\n\nThe API change is breaking but we don't maintain backward compatibility.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T10:28:28.755007+01:00","updated_at":"2025-12-20T10:47:08.910921+01:00","closed_at":"2025-12-20T10:47:08.910921+01:00","close_reason":"Added Claim model, changed WorkspaceInfo to use claims[] array, updated query to return all claims with timestamps. All 497 tests pass.","dependencies":[{"issue_id":"beadhub-7szl","depends_on_id":"beadhub-94uw","type":"parent-child","created_at":"2025-12-20T10:28:32.884531+01:00","created_by":"juanre"}]}
{"id":"beadhub-7uwb","title":"Create coordinator skill for agent orchestration","description":"Create a Claude Code skill that guides coordinators when orchestrating multiple agents. Based on lessons learned:\n\n## Identity \u0026 Workspace Safety\n- Always run `bdh :status` first to know your alias - never assume from doc examples\n- Only run bdh from YOUR workspace directory - running from another dir impersonates that agent\n- Check `.beadhub` file to confirm workspace identity\n\n## Before Assigning Work\n1. Run `bdh :who` to see current team status and who's working on what\n2. Run `bdh :inbox` to check for pending messages\n3. Run `bdh :chat --pending` to check for waiting conversations\n4. Check what epic(s) agents are currently working on\n5. Check if agents are coordinating together on related work\n\n## Work Assignment Principles\n- Keep agents on their current epic when possible - don't scatter to unrelated work\n- If agents are coordinating together, don't break them up\n- When an epic is nearly complete, assign remaining items to same team\n- Cross-repo claims are visible (beadhub syncs claims from all repos in project)\n- Before assigning, check if work is blocked by other items\n\n## Communication\n- Use mail (`:send`) for status updates and FYIs - async first\n- Use chat (`:chat`) only when blocking on an answer NOW\n- Respond immediately to WAITING notifications\n- Stay engaged in chat until exchange is complete - don't leave agents hanging\n- End chat with `--no-wait` only at END of conversation\n\n## Epic Management\n- Check epic children status before closing: `bdh show \u003cepic-id\u003e`\n- Discovered work can stay standalone with discovered-from link\n- Don't reopen closed epics for minor follow-up work\n\n## Session Start Checklist\n1. `bdh :status` - know who you are\n2. `bdh :inbox` - check mail\n3. `bdh :chat --pending` - check waiting chats\n4. `bdh :who` - see team status\n5. `bdh ready` - see available work","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-21T18:48:30.152011+01:00","updated_at":"2026-01-08T20:07:09.965349+01:00","deleted_at":"2026-01-08T20:07:09.965349+01:00","deleted_by":"daemon","delete_reason":"Obsolete - replaced by server-backed project policy system","original_type":"task"}
{"id":"beadhub-7wpr","title":"Migrate all tests to use db_infra fixture","description":"# Migrate all tests to use db_infra fixture\n\n## Related Issue\nSee **beadhub-0gif** for the original bug report with full root cause analysis from the pgdbm team.\n\n## Problem Summary\n\nEvery test run creates orphaned `test_*` databases that are never cleaned up. We currently have 500+ stale test databases accumulating.\n\n### Root Cause 1: Silent cleanup failures\n\nAll cleanup code swallows exceptions:\n\n```python\n# helpers_app.py:83-86 - BAD\nfinally:\n    try:\n        asyncio.run(test_db.drop_test_database())\n    except Exception:\n        pass  # Silently ignored!\n```\n\n### Root Cause 2: Manual database management in tests\n\nInstead of using the `db_infra` fixture, tests manually manage databases:\n\n```python\n# BAD - manual try/finally pattern\ntest_db = AsyncTestDatabase(test_config)\ndb_name = await test_db.create_test_database()\ntry:\n    # ... test code ...\nfinally:\n    await test_db.drop_test_database()\n```\n\nThis fails when tests are interrupted (Ctrl+C), pytest crashes, or cleanup itself fails.\n\n### Root Cause 3: app_with_test_db context manager\n\nThe `app_with_test_db` context manager in `helpers_app.py` creates databases with the same problematic pattern.\n\n## The Fix\n\n### The db_infra fixture (already exists in conftest.py)\n\n```python\n@pytest_asyncio.fixture\nasync def db_infra(monkeypatch) -\u003e AsyncGenerator[DatabaseInfra, None]:\n    \"\"\"Provides an initialized DatabaseInfra with a fresh test database.\"\"\"\n    test_config = DatabaseTestConfig.from_env()\n    test_db = AsyncTestDatabase(test_config)\n    db_name = await test_db.create_test_database()\n\n    database_url = build_database_url(test_config, db_name)\n    monkeypatch.setenv(\"DATABASE_URL\", database_url)\n\n    infra = DatabaseInfra()\n    await infra.initialize()\n\n    try:\n        yield infra\n    finally:\n        await infra.close()\n        await test_db.drop_test_database()\n```\n\nThis fixture uses pytest's cleanup mechanism which is robust even on Ctrl+C.\n\n### Conversion Pattern\n\n**BEFORE (sync test with app_with_test_db):**\n```python\ndef test_something(set_redis_env):\n    with app_with_test_db() as client:\n        resp = client.get(\"/health\")\n        assert resp.status_code == 200\n```\n\n**AFTER (async test with db_infra):**\n```python\n@pytest.mark.asyncio\nasync def test_something(db_infra, redis_client):\n    app = create_app(db_infra=db_infra, redis=redis_client, serve_frontend=False)\n    async with LifespanManager(app):\n        async with AsyncClient(\n            transport=ASGITransport(app=app),\n            base_url=\"http://test\",\n        ) as client:\n            resp = await client.get(\"/health\")\n            assert resp.status_code == 200\n```\n\n### Required imports for converted tests\n\n```python\nimport pytest\nfrom asgi_lifespan import LifespanManager\nfrom httpx import ASGITransport, AsyncClient\nfrom beadhub.api import create_app\n```\n\n### Redis fixture\n\nUse `redis_client` fixture (sync) from conftest.py. For async tests that need async redis:\n```python\nfrom redis.asyncio import Redis\nredis = await Redis.from_url(redis_url, decode_responses=True)\n```\n\n## Task Checklist for Each File\n\n1. Remove `from .helpers_app import app_with_test_db` import\n2. Add required async imports (LifespanManager, AsyncClient, ASGITransport)\n3. Convert each `def test_*` to `async def test_*`\n4. Add `@pytest.mark.asyncio` decorator\n5. Replace `set_redis_env` fixture with `db_infra, redis_client` fixtures\n6. Replace `with app_with_test_db() as client:` with the async pattern above\n7. Convert all `client.get/post` to `await client.get/post`\n8. Run the tests to verify they pass\n9. Verify no new test databases are orphaned\n\n## Requirements\n\n- **NO SHORTCUTS**: Every file must be fully converted\n- **NO TECH DEBT**: Do not leave any manual database management\n- **NO WORKAROUNDS**: Fix the root cause, don't add cleanup scripts\n- Tests must pass after conversion","status":"closed","priority":0,"issue_type":"epic","created_at":"2026-01-10T10:54:21.339837+01:00","created_by":"juanre","updated_at":"2026-01-10T13:24:06.850108+01:00","closed_at":"2026-01-10T13:24:06.850108+01:00","close_reason":"All test files migrated to async db_infra + async_redis fixtures. helpers_app.py deleted. 855 tests pass."}
{"id":"beadhub-7xn0","title":"Decide whether /v1/chat/pending should include other_alias","description":"beadhub-6qlj description mentions returning other_alias, and beadhub-yvd1 expects it, but current pending response returns participants[] + last_from instead. For 1-1 chats, other_alias can be derived client-side; for group chats it is ambiguous. Decide on the contract and update clients/spec accordingly (likely: keep participants only, remove other_alias expectation from clients/docs).","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-14T00:46:50.200114+01:00","updated_at":"2025-12-14T09:29:26.06273+01:00","closed_at":"2025-12-14T09:29:26.06273+01:00","dependencies":[{"issue_id":"beadhub-7xn0","depends_on_id":"beadhub-6qlj","type":"discovered-from","created_at":"2025-12-14T00:46:50.201342+01:00","created_by":"juanre"}]}
{"id":"beadhub-7xyg","title":"aw CLI: multi-server config file (no more copy/paste exports)","description":"Goal: implement the SOT-defined multi-server configuration for aw so onboarding does not require manual env exports.\n\nSOT reference:\n- ../beadhub-sot/source-of-truth/aweb-beadhub-integration.md (Multi-Server Configuration)\n\nDesired UX:\n- aw init registers with a server and stores the API key + agent identity in config.\n- aw who, aw chat, aw mail, etc. use config by default.\n- Environment variables and flags can still override for scripting.\n\nProposed config shape (backwards-compatible with SOT; url field optional):\n\n```yaml\nservers:\n  local:\n    url: http://localhost:8000\n    api_key: aw_sk_...\n    default_project: demo\n\ndefault_server: local\n```\n","acceptance_criteria":"- aw reads ~/.config/aw/config.yaml per SOT\n- aw init persists credentials and default server entry\n- aw commands work with config only (no env exports required)\n- File permissions are safe (0600) and writes are atomic\n- Minimal tests cover load/save and selection","status":"closed","priority":1,"issue_type":"epic","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-24T00:02:41.326997+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T08:52:31.387357+01:00","closed_at":"2026-01-24T08:52:31.387357+01:00","close_reason":"Completed aw multi-server config persistence: aw init writes ~/.config/aw/config.yaml; aw commands read config with --server selection; SOT and docs updated."}
{"id":"beadhub-7xyg.1","title":"aweb-go: define aw config schema + precedence rules","description":"Define the config file behavior for aw in a way that matches the SOT, but supports a recommended optional explicit url field.\n\nDecisions to include:\n- config path: ~/.config/aw/config.yaml\n- file permissions: 0600; directory permissions: 0700\n- server selection:\n  - if --server provided, use that key\n  - else use default_server if present\n  - else if only one server configured, use it\n  - else error with guidance\n- url resolution:\n  - per-server url if present\n  - else derive url from server key (e.g., localhost:8000 -\u003e http://localhost:8000)\n- auth resolution:\n  - per-server api_key if present\n  - env AWEB_API_KEY overrides when set\n\nThis is a design+implementation task to create the shared config module used by aw commands.\n","acceptance_criteria":"- Config schema is defined (servers map, default_server, per-server url/api_key/default_project)\n- Precedence is explicit: flags \u003e env \u003e config \u003e defaults\n- Server naming rules are specified (derive from URL if not provided)\n- Documented behavior for missing fields and errors","notes":"Implemented initial aw config schema + precedence helpers in ../aweb-go cmd/aw/internal/awconfig. Commit: ../aweb-go@edef503.","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-24T00:03:15.961258+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T00:13:40.763733+01:00","closed_at":"2026-01-24T00:13:40.763733+01:00","close_reason":"Config schema and precedence implemented","dependencies":[{"issue_id":"beadhub-7xyg.1","depends_on_id":"beadhub-7xyg","type":"parent-child","created_at":"2026-01-24T00:03:15.962263+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-7xyg.2","title":"aweb-go: implement config load/save (YAML) with safe perms + atomic writes","description":"Implement the aw config subsystem in ../aweb-go:\n- YAML marshal/unmarshal\n- strict-ish validation\n- atomic update: write temp file then rename\n- permissions: mkdir -p ~/.config/aw with 0700, config.yaml with 0600\n- helper functions to select effective server + base URL + api key\n\nThis should be a reusable package/module used by all aw subcommands.\n","acceptance_criteria":"- aw reads ~/.config/aw/config.yaml\n- aw can write/update config.yaml safely (atomic write + chmod 0600)\n- Supports servers entries with url + api_key + default_project\n- Tests cover parsing, missing fields, and atomic write behavior","notes":"Implemented config load/save with atomic write + 0600 perms and tests. Commit: ../aweb-go@edef503.","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-24T00:03:32.245118+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T00:14:01.354222+01:00","closed_at":"2026-01-24T00:14:01.354222+01:00","close_reason":"Config load/save implemented","dependencies":[{"issue_id":"beadhub-7xyg.2","depends_on_id":"beadhub-7xyg","type":"parent-child","created_at":"2026-01-24T00:03:32.246147+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-7xyg.2","depends_on_id":"beadhub-7xyg.1","type":"blocks","created_at":"2026-01-24T00:05:12.534102+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-7xyg.3","title":"aweb-go: aw init writes config entry (no paste exports)","description":"Update aw init to persist credentials:\n- choose server entry name:\n  - if --server-name provided, use it\n  - else derive from URL host:port (e.g., localhost:8000)\n- write/update servers[name] with url, api_key, default_project (project_slug), and optionally agent_id/alias\n- print a short success summary; keep --print-exports for scripting but default to config persistence.\n","acceptance_criteria":"- aw init stores the new server+api_key in config.yaml\n- aw init sets default_server on first init (or when --set-default is used)\n- aw init can select server name deterministically (or via --server-name)\n- After aw init, aw commands work without env exports","notes":"Update aw init to persist new server credentials to ~/.config/aw/config.yaml (no manual exports).","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-24T00:03:50.720512+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T08:50:46.789326+01:00","closed_at":"2026-01-24T08:50:46.789326+01:00","close_reason":"Implemented aw init config persistence to ~/.config/aw/config.yaml (server entry + default_server), with tests. aweb-go commits: e2dca20, bba14b8.","dependencies":[{"issue_id":"beadhub-7xyg.3","depends_on_id":"beadhub-7xyg","type":"parent-child","created_at":"2026-01-24T00:03:50.721524+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-7xyg.3","depends_on_id":"beadhub-7xyg.2","type":"blocks","created_at":"2026-01-24T00:05:22.824794+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-7xyg.4","title":"aweb-go: aw commands use config (server selection + api key)","description":"Extend aw command wiring:\n- Update client construction to use config selection.\n- Add a global --server option (or per-command) to choose a configured server.\n- Keep env vars as overrides for scripts/CI.\n\nOut of scope: cross-server URI addressing and --all fanout unless explicitly needed.\n","acceptance_criteria":"- aw commands no longer require AWEB_URL/AWEB_API_KEY when config is present\n- --server flag selects a configured server\n- Helpful errors when no default server exists\n- Tests cover selection and env override","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-24T00:04:08.116432+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T08:51:14.126488+01:00","closed_at":"2026-01-24T08:51:14.126488+01:00","close_reason":"aw commands use config selection by default; added per-command --server and tests for config selection + env override. aweb-go commits: 97d96dc, 69a8d2b, bba14b8.","dependencies":[{"issue_id":"beadhub-7xyg.4","depends_on_id":"beadhub-7xyg","type":"parent-child","created_at":"2026-01-24T00:04:08.117525+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-7xyg.4","depends_on_id":"beadhub-7xyg.2","type":"blocks","created_at":"2026-01-24T00:05:33.132179+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-7xyg.4","depends_on_id":"beadhub-7xyg.3","type":"blocks","created_at":"2026-01-24T00:05:43.414487+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-7xyg.5","title":"SOT: update multi-server config to allow explicit url field","description":"Update ../beadhub-sot/source-of-truth/aweb-beadhub-integration.md:\n- Keep existing servers map format.\n- Add optional url field per server entry so server keys can be friendly names.\n","acceptance_criteria":"- aweb-beadhub-integration.md documents optional per-server url field\n- Examples show both styles: key-as-host and explicit url\n- No legacy two-service wording introduced","status":"closed","priority":2,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-24T00:04:24.23383+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T08:51:38.833435+01:00","closed_at":"2026-01-24T08:51:38.833435+01:00","close_reason":"SOT updated: multi-server config docs now include optional per-server url field with examples. beadhub-sot commit: 829b06f.","dependencies":[{"issue_id":"beadhub-7xyg.5","depends_on_id":"beadhub-7xyg","type":"parent-child","created_at":"2026-01-24T00:04:24.234841+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-7xyg.6","title":"Docs: update onboarding to use config persistence by default","description":"Update docs in ../aweb-go and ../aweb to reflect the new default onboarding path:\n- aw init writes ~/.config/aw/config.yaml\n- subsequent aw commands work without exporting AWEB_API_KEY\n- optionally still support .env.aweb for local per-repo convenience\n","acceptance_criteria":"- aweb-go README shows aw init writing config and no env exports needed\n- aweb README references config-based onboarding\n- Mentions .env.aweb as optional for repo-local workflows","status":"closed","priority":2,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-24T00:04:57.08383+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T08:52:04.543988+01:00","closed_at":"2026-01-24T08:52:04.543988+01:00","close_reason":"Docs updated: aweb-go and aweb README onboarding uses config persistence by default (no export paste). Commits: aweb-go 4ffb290; aweb 61e51c1.","dependencies":[{"issue_id":"beadhub-7xyg.6","depends_on_id":"beadhub-7xyg","type":"parent-child","created_at":"2026-01-24T00:04:57.08485+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-7xyg.6","depends_on_id":"beadhub-7xyg.4","type":"blocks","created_at":"2026-01-24T00:05:53.726072+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-7xyg.6","depends_on_id":"beadhub-7xyg.5","type":"blocks","created_at":"2026-01-24T00:06:18.37572+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-7y13","title":"bdh :who: Display all claims per workspace with timestamps","description":"Update :who command to show all claims per workspace with age.\n\nChanges to bdh/internal/commands/who.go:\n1. Update formatWorkspace to iterate over Claims[] instead of single CurrentBead\n2. Show claim age (e.g., '2 hours ago', '3 days ago âš ï¸')\n3. Mark stale claims (\u003e24h) with warning indicator\n\nExample output:\n  claude-main (juanre)\n    Role: Main coordinator workspace\n    Claims:\n      beadhub-8m8m \"Implement apex...\" â€” 2 hours ago\n      beadhub-1of2 \"Add error logging...\" â€” 3 days ago âš ï¸\n    Status: active â€” just now","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T10:29:02.002524+01:00","updated_at":"2025-12-20T10:55:57.565139+01:00","closed_at":"2025-12-20T10:55:57.565139+01:00","close_reason":"Added claim age display and stale warning indicator (\u003e24h shows âš ï¸) to :who command output. Go tests pass.","dependencies":[{"issue_id":"beadhub-7y13","depends_on_id":"beadhub-94uw","type":"parent-child","created_at":"2025-12-20T10:29:06.936774+01:00","created_by":"juanre"},{"issue_id":"beadhub-7y13","depends_on_id":"beadhub-y6ul","type":"blocks","created_at":"2025-12-20T10:29:07.052584+01:00","created_by":"juanre"}]}
{"id":"beadhub-7zjk","title":"Delete app_with_test_db from helpers_app.py","description":"BLOCKED: Cannot delete app_with_test_db - still used by 15 files that were marked closed but not actually migrated","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-10T10:54:37.1351+01:00","created_by":"juanre","updated_at":"2026-01-10T13:12:42.219805+01:00","closed_at":"2026-01-10T13:12:42.219805+01:00","close_reason":"Deleted helpers_app.py - all tests migrated to async fixtures. Fixed one remaining test using deprecated set_redis_env fixture.","dependencies":[{"issue_id":"beadhub-7zjk","depends_on_id":"beadhub-7wpr","type":"parent-child","created_at":"2026-01-10T10:55:47.824113+01:00","created_by":"juanre"}]}
{"id":"beadhub-832m","title":"Release hardening: remaining code review findings (no ABOUTME)","description":"Address the remaining items from beadhub-sot/CODE_REVIEW_FINDINGS.md that we agree are real and release-relevant, excluding the ABOUTME-header suggestion (we prefer standard docstrings).\\n\\nScope:\\n- bdh :add-worktree path traversal validation\\n- bdh :add-worktree alias retry backoff\\n- aweb-go validate env overrides + better config/context errors\\n- aweb: fix verify_bearer_token manager_name defaults\\n- beadhub: strengthen /v1/init hostname/worktree_path validation\\n- SOT: update CODE_REVIEW_FINDINGS.md to remove ABOUTME recommendation","status":"closed","priority":0,"issue_type":"epic","owner":"juan@juanreyero.com","created_at":"2026-01-24T23:51:28.721799+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T00:19:41.512454+01:00","closed_at":"2026-01-25T00:19:41.512454+01:00","close_reason":"Completed remaining agreed release-hardening items from CODE_REVIEW_FINDINGS.","labels":["area:release","area:security","component:aweb","component:aweb-go","component:bdh","component:beadhub"]}
{"id":"beadhub-832m.1","title":"bdh :add-worktree: robust path traversal check","description":"Replace the current prefix-based traversal check in deriveWorktreePath with filepath.Rel-based validation; ensure it cannot be bypassed with crafted input. Add/adjust unit tests.","acceptance_criteria":"deriveWorktreePath rejects any path escaping parent; tests cover traversal edge cases.","status":"closed","priority":0,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-24T23:52:26.91052+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T23:59:21.706729+01:00","closed_at":"2026-01-24T23:59:21.706729+01:00","close_reason":"Hardened deriveWorktreePath traversal check using filepath.Rel; go tests pass.","labels":["area:security","component:bdh","lang:go"],"dependencies":[{"issue_id":"beadhub-832m.1","depends_on_id":"beadhub-832m","type":"parent-child","created_at":"2026-01-24T23:52:26.911506+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-832m.2","title":"bdh :add-worktree: add retry backoff","description":"When auto-retrying alias selection (maxAttempts loop), add a small delay/backoff to avoid hammering the server.","acceptance_criteria":"Retries are rate-limit friendly; tests updated if applicable.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-24T23:52:37.310126+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T00:00:13.530369+01:00","closed_at":"2026-01-25T00:00:13.530369+01:00","close_reason":"Added small linear backoff between alias-collision retries in :add-worktree.","labels":["area:reliability","component:bdh","lang:go"],"dependencies":[{"issue_id":"beadhub-832m.2","depends_on_id":"beadhub-832m","type":"parent-child","created_at":"2026-01-24T23:52:37.311279+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-832m.3","title":"aweb-go: validate AWEB_URL (env override)","description":"When Resolve() reads baseURL from AWEB_URL, validate it with ValidateBaseURL before returning Selection.","acceptance_criteria":"Invalid AWEB_URL produces a clear error; unit tests cover env override validation.","status":"closed","priority":0,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-24T23:52:47.719179+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T00:01:59.613351+01:00","closed_at":"2026-01-25T00:01:59.613351+01:00","close_reason":"Validate AWEB_URL env override via ValidateBaseURL in aweb-go selection.","labels":["area:security","component:aweb-go","lang:go"],"dependencies":[{"issue_id":"beadhub-832m.3","depends_on_id":"beadhub-832m","type":"parent-child","created_at":"2026-01-24T23:52:47.720166+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-832m.4","title":"aweb-go: fix hardcoded config path in errors","description":"Replace error strings that hardcode ~/.config/aw/config.yaml with either the resolved config path (including AW_CONFIG_PATH) or generic wording.","acceptance_criteria":"Error messages do not hardcode a path; tests updated.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-24T23:52:58.11611+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T00:02:24.646385+01:00","closed_at":"2026-01-25T00:02:24.646385+01:00","close_reason":"Removed hardcoded ~/.config/aw/config.yaml path from aweb-go selection errors.","labels":["area:ux","component:aweb-go","lang:go"],"dependencies":[{"issue_id":"beadhub-832m.4","depends_on_id":"beadhub-832m","type":"parent-child","created_at":"2026-01-24T23:52:58.117148+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-832m.5","title":"aweb-go: surface corrupted .aw/context errors","description":"In Resolve(), if LoadWorktreeContextFromDir finds a context file but it is invalid/corrupted, return an error instead of silently ignoring it.","acceptance_criteria":"Corrupt .aw/context causes a deterministic error; missing context remains non-fatal.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-24T23:53:08.503666+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T00:02:49.504662+01:00","closed_at":"2026-01-25T00:02:49.504662+01:00","close_reason":"Surface corrupted .aw/context errors (only ignore not-found) in aweb-go Resolve().","labels":["area:ux","component:aweb-go","lang:go"],"dependencies":[{"issue_id":"beadhub-832m.5","depends_on_id":"beadhub-832m","type":"parent-child","created_at":"2026-01-24T23:53:08.504699+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-832m.6","title":"aweb: fix auth manager_name defaults","description":"Change verify_bearer_token and verify_bearer_token_details defaults from manager_name=\"server\" to \"aweb\" (since aweb schema manager is \"aweb\"). Ensure call sites/tests remain correct.","acceptance_criteria":"No code path depends on the wrong default; tests pass.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-24T23:53:37.671901+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T00:04:50.111571+01:00","closed_at":"2026-01-25T00:04:50.111571+01:00","close_reason":"Changed aweb auth helpers default manager_name to 'aweb'; aweb tests pass.","labels":["area:bug","component:aweb","lang:python"],"dependencies":[{"issue_id":"beadhub-832m.6","depends_on_id":"beadhub-832m","type":"parent-child","created_at":"2026-01-24T23:53:37.672822+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-832m.7","title":"beadhub: strengthen /v1/init hostname + workspace_path validation","description":"Align InitRequest hostname/workspace_path validation with existing workspaces validators (reject null/control chars; ensure workspace_path is safe).","acceptance_criteria":"Invalid hostname/workspace_path rejected with 422; tests cover key cases.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-24T23:53:48.07483+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T00:07:41.283923+01:00","closed_at":"2026-01-25T00:07:41.283923+01:00","close_reason":"Added control-char validators for /v1/init hostname/workspace_path and tests.","labels":["area:security","component:beadhub","lang:python"],"dependencies":[{"issue_id":"beadhub-832m.7","depends_on_id":"beadhub-832m","type":"parent-child","created_at":"2026-01-24T23:53:48.07586+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-832m.8","title":"SOT: update CODE_REVIEW_FINDINGS (no ABOUTME; docstrings)","description":"Edit beadhub-sot/CODE_REVIEW_FINDINGS.md to remove the ABOUTME-header recommendation and instead state the standard docstring expectation.","acceptance_criteria":"Doc reflects actual policy; no ABOUTME guidance remains.","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-24T23:53:58.486238+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T00:18:21.207223+01:00","closed_at":"2026-01-25T00:18:21.207223+01:00","close_reason":"Updated CODE_REVIEW_FINDINGS: remove ABOUTME guidance; prefer standard docstrings/doc comments.","labels":["area:docs","component:sot"],"dependencies":[{"issue_id":"beadhub-832m.8","depends_on_id":"beadhub-832m","type":"parent-child","created_at":"2026-01-24T23:53:58.48721+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-83t","title":"Update and run tests for beadhub-cloud","description":"Remove conversation/registry tests. Update remaining tests for beadhub-cloud naming. Run test suite to verify auth, projects, api_keys functionality works.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-03T08:21:18.930218+01:00","updated_at":"2025-12-03T08:41:27.870885+01:00","closed_at":"2025-12-03T08:41:27.870885+01:00","close_reason":"81 tests pass, 13 skipped (need beadhub library mode)","dependencies":[{"issue_id":"beadhub-83t","depends_on_id":"beadhub-jy8","type":"blocks","created_at":"2025-12-03T08:21:27.09282+01:00","created_by":"juanre"}]}
{"id":"beadhub-84h","title":"Add structured logging throughout codebase","description":"**Problem**: No logging anywhere in the codebase. Errors, warnings, and important events aren't logged, making production debugging very difficult.\n\n**Scope**: All source files need logging added.\n\n**Implementation**:\n1. Configure logging in config.py or a dedicated logging module\n2. Use JSON format for production (structured logging)\n3. Add loggers to each module\n4. Log: errors, warnings, request IDs, important operations\n\n**Example**:\n```python\nimport logging\nimport json\n\nclass JSONFormatter(logging.Formatter):\n    def format(self, record):\n        return json.dumps({\n            'timestamp': self.formatTime(record),\n            'level': record.levelname,\n            'module': record.module,\n            'message': record.getMessage(),\n        })\n\nlogger = logging.getLogger(__name__)\n```","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-02T19:47:57.0506+01:00","updated_at":"2025-12-02T22:09:08.217745+01:00","closed_at":"2025-12-02T22:09:08.217745+01:00","close_reason":"Added structured JSON logging: logging.py with JSONFormatter (timestamp, level, logger, message, function, line, exception). Configurable via BEADHUB_LOG_JSON env var. Exception logging for startup failures."}
{"id":"beadhub-84t5","title":"Frontend - Remove Locks Page","description":"Delete LocksPage.tsx, remove /locks route from App.tsx, remove Locks nav item from Layout.tsx.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T17:56:36.37581+01:00","updated_at":"2025-12-12T18:31:11.836111+01:00","closed_at":"2025-12-12T18:31:11.836111+01:00","dependencies":[{"issue_id":"beadhub-84t5","depends_on_id":"beadhub-wrab","type":"blocks","created_at":"2025-12-12T17:57:22.243336+01:00","created_by":"juanre"},{"issue_id":"beadhub-84t5","depends_on_id":"beadhub-bpyn","type":"blocks","created_at":"2025-12-12T17:57:22.316074+01:00","created_by":"juanre"}]}
{"id":"beadhub-86ux","title":"bdh :who: Include current bead descriptions","description":"Update bdh :who output to show what each agent is working on with bead titles:\n\n```\nONLINE AGENTS:\n  claude-be (Juan) â€” Backend API expert\n    Working on: bd-42 \"Implement JWT validation\"\n    \n  claude-test (Maria) â€” Testing and QA\n    Working on: bd-45 \"Add integration tests for auth\"\n    \n  claude-fe (â€”) â€” Frontend\n    Idle (last seen 2h ago)\n```\n\nRequires:\n- Fetch bead claims with titles from server\n- Join with presence data","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-15T18:23:22.129347+01:00","updated_at":"2025-12-15T18:39:49.481784+01:00","closed_at":"2025-12-15T18:39:49.481784+01:00","dependencies":[{"issue_id":"beadhub-86ux","depends_on_id":"beadhub-fei6","type":"blocks","created_at":"2025-12-15T18:23:28.881603+01:00","created_by":"juanre"}]}
{"id":"beadhub-87ve","title":"bdh ready: Add YOUR CLAIMS section with stale warnings","description":"Add YOUR CLAIMS section to bdh ready output to show the agent their own claims.\n\nChanges to bdh/internal/commands/passthrough.go:\n1. Fetch my own workspace from TeamStatus (or add dedicated call)\n2. Add formatMyClaims() to display my claims with age\n3. Show YOUR CLAIMS section before TEAM STATUS\n4. Mark stale claims (\u003e24h) with warning and suggested action\n\nExample output:\n  YOUR CLAIMS:\n    beadhub-8m8m \"Implement apex...\" â€” 2 hours ago\n    beadhub-1of2 \"Add error logging...\" â€” 3 days ago âš ï¸ stale\n    â†’ Release stale claims: bdh close \u003cid\u003e --reason \"releasing stale claim\"\n\n  TEAM STATUS:\n    claude-fe â€” working on beadhub-xyz \"Feature...\"\n  \n  Ready issues:\n    ...\n\nThe goal is for the agent to immediately see what claims they hold and question stale ones.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T10:29:16.250936+01:00","updated_at":"2025-12-20T10:57:44.513792+01:00","closed_at":"2025-12-20T10:57:44.513792+01:00","close_reason":"Added YOUR CLAIMS section to bdh ready output showing my claims with age and stale warnings (\u003e24h shows âš ï¸ stale). Tests pass.","dependencies":[{"issue_id":"beadhub-87ve","depends_on_id":"beadhub-94uw","type":"parent-child","created_at":"2025-12-20T10:29:20.76023+01:00","created_by":"juanre"},{"issue_id":"beadhub-87ve","depends_on_id":"beadhub-y6ul","type":"blocks","created_at":"2025-12-20T10:29:20.874996+01:00","created_by":"juanre"}]}
{"id":"beadhub-8a5d","title":"Create Postgres migration for messages table","description":"Create migration in server schema for messages table with tenant isolation.\n\n**CRITICAL**: Must include project_id for tenant isolation (see epic beadhub-37yb for security rationale).\n\nSchema:\n```sql\nCREATE TABLE server.messages (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    project_id UUID NOT NULL REFERENCES server.projects(id),\n    from_workspace_id UUID NOT NULL REFERENCES server.workspaces(workspace_id),\n    to_workspace_id UUID NOT NULL REFERENCES server.workspaces(workspace_id),\n    from_alias TEXT NOT NULL,\n    subject TEXT NOT NULL DEFAULT '',\n    body TEXT NOT NULL,\n    priority TEXT NOT NULL DEFAULT 'normal' CHECK (priority IN ('low', 'normal', 'high', 'urgent')),\n    thread_id UUID,\n    read BOOLEAN NOT NULL DEFAULT false,\n    created_at TIMESTAMPTZ NOT NULL DEFAULT now(),\n    read_at TIMESTAMPTZ\n);\n\n-- Tenant-scoped indexes (project_id first for partition pruning)\nCREATE INDEX idx_messages_inbox ON server.messages(project_id, to_workspace_id, read, created_at DESC);\nCREATE INDEX idx_messages_thread ON server.messages(thread_id) WHERE thread_id IS NOT NULL;\nCREATE INDEX idx_messages_sent ON server.messages(project_id, from_workspace_id, created_at DESC);\n```\n\nNote: project_id is denormalized from workspace for query efficiency (avoid JOINs on every inbox fetch). Validated at insert time via app logic.\n\nPart of epic beadhub-37yb","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T09:44:14.36013+01:00","updated_at":"2025-12-20T10:40:03.755707+01:00","closed_at":"2025-12-20T10:40:03.755707+01:00","close_reason":"Completed"}
{"id":"beadhub-8bd","title":"Create bdh shell script wrapper for bd with BeadHub integration","description":"Shell script that wraps bd command: 1) Runs real bd with all args, 2) On mutation commands (create/close/update/delete/reopen), syncs issues.jsonl to BeadHub via upload-jsonl endpoint, 3) On every command, checks inbox/count and prints notification if unread messages exist. Must be deployable as single downloadable script without cloning repo. Env vars: BEADHUB_URL, BEADHUB_REPO, BEADHUB_AGENT, BEADHUB_API_KEY.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T12:03:57.150958+01:00","updated_at":"2025-12-07T18:09:05.371671+01:00","closed_at":"2025-12-07T18:09:05.371671+01:00","dependencies":[{"issue_id":"beadhub-8bd","depends_on_id":"beadhub-1fl","type":"blocks","created_at":"2025-12-07T12:03:57.152075+01:00","created_by":"juanre"},{"issue_id":"beadhub-8bd","depends_on_id":"beadhub-dny","type":"blocks","created_at":"2025-12-07T12:03:57.152642+01:00","created_by":"juanre"}]}
{"id":"beadhub-8bds","title":"Create JSONB parsing helper to eliminate repeated pattern","description":"## Problem\n\nSame JSONB deserialization pattern is repeated many times throughout the codebase.\n\n### Current Behavior\n\nThis pattern appears in beads.py at lines 419-421, 582-584, 699-701, 818-820 and elsewhere:\n```python\nblocked_by = row[\"blocked_by\"]\nif isinstance(blocked_by, str):\n    blocked_by = json.loads(blocked_by)\n```\n\n### Impact\n\n- ~20+ lines of repeated code\n- Risk of inconsistent handling\n- Not clear why this is needed (psycopg2/asyncpg difference?)\n\n### Solution\n\nCreate a helper function:\n\n```python\n# src/beadhub/db.py or new utils.py\n\nimport json\nfrom typing import Any\n\ndef parse_jsonb_field(value: Any) -\u003e Any:\n    \"\"\"Parse JSONB field that might be returned as string.\n    \n    Some database drivers return JSONB as string, others as dict.\n    This normalizes the behavior.\n    \"\"\"\n    if value is None:\n        return None\n    if isinstance(value, str):\n        return json.loads(value)\n    return value\n\n# Usage:\nblocked_by = parse_jsonb_field(row[\"blocked_by\"])\n```\n\nOr consider fixing at the database layer if psycopg2 should be returning dicts.\n\n### Files to Update\n\n- `src/beadhub/db.py` or create `src/beadhub/utils.py`\n- `src/beadhub/routes/beads.py` (multiple locations)\n- Any other files with this pattern\n\n### Acceptance Criteria\n\n- [ ] Single helper function for JSONB parsing\n- [ ] All occurrences use the helper\n- [ ] Consider documenting why this is needed (driver behavior)","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-08T12:42:22.008436+01:00","created_by":"juanre","updated_at":"2026-01-08T12:42:22.008436+01:00"}
{"id":"beadhub-8ckm","title":"Redesign WorkspacesPage UX to match Issues/Claims pattern","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T18:51:08.203616+01:00","updated_at":"2025-12-13T18:56:16.627611+01:00","closed_at":"2025-12-13T18:56:16.627611+01:00"}
{"id":"beadhub-8d0q","title":"Dashboard: API key prompt + authenticated SSE (no EventSource)","description":"Dashboard: authenticate with Authorization Bearer; support SSE with headers (replace EventSource); remove any dependency on X-Project-ID.","design":"Spec: docs/specs/auth-model.md\\n\\nImplementation notes:\\n- Add an API key entry flow (prompt modal or settings screen). Store in localStorage (or sessionStorage) and attach as Authorization header for all API calls.\\n- Replace EventSource-based SSE with a fetch() streaming client so headers can be sent.\\n- Ensure reconnection/backoff and proper cleanup (AbortController).\\n- Avoid putting project_id into client state; server scopes by key.","acceptance_criteria":"- Dashboard works with only an API key (no project selection)\\n- Status stream/chat updates work when auth is enabled (no EventSource header limitation)\\n- No dashboard requests send X-Project-ID","status":"closed","priority":0,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-17T19:14:54.851266+01:00","created_by":"Juan Reyero","updated_at":"2026-01-18T14:06:05.42336+01:00","closed_at":"2026-01-18T14:06:05.42336+01:00","close_reason":"Dashboard now authenticates with Authorization: Bearer and uses fetch-streaming for SSE (no EventSource); no X-Project-ID.","dependencies":[{"issue_id":"beadhub-8d0q","depends_on_id":"beadhub-p2ha","type":"parent-child","created_at":"2026-01-17T19:15:00.584995+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-8e2","title":"Add workspace_id param to escalation endpoints","description":"Update /v1/escalations endpoints to use workspace_id instead of project_key.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T19:18:05.797014+01:00","updated_at":"2025-12-07T20:56:30.569166+01:00","closed_at":"2025-12-07T20:56:30.569166+01:00","dependencies":[{"issue_id":"beadhub-8e2","depends_on_id":"beadhub-6am","type":"blocks","created_at":"2025-12-07T19:18:12.314587+01:00","created_by":"juanre"}]}
{"id":"beadhub-8fa7","title":"bdh chat: build SSE URLs with net/url (escape, handle existing query)","description":"Chat builds SSE URLs via string concatenation (cfg.BeadhubURL + resp.SSEURL + ?workspace_id=...). This fails if SSEURL already has a query, and it doesnâ€™t URL-escape. Use net/url: parse base, resolve relative SSE path, add query param via Values.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-13T12:52:10.21249+01:00","updated_at":"2025-12-13T18:01:10.309133+01:00","closed_at":"2025-12-13T18:01:10.309133+01:00","dependencies":[{"issue_id":"beadhub-8fa7","depends_on_id":"beadhub-t265","type":"discovered-from","created_at":"2025-12-13T12:52:10.213696+01:00","created_by":"juanre"}]}
{"id":"beadhub-8g0d","title":"Accounts + .aw/context for multi-worktree agents (aw + bdh)","description":"# Goal\n\nMake multi-agent, multi-worktree usage frictionless and safe by introducing an **accounts model** (many identities per server) plus a **worktree-local non-secret pointer** (`.aw/context`).\n\nThis is required for the common workflow where a developer runs several worktrees, each with its own agent identity, all coordinating via a single local beadhub server (which embeds aweb).\n\n# Source of Truth\n\n- `../beadhub-sot/source-of-truth/aweb-beadhub-integration.md` (Multi-Server Configuration, Worktree context, `bdh :add-worktree`)\n\n# Problem\n\nThe prior model (one `api_key` per server entry) breaks down when many agents run on one machine:\n\n- Credentials clobber each other (last init wins)\n- Presence/status overwrites across agents\n- Messages/locks cannot be attributed to the correct worktree agent\n\n# Target UX\n\n- Global secrets live only in `~/.config/aw/config.yaml`.\n- Each worktree contains only a non-secret `.aw/context` pointer selecting the correct account(s).\n- `bdh :add-worktree` is the primary workflow:\n  - creates a git worktree + branch\n  - provisions a new beadhub agent identity (server-side allocation if needed)\n  - stores a new beadhub account globally\n  - writes `.aw/context` in the new worktree\n  - does **not** provision accounts on other servers (e.g., app.aweb.ai)\n\n# Notes\n\n- Clean slate: no migration/legacy support required.\n- Concurrency: multiple processes may update the global config; must be safe (lock + atomic write).\n","acceptance_criteria":"- Multiple concurrent worktree agents can operate on the same beadhub server without identity clobbering\n- No secrets are written inside repos/worktrees (only non-secret .aw/context pointers)\n- bdh :add-worktree provisions only the beadhub (embedded-aweb) account and is frictionless\n- aw and bdh share the same selection semantics (account/server/context precedence)\n- Global config updates are safe under concurrency (lock + atomic write)\n- Tests cover multi-account behavior and add-worktree flow","status":"closed","priority":1,"issue_type":"epic","owner":"juan@juanreyero.com","created_at":"2026-01-24T09:38:10.962859+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T11:13:06.268838+01:00","closed_at":"2026-01-24T11:13:06.268838+01:00","close_reason":"All children complete (accounts + .aw/context + init/add-worktree/docs)"}
{"id":"beadhub-8g0d.1","title":"Define config v2: servers + accounts + worktree .aw/context (Go)","description":"# Summary\n\nImplement the **accounts model** and **worktree context** as a Go library module that both `aw` (aweb-go) and `bdh` can use.\n\nThis is the foundation for multi-worktree multi-agent setups.\n\n# Requirements\n\n## Global config (secrets)\n\n- Path: `~/.config/aw/config.yaml` (override via `AW_CONFIG_PATH`)\n- Schema:\n  - `servers`: map of server name -\u003e { url? }\n  - `accounts`: map of account name -\u003e { server, api_key, default_project, agent_id?, agent_alias? }\n  - `default_account`\n\n## Worktree context (non-secrets)\n\n- Path: `\u003cworktree\u003e/.aw/context` (YAML)\n- Schema:\n  - `default_account`\n  - `server_accounts` (optional mapping server -\u003e account)\n  - `human_account` (optional)\n\n## Selection precedence\n\n1. Explicit flag `--account`\n2. If destination server is explicit (flag or server-qualified address): `server_accounts[server]` then any configured server default\n3. Worktree `.aw/context.default_account`\n4. Global `default_account`\n\n## Concurrency\n\n- Use an OS-level lock around read-modify-write updates to `~/.config/aw/config.yaml`.\n- Writes must remain atomic (temp file + rename).\n\n# Notes\n\nClean slate: no migration path needed.\n","acceptance_criteria":"- Global config schema supports many accounts per server\\n- Worktree .aw/context schema is non-secret and supports per-server mapping\\n- Deterministic selection precedence is implemented and documented in code\\n- Global config updates are safe under concurrency (lock + atomic write)\\n- Unit tests cover load/save, selection, and concurrent-safe update path","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-24T09:39:17.678304+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T10:03:24.717919+01:00","closed_at":"2026-01-24T10:03:24.717919+01:00","close_reason":"Implemented shared Go config v2 library in aweb-go (servers+accounts+default_account + .aw/context + selection precedence + flock lock + atomic writes + tests). Commit: ../aweb-go@00786cd.","dependencies":[{"issue_id":"beadhub-8g0d.1","depends_on_id":"beadhub-8g0d","type":"parent-child","created_at":"2026-01-24T09:39:30.811644+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-8g0d.2","title":"aweb-go: aw CLI uses accounts + .aw/context (no clobbering)","description":"# Summary\n\nUpdate the `aw` CLI to use the **accounts model** and `.aw/context` selection described in the SOT.\n\n# Requirements\n\n- Replace the current server-level credential storage with `accounts`.\n- `aw init` must create/update a single account (selected by flag or derived name), and must not overwrite other accounts on the same server.\n- `aw` commands must resolve credentials via `.aw/context` when run inside a worktree.\n- Provide explicit overrides for scripting/CI (e.g., flags and/or env vars), but make the default UX config/context-first.\n\n# Out of scope\n\n- Server-to-server forwarding or any federation.\n","acceptance_criteria":"- aw reads global accounts config and worktree .aw/context\\n- aw init creates a new account entry without overwriting other accounts\\n- aw supports explicit identity selection (e.g., --account and/or --server)\\n- Commands resolve identity deterministically via the precedence rules\\n- Tests cover multi-account selection and init behavior","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-24T09:39:57.911176+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T10:20:08.405242+01:00","closed_at":"2026-01-24T10:20:08.405242+01:00","close_reason":"Updated aw CLI to use accounts + .aw/context via aweb-go/awconfig v2 (no server-level key clobbering), added --account flags, updated tests, removed obsolete internal awconfig. Commits: ../aweb-go@6bf4aeb (depends on ../aweb-go@00786cd).","dependencies":[{"issue_id":"beadhub-8g0d.2","depends_on_id":"beadhub-8g0d","type":"parent-child","created_at":"2026-01-24T09:40:11.424176+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-8g0d.2","depends_on_id":"beadhub-8g0d.1","type":"blocks","created_at":"2026-01-24T09:43:30.207968+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-8g0d.2","depends_on_id":"beadhub-8g0d.6","type":"blocks","created_at":"2026-01-24T09:44:01.208568+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-8g0d.3","title":"bdh: resolve auth via accounts + .aw/context (shared with aw)","description":"# Summary\n\nUpdate the `bdh` CLI to use the same account selection semantics as `aw`.\n\n# Requirements\n\n- Credential lookup must use:\n  - `.aw/context` (worktree-local, non-secret)\n  - `~/.config/aw/config.yaml` (global, secret)\n- Both bead operations and `bdh :aweb` commands must use the same resolved beadhub account.\n\n# Notes\n\nThis task is about **client-side credential resolution** only.\n","acceptance_criteria":"- bdh can run in a worktree with only .aw/context + global config present\\n- bdh :aweb and bead operations use the same resolved account\\n- Explicit overrides exist for scripts/CI, but default is context-first\\n- Tests cover resolution precedence and failure modes (missing context/account)","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-24T09:40:28.637694+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T10:36:17.215229+01:00","closed_at":"2026-01-24T10:36:17.215229+01:00","close_reason":"bdh now resolves beadhub/aweb auth via ~/.config/aw/config.yaml accounts + .aw/context (with BEADHUB_URL/BEADHUB_API_KEY overrides), and bdh :aweb commands use the resolved account identity instead of requiring .beadhub. Added tests. Commit: beadhub@b2eaae3.","dependencies":[{"issue_id":"beadhub-8g0d.3","depends_on_id":"beadhub-8g0d","type":"parent-child","created_at":"2026-01-24T09:40:42.587996+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-8g0d.3","depends_on_id":"beadhub-8g0d.1","type":"blocks","created_at":"2026-01-24T09:43:40.548328+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-8g0d.4","title":"bdh :init writes .aw/context + global beadhub account (no secrets in repo)","description":"# Summary\n\nUpdate `bdh :init` to align with the SOT's accounts+context model.\n\n# Requirements\n\n- On successful init:\n  - write/update a beadhub **account** in `~/.config/aw/config.yaml`\n  - write `\u003cworktree\u003e/.aw/context` selecting that account\n  - keep `.beadhub` (or equivalent) non-secret; do not store API keys in the repo/worktree\n- Stop relying on `.env.beadhub` or manual exports for normal usage.\n\n# Non-goals\n\n- Do not provision accounts on other servers (app.aweb.ai, etc.).\n","acceptance_criteria":"- bdh :init updates ~/.config/aw/config.yaml with a new beadhub account\\n- bdh :init writes \u003cworktree\u003e/.aw/context pointing to that account\\n- Repo/worktree files contain no secrets and no project_id\\n- Existing behavior that seeds beads/workspace metadata remains functional\\n- Tests verify files written and no secret leakage","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-24T09:41:00.131519+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T10:51:32.484797+01:00","closed_at":"2026-01-24T10:51:32.484797+01:00","close_reason":"Implemented accounts+context init; stop .env.beadhub","dependencies":[{"issue_id":"beadhub-8g0d.4","depends_on_id":"beadhub-8g0d","type":"parent-child","created_at":"2026-01-24T09:41:13.28211+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-8g0d.4","depends_on_id":"beadhub-8g0d.6","type":"blocks","created_at":"2026-01-24T09:44:11.555053+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-8g0d.4","depends_on_id":"beadhub-8g0d.3","type":"blocks","created_at":"2026-01-24T09:44:32.257227+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-8g0d.5","title":"bdh :add-worktree: frictionless new worktree agent (beadhub account only)","description":"# Summary\n\nImplement the frictionless workflow for creating new worktree agents.\n\n# Requirements\n\n- Provide a user-facing command `bdh :add-worktree` (it may replace or alias the existing `bdh :add-agent`).\n- In an authenticated repo, it must:\n  1. Create a new agent identity on the beadhub server.\n     - If alias not explicitly provided, request server allocation (init with alias omitted) to avoid races.\n  2. Create a git worktree + branch named after the final alias.\n  3. Run `bdh :init` (or equivalent internal init flow) inside the new worktree.\n  4. Ensure new worktree has `.aw/context` pointing to its beadhub account.\n\n# Scope rule\n\n- Must provision **only** the beadhub account. Any additional identities on other aweb-compatible servers are explicit, separate operations.\n","acceptance_criteria":"- Command creates git worktree + branch named after the final agent alias\\n- Alias allocation is race-safe (server-side allocation when not explicit)\\n- Provisions only the beadhub account (embedded-aweb), not other servers\\n- Writes \u003cnew-worktree\u003e/.aw/context pointing at the new account\\n- Updates global config with the new account without clobbering existing accounts\\n- Tests cover happy path and cleanup on failure","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-24T09:41:33.804631+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T11:03:58.814654+01:00","closed_at":"2026-01-24T11:03:58.814654+01:00","close_reason":"Implement :add-worktree (alias-named branch/worktree) + accounts-based auth","dependencies":[{"issue_id":"beadhub-8g0d.5","depends_on_id":"beadhub-8g0d","type":"parent-child","created_at":"2026-01-24T09:41:47.387522+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-8g0d.5","depends_on_id":"beadhub-8g0d.6","type":"blocks","created_at":"2026-01-24T09:44:21.905353+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-8g0d.5","depends_on_id":"beadhub-8g0d.4","type":"blocks","created_at":"2026-01-24T09:44:42.593316+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-8g0d.6","title":"Align API key format + validation across beadhub, bdh, and aw","description":"# Summary\n\nEnsure the API key format is consistent across server + clients.\n\n# Context\n\nThe SOT standardizes on a single API key style (e.g., `aw_sk_*`). Clients must not hardcode outdated prefixes.\n\n# Requirements\n\n- Server returns the agreed format.\n- `bdh :init` and other client paths validate the agreed format.\n- Any remaining docs/examples/tests referencing older prefixes are updated.\n","acceptance_criteria":"- beadhub issues only the agreed API key prefix/format (per SOT)\\n- bdh and aw validate and handle that format consistently\\n- No stale docs/tests refer to old prefixes or env exports","status":"closed","priority":2,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-24T09:42:03.373219+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T10:10:12.933055+01:00","closed_at":"2026-01-24T10:10:12.933055+01:00","close_reason":"Aligned BEADHUB_API_KEY expectations to aw_sk_* in bdh init validation and tests (server already mints aw_sk_*). Commit: beadhub@95bc30b.","dependencies":[{"issue_id":"beadhub-8g0d.6","depends_on_id":"beadhub-8g0d","type":"parent-child","created_at":"2026-01-24T09:42:17.063469+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-8g0d.6","depends_on_id":"beadhub-8g0d.1","type":"blocks","created_at":"2026-01-24T09:43:50.873739+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-8g0d.7","title":"Docs/help: new onboarding for multi-worktree agents (accounts + .aw/context)","description":"# Summary\n\nUpdate user-facing docs and CLI help to match the new model.\n\n# Requirements\n\n- `aw` onboarding explains:\n  - global accounts config in `~/.config/aw/config.yaml`\n  - worktree pointer in `.aw/context`\n  - how to run many agents concurrently\n- `bdh` onboarding explains `bdh :add-worktree` as the primary workflow.\n","acceptance_criteria":"- aw docs show account-based config + .aw/context (no export paste)\\n- bdh docs/help explain :add-worktree and per-worktree identities\\n- Clear guidance on ignoring .aw/ (non-secret)\\n- SOT remains the canonical reference","status":"closed","priority":2,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-24T09:42:33.011511+01:00","created_by":"Juan Reyero","updated_at":"2026-01-24T11:11:52.005178+01:00","closed_at":"2026-01-24T11:11:52.005178+01:00","close_reason":"Update docs/help/UI for accounts + .aw/context + :add-worktree","dependencies":[{"issue_id":"beadhub-8g0d.7","depends_on_id":"beadhub-8g0d","type":"parent-child","created_at":"2026-01-24T09:42:46.036926+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-8g0d.7","depends_on_id":"beadhub-8g0d.2","type":"blocks","created_at":"2026-01-24T09:44:53.075411+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-8g0d.7","depends_on_id":"beadhub-8g0d.5","type":"blocks","created_at":"2026-01-24T09:45:03.433023+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-8im2","title":"Update chat tests for termination protocol","description":"In bdh/internal/commands/chat_test.go:\n\nTest cases:\n1. Regular message: verify \\n.[bdh-signing-off] is NOT appended\n2. --no-wait message: verify \\n.[bdh-signing-off] IS appended\n3. Receiving termination: verify signal is stripped and '[alias] has left' is printed\n4. Receiving regular message: verify displayed as-is","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-14T11:08:40.25894+01:00","updated_at":"2025-12-14T11:39:05.540416+01:00","closed_at":"2025-12-14T11:39:05.540416+01:00"}
{"id":"beadhub-8kfc","title":"Add GET /v1/chat/pending endpoint","description":"Implement endpoint to check pending chat requests:\n- GET /v1/chat/pending?workspace_id=...\u0026project_id=...\n\nReturns list of pending chat sessions waiting for this workspace.\nUsed by bdh commands to show chat notifications.\n\nPart of epic beadhub-dtcl","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T20:30:03.812579+01:00","updated_at":"2025-12-10T20:35:03.960951+01:00","closed_at":"2025-12-10T20:35:03.960951+01:00","dependencies":[{"issue_id":"beadhub-8kfc","depends_on_id":"beadhub-r0d0","type":"blocks","created_at":"2025-12-10T20:30:43.652423+01:00","created_by":"juanre"}]}
{"id":"beadhub-8lud","title":"Consider adding project_id to _pending_key() for consistency","description":"Code review for beadhub-hbld noted that _pending_key() uses only workspace_id while _pair_key() now includes project_id. For consistency and to avoid information leakage (pending set size), consider changing to chat:pending:{project_id}:{workspace_id}. Low priority since workspace_ids are globally unique UUIDs.","status":"open","priority":3,"issue_type":"chore","created_at":"2025-12-13T14:26:22.685584+01:00","updated_at":"2025-12-13T14:26:22.685584+01:00"}
{"id":"beadhub-8m8m","title":"Implement apex detection algorithm","description":"Walk the dependency tree from a given bead ID to find its apex (parent epic or top-level bead with no parent). Use parent-child dependencies to traverse upward. If no parent exists, the bead is its own apex. Add function in passthrough.go that takes a bead ID and returns the apex bead ID and title.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T21:59:16.759397+01:00","updated_at":"2025-12-20T10:15:31.025453+01:00","closed_at":"2025-12-20T10:15:31.025453+01:00","close_reason":"Implemented findApex() with O(1) parent lookup, cycle protection, and comprehensive tests","dependencies":[{"issue_id":"beadhub-8m8m","depends_on_id":"beadhub-npuh","type":"parent-child","created_at":"2025-12-17T21:59:32.457902+01:00","created_by":"juanre"}]}
{"id":"beadhub-8n28","title":"Implement chat timeout with async message fallback","description":"When chat times out waiting for join or response, save message to target inbox as async fallback. Part of epic beadhub-dtcl","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T20:30:37.559384+01:00","updated_at":"2025-12-20T09:35:11.593272+01:00","closed_at":"2025-12-20T09:35:11.593272+01:00","close_reason":"Wrong approach - mixing chat and mail systems doesn't make sense. Chat messages are already persisted and visible via pending; duplicating to inbox is redundant and confusing.","dependencies":[{"issue_id":"beadhub-8n28","depends_on_id":"beadhub-kxg1","type":"blocks","created_at":"2025-12-10T20:30:43.913719+01:00","created_by":"juanre"},{"issue_id":"beadhub-8n28","depends_on_id":"beadhub-b37m","type":"blocks","created_at":"2025-12-10T20:37:29.038509+01:00","created_by":"juanre"}]}
{"id":"beadhub-8oh0","title":"tmp: test capture","description":"tmp","acceptance_criteria":"tmp","status":"tombstone","priority":4,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-20T11:35:33.514095+01:00","created_by":"Juan Reyero","updated_at":"2026-01-20T11:36:00.539546+01:00","deleted_at":"2026-01-20T11:36:00.539546+01:00","deleted_by":"Juan Reyero","delete_reason":"accidental test issue","original_type":"task"}
{"id":"beadhub-8qqk","title":"Presence lookup by project_id/repo_id is O(all workspaces) - needs secondary index","description":"Location: presence.py. Workspace lookups by project or repo do full SCAN of all presence:* keys and filter in Python. With 1000 customers Ã— 10 workspaces each = 10,000 SCAN iterations for a single lookup.\n\nFix: Add Redis Sets as secondary indexes per architecture doc:\n- idx:project_workspaces:{project_id} containing workspace_ids\n- idx:repo_workspaces:{repo_id} containing workspace_ids\n- idx:branch_workspaces:{repo_id}:{branch} containing workspace_ids\n\nUpdate these when presence is updated. Clear on TTL expiry using keyspace notifications or lazy cleanup.\n\nUpdated 2025-12-12: terminology changed from project_key to project_id, repo to repo_id per data model.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-09T19:54:41.500764+01:00","updated_at":"2025-12-13T14:05:50.651588+01:00","closed_at":"2025-12-13T14:05:50.651588+01:00"}
{"id":"beadhub-8rx","title":"Missing transaction boundaries in multi-step DB operations (beads.py, escalations)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-03T15:38:49.601333+01:00","updated_at":"2025-12-03T17:50:04.516512+01:00","closed_at":"2025-12-03T17:50:04.516512+01:00"}
{"id":"beadhub-8tc","title":"Replace Redis KEYS with SCAN for production safety","description":"**Problem**: Using redis.keys(pattern) which blocks Redis server while scanning all keys. O(N) operation that can make Redis unresponsive in production.\n\n**Files affected**:\n- presence.py:69\n- reservations.py:272\n- mcp.py:309\n\n**Current code**:\n```python\nkeys = await run_in_threadpool(redis.keys, pattern)\n```\n\n**Fix**: Use SCAN with cursor-based iteration:\n```python\nasync def scan_keys(redis, pattern):\n    cursor = 0\n    keys = []\n    while True:\n        cursor, batch = await redis.scan(cursor, match=pattern, count=100)\n        keys.extend(batch)\n        if cursor == 0:\n            break\n    return keys\n```","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-02T19:47:49.233593+01:00","updated_at":"2025-12-02T21:37:43.055018+01:00","closed_at":"2025-12-02T21:37:43.055018+01:00","close_reason":"Already fixed during async Redis migration - all 3 files (presence.py, reservations.py, mcp.py) now use scan_iter instead of keys()"}
{"id":"beadhub-8tkr","title":"Deploy bdh","description":"CI/CD, releases, installation, and documentation for the bdh Go CLI","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-20T09:55:29.669255+01:00","updated_at":"2025-12-22T00:11:23.528788+01:00","closed_at":"2025-12-22T00:11:23.528788+01:00","close_reason":"Merged to main - CI/CD, goreleaser, install.sh, integration tests"}
{"id":"beadhub-8u63","title":"Add internal/beads package with worktree-aware GetBeadsDir()","description":"Create a new package internal/beads with GetBeadsDir() function that:\n1. Uses git rev-parse --git-dir and --git-common-dir to detect worktrees\n2. When in a worktree, finds the main repo and uses its .beads/\n3. Falls back to .beads/ in current directory when not in git repo\n\nThis mirrors the approach in bd's internal/git/gitdir.go and internal/beads/beads.go","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T12:04:28.056991Z","created_by":"juanre","updated_at":"2026-01-02T12:07:30.658634Z","closed_at":"2026-01-02T12:07:30.658634Z","close_reason":"Implemented internal/beads package with GetBeadsDir(), IssuesJSONLPath(), DatabasePath(), SyncStatePath(). All tests pass.","dependencies":[{"issue_id":"beadhub-8u63","depends_on_id":"beadhub-nkjm","type":"blocks","created_at":"2026-01-02T12:04:35.107907Z","created_by":"juanre"}]}
{"id":"beadhub-8xmj","title":"Backend - Delete Reservations Code","description":"Delete routes/reservations.py and remove router from api.py. Dead code cleanup.","status":"closed","priority":1,"issue_type":"chore","created_at":"2025-12-12T17:56:36.095056+01:00","updated_at":"2025-12-12T18:21:30.823139+01:00","closed_at":"2025-12-12T18:21:30.823139+01:00"}
{"id":"beadhub-8yya","title":"fix: --claim flag not creating bead claims","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-05T17:00:41.965328Z","created_by":"juanre","updated_at":"2026-01-05T17:00:47.629018Z","closed_at":"2026-01-05T17:00:47.629018Z","close_reason":"Fixed: parse_status_change now detects --claim flag"}
{"id":"beadhub-8zvf","title":"Add bdh coordination commands: inbox, send, ack, status, escalate","description":"Add explicit coordination commands to bdh:\n\nbdh inbox [--all] [--json]\n  - List messages, unread by default\n\nbdh send \u003cworkspace_id\u003e \"\u003cmessage\u003e\"\n  - Send message to another workspace\n  - Fix JSON escaping issues in current implementation\n\nbdh ack \u003cmessage_id\u003e\n  - Mark message as read\n\nbdh status\n  - Show coordination status: current work, other agents, messages\n\nbdh escalate \"\u003csubject\u003e\" \"\u003csituation\u003e\"\n  - Create escalation to human\n\nThese call existing BeadHub APIs (messages, escalations).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T09:35:32.624035+01:00","updated_at":"2025-12-20T09:38:21.594093+01:00","closed_at":"2025-12-20T09:38:21.594093+01:00","close_reason":"Completed: implemented as :inbox/:send/:ack/:status/:escalate (canonical SOT updated)","dependencies":[{"issue_id":"beadhub-8zvf","depends_on_id":"beadhub-4trs","type":"parent-child","created_at":"2025-12-10T09:36:05.716672+01:00","created_by":"juanre"},{"issue_id":"beadhub-8zvf","depends_on_id":"beadhub-uz09","type":"blocks","created_at":"2025-12-10T09:36:15.456801+01:00","created_by":"juanre"}]}
{"id":"beadhub-90d0","title":"Validate messages priority enum","description":"Add Pydantic validation for messages priority to enforce allowed values (low|normal|high|urgent) so invalid input returns 422 instead of DB constraint error.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T11:20:35.924165+01:00","updated_at":"2025-12-20T11:22:47.403708+01:00","closed_at":"2025-12-20T11:22:47.403708+01:00","close_reason":"Completed","dependencies":[{"issue_id":"beadhub-90d0","depends_on_id":"beadhub-f0kk","type":"discovered-from","created_at":"2025-12-20T11:20:35.925477+01:00","created_by":"juanre"}]}
{"id":"beadhub-92y","title":"Update MCP tools to use workspace_id","description":"Update all MCP tools in routes/mcp.py to use workspace_id instead of project_key. Tools: register_agent, file_reservation_paths, release_file_reservations, send_message, fetch_inbox, etc.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T19:10:10.487504+01:00","updated_at":"2025-12-07T21:57:29.353297+01:00","closed_at":"2025-12-07T21:57:29.353297+01:00","dependencies":[{"issue_id":"beadhub-92y","depends_on_id":"beadhub-6am","type":"blocks","created_at":"2025-12-07T19:10:10.488347+01:00","created_by":"juanre"}]}
{"id":"beadhub-94q9","title":"Create pagination helper module with cursor encoding/decoding","description":"Create a reusable pagination module in src/beadhub/pagination.py:\n\n- encode_cursor(data: dict) -\u003e str: Base64 encode pagination state\n- decode_cursor(cursor: str) -\u003e dict: Decode cursor back to state\n- PaginatedResponse model with: items, has_more, next_cursor\n- validate_pagination_params(limit, cursor): Validate and sanitize inputs\n- Default limit: 50, max limit: 200\n\nThis is the foundation for all paginated endpoints.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T10:30:39.881165+01:00","updated_at":"2025-12-22T10:53:23.117171+01:00","closed_at":"2025-12-22T10:53:23.117171+01:00","close_reason":"Implemented pagination helper module with cursor encoding/decoding, PaginatedResponse model, and validate_pagination_params. Added size validation to prevent DoS. 26 tests passing.","dependencies":[{"issue_id":"beadhub-94q9","depends_on_id":"beadhub-v9wr","type":"blocks","created_at":"2025-12-22T10:32:20.687727+01:00","created_by":"juanre"}]}
{"id":"beadhub-94tb","title":"Collapse admin nav items on mobile","status":"open","priority":4,"issue_type":"feature","created_at":"2026-01-09T22:46:46.725657+01:00","created_by":"juanre","updated_at":"2026-01-09T22:46:46.725657+01:00"}
{"id":"beadhub-94uw","title":"Epic: Replace current_bead with claims array","description":"## Problem\n\n`current_bead` is a legacy single-value field that doesn't reflect reality:\n1. A workspace can have multiple claims (via --:jump-in or stale claims)\n2. Only the most recent claim is shown, hiding others\n3. No timestamp shown, so agents can't detect stale claims\n4. Vestigial `current_bead` field exists in Redis presence but is never populated\n\n## Goals\n\n1. **Agent self-awareness**: When I run `bdh ready`, show me ALL my claims with timestamps so I can question stale ones\n2. **Team visibility**: When colleagues run `bdh :who`, show all claims per workspace with timestamps\n3. **No tech debt**: Remove vestigial Redis field, no backward compatibility shims\n\n## Data Flow Changes\n\n### Before\n- `/v1/workspaces` returns `current_bead` (single, most recent claim only)\n- Redis presence has unused `current_bead` field\n- `bdh ready` shows TEAM STATUS but not MY CLAIMS\n- `bdh :who` shows one bead per workspace\n\n### After\n- `/v1/workspaces` returns `claims[]` array with `{bead_id, title, claimed_at}`\n- Redis presence removes `current_bead` field entirely\n- `bdh ready` shows YOUR CLAIMS section with age warnings\n- `bdh :who` shows all claims per workspace with timestamps","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-20T10:28:08.755938+01:00","updated_at":"2025-12-20T10:57:58.030713+01:00","closed_at":"2025-12-20T10:57:58.030713+01:00","close_reason":"Epic complete. Backend changes done by claude-main (commit 7dbec35). Go client changes (client.go, who.go, passthrough.go) done by me. All tests pass."}
{"id":"beadhub-952","title":"Add workspace_id param to presence and status endpoints","description":"Update /v1/agents/register, /v1/status to use workspace_id. Presence key becomes presence:{workspace_id}.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T19:10:00.499034+01:00","updated_at":"2025-12-07T20:51:32.841718+01:00","closed_at":"2025-12-07T20:51:32.841718+01:00","dependencies":[{"issue_id":"beadhub-952","depends_on_id":"beadhub-6am","type":"blocks","created_at":"2025-12-07T19:10:00.499846+01:00","created_by":"juanre"}]}
{"id":"beadhub-95qk","title":"Verify XSS safety in message rendering (MessagesPage)","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-13T20:34:54.170389+01:00","updated_at":"2025-12-13T20:37:20.779146+01:00","closed_at":"2025-12-13T20:37:20.779146+01:00"}
{"id":"beadhub-95x","title":"Add Docker Compose for local deployment","description":"Create docker-compose.yml with Redis, Postgres, and BeadHub API service. Include health checks and volume mounts.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-02T22:19:44.564452+01:00","updated_at":"2025-12-02T22:22:57.390247+01:00","closed_at":"2025-12-02T22:22:57.390247+01:00","close_reason":"Added docker-compose.yml with Redis, Postgres, and BeadHub API services with health checks","dependencies":[{"issue_id":"beadhub-95x","depends_on_id":"beadhub-3p5","type":"blocks","created_at":"2025-12-02T22:20:16.560257+01:00","created_by":"juanre"}]}
{"id":"beadhub-99j","title":"Add input length limits to Redis operations","description":"Add explicit max length limits for user-controlled strings used in Redis/Lua keys to prevent DoS via extremely long inputs.\n\nContext:\n- ReservationRequest already bounds alias and number of paths, but does not bound per-path length or other freeform strings (reason, bead_id).\n- Similar request models (release/renew + MCP wrappers) should enforce the same limits.\n\nChange:\n- Add constants for max path length and max reason length, enforce in validators.\n- Ensure all endpoints that accept paths/alias/reason/bead_id apply consistent limits.","acceptance_criteria":"- Requests reject overly long path entries (per-path max)\n- Requests reject overly long reason/bead_id where applicable\n- Limits are shared/consistent across reservation + MCP endpoints\n- Tests cover at least one too-long input case","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-07T22:17:23.763778+01:00","updated_at":"2026-01-03T16:33:47.718106Z","closed_at":"2026-01-03T16:33:47.718106Z","close_reason":"merged"}
{"id":"beadhub-9aq9","title":"Workspace soft-delete: add deleted_at column and update unique constraint","description":"Add deleted_at TIMESTAMPTZ column to workspaces table. Update unique constraint to only enforce alias uniqueness for non-deleted workspaces: CREATE UNIQUE INDEX idx_unique_active_alias ON workspaces(project_id, alias) WHERE deleted_at IS NULL. Add last_seen_at column updated on every bdh command.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-16T20:40:40.290071+01:00","updated_at":"2025-12-16T22:56:27.408672+01:00","closed_at":"2025-12-16T22:56:27.408672+01:00","dependencies":[{"issue_id":"beadhub-9aq9","depends_on_id":"beadhub-lmtj","type":"blocks","created_at":"2025-12-16T20:41:17.747231+01:00","created_by":"juanre"}]}
{"id":"beadhub-9c5e","title":"Extract chat protocol into aweb-go + restore missing CLI commands","description":"During the beadhubâ†’aweb refactor, the chat CLI was reduced to just send and pending. The pre-refactor code (beadhub-main) had open, history, hang-on, start-conversation, and leave-conversation. Restore these by: (1) adding 2 missing server endpoints to aweb, (2) adding client methods + fixing types in aweb-go, (3) extracting protocol logic into aweb-go chat/ subpackage, (4) updating aw reference CLI, (5) building bdh chat commands using the chat/ package. Key constraint: copy/refactor from beadhub-main, do NOT reimplement.","status":"closed","priority":1,"issue_type":"epic","owner":"juan@juanreyero.com","created_at":"2026-02-02T08:52:58.093197Z","created_by":"Juan Reyero","updated_at":"2026-02-02T09:40:55.975092Z","closed_at":"2026-02-02T09:40:55.975092Z","close_reason":"All 7 beads complete. Chat protocol extracted into aweb-go chat/ package. Full CLI restored: send (with wait/leaving/start-conversation), pending, open, history, hang-on, show-pending. Server endpoints added, client methods added, protocol tests + presentation tests pass.","labels":["component:aweb","component:aweb-go","component:bdh","component:chat"]}
{"id":"beadhub-9c5e.1","title":"aweb: Add POST /v1/chat/sessions/{session_id}/messages endpoint","description":"Add the send-message-in-existing-session endpoint to the aweb Python server. This is needed for hang-on functionality.\n\nSOURCE: Copy from beadhub-main/src/beadhub/routes/chat.py lines 744-858.\n\nENDPOINT SPEC:\n- Route: POST /v1/chat/sessions/{session_id}/messages\n- Auth: Same as other chat endpoints (get_project_from_auth, get_actor_agent_id_from_auth)\n\nREQUEST MODEL (SendMessageRequest):\n- body: str (message text)\n- hang_on: bool (default false - signals sender needs more time)\n\nRESPONSE MODEL (SendMessageResponse):\n- message_id: str (UUID)\n- delivered: bool\n- extends_wait_seconds: int (\u003e0 when hang_on=true)\n\nLOGIC:\n1. Validate session exists and caller is participant (tenant isolation)\n2. Get canonical alias from participants table (prevent spoofing)\n3. Generate message_id and timestamp\n4. If hang_on=true, set extends_wait_seconds = HANG_ON_EXTENSION_SECONDS\n5. Insert into chat_messages table (sender_leaving always false for this endpoint)\n6. Publish SSE event via publish_chat_event() with ChatMessageEvent\n7. Best-effort deadline extension: for each other participant who is waiting, call extend_workspace_deadline()\n\nTESTS:\n- Test sending message in existing session returns correct response shape\n- Test hang_on=true returns extends_wait_seconds \u003e 0\n- Test non-participant gets 403\n- Test nonexistent session gets 404\n\nACCEPTANCE: Endpoint works, tests pass, uv run pytest passes in aweb.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-02T08:53:12.328344Z","created_by":"Juan Reyero","updated_at":"2026-02-02T09:08:07.951801Z","closed_at":"2026-02-02T09:08:07.951801Z","close_reason":"Closed","labels":["component:aweb","component:chat"],"dependencies":[{"issue_id":"beadhub-9c5e.1","depends_on_id":"beadhub-9c5e","type":"parent-child","created_at":"2026-02-02T08:53:12.32945Z","created_by":"Juan Reyero"}]}
{"id":"beadhub-9c5e.2","title":"aweb: Add GET /v1/chat/sessions endpoint (list sessions)","description":"Add the list-sessions endpoint to the aweb Python server. Needed for session lookup fallback when a conversation has no unread messages (so it doesn't appear in pending).\n\nSOURCE: Copy from beadhub-main/src/beadhub/routes/chat.py lines 1336-1415.\n\nENDPOINT SPEC:\n- Route: GET /v1/chat/sessions\n- Auth: Same as other chat endpoints\n\nRESPONSE MODEL (SessionListResponse):\n- sessions: list[SessionListItem]\n\nSESSION LIST ITEM:\n- session_id: str\n- initiator_agent: str (alias of who started it)\n- target_agent: str (alias of other participant)\n- created_at: str (ISO format)\n\nLOGIC:\n1. Get workspace from auth\n2. Derive project_id server-side for tenant isolation\n3. Query: JOIN chat_sessions with chat_session_participants WHERE project_id matches and workspace is participant\n4. ORDER BY created_at DESC\n5. Return list of SessionListItem\n\nTESTS:\n- Test returns empty list when no sessions exist\n- Test returns sessions the workspace participates in\n- Test does NOT return sessions from other workspaces (tenant isolation)\n- Test ordering is by created_at DESC\n\nACCEPTANCE: Endpoint works, tests pass, uv run pytest passes in aweb.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-02T08:53:20.861808Z","created_by":"Juan Reyero","updated_at":"2026-02-02T09:08:08.041579Z","closed_at":"2026-02-02T09:08:08.041579Z","close_reason":"Closed","labels":["component:aweb","component:chat"],"dependencies":[{"issue_id":"beadhub-9c5e.2","depends_on_id":"beadhub-9c5e","type":"parent-child","created_at":"2026-02-02T08:53:20.862522Z","created_by":"Juan Reyero"}]}
{"id":"beadhub-9c5e.3","title":"aweb-go: Add ChatListSessions and ChatSendMessage client methods","description":"Add two missing client methods to aweb-go/chat.go and fix two response types.\n\nSOURCE: Follow patterns already in aweb-go/chat.go for existing methods.\n\nNEW METHODS:\n\n1. ChatListSessions(ctx context.Context) (*ChatListSessionsResponse, error)\n   - GET /v1/chat/sessions\n   - Response type ChatListSessionsResponse:\n     - Sessions []ChatSessionItem\n   - ChatSessionItem type:\n     - SessionID string `json:\"session_id\"`\n     - InitiatorAgent string `json:\"initiator_agent\"`\n     - TargetAgent string `json:\"target_agent\"`\n     - CreatedAt string `json:\"created_at\"`\n\n2. ChatSendMessage(ctx context.Context, sessionID string, req *ChatSendMessageRequest) (*ChatSendMessageResponse, error)\n   - POST /v1/chat/sessions/{sessionID}/messages\n   - Request type ChatSendMessageRequest:\n     - Body string `json:\"body\"`\n     - HangOn bool `json:\"hang_on\"`\n   - Response type ChatSendMessageResponse:\n     - MessageID string `json:\"message_id\"`\n     - Delivered bool `json:\"delivered\"`\n     - ExtendsWaitSeconds int `json:\"extends_wait_seconds\"`\n\nTYPE FIXES:\n\n3. ChatMarkReadResponse â€” add field:\n   - WaitExtendedSeconds int `json:\"wait_extended_seconds\"`\n\n4. ChatPendingItem.TimeRemainingSeconds â€” change from int to *int\n   - nil vs 0 distinction matters for 'urgent' display logic\n\nTESTS:\n- Test ChatListSessions with httptest mock returning session list\n- Test ChatSendMessage with httptest mock\n- Test ChatSendMessage with hang_on=true\n- Verify ChatPendingItem can unmarshal with null time_remaining_seconds\n\nACCEPTANCE: go test ./... passes in aweb-go root.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-02T08:53:31.940294Z","created_by":"Juan Reyero","updated_at":"2026-02-02T09:18:41.260888Z","closed_at":"2026-02-02T09:18:41.260888Z","close_reason":"Closed","labels":["component:aweb-go","component:chat"],"dependencies":[{"issue_id":"beadhub-9c5e.3","depends_on_id":"beadhub-9c5e","type":"parent-child","created_at":"2026-02-02T08:53:31.940966Z","created_by":"Juan Reyero"},{"issue_id":"beadhub-9c5e.3","depends_on_id":"beadhub-9c5e.1","type":"blocked-by","created_at":"2026-02-02T08:53:31.944018Z","created_by":"Juan Reyero"},{"issue_id":"beadhub-9c5e.3","depends_on_id":"beadhub-9c5e.2","type":"blocked-by","created_at":"2026-02-02T08:53:31.944515Z","created_by":"Juan Reyero"}]}
{"id":"beadhub-9c5e.4","title":"aweb-go: Create chat/ protocol subpackage","description":"Create a new chat/ subpackage in aweb-go with high-level protocol functions that compose the low-level client methods. This is the core extraction â€” the reusable library that both aw CLI and bdh will consume.\n\nSOURCE: Adapt from beadhub-main/bdh/internal/commands/chat.go (~1301 lines). Copy protocol logic, do NOT reimplement.\n\nFILES TO CREATE:\n- aweb-go/chat/types.go\n- aweb-go/chat/chat.go\n- aweb-go/chat/chat_test.go\n\nTYPES (chat/types.go):\n- Event: Type, Agent, SessionID, MessageID, FromAgent, Body, By, Reason, Timestamp, SenderLeaving, ReaderAlias, HangOn, ExtendsWaitSeconds\n- SendResult: SessionID, Status (sent/replied/sender_left/pending/targets_left), TargetAgent, Reply, Events, Error, TargetNotConnected, SenderWaiting, WaitedSeconds\n- OpenResult: SessionID, TargetAgent, Messages []Event, MarkedRead int, SenderWaiting, UnreadWasEmpty, WaitExtendedSeconds\n- HistoryResult: SessionID, Messages []Event\n- PendingResult: Conversations []PendingConversation, MessagesWaiting int\n- PendingConversation: SessionID, Participants, LastMessage, LastFrom, UnreadCount, LastActivity, SenderWaiting, TimeRemainingSeconds *int\n- HangOnResult: SessionID, TargetAgent, Message, ExtendsWaitSeconds\n- SendOptions: Wait int, Leaving bool, StartConversation bool\n- StatusCallback: func(kind string, message string) â€” kind is one of: read_receipt, hang_on, wait_extended\n\nPROTOCOL FUNCTIONS (chat/chat.go):\nPackage needs a Client interface (or accept aweb.Client directly) for the methods it calls.\n\n1. Send(ctx, client, myAlias, targets []string, message string, opts SendOptions, callback StatusCallback) (*SendResult, error)\n   - Create/get session via client.ChatCreateSession\n   - Handle leaving (return immediately)\n   - Handle wait=0 (return immediately)\n   - Handle targets_left (return targets_left status)\n   - Connect to SSE stream with deadline\n   - Wait for reply with timeout, filtering replayed messages\n   - Handle read_receipt events (callback + extend wait)\n   - Handle hang_on messages (callback + extend wait, keep waiting)\n   - Handle sender_leaving messages\n   - Handle normal reply messages\n   - Return SendResult with status and events\n\n2. Open(ctx, client, targetAlias string) (*OpenResult, error)\n   - Find session via pending (captures sender_waiting)\n   - Fallback to ChatListSessions if not in pending\n   - Fetch unread messages (UnreadOnly=true)\n   - Mark read up to last message\n   - Return messages, marked-read count, sender_waiting, wait_extended_seconds\n\n3. History(ctx, client, targetAlias string) (*HistoryResult, error)\n   - Find session (pending first, then list sessions fallback)\n   - Fetch all messages (no UnreadOnly filter)\n   - Return sorted messages\n\n4. Pending(ctx, client) (*PendingResult, error)\n   - Call client.ChatPending()\n   - Map to PendingResult type\n\n5. HangOn(ctx, client, targetAlias string, message string) (*HangOnResult, error)\n   - Find session with target (try pending first, fallback to list)\n   - Send message with hang_on=true via client.ChatSendMessage\n   - Return ExtendsWaitSeconds\n\n6. ShowPending(ctx, client, targetAlias string) (*SendResult, error)\n   - Show pending messages for specific target without marking read\n\nINTERNAL HELPERS:\n- findSession(ctx, client, targetAlias) (sessionID string, senderWaiting bool, err error)\n  - Check pending conversations first\n  - Fallback to ChatListSessions\n  - Match by participant alias\n- parseSSEEvent(data string) (*Event, error) â€” parse JSON SSE data into Event struct\n  - Handle from_agent (primary) and from (fallback) fields\n- streamToChannel(stream *aweb.SSEStream) \u003c-chan sseResult â€” bridge SSEStream.Next() to channel\n  - Goroutine reads stream.Next() in loop\n  - Sends sseResult{event, err} to buffered channel\n  - Closes channel on error/EOF\n\nKEY ADAPTATION NOTES:\n- Pre-refactor used channel-based SSE; aweb-go uses SSEStream.Next(). Bridge with streamToChannel goroutine.\n- Pre-refactor wrote directly to os.Stderr; library uses StatusCallback instead.\n- Pre-refactor had alias resolution (fuzzy matching) â€” that stays in bdh, NOT in this package.\n\nTESTS (chat/chat_test.go):\nUse httptest mock servers. Port ~12 tests from pre-refactor covering:\n- Send with immediate reply\n- Send with timeout (no reply)\n- Send with leaving flag\n- Send with hang_on received\n- Send with read_receipt extending wait\n- Open with unread messages\n- Open with no unread (fallback to list sessions)\n- History retrieval\n- Pending list\n- HangOn send\n- findSession fallback logic\n- parseSSEEvent parsing\n\nACCEPTANCE: go test ./chat/ passes. go test ./... passes in aweb-go.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-02T08:54:05.38198Z","created_by":"Juan Reyero","updated_at":"2026-02-02T09:23:51.330421Z","closed_at":"2026-02-02T09:23:51.330421Z","close_reason":"Closed","labels":["component:aweb-go","component:chat"],"dependencies":[{"issue_id":"beadhub-9c5e.4","depends_on_id":"beadhub-9c5e","type":"parent-child","created_at":"2026-02-02T08:54:05.388582Z","created_by":"Juan Reyero"},{"issue_id":"beadhub-9c5e.4","depends_on_id":"beadhub-9c5e.3","type":"blocked-by","created_at":"2026-02-02T08:54:05.392126Z","created_by":"Juan Reyero"}]}
{"id":"beadhub-9c5e.5","title":"aweb-go: Update aw CLI with all chat subcommands","description":"Update the aw reference CLI (aweb-go/cmd/aw/main.go) to expose all chat protocol functions. Currently has only send and pending.\n\nSOURCE: Adapt command structure from beadhub-main/bdh/internal/commands/chat.go. Use the new chat/ subpackage.\n\nADD SUBCOMMANDS:\n1. aw chat open \u003calias\u003e â€” Read unread messages, mark as read. Uses chat.Open(). Output JSON with OpenResult.\n2. aw chat history \u003calias\u003e â€” Show full conversation history. Uses chat.History(). Output JSON with HistoryResult.\n3. aw chat hang-on \u003calias\u003e \u003cmessage\u003e â€” Send hang-on message requesting more time. Uses chat.HangOn(). Output JSON with HangOnResult.\n4. aw chat show-pending \u003calias\u003e â€” Show pending messages for specific alias without marking read. Uses chat.ShowPending().\n\nUPDATE EXISTING:\n5. aw chat send â€” Add flags:\n   - --wait \u003cseconds\u003e (wait for reply, default 60)\n   - --leaving (send and leave conversation)\n   - --start-conversation (initiate with 5min default wait)\n   Currently send just fires and forgets. Update to use chat.Send() with SendOptions.\n   StatusCallback should print to stderr.\n\nALL commands output JSON. aw is a reference/scripting CLI, not user-facing.\n\nACCEPTANCE: go build ./cmd/aw/ succeeds. All new subcommands work with --help.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-02T08:54:15.816606Z","created_by":"Juan Reyero","updated_at":"2026-02-02T09:28:48.800588Z","closed_at":"2026-02-02T09:28:48.800588Z","close_reason":"All chat subcommands added to aw CLI: send (with --wait/--leaving/--start-conversation), pending, open, history, hang-on, show-pending. Uses chat/ protocol package. Agent alias resolved from config.","labels":["component:aweb-go","component:chat","component:cli"],"dependencies":[{"issue_id":"beadhub-9c5e.5","depends_on_id":"beadhub-9c5e","type":"parent-child","created_at":"2026-02-02T08:54:15.817414Z","created_by":"Juan Reyero"},{"issue_id":"beadhub-9c5e.5","depends_on_id":"beadhub-9c5e.4","type":"blocked-by","created_at":"2026-02-02T08:54:15.820763Z","created_by":"Juan Reyero"}]}
{"id":"beadhub-9c5e.6","title":"bdh: Chat commands using chat/ package","description":"Create bdh/internal/commands/chat.go with full chat command support using the aweb-go chat/ subpackage. Remove old chat send/pending from aweb.go.\n\nSOURCE: Copy presentation/formatting logic from beadhub-main/bdh/internal/commands/chat.go. Protocol logic comes from the chat/ package â€” do NOT duplicate it here.\n\nCREATE: bdh/internal/commands/chat.go\n\nCOBRA COMMANDS (under 'bdh :aweb chat' or 'bdh :chat'):\nFlags (mutually exclusive modes):\n- --start-conversation \u003calias\u003e \u003cmessage\u003e â€” initiate exchange (5min default wait)\n- --reply \u003calias\u003e \u003cmessage\u003e â€” respond to conversation (60s default wait)\n- --leave-conversation \u003calias\u003e \u003cmessage\u003e â€” send final message, exit immediately\n- --open \u003calias\u003e â€” read unread messages, mark as read\n- --pending â€” list conversations with unread messages\n- --history \u003calias\u003e â€” show full conversation history\n- --hang-on \u003calias\u003e \u003cmessage\u003e â€” request more time before replying\n\nOptional flags:\n- --wait \u003cseconds\u003e â€” override timeout\n- --json â€” JSON output\n\nALIAS RESOLUTION:\n- Fuzzy matching (exact â†’ prefix â†’ substring) stays in bdh, NOT in chat/ package\n- Uses existing agent listing from aweb-go client\n- Prevents chat with self\n\nSTATUS CALLBACK:\n- Implement StatusCallback that writes to stderr\n- Kinds: read_receipt (\"[chat] \u003calias\u003e opened your message\"), hang_on (\"[chat] \u003calias\u003e needs more time: \u003cmsg\u003e\"), wait_extended (\"[chat] wait extended by Xs (reason)\")\n\nNOTIFICATION INTEGRATION:\n- Call SetExcludeChatAlias() when actively chatting with someone to avoid redundant notifications\n- Notifications.go may need command hint updates for new syntax\n\nFORMAT FUNCTIONS (copy from pre-refactor, adapt to new types):\n- formatChatOutput(result *chat.SendResult, json bool) string\n  - JSON: marshal SendResult\n  - Text: status-dependent formatting (replied, sender_left, sent, targets_left, pending)\n- formatPendingOutput(result *chat.PendingResult, json bool) string\n  - JSON: summary only (no message bodies â€” agents must open to read)\n  - Text: CHAT WAITING / CHAT lines with unread counts, time remaining for urgent\n- formatHistoryOutput(result *chat.HistoryResult, json bool) string\n  - JSON: full result\n  - Text: numbered messages with [timestamp] agent: body\n- formatChatOpenOutput(result *chat.OpenResult, json bool) string\n  - JSON: full result\n  - Text: unread count, sender_waiting status, messages, next action hint\n- formatHangOnOutput(result *chat.HangOnResult, json bool) string\n  - JSON: full result\n  - Text: \"Sent hang-on to X\" + message + extension note\n\nMODIFY: bdh/internal/commands/aweb.go\n- Remove chatSendCmd and chatPendingCmd (they move to chat.go)\n- Keep the 'chat' parent command, wire it to new subcommands\n\nMODIFY: bdh/internal/commands/notifications.go\n- Update command hints to reference new syntax if needed\n\nACCEPTANCE: go test ./... passes in bdh/. make bdh succeeds.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-02T08:54:37.298452Z","created_by":"Juan Reyero","updated_at":"2026-02-02T09:39:15.036353Z","closed_at":"2026-02-02T09:39:15.036353Z","close_reason":"Chat commands implemented using aweb-go chat/ package. All modes working: --start-conversation, --reply, --leave-conversation, --open, --pending, --history, --hang-on. Format functions, alias resolution, notification integration. Tests pass, make bdh succeeds.","labels":["component:bdh","component:chat","component:cli"],"dependencies":[{"issue_id":"beadhub-9c5e.6","depends_on_id":"beadhub-9c5e","type":"parent-child","created_at":"2026-02-02T08:54:37.299267Z","created_by":"Juan Reyero"},{"issue_id":"beadhub-9c5e.6","depends_on_id":"beadhub-9c5e.4","type":"blocked-by","created_at":"2026-02-02T08:54:37.302309Z","created_by":"Juan Reyero"}]}
{"id":"beadhub-9c5e.7","title":"bdh: Chat presentation tests","description":"Create bdh/internal/commands/chat_test.go with tests for the formatting/presentation functions in chat.go.\n\nSOURCE: Port/adapt format tests from beadhub-main/bdh/internal/commands/chat.go. These test output formatting only â€” no protocol logic.\n\nCREATE: bdh/internal/commands/chat_test.go\n\nTESTS TO PORT:\n1. TestFormatChatOutput_Replied â€” verify text output for status=replied includes agent name and reply body\n2. TestFormatChatOutput_SenderLeft â€” verify includes left note\n3. TestFormatChatOutput_Sent â€” verify message sent text, optional not-connected note\n4. TestFormatChatOutput_TargetsLeft â€” verify restart hint\n5. TestFormatChatOutput_JSON â€” verify valid JSON with all fields\n6. TestFormatPendingOutput_WithWaiting â€” verify CHAT WAITING prefix for sender_waiting=true\n7. TestFormatPendingOutput_NoWaiting â€” verify CHAT prefix without WAITING\n8. TestFormatPendingOutput_TimeRemaining â€” verify urgent display when \u003c 60s\n9. TestFormatPendingOutput_JSON â€” verify JSON summary (no message bodies)\n10. TestFormatHistoryOutput_Text â€” verify numbered message format\n11. TestFormatChatOpenOutput_WithMessages â€” verify unread count and message display\n12. TestFormatChatOpenOutput_Empty â€” verify empty unread handling\n13. TestFormatHangOnOutput â€” verify hang-on text and extension note\n\nAPPROACH: Create chat.SendResult / chat.OpenResult / etc. structs directly, call format functions, assert output strings contain expected fragments.\n\nACCEPTANCE: go test ./internal/commands/ -run TestFormat passes. go test ./... passes in bdh/.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-02T08:54:47.856392Z","created_by":"Juan Reyero","updated_at":"2026-02-02T09:40:47.080425Z","closed_at":"2026-02-02T09:40:47.080425Z","close_reason":"27 presentation tests for all chat format functions. All pass.","labels":["area:tests","component:bdh","component:chat"],"dependencies":[{"issue_id":"beadhub-9c5e.7","depends_on_id":"beadhub-9c5e","type":"parent-child","created_at":"2026-02-02T08:54:47.85809Z","created_by":"Juan Reyero"},{"issue_id":"beadhub-9c5e.7","depends_on_id":"beadhub-9c5e.6","type":"blocked-by","created_at":"2026-02-02T08:54:47.862393Z","created_by":"Juan Reyero"}]}
{"id":"beadhub-9ci1","title":"bdh: Store repo_origin in .beadhub, detect mismatch on commands","description":"## Problem\nbdh :init doesn't store repo_origin, and commands don't verify repo hasn't changed.\n\n## Solution\nStore repo metadata in .beadhub during init, detect mismatch on every command.\n\n## Implementation (from Dave discussion)\n\n### During bdh :init:\n- Store in .beadhub: workspace_id, project_id, alias, role, repo_origin, canonical_origin\n- Fail fast if git remote is weird/missing\n\n### On every bdh command:\n1. Read current git remote\n2. Compare to stored repo_origin\n3. If mismatch: fail with 'workspace repo mismatch; re-run bdh :init'\n4. Send heartbeat with full payload from .beadhub\n\nThis preserves workspaceâ†’repo immutability invariant and prevents stale .beadhub from coordinating wrong repo.\n\n### Heartbeat payload to send:\nworkspace_id, alias, role, current_branch, repo_origin, workspace_path, hostname\n\n## Cross-repo dependency\nDepends on beadhub-cloud-5ae (backend heartbeat endpoint in beadhub-cloud repo).","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-05T10:56:14.687228Z","created_by":"juanre","updated_at":"2026-01-05T11:44:34.251064Z","closed_at":"2026-01-05T11:44:34.251064Z","close_reason":"Implemented CLI heartbeat + repo mismatch detection (e071b3f) and wired Cloud heartbeat endpoint /api/v1/workspaces/heartbeat fallback (ee9a19e)."}
{"id":"beadhub-9gca","title":"Policy Activate action has no confirmation dialog","description":"Problem\n- In `frontend/src/pages/PoliciesPage.tsx`, clicking \"Activate\" on a history version immediately changes the active policy for the entire project.\n\nChange\n- Add an explicit confirmation step before calling `api.activatePolicy(...)`. Use the existing UI dialog patterns (Radix/shadcn `AlertDialog`).\n- Dialog copy should clearly warn: activating affects all workspaces/agents in the project.\n- While activating, disable the confirm button (and ideally show a spinner).\n\nNotes\n- Keep this purely client-side; backend stays unchanged.","acceptance_criteria":"- Clicking \"Activate\" opens a confirmation dialog (no activation happens yet).\n- Cancel closes dialog and does not change the active policy.\n- Confirm triggers activation, updates history active marker, and handles errors visibly.\n- Activation button is disabled while the request is in flight.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-02T18:45:05.352985Z","created_by":"juanre","updated_at":"2026-01-02T21:27:11.977234Z","closed_at":"2026-01-02T21:27:11.977234Z","close_reason":"Add activation confirmation dialog (AlertDialog) and disable while activating","dependencies":[{"issue_id":"beadhub-9gca","depends_on_id":"beadhub-1tqa","type":"discovered-from","created_at":"2026-01-02T18:45:05.355105Z","created_by":"juanre"}]}
{"id":"beadhub-9hb0","title":"SSE streaming endpoint missing tenant isolation - must scope by X-Project-ID when present","description":"The SSE streaming endpoint (/v1/status/stream) in status.py uses database queries that don't enforce tenant isolation:\n\n1. get_all_workspace_ids_from_db() - Returns ALL workspaces across ALL tenants\n2. get_workspace_ids_by_project_slug_from_db() - project_slug is NOT globally unique in Cloud (multiple tenants can have same slug)\n3. get_workspace_ids_by_repo_id_from_db() - No authorization check for repo access\n\n**Fix pattern:**\n- When X-Project-ID header is present (Cloud mode): scope all queries by project_id\n- When X-Project-ID is absent (OSS mode): use project_slug for filtering (globally unique in single-tenant)\n\n**Security assumption:** X-Project-ID is trusted when present because Cloud middleware validates it before forwarding to OSS. In OSS standalone mode, there's no multi-tenant data to leak.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-21T12:01:51.861779+01:00","updated_at":"2025-12-21T12:06:36.553235+01:00","closed_at":"2025-12-21T12:06:36.553235+01:00","close_reason":"Implemented X-Project-ID tenant isolation for SSE endpoint. All 3 database query functions now accept optional project_id parameter and scope queries accordingly. Added 3 new tests for tenant isolation."}
{"id":"beadhub-9i0","title":"Replace sync Redis client with redis.asyncio","description":"**Problem**: All Redis operations use sync `redis` client wrapped in `run_in_threadpool()`. This is inefficient and will exhaust FastAPI's thread pool (40 threads) under load.\n\n**Files affected**:\n- `redis_client.py` - creates sync client\n- `routes/reservations.py:123` - `run_in_threadpool(redis.hgetall, key)`\n- `routes/messages.py:95-96` - `run_in_threadpool(redis.lpush, key, serialized)`\n- `presence.py:44-45` - `run_in_threadpool(redis.hset, key, mapping=fields)`\n\n**Fix**: Replace with `redis.asyncio`:\n```python\nfrom redis.asyncio import Redis, from_url as async_redis_from_url\n\n# In lifespan\nredis = await async_redis_from_url(settings.redis_url, decode_responses=True)\napp.state.redis = redis\n\n# In routes - direct await, no threadpool\nexisting = await redis.hgetall(key)\n```\n\n**Impact**: All routes using Redis need updating. This is foundational - fix this first.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-02T19:42:12.637565+01:00","updated_at":"2025-12-02T21:37:10.740177+01:00","closed_at":"2025-12-02T21:37:10.740177+01:00","close_reason":"Migrated all Redis operations to async using redis.asyncio with FastAPI dependency injection. All 13 tests pass."}
{"id":"beadhub-9i4q","title":"Update EscalationsPage to use pagination","description":"Update frontend escalations view:\n\n- Use new pagination component\n- Fetch first page on mount\n- Load more pages on user request\n- Handle cursor state in component\n- Show loading state during fetches","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T10:31:08.259887+01:00","updated_at":"2025-12-22T13:08:43.894844+01:00","closed_at":"2025-12-22T13:08:43.894844+01:00","close_reason":"Implemented pagination for EscalationsPage with load more support","dependencies":[{"issue_id":"beadhub-9i4q","depends_on_id":"beadhub-v9wr","type":"blocks","created_at":"2025-12-22T10:32:21.988314+01:00","created_by":"juanre"},{"issue_id":"beadhub-9i4q","depends_on_id":"beadhub-4gli","type":"blocks","created_at":"2025-12-22T10:38:06.826887+01:00","created_by":"juanre"},{"issue_id":"beadhub-9i4q","depends_on_id":"beadhub-c6zq","type":"blocks","created_at":"2025-12-22T10:38:06.988397+01:00","created_by":"juanre"}]}
{"id":"beadhub-9ibq","title":"Update bead_claims migration: project_key -\u003e project_id","description":"Rewrite 006_bead_claims.sql migration to use project_id instead of project_key:\n\n```sql\nCREATE TABLE bead_claims (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    project_id UUID NOT NULL REFERENCES projects(id),\n    workspace_id UUID NOT NULL,\n    agent_name TEXT NOT NULL,\n    human_name TEXT NOT NULL,\n    bead_id TEXT NOT NULL,\n    claimed_at TIMESTAMPTZ NOT NULL DEFAULT NOW(),\n    UNIQUE(project_id, bead_id)\n);\n```\n\nThis is greenfield - no production data. Can delete and rewrite migration.\n\nDepends on: beadhub-bkkz (projects table must exist first)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T12:27:51.164979+01:00","updated_at":"2025-12-10T12:55:23.414718+01:00","closed_at":"2025-12-10T12:55:23.414718+01:00","dependencies":[{"issue_id":"beadhub-9ibq","depends_on_id":"beadhub-4trs","type":"parent-child","created_at":"2025-12-10T12:27:51.166024+01:00","created_by":"juanre"},{"issue_id":"beadhub-9ibq","depends_on_id":"beadhub-bkkz","type":"blocks","created_at":"2025-12-10T12:27:51.166635+01:00","created_by":"juanre"}]}
{"id":"beadhub-9jya","title":"Auto-detect and store apex on bead claim","description":"When a bead is claimed (update --status=in_progress), automatically detect its apex and store it in .role line 2. This happens in passthrough.go after successful bd execution. Call the apex detection algorithm, then SaveApex(). If bead has no parent, store the bead ID itself as apex.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T21:59:17.493021+01:00","updated_at":"2025-12-20T10:22:05.03616+01:00","closed_at":"2025-12-20T10:22:05.03616+01:00","close_reason":"Implemented auto-store apex on claim: added isClaimCommand() to detect claim commands, extractBeadIDFromArgs() to get the bead ID, and apex storage logic in runPassthrough(). Errors are logged but don't block command execution. All tests pass.","dependencies":[{"issue_id":"beadhub-9jya","depends_on_id":"beadhub-npuh","type":"parent-child","created_at":"2025-12-17T21:59:32.694678+01:00","created_by":"juanre"},{"issue_id":"beadhub-9jya","depends_on_id":"beadhub-8m8m","type":"blocks","created_at":"2025-12-17T21:59:40.514472+01:00","created_by":"juanre"},{"issue_id":"beadhub-9jya","depends_on_id":"beadhub-vvon","type":"blocks","created_at":"2025-12-17T21:59:40.631855+01:00","created_by":"juanre"}]}
{"id":"beadhub-9ld","title":"Remove hardcoded credentials from config defaults","description":"**Problem**: Default DATABASE_URL contains real-looking credentials. If someone forgets to set the env var in production, they'll use these credentials - a security risk.\n\n**File**: `config.py:28`\n\n**Current code**:\n```python\ndatabase_url=os.getenv(\n    \"DATABASE_URL\",\n    \"postgresql://beadhub:secret@localhost:5432/beadhub\",\n),\n```\n\n**Fix options**:\n1. Use obvious placeholder: `\"postgresql://CHANGE_ME:CHANGE_ME@localhost:5432/beadhub\"`\n2. Fail fast if not set: raise error if DATABASE_URL is missing\n3. Only allow default in development (check for BEADHUB_ENV or similar)\n\n**Recommended**: Option 2 for production safety. Development can use a .env file.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-02T19:45:55.68013+01:00","updated_at":"2025-12-02T21:38:38.184722+01:00","closed_at":"2025-12-02T21:38:38.184722+01:00","close_reason":"Removed hardcoded credentials - DATABASE_URL is now required with a helpful error message if not set"}
{"id":"beadhub-9mt","title":"Add validation in library mode lifespan to verify db_infra is initialized","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-03T09:46:10.349238+01:00","updated_at":"2025-12-03T11:54:54.719745+01:00","closed_at":"2025-12-03T11:54:54.719745+01:00"}
{"id":"beadhub-9p3","title":"Add development setup documentation","description":"Document how to: 1) Run BeadHub locally with docker-compose, 2) Run tests (pytest), 3) Set up Redis/Postgres for development, 4) Use the CLI in dev mode, 5) Point agents at local BeadHub instance","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-03T20:52:28.714666+01:00","updated_at":"2025-12-06T21:37:04.197043+01:00","closed_at":"2025-12-06T21:37:04.197043+01:00"}
{"id":"beadhub-9po0","title":"OSS dashboard: first-run onboarding empty-state when no workspaces","description":"## Context\nWe plan to publish the full `beadhub` repo OSS. A fresh OSS user will typically:\n1) start the server (`docker compose up`)\n2) open the dashboard at `http://localhost:8000`\n3) only later run `bdh :init` in a repo checkout\n\nToday step (2) can be confusing because the OSS dashboard tries to create a dashboard identity by deriving `project_id` from existing workspaces.\n\n## Problem\nWhen there are **zero registered workspaces**, the OSS dashboard:\n- cannot derive a `project_id` to call `POST /v1/dashboard/identity`\n- sets an internal error state (\"No workspaces available. Register a workspace to enable messaging.\")\n- renders without a clear onboarding call-to-action (FilterBar also returns `null` because there are no filter options)\n\nThis makes first-run feel broken and is a launch-risk for OSS.\n\n## Why This Exists / Cloud Coupling\nCloud sets project context via auth + project selection and then injects:\n- `apiBasePath='/api'`\n- `projectId=\u003cactive project\u003e`\n\nSo Cloud users donâ€™t hit the â€œzero workspacesâ€ state when entering the dashboard. OSS users do.\n\n## Goals\n- Make OSS first-run dashboard experience explicit and non-confusing.\n- Preserve Cloud behavior (no Cloud changes required).\n- Keep backend changes to **zero** if possible (front-end UX fix).\n\n## Non-goals\n- Implement Cloud onboarding fixes (tracked separately).\n- Add new OSS admin surfaces (creating projects/repos from dashboard).\n- Change OSS security model.\n\n## Proposed Solution (minimal, OSS-only)\n1) **OSS dashboard global empty state**\n   - In OSS SPA layout, detect `workspaces.length === 0` after the initial `/v1/workspaces` load.\n   - Show a persistent, prominent onboarding panel with:\n     - â€œNo workspaces yetâ€\n     - step-by-step: run `bdh :init` in a git repo checkout\n     - link to docs/README\n\n2) **Graceful degradation for messaging features**\n   - Keep Status/Workspaces/Claims/Issues pages usable (they can show empty lists).\n   - Disable actions requiring `dashboardIdentity` (chat start, send mail, policy writes), and show a clear inline message that identity requires `bdh :init`.\n\n3) (Optional polish) Add a dedicated â€œGetting Startedâ€ route that auto-shows when no workspaces exist.\n\n## UX Copy (draft)\nTitle: â€œNo workspaces connected yetâ€\nBody:\n- â€œBeadHub shows coordination data after at least one workspace is registered.â€\n- â€œFrom a repo checkout, run:â€\n  - `bdh :init --project \u003cslug\u003e --alias \u003calias\u003e --human \"\u003cyour name\u003e\"`\n- â€œThen refresh this page.â€\n\n## Implementation Outline\n- OSS-only frontend:\n  - `frontend/src/components/Layout.tsx`: render empty-state panel when `workspaces.length === 0`.\n  - (If needed) new component e.g. `frontend/src/components/GettingStartedBanner.tsx`.\n- No changes to `frontend/packages/dashboard` (shared package) and no changes to Cloud frontend.\n\n## Acceptance Criteria\n- Fresh DB + server running + opening `http://localhost:8000` shows clear onboarding panel (not a blank/empty nav-only page).\n- No console errors or unhandled promise rejections during first load with empty DB.\n- Status page still loads and refreshes.\n- Chat/Mail/Policies actions are disabled with a clear explanation until a workspace exists.\n- After running `bdh :init` in any repo and refreshing the dashboard, the empty state disappears and identity initialization succeeds.\n- Cloud dashboard behavior unchanged.\n\n## Test Plan\nManual:\n1) `docker compose down -v \u0026\u0026 POSTGRES_PASSWORD=demo docker compose up -d`\n2) Open `http://localhost:8000` â†’ verify onboarding panel present.\n3) In any git repo checkout, run `bdh :init`.\n4) Refresh dashboard â†’ verify normal views + chat/mail actions enabled.\n\n## Notes\nAligned with `dave-coordinator`: Cloud assumptions will not be broken by an OSS-only empty-state UX fix.\n","acceptance_criteria":"Fresh install shows clear CTA; no confusing blank state; Cloud unaffected","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-17T10:58:57.331084+01:00","created_by":"Juan Reyero","updated_at":"2026-01-17T14:00:59.377208+01:00","closed_at":"2026-01-17T14:00:59.377208+01:00","close_reason":"Already implemented in commit ec576cb - getting-started page, auto-redirect, and empty-state handling all done","labels":["dashboard","onboarding","oss"]}
{"id":"beadhub-9su","title":"Add repos table and registration API","description":"Database: repos table with id, name, path_or_url, sync_config.\nAPI: POST /v1/repos to register, GET /v1/repos to list.\nCLI: bd repo add \u003cname\u003e --path=\u003cpath\u003e, bd repo list.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-03T09:15:07.403709+01:00","updated_at":"2025-12-03T12:34:15.960353+01:00","closed_at":"2025-12-03T12:34:15.960353+01:00"}
{"id":"beadhub-9v3g","title":"Implement efficient incremental sync for bdh","description":"Currently bdh sync is extremely inefficient:\n\n**Current Behavior:**\n- Reads entire .beads/issues.jsonl on every sync\n- Sends full file content to server in POST /v1/sync\n- Server parses all issues and UPSERTs every single one\n- No detection of what actually changed\n\n**Impact:**\n- 1000 beads = 1000 UPSERTs per mutation\n- Network overhead grows linearly with bead count\n- Database writes grow linearly with bead count\n- Scales very poorly for large projects\n\n**Solution: Incremental/Delta Sync**\n\n1. Client-side (bdh Go CLI):\n   - Track hash/checksum of each issue\n   - On sync, only send issues where hash changed since last sync\n   - Store last-synced hashes in .beadhub or .beads/sync-state.json\n\n2. Server-side (Python):\n   - Accept partial issue list (changed issues only)\n   - Skip UPSERT for issues not in the request (unchanged)\n   - Return sync statistics (received, changed, skipped)\n\n3. Protocol:\n   - New field: sync_mode: 'full' | 'incremental'\n   - Incremental sends: changed_issues + deleted_ids\n   - Full sync remains available as fallback\n\nThis blocks production deployment for any project with significant bead history.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-22T10:30:18.419576+01:00","updated_at":"2025-12-22T12:46:40.823617+01:00","closed_at":"2025-12-22T12:46:40.823617+01:00","close_reason":"All subtasks complete, merged to main"}
{"id":"beadhub-9w1n","title":"Add deleted_at column to repos table","description":"Migration to add soft-delete support to repos table. Add deleted_at TIMESTAMPTZ column and partial index for active repos.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T15:25:33.566022+01:00","updated_at":"2025-12-21T16:17:58.725762+01:00","closed_at":"2025-12-21T16:17:58.725762+01:00","close_reason":"Added deleted_at column and idx_repos_active partial index to repos table. Retained UNIQUE constraint for ON CONFLICT support. Updated beadhub-4bc4 to note that ON CONFLICT queries need to clear deleted_at.","dependencies":[{"issue_id":"beadhub-9w1n","depends_on_id":"beadhub-1thq","type":"blocks","created_at":"2025-12-21T15:26:54.364795+01:00","created_by":"juanre"}]}
{"id":"beadhub-9y1","title":"Add index on escalations.agent_name for common query pattern","description":"Add DB index to speed up common escalation list filtering by alias.\n\nContext:\n- Escalations table column is named alias (issue title says agent_name).\n- GET /v1/escalations supports query param alias and orders by created_at DESC.\n\nChange:\n- Add a migration that creates an index to support this pattern; prefer a composite index on (alias, created_at DESC) if it matches the query plan.","acceptance_criteria":"- New migration adds index on escalations(alias, created_at DESC) (or alias-only with rationale)\n- Migrations apply cleanly\n- Endpoint behavior unchanged","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-03T15:39:12.892231+01:00","updated_at":"2026-01-03T16:33:51.985574Z","closed_at":"2026-01-03T16:33:51.985574Z","close_reason":"merged"}
{"id":"beadhub-9zpa","title":"Add AbortSignal support to API client for React Query cancellation","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-08T15:32:34.590973+01:00","updated_at":"2025-12-08T15:32:34.590973+01:00","dependencies":[{"issue_id":"beadhub-9zpa","depends_on_id":"beadhub-7r4","type":"discovered-from","created_at":"2025-12-08T15:32:34.591773+01:00","created_by":"juanre"}]}
{"id":"beadhub-a0l0","title":"Migrate test_tenant_isolation.py to db_infra fixture","description":"Convert from app_with_test_db to async tests using db_infra fixture.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-10T10:54:48.509056+01:00","created_by":"juanre","updated_at":"2026-01-10T11:15:56.591797+01:00","closed_at":"2026-01-10T11:15:56.591797+01:00","close_reason":"Migrated 7 tests to use db_infra fixture. Removed all app_with_test_db usage.","dependencies":[{"issue_id":"beadhub-a0l0","depends_on_id":"beadhub-7wpr","type":"parent-child","created_at":"2026-01-10T10:55:48.558145+01:00","created_by":"juanre"}]}
{"id":"beadhub-a3ty","title":"Frontend: Add chat history view (depends on backend persistence)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T14:21:39.044543+01:00","updated_at":"2025-12-13T14:51:15.43232+01:00","closed_at":"2025-12-13T14:51:15.43232+01:00","dependencies":[{"issue_id":"beadhub-a3ty","depends_on_id":"beadhub-n80a","type":"blocks","created_at":"2025-12-13T14:21:43.294401+01:00","created_by":"juanre"}]}
{"id":"beadhub-a4lk","title":"Add bdh :inbox command for checking mail inbox","description":"Restore bdh :inbox command from commit 74ef99e^. The command already existed and was deleted when mail was deprecated. Restore inbox.go and inbox_test.go.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-15T17:40:08.560834+01:00","updated_at":"2025-12-15T17:49:36.729316+01:00","closed_at":"2025-12-15T17:49:36.729316+01:00"}
{"id":"beadhub-a5bg","title":"Validate role length when preserving from Redis","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-15T15:32:03.203111+01:00","updated_at":"2025-12-15T15:33:10.023211+01:00","closed_at":"2025-12-15T15:33:10.023211+01:00"}
{"id":"beadhub-a5xy","title":"bdh git operations should validate repository paths","description":"SECURITY: Git operations in bdh/internal/commands/heartbeat.go:96 and init.go use exec.Command without path validation.\n\n```go\ncmd := exec.CommandContext(ctx, \"git\", args...)\n```\n\nWhile repoRoot currently comes from trusted sources, future changes could introduce risk. Defense in depth suggests validating:\n1. Path is absolute\n2. Path doesn't contain shell metacharacters  \n3. Path is within expected boundaries\n\nRecommendation:\n- Add filepath.Clean() and validation\n- Document that git functions assume trusted paths\n- Consider using go-git library for safer operations","notes":"Track under beadhub-oy60 epic","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T09:20:42.310708Z","created_by":"juanre","updated_at":"2026-01-06T10:12:21.979363Z","closed_at":"2026-01-06T10:12:21.979363Z","close_reason":"Added validateGitRepoPath() with tests. Commit 1648300.","dependencies":[{"issue_id":"beadhub-a5xy","depends_on_id":"beadhub-oy60","type":"parent-child","created_at":"2026-01-06T10:02:34.559146Z","created_by":"juanre"}]}
{"id":"beadhub-a6qb","title":"Race condition in lock acquisition retry logic","description":"Location: src/beadhub/routes/reservations.py lines 307-382. After detecting a lock conflict, the code re-reads lock state and retries if lock disappeared. Race window exists where another agent could acquire the lock between conflict detection and retry. Can cause incorrect lock grants, deadlocks, and data integrity loss. Fix: exponential backoff, limit retries, consider Redlock algorithm.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-08T18:24:11.297565+01:00","updated_at":"2025-12-12T17:33:49.038903+01:00","closed_at":"2025-12-12T17:33:49.038903+01:00"}
{"id":"beadhub-a6yf","title":"Require --:jump-in to close bead claimed by another agent","description":"When running bdh close on a bead where OTHER workspaces have active claims, require --:jump-in with a message. This notifies them that the bead is being closed. If you're the only claimant, close works normally. If others are also working on it (even if you have a claim too), --:jump-in is required.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T11:32:16.411363+01:00","updated_at":"2025-12-13T12:06:35.136135+01:00","closed_at":"2025-12-13T12:06:35.136135+01:00","dependencies":[{"issue_id":"beadhub-a6yf","depends_on_id":"beadhub-3r30","type":"parent-child","created_at":"2025-12-13T11:32:23.38151+01:00","created_by":"juanre"},{"issue_id":"beadhub-a6yf","depends_on_id":"beadhub-wj6x","type":"blocks","created_at":"2025-12-13T11:32:23.527876+01:00","created_by":"juanre"}]}
{"id":"beadhub-a7f2","title":"Add type filter to /v1/beads/issues/all endpoint","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-13T12:51:30.255872+01:00","updated_at":"2025-12-20T12:43:53.844648+01:00","closed_at":"2025-12-20T12:43:53.844648+01:00","close_reason":"Implemented type filter query parameter for /v1/beads/issues/all endpoint. Filter uses issue_type column, test added in test_beads_upload.py"}
{"id":"beadhub-a7tg","title":"Fix 'default' repo name in bdh sync","description":"All issues show 'default' as repo name. The bdh sync command is not passing the actual repo name to the BeadHub upload endpoint. Needs fix in bdh Go code.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-13T12:14:58.572039+01:00","updated_at":"2025-12-13T18:07:57.520595+01:00","closed_at":"2025-12-13T18:07:57.520595+01:00"}
{"id":"beadhub-aav","title":"Add project_key column to DB tables for multi-project isolation","status":"closed","priority":3,"issue_type":"feature","created_at":"2025-12-03T15:39:14.761522+01:00","updated_at":"2025-12-12T12:40:02.270171+01:00","closed_at":"2025-12-12T12:40:02.270171+01:00"}
{"id":"beadhub-ab1g","title":"Cloud mount security: bootstrap + principal gating","description":"## Context\nbeadhub-cloud mounts the BeadHub OSS core (which embeds aweb) under `/api`.\n\nCloud must be able to safely expose a subset of OSS/aweb endpoints while:\n- preserving OSS standalone usability (self-hosted beadhub-oss can still bootstrap itself), and\n- preventing Cloud customers from bypassing SaaS governance (tenancy/billing) via OSS bootstrap surfaces.\n\n## Goal\nEstablish a clean, secure Cloudâ†’OSS mounting pattern:\n- Cloud controls project provisioning and billing.\n- OSS core remains usable standalone.\n- Human principals (JWT/cookie) are not allowed to perform BeadHub bead/workspace operations via the mounted core.\n\n## Acceptance\n- In Cloud mode, `/api/v1/init` is not callable by end-users.\n- In Cloud mode, `Authorization: Bearer aw_sk_*` is accepted only if its `project_id` is a beadhub-cloud project.\n- In Cloud mode, human principals cannot call bead/workspace/repo/claim endpoints under `/api` (agent keys still can).\n- OSS core can still run standalone with bootstrap enabled by default.\n- Internal proxy-signing does not require reusing session/JWT secrets.\n","status":"closed","priority":0,"issue_type":"epic","owner":"juan@juanreyero.com","created_at":"2026-01-25T08:14:09.648891+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T08:38:10.677059+01:00","closed_at":"2026-01-25T08:38:10.677059+01:00","close_reason":"Implemented Cloud mount security policy and documented it"}
{"id":"beadhub-ab1g.1","title":"OSS core: make bootstrap (/v1/init) optional","description":"## Problem\nbeadhub-cloud mounts the OSS core under `/api`. The OSS core currently always serves `/v1/init`, which mints new `aw_sk_*` keys and can create aweb projects.\n\nIn Cloud, `/v1/init` must not be publicly callable, but OSS standalone must keep it.\n\n## Change\n- Add a `create_app(..., enable_bootstrap_routes: bool = True)` parameter in `src/beadhub/api.py`.\n- When `enable_bootstrap_routes` is false, do **not** register `src/beadhub/routes/init.py` (and therefore `/v1/init`).\n- Default remains `True` for standalone OSS.\n\n## Acceptance\n- `create_app()` still exposes `/v1/init` by default.\n- `create_app(enable_bootstrap_routes=False)` does not expose `/v1/init`.\n- No behavior changes to other routes.\n","status":"closed","priority":0,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-25T08:14:31.738827+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T08:17:09.992781+01:00","closed_at":"2026-01-25T08:17:09.992781+01:00","close_reason":"Added create_app(enable_bootstrap_routes) and test","dependencies":[{"issue_id":"beadhub-ab1g.1","depends_on_id":"beadhub-ab1g","type":"parent-child","created_at":"2026-01-25T08:14:31.739853+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-ab1g.2","title":"beadhub-cloud: fix OSS mount + block /api/v1/init","description":"## Problem\nCloud mounts OSS under `/api`. The current `../beadhub-cloud/backend/src/beadhub_cloud/main.py` has a broken indentation around `beadhub_app.add_middleware(...)`, and Cloud does not block `/api/v1/init`.\n\n## Change\n- Fix the indentation/structure in `../beadhub-cloud/backend/src/beadhub_cloud/main.py` so OSS middleware is applied correctly.\n- Ensure `/v1/init` is blocked in Cloud mode (either via denylist and/or disabling the route via `create_beadhub_app(enable_bootstrap_routes=False)`).\n\n## Acceptance\n- Importing/running `beadhub_cloud.main` does not raise syntax/indentation errors.\n- `/api/v1/init` returns 403 in Cloud mode.\n","status":"closed","priority":0,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-25T08:14:42.175151+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T08:37:26.124728+01:00","closed_at":"2026-01-25T08:37:26.124728+01:00","close_reason":"Fixed OSS mount, disabled bootstrap routes, and blocked /api/v1/init in Cloud","dependencies":[{"issue_id":"beadhub-ab1g.2","depends_on_id":"beadhub-ab1g","type":"parent-child","created_at":"2026-01-25T08:14:42.176193+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-ab1g.3","title":"beadhub-cloud: reject Bearer aw_sk_* for unknown Cloud projects","description":"## Problem\nCloud middleware currently accepts `Authorization: Bearer aw_sk_*` by validating it against the embedded OSS/aweb schema.\n\nIf a user can obtain an `aw_sk_*` for a project that Cloud does not recognize, they could potentially access OSS/aweb endpoints without Cloud governance (billing/tenancy).\n\n## Change\nIn `../beadhub-cloud/backend/src/beadhub_cloud/middleware/auth_bridge.py`, when authenticating `aw_sk_*`:\n- After verifying the token and extracting `project_id`, require that `project_id` exists in `beadhub_cloud.projects` and is active.\n- If not, do not inject `X-BH-Auth`/`X-Project-ID`/`X-Aweb-Actor-ID` and treat the request as unauthenticated.\n\n## Acceptance\n- `aw_sk_*` for a non-Cloud project is rejected (401 from OSS layer).\n- `aw_sk_*` for a Cloud project is accepted.\n","status":"closed","priority":0,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-25T08:14:52.615008+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T08:37:36.522148+01:00","closed_at":"2026-01-25T08:37:36.522148+01:00","close_reason":"Cloud bridge now requires aw_sk project_id to exist in beadhub-cloud","dependencies":[{"issue_id":"beadhub-ab1g.3","depends_on_id":"beadhub-ab1g","type":"parent-child","created_at":"2026-01-25T08:14:52.616031+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-ab1g.4","title":"beadhub-cloud: human principals cannot do BeadHub bead ops via /api","description":"## Decision\nHuman principals (JWT/cookie) may use aweb coordination endpoints, but must not perform BeadHub bead/workspace/repo/claim operations via the mounted OSS core.\n\n## Change\nIn `../beadhub-cloud/backend/src/beadhub_cloud/middleware/oss_auth.py`:\n- After validating `X-BH-Auth`, detect principal type (`X-User-ID` present =\u003e human principal).\n- Enforce an allowlist of safe endpoints for humans (aweb protocol routes only).\n- Default to deny for any non-allowlisted OSS endpoints when principal is human.\n\n## Acceptance\n- Human principal requests to `/api/v1/beads*`, `/api/v1/claims*`, `/api/v1/workspaces*`, etc are 403.\n- Human principal can still use `/api/v1/messages*`, `/api/v1/chat*`, `/api/v1/reservations*`, `/api/v1/auth*`.\n","status":"closed","priority":0,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-25T08:15:03.056455+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T08:37:46.916643+01:00","closed_at":"2026-01-25T08:37:46.916643+01:00","close_reason":"Human principals blocked from /v1/beads and /v1/claims via Cloud OSS auth middleware","dependencies":[{"issue_id":"beadhub-ab1g.4","depends_on_id":"beadhub-ab1g","type":"parent-child","created_at":"2026-01-25T08:15:03.057375+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-ab1g.5","title":"beadhub-cloud: use dedicated internal auth secret for X-BH-Auth","description":"## Problem\nCloud signs `X-BH-Auth` using `SESSION_SECRET_KEY` (also used for session/JWT infrastructure). Secret reuse increases blast radius.\n\n## Change\n- Add a distinct Cloud config setting (env var) for the OSS internal-auth signing secret, e.g. `BEADHUB_INTERNAL_AUTH_SECRET`.\n- Update Cloud middleware (`../beadhub-cloud/backend/src/beadhub_cloud/middleware/auth_bridge.py` and `../beadhub-cloud/backend/src/beadhub_cloud/middleware/oss_auth.py`) to sign/verify with the dedicated secret, falling back only if explicitly configured.\n\n## Acceptance\n- Cloudâ†’OSS HMAC signing uses `BEADHUB_INTERNAL_AUTH_SECRET` when present.\n- OSS already supports `BEADHUB_INTERNAL_AUTH_SECRET` (do not regress).\n","status":"closed","priority":0,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-25T08:15:13.470825+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T08:37:57.314646+01:00","closed_at":"2026-01-25T08:37:57.314646+01:00","close_reason":"Cloud uses dedicated BEADHUB_INTERNAL_AUTH_SECRET for X-BH-Auth when configured","dependencies":[{"issue_id":"beadhub-ab1g.5","depends_on_id":"beadhub-ab1g","type":"parent-child","created_at":"2026-01-25T08:15:13.471932+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-ab1g.6","title":"SOT: document Cloud bootstrap and principal gating","description":"## Change\nUpdate `../beadhub-sot/source-of-truth/security-patterns.md` and `../beadhub-sot/source-of-truth/aweb-beadhub-integration.md` to clearly specify:\n- Cloud must not expose OSS `/v1/init` directly.\n- Cloud may accept `aw_sk_*` only when tied to Cloud-owned projects.\n- Human principals are restricted to aweb coordination surfaces.\n- Recommended configuration for internal signing secret (`BEADHUB_INTERNAL_AUTH_SECRET`).\n\n## Acceptance\nDocs are standalone, and future `aweb-cloud` can reuse the same pattern.\n","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-25T08:15:23.912612+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T08:31:26.395783+01:00","closed_at":"2026-01-25T08:31:26.395783+01:00","close_reason":"Documented Cloud bootstrap policy, aw_sk governance, human bead-op restriction, and internal auth secret","dependencies":[{"issue_id":"beadhub-ab1g.6","depends_on_id":"beadhub-ab1g","type":"parent-child","created_at":"2026-01-25T08:15:23.913583+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-ab8o","title":"bdh init should auto-detect project from repo","description":"When a repo is already registered, bdh init should use that project automatically instead of asking for BEADHUB_PROJECT","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-13T10:27:51.868722+01:00","updated_at":"2025-12-13T10:32:14.96637+01:00","closed_at":"2025-12-13T10:32:14.96637+01:00"}
{"id":"beadhub-acd","title":"Implement AuthService for API key management","description":"Port AuthService from llmring: create_api_key (generates bh_pk_xxx, stores SHA256 hash), validate_api_key (lookup by hash, update last_used_at), revoke_api_key, list_api_keys_by_project. Key format: bh_pk_{secrets.token_urlsafe(32)}","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-03T08:09:15.090253+01:00","updated_at":"2025-12-03T08:41:45.105824+01:00","closed_at":"2025-12-03T08:41:45.105824+01:00","close_reason":"Already exists from llmring-api template","dependencies":[{"issue_id":"beadhub-acd","depends_on_id":"beadhub-3k4","type":"blocks","created_at":"2025-12-03T08:09:21.486504+01:00","created_by":"juanre"}]}
{"id":"beadhub-acij","title":"Link Active Claims stat to Claims page","description":"Make the Active Claims stat card on Status page clickable, linking to /claims.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T12:15:53.865516+01:00","updated_at":"2025-12-13T12:16:07.682899+01:00","closed_at":"2025-12-13T12:16:07.682899+01:00"}
{"id":"beadhub-aeiq","title":"Config - Update Descriptions","description":"Update repository configuration descriptions to reflect the current product focus.\n\nCurrent state:\n- `pyproject.toml` description emphasizes file locking; BeadHub is primarily a coordination layer (bdh + beads + messaging + escalations), with file reservations as a secondary/optional feature.\n\nChange:\n- Update `pyproject.toml` description to match current positioning.\n- Update `docs/api-reference.md` and/or `README.md` wording if they still over-emphasize file locking.\n\nNon-goals:\n- No functional changes.\n","acceptance_criteria":"- Packaging + docs descriptions align with current positioning","status":"open","priority":2,"issue_type":"chore","created_at":"2025-12-12T17:56:52.543454+01:00","updated_at":"2026-01-03T18:41:07.763731Z"}
{"id":"beadhub-aev5","title":"Update Python tests: all test files with agent_name references","description":"Update all Python test files for new data model.\n\nFiles to update (agent_name â†’ alias, from_agent_name â†’ from_alias):\n- tests/test_agents.py\n- tests/test_bdh.py\n- tests/test_bdh_command.py\n- tests/test_chat.py\n- tests/test_cli_init.py\n- tests/test_cross_repo_messaging.py\n- tests/test_escalation_events.py\n- tests/test_messages.py\n- tests/test_mcp.py\n- tests/test_project_filter.py\n- tests/test_reservation_race.py\n- tests/test_reservations.py\n- tests/test_revoke.py\n- tests/test_sse_streaming.py\n- tests/test_status.py\n- tests/test_subscriptions.py\n- tests/test_tenant_isolation.py\n- tests/test_workspace_config.py\n- tests/test_workspace_id.py\n\nChanges per file:\n- Test data using agent_name â†’ alias\n- Assertions checking agent_name â†’ alias\n- Request payloads with agent_name â†’ alias\n- Response validation for alias field\n\nThis is mechanical but extensive - every test touching workspace/agent data needs updates.\n\nDepends on: all Python route updates, events.py, presence.py","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T12:52:25.171533+01:00","updated_at":"2025-12-13T17:48:09.370678+01:00","closed_at":"2025-12-13T17:48:09.370678+01:00","dependencies":[{"issue_id":"beadhub-aev5","depends_on_id":"beadhub-3wc0","type":"blocks","created_at":"2025-12-12T12:52:35.442611+01:00","created_by":"juanre"},{"issue_id":"beadhub-aev5","depends_on_id":"beadhub-i8qj","type":"blocks","created_at":"2025-12-12T12:52:35.502188+01:00","created_by":"juanre"},{"issue_id":"beadhub-aev5","depends_on_id":"beadhub-47mi","type":"blocks","created_at":"2025-12-12T12:52:35.562367+01:00","created_by":"juanre"}]}
{"id":"beadhub-ag9z","title":"Populate focus_apex_repo_name and focus_apex_branch when claiming beads","description":"## Problem\nThe `focus_apex_repo_name` and `focus_apex_branch` columns in the workspaces table exist in the schema but are NEVER written. This means `bdh :who` can't show which repo agents are working in.\n\n## Root cause\n- Columns defined in `migrations/server/001_initial.sql` (lines 61-62)\n- Fields are read and returned in workspaces.py list endpoints\n- But NO code ever writes to these columns\n\n## Fix needed\nWhen bdh syncs a claim (workspace sets a bead to status=in_progress), populate:\n- `focus_apex_bead_id` - the bead being worked on\n- `focus_apex_repo_name` - from the bead's repo field\n- `focus_apex_branch` - from the bead's branch field\n\nThis happens in the claims sync logic, likely in `src/beadhub/routes/bdh.py` or claims handling code.\n\n## Impact\nAgents can't see which repo/branch others are working in via `bdh :who`.","status":"in_progress","priority":2,"issue_type":"bug","assignee":"alice-coordinator","owner":"juan@juanreyero.com","created_at":"2026-02-05T15:52:55.612734Z","created_by":"Juan Reyero","updated_at":"2026-02-05T15:54:00.786857Z"}
{"id":"beadhub-ahag","title":"UX: Workspace cards should show 'Last seen' timestamp","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-13T21:26:24.665525+01:00","updated_at":"2025-12-13T21:26:24.665525+01:00"}
{"id":"beadhub-aihy","title":"Final --claim test","status":"closed","priority":3,"issue_type":"task","assignee":"juanre","created_at":"2026-01-05T16:59:17.683527Z","created_by":"juanre","updated_at":"2026-01-05T16:59:46.574328Z","closed_at":"2026-01-05T16:59:46.574328Z","close_reason":"Test beads for --claim bug fix verification"}
{"id":"beadhub-aiv6","title":"Add persistent workspaces table for agent-\u003eworkspace mapping","description":"Currently agent_name -\u003e workspace_id mapping is only in Redis presence (expires after 5 min). Need persistent table so chat can find workspace_id by agent_name even when target is offline.\n\nDesign:\n- workspace_id is PRIMARY KEY (constant per worktree/checkout)\n- agent_name, human_name, project_id can change via bdh init\n- agent_name should be unique (no two workspaces can have same agent_name)\n- project_id relationship TBD (may or may not be required)","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-11T21:01:37.461298+01:00","updated_at":"2025-12-11T21:07:46.683001+01:00","closed_at":"2025-12-11T21:07:46.683001+01:00","dependencies":[{"issue_id":"beadhub-aiv6","depends_on_id":"beadhub-71w4","type":"blocks","created_at":"2025-12-11T21:02:13.282185+01:00","created_by":"juanre"}]}
{"id":"beadhub-ajnk","title":"Server: preserve workspaces.role on upsert when clients omit role","description":"Currently `upsert_workspace` writes `role = EXCLUDED.role` on every command. When clients omit role, this sets role to NULL and erases the previous value.\n\nWhy:\n- Even if presence role is preserved in Redis, offline workspaces rely on DB fields.\n- Reintroducing role in `.beadhub` will help, but we still need correct semantics for older clients and partial requests.\n\nImplementation outline:\n1) Update `src/beadhub/routes/bdh.py:upsert_workspace` so that on conflict:\n   - role is only updated if `EXCLUDED.role` is not NULL (or not empty, depending on clear semantics).\n   - Example: `role = COALESCE(EXCLUDED.role, {{tables.workspaces}}.role)`.\n2) Add/adjust tests to cover:\n   - existing role preserved when role omitted\n   - role updated when provided\n   - (optional) role cleared if we define an explicit clear value.\n\nFiles:\n- `src/beadhub/routes/bdh.py`\n- relevant tests under `tests/`.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T13:54:49.906672+01:00","updated_at":"2025-12-20T16:30:33.065434+01:00","closed_at":"2025-12-20T16:30:33.065434+01:00","close_reason":"Preserve workspaces.role on upsert when role omitted","dependencies":[{"issue_id":"beadhub-ajnk","depends_on_id":"beadhub-o9h7","type":"parent-child","created_at":"2025-12-20T13:54:49.907789+01:00","created_by":"juanre"}]}
{"id":"beadhub-akvk","title":"Update WorkspacesPage to use pagination","description":"Update frontend/src/pages/WorkspacesPage.tsx:\n\n- Use new pagination component\n- Fetch first page on mount\n- Load more pages on user request\n- Handle cursor state in component\n- Show loading state during fetches","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T10:31:09.052615+01:00","updated_at":"2025-12-22T13:12:44.822402+01:00","closed_at":"2025-12-22T13:12:44.822402+01:00","close_reason":"Implemented pagination for WorkspacesPage with load more support","dependencies":[{"issue_id":"beadhub-akvk","depends_on_id":"beadhub-v9wr","type":"blocks","created_at":"2025-12-22T10:32:22.305635+01:00","created_by":"juanre"},{"issue_id":"beadhub-akvk","depends_on_id":"beadhub-frnp","type":"blocks","created_at":"2025-12-22T10:38:07.481498+01:00","created_by":"juanre"},{"issue_id":"beadhub-akvk","depends_on_id":"beadhub-c6zq","type":"blocks","created_at":"2025-12-22T10:38:07.643145+01:00","created_by":"juanre"}]}
{"id":"beadhub-ar0","title":"Phase 1 OSS Release Completion","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-02T22:19:34.454436+01:00","updated_at":"2025-12-02T22:25:27.845965+01:00","closed_at":"2025-12-02T22:25:27.845965+01:00","close_reason":"Phase 1 OSS release complete: Dockerfile, Docker Compose, LICENSE, README, panic button, locks CLI","dependencies":[{"issue_id":"beadhub-ar0","depends_on_id":"beadhub-95x","type":"blocks","created_at":"2025-12-02T22:20:11.088708+01:00","created_by":"juanre"},{"issue_id":"beadhub-ar0","depends_on_id":"beadhub-3p5","type":"blocks","created_at":"2025-12-02T22:20:11.141882+01:00","created_by":"juanre"},{"issue_id":"beadhub-ar0","depends_on_id":"beadhub-0pc","type":"blocks","created_at":"2025-12-02T22:20:11.194749+01:00","created_by":"juanre"},{"issue_id":"beadhub-ar0","depends_on_id":"beadhub-2nq","type":"blocks","created_at":"2025-12-02T22:20:11.247532+01:00","created_by":"juanre"},{"issue_id":"beadhub-ar0","depends_on_id":"beadhub-1og","type":"blocks","created_at":"2025-12-02T22:20:11.300711+01:00","created_by":"juanre"}]}
{"id":"beadhub-asx","title":"Define .beadhub file format and bdh init command","description":"Create the .beadhub configuration file specification and implement bdh init to generate workspace_id and create the file. Should add .beadhub to .gitignore automatically.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T19:09:52.286568+01:00","updated_at":"2025-12-07T20:27:15.655439+01:00","closed_at":"2025-12-07T20:27:15.655439+01:00","dependencies":[{"issue_id":"beadhub-asx","depends_on_id":"beadhub-6am","type":"blocks","created_at":"2025-12-07T19:09:52.287371+01:00","created_by":"juanre"}]}
{"id":"beadhub-ate4","title":"bdh: stop fetching full /v1/workspaces on ready/:who/:send (use limited/filter endpoints)","description":"Context\n- bdh currently calls `GET /v1/workspaces` and filters locally in multiple commands (ready context, :who, and alias resolution in :send). With the new `be` branch changes, `/v1/workspaces` is tenant-aware (X-Project-ID) and `/v1/status/stream` filters were unified, but bdh still needs a bounded team view.\n\nGoal\n- Update bdh CLI commands to use the new Workspaces API vNext from beadhub-qrnr so common operations are bounded, fast, and return only meaningful slices (not thousands of workspaces).\n\nWork\n1) Add client support for new server endpoints/params\n   - Add `limit`, `include_claims`, `include_presence`, `only_with_claims` (as applicable) to the Workspaces request type.\n   - Add a dedicated method for `/v1/workspaces/team` (preferred) or equivalent params on `/v1/workspaces`.\n\n2) Command behavior\n- `bdh ready`:\n  - Fetch caller workspace claims (either via server response including caller or via `always_include_workspace_id`).\n  - Fetch at most 15 *other* workspaces for TEAM STATUS, prioritized by has-claims + recent activity.\n  - Do not download all workspaces.\n- `bdh :who`:\n  - Default to a bounded list (e.g. 50).\n  - Provide explicit `--all` only if we actually want it; otherwise keep bounded by design.\n- `bdh :send \u003calias\u003e`:\n  - Do not fetch all workspaces. Add server-side alias resolution (`/v1/workspaces/team` with `limit` + alias filter, or a dedicated resolve endpoint if needed).\n\nValidation\n- Go tests verify the correct query params are sent and that outputs are stable/deterministic.\n- An integration-style test should assert that with many workspaces, bdh still requests only bounded counts.\n\nDone when\n- bdh no longer performs unbounded workspace list calls in common commands; it uses the bounded team-status API.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T08:51:08.541511+01:00","updated_at":"2025-12-21T16:30:56.090621+01:00","closed_at":"2025-12-21T16:30:56.090621+01:00","close_reason":"Add bounded query param tests for ready/:who/:send","dependencies":[{"issue_id":"beadhub-ate4","depends_on_id":"beadhub-o9h7","type":"discovered-from","created_at":"2025-12-21T08:51:08.542562+01:00","created_by":"juanre"}]}
{"id":"beadhub-auac","title":"bdh UX: bounded team status defaults (ready/:who) and optional deep-dive modes","description":"Context\n- Even with a scalable server API, we need bdh output semantics that are meaningful for humans/agents. Returning â€œall agents/claimsâ€ is counterproductive at scale.\n\nGoal\n- Define bdh default behaviors that remain useful with thousands of workspaces while still enabling deeper inspection when needed.\n\nDesign\n- `bdh ready`:\n  - Show MY CLAIMS (all my active claims).\n  - Show TEAM STATUS: up to 10â€“15 other workspaces prioritized by: has_claims, recent activity, and (optionally) explicit role matching.\n  - If there are more than N active claimants, show a one-line summary: â€œ+X more workspaces with claims (use ... to expand)â€.\n\n- `bdh :who`:\n  - Default to bounded output (e.g. 50).\n  - Provide explicit opt-in flags if we truly want more: `--limit`, maybe `--all` only for debugging.\n  - Provide `--only-with-claims` option for the common coordination case.\n\n- `bdh :send`:\n  - Alias resolution should query the server in a targeted way; if multiple matches exist, present a short disambiguation list (bounded) rather than dumping all workspaces.\n\nValidation\n- Golden-output style tests for formatting (stable ordering) and correctness.\n- Ensure the CLI never makes unbounded calls in default paths.\n\nDone when\n- bdh UX remains readable and fast at large N, with explicit escape hatches for debugging.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T13:34:47.750164+01:00","updated_at":"2025-12-21T17:00:22.702833+01:00","closed_at":"2025-12-21T17:00:22.702833+01:00","close_reason":"Add bounded defaults and flags for who/ready/send","dependencies":[{"issue_id":"beadhub-auac","depends_on_id":"beadhub-ate4","type":"discovered-from","created_at":"2025-12-21T13:34:47.751213+01:00","created_by":"juanre"}]}
{"id":"beadhub-av7","title":"Fix MCP route to use Depends() pattern for db_infra and redis","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-03T09:46:10.739914+01:00","updated_at":"2025-12-03T12:02:17.867547+01:00","closed_at":"2025-12-03T12:02:17.867547+01:00"}
{"id":"beadhub-ayay","title":"Redesign chat wait logic with explicit --start-conversation and --leave-conversation flags","description":"Current problem: When starting a chat, target isn't connected to SSE yet (session just created), so bdh exits immediately without waiting. But when conversation ends, if you reconnect you wait for nothing because they left.\n\nSolution: Add explicit flags to control wait behavior:\n- --start-conversation: I'm initiating a new exchange, wait long (5 min) even if they've previously left\n- --leave-conversation: I'm done, don't wait (replaces --no-wait semantically)\n- Default: Check if all targets have left (sender_leaving), if so don't wait, otherwise wait 60s\n\nImplementation:\n1. Server: Add targets_left to CreateSessionResponse (aliases whose last msg had sender_leaving)\n2. Client: New flags --start-conversation, --leave-conversation\n3. Client: Logic - leave=no wait, start=long wait ignore left, default=check left status\n4. Update targets_connected to be informational only\n\nSee beadhub-chat-spec.md for current spec.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-16T21:19:36.352252+01:00","updated_at":"2025-12-16T21:22:26.743321+01:00","closed_at":"2025-12-16T21:22:26.743321+01:00"}
{"id":"beadhub-b29k","title":"Add context to Send Message tooltip (workspace status, etc)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T20:35:32.527979+01:00","updated_at":"2026-01-03T18:38:46.832257Z","closed_at":"2026-01-03T18:38:46.832257Z","close_reason":"Defer/low value: message button context tooltip is a nice-to-have; not prioritizing."}
{"id":"beadhub-b37m","title":"Chat SSE streaming endpoint for real-time delivery","description":"Implement SSE streaming for real-time message delivery:\n\n- GET /v1/chat/sessions/{id}/stream - SSE endpoint for receiving messages\n\nSSE event types:\n- joined: {agent, timestamp} - when target joins\n- message: {from, body, timestamp} - new message\n- ended: {by, reason, timestamp} - session ended\n- timeout: {reason, fallback} - timeout occurred\n\nUse Redis pub/sub for broadcasting to SSE connections.\n\nSee spec: beadhub-sot/source-of-truth/beadhub-chat-spec.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T20:33:22.545891+01:00","updated_at":"2025-12-10T22:54:58.710008+01:00","closed_at":"2025-12-10T22:54:58.710008+01:00","dependencies":[{"issue_id":"beadhub-b37m","depends_on_id":"beadhub-w143","type":"blocks","created_at":"2025-12-10T20:37:28.711191+01:00","created_by":"juanre"}]}
{"id":"beadhub-b4k4","title":"Add input validation/length limits to sendMessage","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-13T20:34:54.472012+01:00","updated_at":"2025-12-13T20:40:18.287576+01:00","closed_at":"2025-12-13T20:40:18.287576+01:00"}
{"id":"beadhub-b5j","title":"Update pyproject.toml metadata","description":"Fix placeholder values: 1) description field still says placeholder, 2) Add proper project URLs, 3) Verify dependencies are correct","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-03T20:52:53.870671+01:00","updated_at":"2025-12-06T21:43:00.186202+01:00","closed_at":"2025-12-06T21:43:00.186202+01:00"}
{"id":"beadhub-b6yy","title":"Analyze and remove redundant beads_issues indexes","description":"Code review of beadhub-pph8 identified potential index redundancy after adding composite index idx_beads_issues_project_status(project_id, status).\n\n**Potentially redundant indexes:**\n- idx_beads_issues_project_id - composite can serve prefix queries on project_id alone\n- idx_beads_issues_status - tenant isolation requires project_id in ALL queries\n\n**Query patterns to analyze:**\n1. Ready query (beads.py:637-639): WHERE project_id = $1 AND status = 'open' â†’ uses new composite\n2. Single-issue lookup: WHERE project_id = $1 AND bead_id = $2 â†’ uses idx_beads_issues_project_bead  \n3. Any status-only queries? If none exist (due to tenant isolation), idx_beads_issues_status is unused\n\n**EXPLAIN guidance:**\n- Run EXPLAIN ANALYZE on production with both index sets\n- Compare Seq Scan vs Index Scan usage\n- Check pg_stat_user_indexes for idx_scan counts on each index\n- If idx_beads_issues_project_id and idx_beads_issues_status show zero scans, safe to drop\n\n**Recommendation:** Defer dropping until production signals confirm redundancy.","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-03T18:39:31.652627Z","created_by":"juanre","updated_at":"2026-01-03T18:47:49.872861Z","dependencies":[{"issue_id":"beadhub-b6yy","depends_on_id":"beadhub-pph8","type":"discovered-from","created_at":"2026-01-03T18:47:36.657206Z","created_by":"juanre"}]}
{"id":"beadhub-b9d","title":"Add logging for lock conflicts and disappearing locks in reservations","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-03T16:45:16.62724+01:00","updated_at":"2025-12-03T16:47:26.381177+01:00","closed_at":"2025-12-03T16:47:26.381177+01:00"}
{"id":"beadhub-b9jp","title":"Update ClaimsPage to use pagination","description":"Update frontend/src/pages/ClaimsPage.tsx:\n\n- Use new pagination component\n- Fetch first page on mount\n- Load more pages on user request\n- Handle cursor state in component\n- Show loading state during fetches","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T10:30:57.341189+01:00","updated_at":"2025-12-22T12:51:23.815822+01:00","closed_at":"2025-12-22T12:51:23.815822+01:00","close_reason":"Implemented pagination for ClaimsPage with OSS/Cloud mode security","dependencies":[{"issue_id":"beadhub-b9jp","depends_on_id":"beadhub-v9wr","type":"blocks","created_at":"2025-12-22T10:32:21.824126+01:00","created_by":"juanre"},{"issue_id":"beadhub-b9jp","depends_on_id":"beadhub-bp01","type":"blocks","created_at":"2025-12-22T10:38:06.491467+01:00","created_by":"juanre"},{"issue_id":"beadhub-b9jp","depends_on_id":"beadhub-c6zq","type":"blocks","created_at":"2025-12-22T10:38:06.654866+01:00","created_by":"juanre"}]}
{"id":"beadhub-baqf","title":"Migrate test_workspace_id.py to db_infra fixture","description":"Convert from app_with_test_db to async tests using db_infra fixture.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-10T10:54:49.755855+01:00","created_by":"juanre","updated_at":"2026-01-10T11:16:41.097636+01:00","closed_at":"2026-01-10T11:16:41.097636+01:00","close_reason":"Migrated 3 tests to use db_infra fixture. Removed all app_with_test_db usage.","dependencies":[{"issue_id":"beadhub-baqf","depends_on_id":"beadhub-7wpr","type":"parent-child","created_at":"2026-01-10T10:55:48.87568+01:00","created_by":"juanre"}]}
{"id":"beadhub-bbvw","title":"Receiver: Detect termination signal and exit wait loop","description":"In bdh/internal/commands/chat.go SSE message handling:\n\nWhen receiving a message:\n- Check if body ends with \\n.[bdh-signing-off]\n- If yes:\n  1. Strip the signal from body for display\n  2. Print the message content\n  3. Print '[alias] has left the exchange'\n- If no:\n  Print message normally\n\nNote: bdh always exits after receiving one reply - this is about informing the agent that the sender left.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-14T11:08:39.980426+01:00","updated_at":"2025-12-14T11:39:05.540108+01:00","closed_at":"2025-12-14T11:39:05.540108+01:00"}
{"id":"beadhub-bc1y","title":"Fix test_project_filter.py tests","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-10T10:00:24.699175+01:00","updated_at":"2026-01-03T18:38:41.243511Z","closed_at":"2026-01-03T18:38:41.243511Z","close_reason":"Obsolete: test_project_filter.py is not present in this repo; no failing tests to fix.","dependencies":[{"issue_id":"beadhub-bc1y","depends_on_id":"beadhub-6gfo","type":"discovered-from","created_at":"2025-12-10T10:00:24.700032+01:00","created_by":"juanre"}]}
{"id":"beadhub-bcdk","title":"Design: choose scalable apex computation strategy (client vs server vs persisted)","description":"We need apex context per claim/workspace, but the current implementation computes apex via a recursive CTE in `/v1/workspaces` on every request. This is likely the main scaling bottleneck.\n\nThis task is to decide and document the contract we will implement:\n\nOption A (server-persisted apex, recommended for correctness):\n- Add `apex_bead_id` (and possibly apex repo/branch ref) to `server.bead_claims`.\n- Compute apex on claim creation/update (write path), store it.\n- `/v1/workspaces` becomes a simple join over claims + lateral title lookups.\n\nOption B (client-computed apex hints, fast + offline-friendly):\n- bdh computes apex for its own claim(s) from local `.beads/issues.jsonl`.\n- bdh sends `apex_bead_id` (+ title/type) as part of /command or /presence.\n- Server treats it as advisory and stores it; avoids DB recursion entirely.\n- Needs validation/guardrails to avoid garbage data.\n\nOption C (hybrid):\n- Prefer client hints when provided; server backfills/validates when not.\n\nDeliverables:\n1) A short design note in the bead itself: chosen option + rationale.\n2) A list of schema/API changes required.\n3) A list of tests needed to prove correctness.\n4) Performance expectations (whatâ€™s O(1)/O(N) and where).\n\nReferences:\n- `beadhub-sot/source-of-truth/data-model.md` (apex defined server-side today)\n- `beadhub-coord/src/beadhub/routes/workspaces.py` recursive CTE\n- `beadhub-coord/bdh/internal/commands/passthrough.go` historical client apex logic.","notes":"Decision: choose Option A (serverâ€‘persisted apex), no client-provided apex in the contract.\n\nRationale:\n- Correctness: only the server has a consistent view across workspaces/repos; client hints risk drift or partial data.\n- Scale: move apex computation to the *write path* (claim creation/update) rather than every `/v1/workspaces` call. This keeps list queries O(#claims) with a small constant and avoids recursive CTEs on hot reads.\n- Simplicity: a single authoritative source of apex for each claim; no extra validation pipelines or stale client state to manage.\n- Aligns with data-model.md: apex is defined server-side as the root of parent chain.\n\nChosen representation:\n- Add explicit columns on `server.bead_claims`:\n  - `apex_bead_id TEXT NULL`\n  - `apex_repo_name TEXT NULL`\n  - `apex_branch TEXT NULL`\n  (Optional later: `apex_issue_type TEXT` if we choose to denormalize; default is to join to `beads.beads_issues` for title/type.)\n- This avoids ambiguity because bead IDs are not globally unique across repo/branch.\n\nWrite-path behavior:\n- On claim creation (and jump-in claims), compute apex using `beads.beads_issues` parent chain (bounded depth, e.g. 20). Store apex ref on the claim row.\n- If the claimed bead is not in `beads_issues` yet, set apex fields NULL and backfill when `/v1/bdh/sync` brings the bead in (update claims where `bead_id` matches and apex is NULL).\n\nRead-path behavior:\n- `/v1/workspaces` loads claims and joins to `beads_issues` via the stored apex ref (project_id + repo + branch + bead_id) to fetch `apex_title`/`apex_type`. No recursive CTE.\n\nAPI changes:\n- `GET /v1/workspaces` still returns `apex_id/apex_title/apex_type`; computation source changes to stored apex ref.\n- No client changes required for apex (bdh may optionally compute local apex for UX, tracked in beadhub-y9j9, but does not affect server contract).\n\nTests to add:\n- Migration tests for new bead_claims columns.\n- Claim creation tests: standalone bead â†’ apex=itself; parent chain â†’ apex=root; malformed/missing parent_id â†’ apex=current; bead missing in beads_issues â†’ apex NULL.\n- Sync backfill test: claim created before beads_issues exists, then sync populates apex fields.\n- /v1/workspaces response test verifies apex fields populated without recursive query.\n\nPerformance expectations:\n- Claim creation O(depth\u003c=20) per claim (acceptable).\n- `/v1/workspaces` query is O(#claims + #workspaces), constant number of queries, no recursion.\n","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T13:55:04.603661+01:00","updated_at":"2025-12-20T13:59:36.899796+01:00","closed_at":"2025-12-20T13:59:36.899796+01:00","close_reason":"Recorded decision and plan (server-persisted apex) with schema/API/test/perf notes.","dependencies":[{"issue_id":"beadhub-bcdk","depends_on_id":"beadhub-o9h7","type":"parent-child","created_at":"2025-12-20T13:55:04.604962+01:00","created_by":"juanre"}]}
{"id":"beadhub-bef3","title":"Add workspace restoration endpoint and UI","description":"No way to undo accidental workspace deletion. Add: (1) POST /v1/workspaces/{id}/restore endpoint to clear deleted_at, (2) 'Restore' button in dashboard when viewing deleted workspaces (include_deleted=true), (3) Consider toast with 'Undo' button after deletion.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-17T08:01:37.555826+01:00","updated_at":"2026-01-04T17:30:37.148574Z","closed_at":"2026-01-04T17:30:37.148574Z","close_reason":"Added restore endpoint POST /v1/workspaces/{id}/restore, API client method, and Deleted tab with Restore button in WorkspacesPage","dependencies":[{"issue_id":"beadhub-bef3","depends_on_id":"beadhub-lmtj","type":"discovered-from","created_at":"2025-12-17T08:01:37.557028+01:00","created_by":"juanre"}]}
{"id":"beadhub-bfza","title":"bdh ready: Add inbox count, team status, and related work suggestions","description":"Update bdh ready output to show:\n\n1. INBOX section: count of unread messages + preview of recent ones\n2. TEAM STATUS section: who's working on what (alias + bead ID + bead title)\n3. READY WORK section: available beads with related work hints\n   - If a ready bead is related to work another agent is doing, suggest emailing them\n\nExample output:\n```\nINBOX: 2 unread messages\n  From claude-be (3h ago): \"Finished auth middleware...\"\n  â†’ Run: bdh :inbox\n\nTEAM STATUS:\n  claude-be â€” working on bd-42 \"Implement JWT validation\"\n  claude-test â€” working on bd-45 \"Add integration tests\"\n\nREADY WORK:\n  bd-47  [p1] Add rate limiting to API endpoints\n         â†’ Related: claude-be is working on auth (bd-42)\n         â†’ Consider: bdh :send claude-be \"Planning to add rate limiting...\"\n```\n\nRequires:\n- Server endpoint to return team status with bead titles\n- Client changes to fetch and display this info","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-15T18:23:21.820026+01:00","updated_at":"2025-12-15T18:39:49.48064+01:00","closed_at":"2025-12-15T18:39:49.48064+01:00","dependencies":[{"issue_id":"beadhub-bfza","depends_on_id":"beadhub-fei6","type":"blocks","created_at":"2025-12-15T18:23:28.798907+01:00","created_by":"juanre"}]}
{"id":"beadhub-bg9d","title":"Multi-claim test A","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-05T17:42:00.956946Z","created_by":"juanre","updated_at":"2026-01-05T17:58:45.081526Z","closed_at":"2026-01-05T17:58:45.081526Z","close_reason":"Bug fixed and verified - multi-bead claim/close now works"}
{"id":"beadhub-bga","title":"Document API endpoints and MCP tools","description":"Add API reference: 1) All REST endpoints with request/response examples, 2) MCP tool reference table (already in AGENTS.md.template, verify complete), 3) CLI command reference, 4) Authentication: explain API key requirement and dev mode behavior","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-03T20:52:46.937376+01:00","updated_at":"2025-12-06T21:41:34.740911+01:00","closed_at":"2025-12-06T21:41:34.740911+01:00"}
{"id":"beadhub-bix","title":"Add workspace_id param to reservation endpoints","description":"Update /v1/reservations, /v1/reservations/release, /v1/reservations/renew, GET /v1/reservations to use workspace_id instead of project_key.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T19:10:00.159773+01:00","updated_at":"2025-12-07T20:55:41.212537+01:00","closed_at":"2025-12-07T20:55:41.212537+01:00","dependencies":[{"issue_id":"beadhub-bix","depends_on_id":"beadhub-6am","type":"blocks","created_at":"2025-12-07T19:10:00.16053+01:00","created_by":"juanre"}]}
{"id":"beadhub-bj5h","title":"UX: Surface file reservations before agents start work","description":"Problem: Agents don't know files are reserved until AFTER they've started modifying them. Auto-reserve shows conflicts reactively, not proactively.\n\nCurrent state:\n- Auto-reserve locks files when you run bdh with modified files\n- Conflicts only shown after you've already modified a file someone else has locked\n- bdh :locks exists but agents don't naturally check it\n\nOptions to explore:\n1. Show locks in 'bdh ready' - alongside team status, show what files each agent has locked\n2. Show locks in ':who' - already shows claims, could show locks too  \n3. Warn on 'bdh update --status in_progress' - check if bead typically touches files that are locked\n4. Add locks to team status display - 'claude-be â€” working on bd-42 â€” locks: src/api.py'\n\nGoal: Agents should see file reservations at natural coordination checkpoints (ready, :who, claiming work) so they can coordinate BEFORE creating conflicts.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T22:39:29.40099+01:00","updated_at":"2025-12-22T00:21:49.569614+01:00","closed_at":"2025-12-22T00:21:49.569614+01:00","close_reason":"Merged to main"}
{"id":"beadhub-bjj","title":"Fix critical security issues from code review","description":"1. Hardcoded DB creds in docker-compose 2. Redis SCAN glob injection 3. Add API key auth for admin endpoints","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-03T06:38:49.545752+01:00","updated_at":"2025-12-03T06:45:57.943173+01:00","closed_at":"2025-12-03T06:45:57.943173+01:00","close_reason":"Fixed critical security issues: added auth to /v1/beads/sync, project_key validation to prevent glob injection, port validation in config. Added 7 tests for auth and revoke functionality."}
{"id":"beadhub-bjpm","title":"Add Chat page to frontend dashboard","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-13T13:54:08.6173+01:00","updated_at":"2025-12-13T14:10:47.533669+01:00","closed_at":"2025-12-13T14:10:47.533669+01:00"}
{"id":"beadhub-bkkz","title":"Add server.projects table migration","description":"Add migration for server.projects table:\n\n```sql\nCREATE TABLE projects (\n    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),\n    slug TEXT UNIQUE NOT NULL,\n    name TEXT,\n    created_at TIMESTAMPTZ DEFAULT NOW()\n);\n```\n\nThis table maps human-readable slugs to UUIDs. Required for:\n- bdh init to get project_id from slug\n- All tables to use project_id (UUID) as partition key\n\nSee beadhub-architecture.md for schema details.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T12:27:41.501868+01:00","updated_at":"2025-12-10T12:55:29.841999+01:00","closed_at":"2025-12-10T12:55:29.841999+01:00","dependencies":[{"issue_id":"beadhub-bkkz","depends_on_id":"beadhub-4trs","type":"parent-child","created_at":"2025-12-10T12:27:41.502749+01:00","created_by":"juanre"},{"issue_id":"beadhub-bkkz","depends_on_id":"beadhub-x5r8","type":"blocks","created_at":"2025-12-10T12:49:05.344001+01:00","created_by":"juanre"}]}
{"id":"beadhub-bkp8","title":"Persist chat sessions/messages to Postgres on create/send","description":"Write to Postgres alongside Redis","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T14:22:18.867306+01:00","updated_at":"2025-12-13T14:45:14.679812+01:00","closed_at":"2025-12-13T14:45:14.679812+01:00","dependencies":[{"issue_id":"beadhub-bkp8","depends_on_id":"beadhub-n80a","type":"blocks","created_at":"2025-12-13T14:22:18.868207+01:00","created_by":"juanre"}]}
{"id":"beadhub-bks7","title":"Migrate test_messages.py to db_infra fixture","description":"Convert from app_with_test_db to async tests using db_infra fixture.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-10T10:54:59.589743+01:00","created_by":"juanre","updated_at":"2026-01-10T12:03:51.706652+01:00","closed_at":"2026-01-10T12:03:51.706652+01:00","close_reason":"Migrated test_messages.py to async pattern using db_infra and redis_client_async fixtures. All 20 tests pass. Code review confirmed correct implementation.","dependencies":[{"issue_id":"beadhub-bks7","depends_on_id":"beadhub-7wpr","type":"parent-child","created_at":"2026-01-10T10:55:49.421862+01:00","created_by":"juanre"}]}
{"id":"beadhub-bni3","title":"API: include parent_id in beads/issues response","description":"## Problem\n\nThe beads API endpoints return `blocked_by` but NOT `parent_id`, even though the database stores it correctly.\n\n### Evidence\n\n**Database has correct data:**\n```sql\nSELECT bead_id, parent_id FROM beads.beads_issues WHERE bead_id = 'beadhub-3sl6.1';\n-- parent_id = {\"repo\": \"beadhub\", \"branch\": \"main\", \"bead_id\": \"beadhub-3sl6\"}\n```\n\n**API response is missing parent_id:**\n```bash\ncurl \"http://localhost:8000/v1/beads/issues/all\" | jq '.issues[] | select(.bead_id == \"beadhub-3sl6.1\")'\n# returns blocked_by but NO parent_id field\n```\n\n### Root Cause\n\nAll three beads API endpoints in `src/beadhub/routes/beads.py` have the same bug:\n\n1. **GET /v1/beads/issues** (lines 309-445)\n2. **GET /v1/beads/issues/all** (lines 448-613)\n3. **GET /v1/beads/issues/{bead_id}** (lines 616-718)\n\nThe SQL queries SELECT `blocked_by` but NOT `parent_id`:\n```python\nbase_query = \"\"\"\n    SELECT bead_id, repo_name, branch, title, status, priority,\n           issue_type, assignee, created_by, labels, blocked_by\n    FROM {{tables.beads_issues}}\n\"\"\"\n# Missing: parent_id\n```\n\nAnd the response builders don't include it:\n```python\nissues.append({\n    \"bead_id\": bead_id,\n    \"blocked_by\": blocked_by,\n    # Missing: \"parent_id\": row[\"parent_id\"],\n})\n```\n\n### Impact\n\n- Dashboard cannot display parent-child hierarchy correctly\n- Clients cannot distinguish parent-child from blocking dependencies\n- The bdh CLI shows \"Depends on\" for both parent and blocker relationships\n\n### Fix\n\nFor each of the three endpoints:\n1. Add `parent_id` to the SELECT clause\n2. Add `parent_id` to the response dict\n3. Consider also returning the parsed parent info (bead_id, repo, branch)\n\n### Acceptance Criteria\n\n- [ ] All three /v1/beads/issues* endpoints include parent_id in response\n- [ ] Dashboard can access parent_id to build hierarchy view\n- [ ] Tests verify parent_id is returned correctly","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-08T20:30:51.656665+01:00","created_by":"juanre","updated_at":"2026-01-08T20:51:51.742661+01:00","closed_at":"2026-01-08T20:51:51.742661+01:00","close_reason":"Implemented: API now includes parent_id in all three beads/issues endpoints","labels":["area:bug","component:api","component:beads"]}
{"id":"beadhub-bnyk","title":"Chat: --hang-on command to request more time before replying","description":"## Summary\n\nAdd a `--hang-on` command that lets Bob acknowledge Alice's message and request more time to formulate a proper reply. Unlike `--reply`, Alice does NOT exit â€” she continues waiting with an extended timeout.\n\n## Use Case\n\nAlice asks a complex question. Bob needs time to investigate before answering:\n\n```bash\nalice$ bdh :chat --reply bob \"How should we handle the auth migration?\" --start-conversation\n# [chat] Sent to bob\n# [chat] Waiting for reply... (5 min)\n\nbob$ bdh :chat --open alice\n# [14:32] alice: How should we handle the auth migration?\n\nbob$ bdh :chat --hang-on alice \"Good question, let me check the current state. Give me a few minutes.\"\n# [chat] Sent acknowledgment to alice (extended wait by 5 min)\n\n# Alice sees:\n# [chat] bob: Good question, let me check the current state. Give me a few minutes.\n# [chat] bob requested more time â€” wait extended to 9m 30s remaining\n\n# Later...\nbob$ bdh :chat --reply alice \"OK, I looked at it. We should...\"\n# Alice receives reply and exits\n```\n\n## Design\n\n### New flag: `--hang-on`\n\n```bash\nbdh :chat --hang-on \u003calias\u003e \"message\"\n```\n\n- Sends message to session\n- Message includes `hang_on: true` flag\n- Server publishes event with `extends_wait: true`\n- Alice's CLI shows message but does NOT exit\n- Alice's timeout extended by 5 minutes (configurable?)\n\n### Event structure\n\n```json\n{\n  \"type\": \"message\",\n  \"message_id\": \"msg_xyz\",\n  \"from_alias\": \"bob\",\n  \"body\": \"Good question, let me check...\",\n  \"hang_on\": true,\n  \"extends_wait_seconds\": 300\n}\n```\n\n### Alice's CLI behavior\n\nWhen receiving a message with `hang_on: true`:\n1. Display the message normally\n2. Show: `[chat] bob requested more time â€” wait extended to Xm Ys remaining`\n3. Extend deadline by `extends_wait_seconds`\n4. Continue waiting (do NOT exit)\n\nWhen receiving a message with `hang_on: false` (normal reply):\n1. Display the message\n2. Exit (current behavior)\n\n### Server changes\n\n**`POST /v1/chat/sessions/{id}/messages`:**\n- Add optional `hang_on: bool` field to request body\n- If true, set `extends_wait_seconds` in the published event\n\n**`routes/chat.py`:**\n```python\nclass SendChatMessageRequest(BaseModel):\n    workspace_id: str\n    alias: str\n    body: str\n    hang_on: bool = False  # NEW\n\nasync def send_message(...):\n    # ... existing logic ...\n    event = ChatMessageEvent(\n        message_id=message_id,\n        from_alias=alias,\n        body=body,\n        hang_on=request.hang_on,\n        extends_wait_seconds=300 if request.hang_on else 0,\n    )\n    await publish_chat_event(redis, session_id, event)\n```\n\n### CLI changes\n\n**`chat.go`:**\n```go\n// New flag\nvar hangOnFlag bool\n\nfunc init() {\n    chatCmd.Flags().BoolVar(\u0026hangOnFlag, \"hang-on\", false, \n        \"Acknowledge and request more time (recipient continues waiting)\")\n}\n\nfunc runChatReply() {\n    // ... existing logic ...\n    req := \u0026client.SendChatMessageRequest{\n        WorkspaceID: cfg.WorkspaceID,\n        Alias:       cfg.Alias,\n        Body:        message,\n        HangOn:      hangOnFlag,  // NEW\n    }\n}\n\nfunc runChatWait() {\n    // In SSE handler:\n    case \"message\":\n        var msg ChatMessageEvent\n        json.Unmarshal(data, \u0026msg)\n        displayMessage(msg)\n        \n        if msg.HangOn {\n            // Extend deadline\n            deadline = time.Now().Add(time.Duration(msg.ExtendsWaitSeconds) * time.Second)\n            fmt.Printf(\"[chat] %s requested more time â€” wait extended\\n\", msg.FromAlias)\n            // Continue waiting (don't return)\n        } else {\n            // Normal reply â€” exit\n            return\n        }\n}\n```\n\n## Edge Cases\n\n1. **Multiple hang-ons**: Each extends timeout. Cap total wait at 30 minutes?\n\n2. **Hang-on after deadline passed**: Alice already timed out. Message becomes regular async (seen on next `--open`).\n\n3. **N-party chat**: Any participant can `--hang-on`. Others see it and wait is extended for all.\n\n4. **Hang-on without prior message**: Unusual but valid â€” starts a conversation in \"acknowledgment\" mode.\n\n## Relationship to Other Features\n\n- **beadhub-5qm3** (read receipts): `--hang-on` is a stronger signal than a read receipt. Read = \"I saw it\", Hang-on = \"I'm working on a response\".\n- **beadhub-yysg** (urgent time display): After `--hang-on`, time remaining resets, so urgency indicator disappears.\n\n## Testing\n\n1. Unit: `hang_on` flag propagates through API\n2. Integration: Alice receives hang-on message and continues waiting\n3. CLI: Timeout extended correctly, message displayed\n\n## Acceptance Criteria\n\n- [ ] `bdh :chat --hang-on \u003calias\u003e \"msg\"` sends acknowledgment\n- [ ] Alice sees message and \"[chat] X requested more time\"\n- [ ] Alice's timeout extended by 5 minutes\n- [ ] Alice does NOT exit after hang-on message\n- [ ] Normal `--reply` still causes Alice to exit","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-09T19:46:12.65586+01:00","created_by":"juanre","updated_at":"2026-01-09T20:04:38.783978+01:00","closed_at":"2026-01-09T20:04:38.783978+01:00","close_reason":"Implemented in commit 9a27b48","dependencies":[{"issue_id":"beadhub-bnyk","depends_on_id":"beadhub-5qm3","type":"related","created_at":"2026-01-09T19:46:17.234189+01:00","created_by":"juanre"},{"issue_id":"beadhub-bnyk","depends_on_id":"beadhub-yysg","type":"related","created_at":"2026-01-09T19:46:17.334862+01:00","created_by":"juanre"}]}
{"id":"beadhub-bp01","title":"Add cursor-based pagination to GET /v1/claims","description":"Update claims.py to use cursor-based pagination:\n\nCurrent: Returns ALL claims with no pagination\nTarget: \n- Add limit and cursor query params\n- Order by created_at DESC for stable ordering\n- Return {items: [...], has_more: bool, next_cursor: str}\n- Default limit 50, max 200\n\nUse the pagination helper module.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T10:30:40.285196+01:00","updated_at":"2025-12-22T11:24:10.137584+01:00","closed_at":"2025-12-22T11:24:10.137584+01:00","close_reason":"Added cursor-based pagination to GET /v1/claims:\n- Added limit and cursor query params\n- Response includes has_more and next_cursor fields\n- Uses claimed_at DESC for stable ordering\n- Validates cursor format with proper error handling\n- 11 tests passing (8 existing + 3 new pagination tests)","dependencies":[{"issue_id":"beadhub-bp01","depends_on_id":"beadhub-v9wr","type":"blocks","created_at":"2025-12-22T10:32:20.845404+01:00","created_by":"juanre"},{"issue_id":"beadhub-bp01","depends_on_id":"beadhub-94q9","type":"blocks","created_at":"2025-12-22T10:36:51.673243+01:00","created_by":"juanre"}]}
{"id":"beadhub-bpyn","title":"Backend - Update Status Endpoint","description":"Replace locks with claims in GET /v1/status response. Remove reservations import.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T17:56:35.820813+01:00","updated_at":"2025-12-12T18:20:53.380241+01:00","closed_at":"2025-12-12T18:20:53.380241+01:00"}
{"id":"beadhub-brow","title":"bdh init: Show existing projects when repo not found","description":"Improve bdh init UX. When repo lookup returns 404, fetch and display existing projects. Let user select by number or enter new slug. Prevents accidental project creation.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T15:25:36.528544+01:00","updated_at":"2025-12-21T17:28:23.384876+01:00","closed_at":"2025-12-21T17:28:23.384876+01:00","close_reason":"Implemented project selection in bdh init. When repo not found, shows existing projects for selection.","dependencies":[{"issue_id":"beadhub-brow","depends_on_id":"beadhub-1thq","type":"blocks","created_at":"2025-12-21T15:26:55.364883+01:00","created_by":"juanre"},{"issue_id":"beadhub-brow","depends_on_id":"beadhub-bzig","type":"blocks","created_at":"2025-12-21T15:27:04.654302+01:00","created_by":"juanre"}]}
{"id":"beadhub-bs3","title":"Presence TTL 60s too short - agents appear offline during long operations","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-03T15:38:52.681486+01:00","updated_at":"2025-12-03T18:03:28.735181+01:00","closed_at":"2025-12-03T18:03:28.735181+01:00"}
{"id":"beadhub-bt0","title":"Repo-scoped agent registration","description":"Add repo field to agent registration.\nTrack which repo each agent is working in.\nEnable agent queries filtered by repo.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-03T09:15:08.58329+01:00","updated_at":"2025-12-03T18:17:56.72145+01:00","closed_at":"2025-12-03T18:17:56.72145+01:00","dependencies":[{"issue_id":"beadhub-bt0","depends_on_id":"beadhub-9su","type":"blocks","created_at":"2025-12-03T09:15:17.135123+01:00","created_by":"juanre"}]}
{"id":"beadhub-bt5h","title":"notifications: Create simple PrintNotifications entry point in main.go","description":"## Goal\n\nCreate the new simple notification system where main.go is responsible for printing notifications at the end of every command.\n\n## Current State\n\n- Passthrough commands handle notifications inline in formatPassthroughOutput\n- Colon commands use DeferServerNotifications/PrintDeferredServerNotifications pattern\n- Gone workspace detection only runs on :status\n\n## Implementation\n\n1. **main.go changes:**\n   - Load config at the end (after Execute returns)\n   - Call `PrintNotifications(w, cfg, excludeAlias)`\n   - If config load fails, silently skip (not initialized)\n\n2. **New simple API in notifications.go:**\n   - `PrintNotifications(w io.Writer, cfg *config.Config, excludeAlias string)` - fetch and print\n   - `SetExcludeChatAlias(alias string)` - global setter for chat command\n   - `FetchNotifications(cfg)` - returns NotificationContext\n   - `FormatNotifications(ctx, excludeAlias)` - formats the output\n\n3. **Coordination with old system:**\n   - Add `notificationsAlreadyPrinted` flag\n   - Old systems set this flag when they print\n   - New PrintNotifications checks flag and skips if set\n   - This prevents double-printing during migration\n\n## Acceptance Criteria\n\n- main.go calls PrintNotifications at the end\n- Old behavior preserved (no double printing)\n- New API is in place and tested\n- No dead code","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T10:02:29.809884+01:00","created_by":"juanre","updated_at":"2026-01-10T10:20:53.368021+01:00","closed_at":"2026-01-10T10:20:53.368021+01:00","close_reason":"Implemented unified PrintNotifications entry point with coordination flag for migration","dependencies":[{"issue_id":"beadhub-bt5h","depends_on_id":"beadhub-1wqx","type":"parent-child","created_at":"2026-01-10T10:07:43.772419+01:00","created_by":"juanre"}]}
{"id":"beadhub-btoj","title":"Collapse Open and In Progress tabs into Active tab on Beads page","description":"## Summary\n\nConsolidate the Beads page tabs from four to three by combining \"Open\" and \"In Progress\" into a single \"Active\" tab.\n\n**Current tabs:** Open | In Progress | Closed | All\n**Proposed tabs:** Active | Closed | All\n\n## Rationale\n\nOpen and In Progress are both \"active work\" states. Separating them forces users to check two tabs to see current work. A unified Active tab gives a single view of all work that isn't done yet.\n\n## Backend Change Required\n\nThe `/v1/beads/issues/all` endpoint currently uses simple equality for status filtering (line 654-657):\n\n```python\nif status:\n    conditions.append(f\"i.status = ${param_idx}\")\n    params.append(status)\n```\n\n**Required change:** Support comma-separated status values.\n\n```python\nif status:\n    # Support comma-separated status values (e.g., \"open,in_progress\")\n    status_list = [s.strip() for s in status.split(\",\") if s.strip()]\n    if len(status_list) == 1:\n        conditions.append(f\"i.status = ${param_idx}\")\n        params.append(status_list[0])\n    else:\n        conditions.append(f\"i.status = ANY(${param_idx})\")\n        params.append(status_list)\n    param_idx += 1\n```\n\nSame change needed for `/v1/beads/issues` endpoint (lines 403-406).\n\n## Frontend Changes\n\n**File:** `frontend/packages/dashboard/src/pages/IssuesPage.tsx`\n\n1. **Update TabsList (lines 628-634):**\n   ```tsx\n   \u003cTabsList\u003e\n     \u003cTabsTrigger value=\"active\"\u003eActive\u003c/TabsTrigger\u003e\n     \u003cTabsTrigger value=\"closed\"\u003eClosed\u003c/TabsTrigger\u003e\n     \u003cTabsTrigger value=\"\"\u003eAll\u003c/TabsTrigger\u003e\n   \u003c/TabsList\u003e\n   ```\n\n2. **Update default statusFilter state (line 255):**\n   - Change from `useState\u003cstring\u003e(\"open\")` to `useState\u003cstring\u003e(\"active\")`\n\n3. **Map \"active\" to API status (lines 354-364):**\n   ```tsx\n   status: statusFilter === \"active\" ? \"open,in_progress\" : statusFilter || undefined,\n   ```\n\n4. **Update empty state messages (lines 661-669):**\n   - Replace \"open\" and \"in_progress\" cases with single \"active\" case\n   - Message: \"No active beads\"\n\n## Status Colors (no change needed)\n\nThe statusColors map (lines 70-74) doesn't need changes - individual issues still show their actual status (open/in_progress) with the correct dot color. The tab just filters to show both.\n\n## Testing\n\n1. Active tab shows both open AND in_progress beads\n2. Closed tab works unchanged\n3. All tab works unchanged  \n4. Default tab on page load is Active\n5. Empty state shows \"No active beads\" when Active tab is empty\n6. Status dots still show correct colors (green for open, blue for in_progress)\n7. Search and other filters work with Active tab\n8. Pagination works correctly with combined results\n\n## Files to Modify\n\n- `src/beadhub/routes/beads.py` - add comma-separated status support (lines 403-406, 654-657)\n- `frontend/packages/dashboard/src/pages/IssuesPage.tsx` - tab UI changes","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-11T00:27:59.022676+01:00","created_by":"juanre","updated_at":"2026-01-11T00:40:36.18732+01:00","closed_at":"2026-01-11T00:40:36.18732+01:00","close_reason":"Implemented Active tab combining Open + In Progress statuses. Added comma-separated status filter support to backend API, status validation, and comprehensive tests."}
{"id":"beadhub-bwpi","title":"Implement chat v2.5: --start-conversation flag and smart wait logic","description":"Implement the v2.5 chat protocol changes from beadhub-chat-spec.md:\n\nDesign bead: beadhub-ayay (closed - spec complete)\n\nKey changes:\n1. Server: Add targets_left to CreateSessionResponse (aliases whose last msg had sender_leaving)\n2. Client: Add --start-conversation flag (5 min wait, ignore targets_left)\n3. Client: Smart default - skip wait if all targets in targets_left\n4. Client: Enhanced --pending display showing sender_waiting status with guidance\n5. Client: targets_connected becomes informational only\n\nSee beadhub-chat-spec.md v2.5 for full specification.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-16T21:32:06.796843+01:00","updated_at":"2025-12-16T21:49:20.74374+01:00","closed_at":"2025-12-16T21:49:20.74374+01:00"}
{"id":"beadhub-bwu8","title":"Multi-claim retest B","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-05T17:58:09.969647Z","created_by":"juanre","updated_at":"2026-01-05T17:58:30.63292Z","closed_at":"2026-01-05T17:58:30.63292Z","close_reason":"Testing multi-close fix"}
{"id":"beadhub-bxcf","title":"Filter bar UX: Add labels or dropdowns to distinguish project from repo filters","description":"Current filter bar shows badges for project keys and repos separated by a pipe, but no labels explain what each group is. Options:\n1. Add labels 'Project:' and 'Repo:' before each group of badges\n2. Replace badges with labeled dropdown menus (Select components)\n3. Combine into a single searchable combobox with grouped options\n\nDropdowns would scale better if there are many projects/repos. Badge approach only works well with ~5 items.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T17:17:35.557944+01:00","updated_at":"2025-12-08T17:25:44.470767+01:00","closed_at":"2025-12-08T17:25:44.470767+01:00"}
{"id":"beadhub-bxn","title":"Add workspace_id param to subscription endpoints","description":"Update /v1/subscriptions endpoints to use workspace_id instead of project_key. Subscriptions link agents to bead events.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T19:18:05.623353+01:00","updated_at":"2025-12-07T20:56:30.365204+01:00","closed_at":"2025-12-07T20:56:30.365204+01:00","dependencies":[{"issue_id":"beadhub-bxn","depends_on_id":"beadhub-6am","type":"blocks","created_at":"2025-12-07T19:18:12.263901+01:00","created_by":"juanre"}]}
{"id":"beadhub-byjy","title":"Add tests for security edge cases in /v1/bdh/command","description":"Missing test coverage for /v1/bdh/command security edge cases:\n\n1. Malformed bead_id with shell metacharacters\n2. SQL injection attempts in human_name, project_slug, alias\n3. Whitespace-only command_line\n4. Boundary testing for max length fields\n5. Case variations in status value\n6. Concurrency test for race condition\n7. Invalid patterns in human_name (must match ^[a-zA-Z][a-zA-Z '-]{0,63}$)\n8. Invalid patterns in project_slug (must match ^[a-z0-9][a-z0-9-]{0,62}$)\n9. Invalid patterns in alias (must match ^[a-zA-Z0-9][a-zA-Z0-9_-]{0,63}$)\n\nUpdated 2025-12-12: field names updated per data model (project_key â†’ project_slug, agent_name â†’ alias).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T10:43:04.275001+01:00","updated_at":"2026-01-09T21:04:51.116006+01:00","closed_at":"2026-01-09T21:04:51.116006+01:00","close_reason":"Largely covered: 3/9 explicitly tested, 2/9 N/A (wrong field or separate issue), 2/9 protected by design (parameterized queries + regex validators), 2/9 minor gaps (whitespace/case) not security risks. Validators in bdh.py:305-360 provide strong input validation.","dependencies":[{"issue_id":"beadhub-byjy","depends_on_id":"beadhub-f5il","type":"discovered-from","created_at":"2025-12-10T10:43:04.27587+01:00","created_by":"juanre"}]}
{"id":"beadhub-byt4","title":"UX: Claims page should show alias instead of UUID","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T21:26:08.79848+01:00","updated_at":"2025-12-13T23:17:37.796245+01:00","closed_at":"2025-12-13T23:17:37.796245+01:00"}
{"id":"beadhub-bzig","title":"OSS API: GET /v1/projects - list projects","description":"Add endpoint to list all projects. Return id, slug, name, created_at, repo_count, workspace_count.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T15:25:33.978262+01:00","updated_at":"2025-12-21T16:42:18.947241+01:00","closed_at":"2025-12-21T16:42:18.947241+01:00","close_reason":"Implemented GET /v1/projects, GET /v1/projects/{id}, and GET /v1/repos endpoints with tests","dependencies":[{"issue_id":"beadhub-bzig","depends_on_id":"beadhub-1thq","type":"blocks","created_at":"2025-12-21T15:26:54.510194+01:00","created_by":"juanre"}]}
{"id":"beadhub-bzmx","title":"Document magic numbers in cleanup logic","description":"maxDeletionsPerRun=5 and 5-second timeout are hardcoded without explanation. Document rationale and consider making configurable via environment variable.","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-17T08:02:06.894454+01:00","updated_at":"2025-12-17T18:57:57.242349+01:00","closed_at":"2025-12-17T18:57:57.242349+01:00","close_reason":"Won't fix: auto-cleanup feature removed - worktree-based detection doesn't work across machines","dependencies":[{"issue_id":"beadhub-bzmx","depends_on_id":"beadhub-lmtj","type":"discovered-from","created_at":"2025-12-17T08:02:06.895963+01:00","created_by":"juanre"}]}
{"id":"beadhub-c0qe","title":"bdh: store short role classification in .beadhub and send to server","description":"Re-introduce `role`, but as a short classification (1â€“2 words) like: \"manager\", \"reviewer\", \"frontend\", \"backend\", \"fullstack\".\n\nWhy:\n- Role removal caused server to perform extra Redis reads to preserve a missing field, adding latency on every command.\n- Role is still useful context (what this workspace is for) and is independent from \"what bead is being worked on\".\n\nImplementation outline (Go CLI):\n1) Extend `.beadhub` schema to include `role` (string, optional) and load/validate it in `bdh/internal/config/config.go`.\n2) Re-add `bdh :init --role` flag (and env var support if desired) to write role into `.beadhub`.\n3) Include `role` in:\n   - `POST /v1/bdh/command` (`bdh/internal/commands/passthrough.go`)\n   - presence refresh (`bdh/internal/commands/context.go` and any other refresh calls)\n4) Update `bdh :who` output to display role if present.\n\nNon-goals:\n- Do NOT store dynamic \"working on\"/apex state in `.beadhub`.\n\nNotes:\n- Prefer a small allowlist or tight validation (length, charset) to avoid free-form text and keep display consistent.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-20T13:54:29.719679+01:00","updated_at":"2025-12-20T14:13:53.062638+01:00","closed_at":"2025-12-20T14:13:53.062638+01:00","close_reason":"Restore short role in .beadhub and propagate through bdh; update docs/tests.","dependencies":[{"issue_id":"beadhub-c0qe","depends_on_id":"beadhub-o9h7","type":"parent-child","created_at":"2025-12-20T13:54:29.721645+01:00","created_by":"juanre"}]}
{"id":"beadhub-c1tj","title":"Backend: Support project-wide SSE event streaming","description":"Currently /v1/status/stream requires workspace_id. For dashboard 'All workspaces' mode, need to support:\n\n1. Make workspace_id optional\n2. Add project_id and/or project_slug query params\n3. When workspace_id is omitted, subscribe to events matching the filter (project, repo, etc)\n4. If no filters, subscribe to all events\n\nThis enables the frontend to show aggregated events in the Event Feed when viewing all workspaces.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-14T00:12:34.591492+01:00","updated_at":"2025-12-14T00:33:29.259608+01:00","closed_at":"2025-12-14T00:33:29.259608+01:00"}
{"id":"beadhub-c1x","title":"Add error handling for redis.eval() in reservation acquisition","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-03T16:45:16.2016+01:00","updated_at":"2025-12-03T16:47:26.332665+01:00","closed_at":"2025-12-03T16:47:26.332665+01:00"}
{"id":"beadhub-c26h","title":"TECH DEBT: Fix .gitignore pattern for .venv","description":"## Problem\n\nUnusual gitignore pattern may not work as intended.\n\n### Current Behavior\n\nIn `.gitignore:110`:\n```\n***/.venv\n```\n\nThree asterisks is unusual and may not behave as expected.\n\n### Expected Patterns\n\n- `**/.venv` - Two asterisks for glob (match .venv in any subdirectory)\n- `.venv` - Match .venv at repository root only\n- `**/venv` - If the directory is named venv, not .venv\n\n### Solution\n\nChange to standard pattern:\n\n```gitignore\n# Python virtual environment\n.venv/\n**/.venv/\n```\n\n### Files to Update\n\n- `.gitignore`\n\n### Acceptance Criteria\n\n- [ ] .gitignore uses standard glob pattern\n- [ ] .venv directories are properly ignored\n- [ ] Test by creating .venv in subdirectory","status":"closed","priority":4,"issue_type":"bug","created_at":"2026-01-09T08:31:48.807755+01:00","created_by":"juanre","updated_at":"2026-01-09T21:16:34.738833+01:00","closed_at":"2026-01-09T21:16:34.738833+01:00","close_reason":"Not a real problem. Tested: ***/.venv works correctly - Git treats *** same as **. Matches .venv at root and all subdirectories. Unusual but not broken."}
{"id":"beadhub-c2n8","title":"UX: Messages page should show sender alias prominently at top of card","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-13T21:26:18.049559+01:00","updated_at":"2025-12-13T23:31:12.94813+01:00","closed_at":"2025-12-13T23:31:12.94813+01:00"}
{"id":"beadhub-c4fg","title":"Epic: Server-side apex computation - eliminate .role file","description":"Move apex computation entirely to server, eliminating the .role file and all client-side apex tracking.\n\n**Context**: Currently apex is computed client-side in passthrough.go, stored in .role line 2, and pushed via Redis presence. This creates stale data and unnecessary complexity.\n\n**Goal**: Server computes apex from claims + beads_issues.parent_id. Client receives apex in API responses. No .role file needed.\n\n**Important**: We have NOT shipped. No backward compatibility needed. We want a FULLY CLEAN codebase - remove all stale code, don't leave dead paths or compatibility shims.\n\n**Key changes**:\n1. Server: Compute apex by walking parent_id chain for each claim\n2. Server: Return apex_id + apex_title in workspaces/claims endpoints\n3. Client: Remove .role file entirely (config.LoadApex, SaveApex, LoadRole)\n4. Client: Remove client-side apex computation (findApex, apex storage in passthrough.go)\n5. Client: Update :who/:ready to use server-provided apex\n6. Docs: Update CLAUDE.md to remove .role references\n\n**Result**: :who shows 'Working on: [apex title]' prominently, computed fresh from server every time.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-20T11:46:09.757389+01:00","updated_at":"2025-12-20T13:01:34.072531+01:00","closed_at":"2025-12-20T13:01:34.072531+01:00","close_reason":"All subtasks completed - apex is now computed server-side, .role file eliminated"}
{"id":"beadhub-c4fg.1","title":"Server: Add apex computation to workspaces endpoint","description":"Add server-side apex computation to GET /v1/workspaces.\n\nFor each workspace with claims:\n1. For each claimed bead_id, look up in beads_issues\n2. Walk parent_id chain until null (apex has no parent)\n3. Return apex_id and apex_title per claim\n4. Deduplicate if multiple claims have same apex\n\nUpdate WorkspaceInfo model to include:\n- apex_id: str (bead ID of the apex)\n- apex_title: str (title of the apex bead)\n- Remove the old 'apex' field that came from Redis presence\n\nUse recursive CTE or iterative query. Handle cycles (max depth ~20).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T11:46:45.234303+01:00","updated_at":"2025-12-20T12:02:33.888989+01:00","closed_at":"2025-12-20T12:02:33.888989+01:00","close_reason":"Implemented server-side apex computation in GET /v1/workspaces","dependencies":[{"issue_id":"beadhub-c4fg.1","depends_on_id":"beadhub-c4fg","type":"parent-child","created_at":"2025-12-20T11:46:45.23494+01:00","created_by":"juanre"}]}
{"id":"beadhub-c4fg.2","title":"Server: Remove apex from Redis presence contract","description":"Remove apex field from presence data since server now computes it.\n\n1. Update presence.py to not expect/return apex\n2. Update any heartbeat handling that stores apex\n3. Clean up Redis presence schema docs if any","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T11:46:45.628278+01:00","updated_at":"2025-12-20T12:57:46.354339+01:00","closed_at":"2025-12-20T12:57:46.354339+01:00","close_reason":"Removed apex from Redis presence contract and client, removed .role file creation","dependencies":[{"issue_id":"beadhub-c4fg.2","depends_on_id":"beadhub-c4fg","type":"parent-child","created_at":"2025-12-20T11:46:45.628915+01:00","created_by":"juanre"}]}
{"id":"beadhub-c4fg.3","title":"Client: Remove .role file and all apex/role config code","description":"Delete all .role file handling from bdh client.\n\nRemove from config/config.go:\n- RoleFileName constant\n- MaxRoleLength constant  \n- LoadRole() function\n- LoadApex() function\n- SaveApex() function\n- getRolePath() function\n\nRemove from config/config_test.go:\n- All TestLoadApex* tests\n- All TestSaveApex* tests\n- All TestLoadRole* tests\n\nThis is a clean removal - no deprecation, no compatibility.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T11:46:46.031274+01:00","updated_at":"2025-12-20T12:13:34.661638+01:00","closed_at":"2025-12-20T12:13:34.661638+01:00","close_reason":"Removed .role file handling: RoleFileName, MaxRoleLength constants; LoadRole, LoadApex, SaveApex functions; role flag from init; Role field from presence refresh","dependencies":[{"issue_id":"beadhub-c4fg.3","depends_on_id":"beadhub-c4fg","type":"parent-child","created_at":"2025-12-20T11:46:46.031827+01:00","created_by":"juanre"},{"issue_id":"beadhub-c4fg.3","depends_on_id":"beadhub-c4fg.1","type":"blocks","created_at":"2025-12-20T11:47:03.577211+01:00","created_by":"juanre"}]}
{"id":"beadhub-c4fg.4","title":"Client: Remove client-side apex computation from passthrough.go","description":"Remove all apex-related code from passthrough.go:\n\nDelete functions:\n- findApex()\n- loadApexContext()\n- clearClosedApex()\n- Any apex storage logic in claim handling\n\nDelete types:\n- ApexInfo struct (if only used for local apex)\n\nRemove from passthrough_test.go:\n- TestFindApex\n- TestFindApex_CycleProtection\n- TestPassthrough_StoresApexOnClaim\n- TestPassthrough_AccumulatesMultipleApexes\n- TestPassthrough_DoesNotDuplicateExistingApex\n- TestReady_ShowsApexContext\n- TestReady_ClearsClosedApex\n- TestClose_ClearsApexWhenClosingApexBead\n- TestClose_RemovesOnlyClosedApexFromMultiple\n\nClean removal - these tests validated client-side logic that no longer exists.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T11:46:46.460348+01:00","updated_at":"2025-12-20T12:37:56.710487+01:00","closed_at":"2025-12-20T12:37:56.710487+01:00","close_reason":"Completed: Removed client-side apex computation, added server-provided apex to Claim struct and :ready display","dependencies":[{"issue_id":"beadhub-c4fg.4","depends_on_id":"beadhub-c4fg","type":"parent-child","created_at":"2025-12-20T11:46:46.461022+01:00","created_by":"juanre"},{"issue_id":"beadhub-c4fg.4","depends_on_id":"beadhub-c4fg.1","type":"blocks","created_at":"2025-12-20T11:47:03.742185+01:00","created_by":"juanre"}]}
{"id":"beadhub-c4fg.5","title":"Client: Update :who to display server-provided apex prominently","description":"Update who.go to use apex from server response instead of .role file.\n\nUpdate WorkspaceInfo struct to match new server response:\n- apex_id: string\n- apex_title: string\n\nUpdate formatWhoOutput() to show apex prominently:\n```\nclaude-main (Juan)\n  Working on: Epic: Apex bead tracking  \n  Claims:\n    beadhub-sppz \"Handle multiple apex\" â€” 2h\n  Status: active â€” 5m ago\n```\n\nThe 'Working on' line shows the apex title(s), replacing the old stale role description.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T11:46:46.888708+01:00","updated_at":"2025-12-20T12:34:43.872228+01:00","closed_at":"2025-12-20T12:34:43.872228+01:00","close_reason":"Updated :who to use server-provided apex_id/apex_title","dependencies":[{"issue_id":"beadhub-c4fg.5","depends_on_id":"beadhub-c4fg","type":"parent-child","created_at":"2025-12-20T11:46:46.889379+01:00","created_by":"juanre"},{"issue_id":"beadhub-c4fg.5","depends_on_id":"beadhub-c4fg.1","type":"blocks","created_at":"2025-12-20T11:47:03.896295+01:00","created_by":"juanre"}]}
{"id":"beadhub-c4fg.6","title":"Client: Update :ready to use server-provided apex","description":"Update ready command to show apex context from server.\n\nCurrently ready shows apex from loadApexContext() which reads .role file.\nChange to get apex from server response (probably via :status or similar endpoint).\n\nShow 'Working on: [apex]' at top of ready output if agent has claims.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T11:46:47.318285+01:00","updated_at":"2025-12-20T12:37:56.711819+01:00","closed_at":"2025-12-20T12:37:56.711819+01:00","close_reason":"Completed: Removed client-side apex computation, added server-provided apex to Claim struct and :ready display","dependencies":[{"issue_id":"beadhub-c4fg.6","depends_on_id":"beadhub-c4fg","type":"parent-child","created_at":"2025-12-20T11:46:47.318943+01:00","created_by":"juanre"},{"issue_id":"beadhub-c4fg.6","depends_on_id":"beadhub-c4fg.1","type":"blocks","created_at":"2025-12-20T11:47:04.05856+01:00","created_by":"juanre"}]}
{"id":"beadhub-c4fg.7","title":"Client: Remove apex from heartbeat/presence push","description":"Remove apex from data sent to server during heartbeat.\n\nFind where client pushes presence data (likely in init or status commands) and remove the apex field. Server no longer needs it since it computes apex from claims.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T11:46:47.748105+01:00","updated_at":"2025-12-20T12:57:46.355573+01:00","closed_at":"2025-12-20T12:57:46.355573+01:00","close_reason":"Removed apex from Redis presence contract and client, removed .role file creation","dependencies":[{"issue_id":"beadhub-c4fg.7","depends_on_id":"beadhub-c4fg","type":"parent-child","created_at":"2025-12-20T11:46:47.748697+01:00","created_by":"juanre"},{"issue_id":"beadhub-c4fg.7","depends_on_id":"beadhub-c4fg.2","type":"blocks","created_at":"2025-12-20T11:47:04.212692+01:00","created_by":"juanre"}]}
{"id":"beadhub-c4fg.8","title":"Docs: Remove .role references from CLAUDE.md and other docs","description":"Update documentation to remove .role file references.\n\nFiles to check:\n- CLAUDE.md (beadhub project)\n- Any bdh --help text mentioning role\n- Comments in code that reference .role\n\nThe .role file no longer exists - remove all traces.","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-20T11:46:48.15484+01:00","updated_at":"2025-12-20T12:57:46.356005+01:00","closed_at":"2025-12-20T12:57:46.356005+01:00","close_reason":"Removed apex from Redis presence contract and client, removed .role file creation","dependencies":[{"issue_id":"beadhub-c4fg.8","depends_on_id":"beadhub-c4fg","type":"parent-child","created_at":"2025-12-20T11:46:48.155391+01:00","created_by":"juanre"},{"issue_id":"beadhub-c4fg.8","depends_on_id":"beadhub-c4fg.3","type":"blocks","created_at":"2025-12-20T11:47:04.371963+01:00","created_by":"juanre"},{"issue_id":"beadhub-c4fg.8","depends_on_id":"beadhub-c4fg.4","type":"blocks","created_at":"2025-12-20T11:47:04.531025+01:00","created_by":"juanre"}]}
{"id":"beadhub-c5ez","title":"Update routes/chat.py: rename agent fields to alias","description":"Update src/beadhub/routes/chat.py for new data model.\n\nChanges:\n- _resolve_agent_to_workspace(): query by alias instead of agent_name\n- _validate_agent_name_field() â†’ _validate_alias_field()\n- All Pydantic models: agent_name â†’ alias\n- Redis hash fields in chat session: initiator_agent â†’ initiator_alias, target_agent â†’ target_alias\n- Chat message fields: from_agent â†’ from_alias\n\nSSE events should use alias variants as per beadhub-chat-spec.md v1.1.0.\n\nDepends on: presence.py update, workspace table migration","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T12:50:47.959156+01:00","updated_at":"2025-12-13T17:47:13.123598+01:00","closed_at":"2025-12-13T17:47:13.123598+01:00","dependencies":[{"issue_id":"beadhub-c5ez","depends_on_id":"beadhub-47mi","type":"blocks","created_at":"2025-12-12T12:50:54.650801+01:00","created_by":"juanre"},{"issue_id":"beadhub-c5ez","depends_on_id":"beadhub-wvj6","type":"blocks","created_at":"2025-12-12T12:50:54.710383+01:00","created_by":"juanre"}]}
{"id":"beadhub-c5r","title":"Standardize naming: pick 'reservation' or 'lock' and use consistently","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-03T15:39:15.336026+01:00","updated_at":"2025-12-22T01:17:07.713823+01:00","closed_at":"2025-12-22T01:17:07.713823+01:00","close_reason":"Standardized on 'reservation' terminology throughout codebase (lockâ†’reservation)"}
{"id":"beadhub-c6zq","title":"Create reusable frontend pagination component","description":"Create a reusable pagination component in frontend/src/components/Pagination.tsx:\n\nFeatures:\n- 'Load more' button pattern (fits infinite scroll UX)\n- Shows loading state while fetching\n- Hides when no more items (has_more=false)\n- Accepts: onLoadMore callback, hasMore bool, isLoading bool\n- Optional: Item count display\n\nThis component will be used by all list views.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T10:30:56.932935+01:00","updated_at":"2025-12-22T11:17:14.746459+01:00","closed_at":"2025-12-22T11:17:14.746459+01:00","close_reason":"Created reusable Pagination component in frontend/src/components/Pagination.tsx with:\n- Load more button pattern with loading state\n- Hides when hasMore=false\n- Optional item count display (X of Y or X items)\n- Proper accessibility (aria-labels, aria-hidden for decorative icon)\n- 12 tests covering all states and edge cases","dependencies":[{"issue_id":"beadhub-c6zq","depends_on_id":"beadhub-v9wr","type":"blocks","created_at":"2025-12-22T10:32:21.66275+01:00","created_by":"juanre"}]}
{"id":"beadhub-c8fu","title":"Improve bdh init with CLI flags and better defaults","description":"Add CLI flags for --url, --alias, --human, --project. Load .env for BEADHUB_URL and BEADHUB_PROJECT. Default alias to claude-[branch]. Default human to username.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-13T10:08:24.793966+01:00","updated_at":"2025-12-13T10:25:05.445158+01:00","closed_at":"2025-12-13T10:25:05.445158+01:00"}
{"id":"beadhub-c8s","title":"Update bdh script to use workspace_id from .beadhub","description":"Update bdh to read workspace_id from .beadhub file. Require .beadhub to exist (fail with helpful message if not). Use workspace_id for inbox checks instead of project_key.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T19:10:10.321007+01:00","updated_at":"2025-12-07T21:52:28.152612+01:00","closed_at":"2025-12-07T21:52:28.152612+01:00","dependencies":[{"issue_id":"beadhub-c8s","depends_on_id":"beadhub-asx","type":"blocks","created_at":"2025-12-07T19:10:10.322106+01:00","created_by":"juanre"}]}
{"id":"beadhub-caw5","title":"bdh: timeouts + remove project_id from pending","description":"Discovered during code review of beadhub-x3um.\n\nWork:\n- Enforce tenant isolation per SOT: /v1/chat/pending derives project server-side, so bdh client must NOT send project_id; remove it from client request/encoding and context fetch.\n- Add API timeouts to remaining coordination calls that still use context.Background() (presence refresh, command preflight, pending chats, sync) so bdh never hangs.\n- Keep --json output pure JSON for all affected paths; extend/adjust tests accordingly.\n\nOut of scope: backwards compatibility with older servers/clients.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T00:29:57.461979+01:00","updated_at":"2025-12-22T00:47:04.314361+01:00","closed_at":"2025-12-22T00:47:04.314361+01:00","close_reason":"Merged to main","dependencies":[{"issue_id":"beadhub-caw5","depends_on_id":"beadhub-x3um","type":"discovered-from","created_at":"2025-12-22T00:34:13.373316+01:00","created_by":"juanre"}]}
{"id":"beadhub-cbs6","title":"Standardize coordination footer across all bdh output","description":"## Problem\n\nCoordination information (notifications, focus, team status) appears inconsistently across bdh commands:\n\n**Current state:**\n- `bdh :who` â†’ NOTIFICATIONS at end âœ“\n- `bdh ready` â†’ WAITING at TOP, YOUR FOCUS/TEAM STATUS at bottom âœ—\n- Other `bd` subcontracted commands â†’ mixed\n\n## Solution\n\nAll coordination info should be in a **consistent footer** at the END of every command output:\n\n```\n[Primary command output here]\n\nYOUR FOCUS:\n  beadhub-xyz \"Current task\"\n\nTEAM STATUS (top N):\n  agent-a â€” focused on beadhub-abc\n  agent-b â€” idle\n\nNOTIFICATIONS:\n  WAITING: agent-c is waiting for your reply â€” Run \"bdh :chat --open agent-c\"\n  MAILS: 2 unread â€” Run \"bdh :inbox\"\n  CHATS: 1 unread conversation â€” Run \"bdh :chat --pending\"\n```\n\n## Implementation\n\n1. Refactor bdh Go code to collect all coordination info\n2. Render coordination footer AFTER primary output completes\n3. Move WAITING notifications from banner to NOTIFICATIONS section\n4. Consistent ordering: YOUR FOCUS â†’ TEAM STATUS â†’ NOTIFICATIONS\n5. Apply to both native :* commands and wrapped bd commands","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T20:52:05.171418+01:00","created_by":"juanre","updated_at":"2026-01-09T21:12:01.675462+01:00","closed_at":"2026-01-09T21:12:01.675462+01:00","close_reason":"Implemented in commit 97fa665"}
{"id":"beadhub-cbv","title":"Require API key in production or document dev mode auth behavior","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-03T15:39:15.910091+01:00","updated_at":"2025-12-22T12:28:04.712684+01:00","closed_at":"2025-12-22T12:28:04.712684+01:00","close_reason":"Documented OSS auth behavior and secure patterns"}
{"id":"beadhub-ccjx","title":"Simplify workspace registration: remove redundant pre-check","description":"In src/beadhub/routes/workspaces.py register_workspace(), there's a pre-check for alias uniqueness (lines 138-151) followed by an INSERT that catches UniqueViolationError. The pre-check is redundant - the database constraint catches races anyway. Remove the pre-check and rely solely on the constraint, or add a comment explaining why both are needed.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T10:50:06.270677+01:00","updated_at":"2025-12-13T18:56:28.918933+01:00","closed_at":"2025-12-13T18:56:28.918933+01:00"}
{"id":"beadhub-ceqf","title":"Migrate test_error_paths.py to db_infra fixture","description":"Convert from app_with_test_db to async tests using db_infra fixture.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-10T10:55:08.302835+01:00","created_by":"juanre","updated_at":"2026-01-10T12:43:04.938851+01:00","closed_at":"2026-01-10T12:43:04.938851+01:00","close_reason":"Migrated test_error_paths.py to async fixtures. 6 tests pass.","dependencies":[{"issue_id":"beadhub-ceqf","depends_on_id":"beadhub-7wpr","type":"parent-child","created_at":"2026-01-10T10:55:49.869237+01:00","created_by":"juanre"}]}
{"id":"beadhub-chy0","title":"Chat frontend: disable input while joining session to prevent race condition","description":"In SessionViewer component, user can potentially try to send a message while join is still in progress. Should disable input field while isJoining is true. Low priority UX fix.","status":"open","priority":3,"issue_type":"bug","created_at":"2025-12-15T22:03:48.931867+01:00","updated_at":"2025-12-15T22:03:48.931867+01:00"}
{"id":"beadhub-ci41","title":"Dashboard: Display role in workspace cards","description":"Show role description in workspace cards on the workspaces page","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-14T09:06:38.193224+01:00","updated_at":"2025-12-15T15:35:00.599942+01:00","closed_at":"2025-12-15T15:18:22.476426+01:00","dependencies":[{"issue_id":"beadhub-ci41","depends_on_id":"beadhub-1bad","type":"blocks","created_at":"2025-12-14T09:06:56.445136+01:00","created_by":"juanre"},{"issue_id":"beadhub-ci41","depends_on_id":"beadhub-161u","type":"parent-child","created_at":"2025-12-14T09:24:11.556696+01:00","created_by":"juanre"}]}
{"id":"beadhub-co7i","title":"Chat SSE: Late joiners miss events (race condition)","description":"When target joins a chat session, the 'joined' event is published but the initiator may not be subscribed to the SSE stream yet, causing them to miss the event. Options: (A) Store last N events in Redis for late joiners, (B) Document that clients must connect before operations, (C) Send current session state on SSE connect. Discovered in code review of beadhub-b37m.","status":"closed","priority":1,"issue_type":"bug","assignee":"frank-agent","created_at":"2025-12-10T22:54:41.176138+01:00","updated_at":"2026-01-03T18:53:27.2378Z","closed_at":"2026-01-03T18:53:27.2378Z","close_reason":"Implemented stream_with_history() to replay Postgres messages on SSE connect","dependencies":[{"issue_id":"beadhub-co7i","depends_on_id":"beadhub-b37m","type":"discovered-from","created_at":"2025-12-10T22:54:41.17719+01:00","created_by":"juanre"}]}
{"id":"beadhub-col1","title":"Update frontend/Go pending chat types after removing expires_in_seconds","description":"Server PendingRequest (GET /v1/chat/pending) no longer returns expires_in_seconds (sessions are persistent). Client code still models the field:\n- frontend/src/lib/api.ts PendingChatRequest.expires_in_seconds\n- bdh/internal/client/client.go PendingChatRequest.ExpiresInSeconds\n\nFix: update client models and any UI/output to stop expecting/displaying expiry; align with beadhub-chat-spec.md v2.1 pending fields (unread_count, last_activity, etc. will come via beadhub-6qlj).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T23:43:53.569954+01:00","updated_at":"2025-12-14T09:29:26.150549+01:00","closed_at":"2025-12-14T09:29:26.150549+01:00","dependencies":[{"issue_id":"beadhub-col1","depends_on_id":"beadhub-r93o","type":"discovered-from","created_at":"2025-12-13T23:43:53.571085+01:00","created_by":"juanre"}]}
{"id":"beadhub-cpl","title":"Add docstring examples for create_app() library mode usage","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-03T09:46:21.528949+01:00","updated_at":"2025-12-03T12:09:27.847049+01:00","closed_at":"2025-12-03T12:09:27.847049+01:00"}
{"id":"beadhub-cpp8","title":"Prompt for epic closure on last bead completion","description":"When closing a bead, check if it's the last open bead under the current apex epic. If so, display prompt: 'All work under [apex title] is complete. Close the epic? Run: bdh close [apex-id]'. Detection: count open beads with parent-child dependency to the apex. Don't auto-close - just prompt.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T21:59:18.988944+01:00","updated_at":"2025-12-20T10:44:38.166069+01:00","closed_at":"2025-12-20T10:44:38.166069+01:00","close_reason":"Implemented checkForEpicClosure() that checks if all children of the apex are closed after a close command. When detected, displays prompt: 'âœ… All work under [epic-id] \"[title]\" is complete. â†’ Close the epic: bdh close [epic-id]'. Added EpicClosurePrompt struct and display logic. All tests pass.","dependencies":[{"issue_id":"beadhub-cpp8","depends_on_id":"beadhub-npuh","type":"parent-child","created_at":"2025-12-17T21:59:33.155156+01:00","created_by":"juanre"},{"issue_id":"beadhub-cpp8","depends_on_id":"beadhub-8m8m","type":"blocks","created_at":"2025-12-17T21:59:41.099155+01:00","created_by":"juanre"}]}
{"id":"beadhub-cquk","title":"notifications: Remove dead notification code","description":"## Goal\n\nRemove all dead code from the old notification system after migration is complete.\n\n## Files to clean up\n\n### context.go - remove entirely or gut:\n- ServerContext struct (replaced by NotificationContext)\n- ServerContextDisplayOptions struct (no longer needed)\n- FetchServerContext function\n- FetchServerNotifications function (old one)\n- FormatServerNotifications function (old one)\n- FormatServerContextPrefix function\n- FormatServerContextSuffix function\n- FormatWaitingNotification function\n- ShowServerContext function\n- ShowServerContextWithOptions function\n- DefaultServerContextDisplayOptions function\n\n### notifications.go - remove:\n- notificationsAlreadyPrinted flag (no longer needed after migration)\n- Old DeferServerNotifications compatibility (if any)\n- deferredServerNotifications struct (if still present)\n\n### status.go - remove:\n- detectAndCleanGoneWorkspaces function (now in notifications.go)\n- GoneWorkspace type (now in notifications.go)\n- Gone workspace display code in runStatus\n\n### context_test.go - update or remove:\n- Tests for removed functions\n\n## Result\n\n- Only the new simple notification system remains\n- No dead code\n- Smaller, cleaner codebase","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T10:03:04.313592+01:00","created_by":"juanre","updated_at":"2026-01-10T10:55:11.958296+01:00","closed_at":"2026-01-10T10:55:11.958296+01:00","close_reason":"Removed 579 lines of dead notification code: context.go, old deferred system","dependencies":[{"issue_id":"beadhub-cquk","depends_on_id":"beadhub-mmox","type":"blocks","created_at":"2026-01-10T10:03:09.294863+01:00","created_by":"juanre"},{"issue_id":"beadhub-cquk","depends_on_id":"beadhub-swnj","type":"blocks","created_at":"2026-01-10T10:03:09.379774+01:00","created_by":"juanre"},{"issue_id":"beadhub-cquk","depends_on_id":"beadhub-1wqx","type":"parent-child","created_at":"2026-01-10T10:07:44.738897+01:00","created_by":"juanre"}]}
{"id":"beadhub-cr1w","title":"Migrate test_repos.py to db_infra fixture","description":"Convert from app_with_test_db to async tests using db_infra fixture.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-10T10:55:07.50732+01:00","created_by":"juanre","updated_at":"2026-01-10T12:13:34.658118+01:00","closed_at":"2026-01-10T12:13:34.658118+01:00","close_reason":"Migrated test_repos.py to async fixtures (db_infra + redis_client_async). 48 tests pass. Pure unit tests (TestCanonicalizeGitUrl) remain sync, API tests properly use LifespanManager + AsyncClient pattern.","dependencies":[{"issue_id":"beadhub-cr1w","depends_on_id":"beadhub-7wpr","type":"parent-child","created_at":"2026-01-10T10:55:49.628812+01:00","created_by":"juanre"}]}
{"id":"beadhub-ctkz","title":"Frontend UI: Send Message action on workspace cards","description":"Add 'Send Message' button/icon to WorkspaceCard component. On click, open SendMessageDialog with target workspace pre-filled. Icon: mail or message-square from lucide-react.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T19:27:05.387799+01:00","updated_at":"2025-12-14T08:53:08.27012+01:00","closed_at":"2025-12-13T20:17:28.015348+01:00","dependencies":[{"issue_id":"beadhub-ctkz","depends_on_id":"beadhub-x2lj","type":"blocks","created_at":"2025-12-13T19:27:37.6753+01:00","created_by":"juanre"},{"issue_id":"beadhub-ctkz","depends_on_id":"beadhub-g9l6","type":"parent-child","created_at":"2025-12-13T19:27:53.117871+01:00","created_by":"juanre"}]}
{"id":"beadhub-cut4","title":"dashboard.py: identity lookup missing deleted_at filter","description":"Line 120: Dashboard identity lookup queries workspaces without deleted_at IS NULL filter. Could return deleted dashboard workspace.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-21T20:47:00.038716+01:00","updated_at":"2025-12-21T21:05:47.764038+01:00","closed_at":"2025-12-21T21:05:47.764038+01:00","close_reason":"Added deleted_at IS NULL filter to dashboard identity lookup"}
{"id":"beadhub-cx62","title":"Update bdh consumers to use GetBeadsDir()","description":"Update all hardcoded .beads/ paths to use beads.GetBeadsDir():\n- init.go:160 - .beads/beads.db check\n- passthrough.go:484 - loadIssues() reads .beads/issues.jsonl\n- passthrough.go:691 - syncToBeadHub() reads .beads/issues.jsonl\n- sync/state.go:28 - DefaultStateFile constant","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-02T12:04:28.323236Z","created_by":"juanre","updated_at":"2026-01-02T12:09:25.371935Z","closed_at":"2026-01-02T12:09:25.371935Z","close_reason":"Updated init.go, passthrough.go, and sync/state.go to use beads.GetBeadsDir() and related functions. All tests pass.","dependencies":[{"issue_id":"beadhub-cx62","depends_on_id":"beadhub-nkjm","type":"blocks","created_at":"2026-01-02T12:04:35.228716Z","created_by":"juanre"},{"issue_id":"beadhub-cx62","depends_on_id":"beadhub-8u63","type":"blocks","created_at":"2026-01-02T12:04:35.437682Z","created_by":"juanre"}]}
{"id":"beadhub-cyl","title":"Use async file I/O in beads_sync","description":"**Problem**: beads_sync.py opens and reads files synchronously without using aiofiles. Large JSONL files could block the async event loop.\n\n**File**: beads_sync.py:41-55\n\n**Current code**:\n```python\nwith jsonl_path.open('r', encoding='utf-8') as f:\n    for line in f:  # Blocking I/O\n```\n\n**Fix options**:\n1. Use aiofiles for async file I/O\n2. Wrap file reading in run_in_threadpool\n\n**Option 1 (preferred)**:\n```python\nimport aiofiles\n\nasync with aiofiles.open(jsonl_path, 'r', encoding='utf-8') as f:\n    async for line in f:\n        ...\n```\n\nNote: Add aiofiles to dependencies in pyproject.toml","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-02T19:47:24.719352+01:00","updated_at":"2025-12-02T22:01:12.929594+01:00","closed_at":"2025-12-02T22:01:12.929594+01:00","close_reason":"Switched to aiofiles for async file I/O in beads_sync.py. Prevents blocking event loop on large JSONL files."}
{"id":"beadhub-d0cw","title":"No skeleton loaders in StatusPage","description":"Location: frontend/src/pages/StatusPage.tsx:247-263. While error handling exists, loading state UI is minimal. During initial load, page shows 0 values which could confuse users. Fix: add skeleton loaders or explicit loading indicators during initial fetch.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-08T18:26:00.883175+01:00","updated_at":"2025-12-13T15:28:27.707243+01:00","closed_at":"2025-12-13T14:16:39.042447+01:00"}
{"id":"beadhub-d0l2","title":"Add --update flag to bdh :init to update existing workspace","description":"Allow updating hostname, workspace_path, and role for existing workspaces.\n\nCurrent behavior: bdh :init exits early if .beadhub exists.\n\nNew behavior with --update:\n- Re-reads hostname from os.Hostname()\n- Re-reads workspace_path from os.Getwd()  \n- Optionally updates role if --role provided\n- Sends update to server (needs new UPSERT logic that overwrites instead of COALESCE-preserving)\n\nUse cases:\n1. Backfill hostname/workspace_path for old workspaces (enables gone detection)\n2. Update path after moving a worktree\n3. Update role (e.g., agent â†’ reviewer)\n\nServer change needed: Add update_mode flag to workspace upsert that changes COALESCE order for hostname/workspace_path to prefer new values.\n\nKeeps immutable: alias, workspace_id, project_id","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-22T15:24:00.099004+01:00","updated_at":"2025-12-22T16:09:47.939522+01:00","closed_at":"2025-12-22T16:09:47.939522+01:00","close_reason":"Merged to main - init --update implemented"}
{"id":"beadhub-d3h","title":"Add Redis ping check in standalone mode lifespan","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-03T09:46:19.950497+01:00","updated_at":"2025-12-03T12:05:35.412011+01:00","closed_at":"2025-12-03T12:05:35.412011+01:00"}
{"id":"beadhub-d49g","title":"Add index for deleted workspace queries","description":"Only active workspaces have an index. Admin cleanup views querying deleted workspaces need full table scan. Add: CREATE INDEX idx_workspaces_deleted ON workspaces(project_id, deleted_at) WHERE deleted_at IS NOT NULL;","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-17T08:01:51.361768+01:00","updated_at":"2025-12-17T08:01:51.361768+01:00","dependencies":[{"issue_id":"beadhub-d49g","depends_on_id":"beadhub-lmtj","type":"discovered-from","created_at":"2025-12-17T08:01:51.363077+01:00","created_by":"juanre"}]}
{"id":"beadhub-d4q","title":"Add async lock to DatabaseInfra.initialize() to prevent race condition","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-03T09:46:09.961895+01:00","updated_at":"2025-12-03T11:51:59.198833+01:00","closed_at":"2025-12-03T11:51:59.198833+01:00"}
{"id":"beadhub-d5v5","title":"Handle empty workspaces array gracefully in Layout identity init","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-13T20:34:55.092256+01:00","updated_at":"2025-12-13T20:45:03.834586+01:00","closed_at":"2025-12-13T20:45:03.834586+01:00"}
{"id":"beadhub-d63j","title":"Add authentication to /v1/bdh/command endpoint","description":"CRITICAL for Cloud multi-tenant: The /v1/bdh/command endpoint has no authentication. It creates side effects (auto-registers presence), controls access (blocks claims), and exposes project data (returns all beads_in_progress). An attacker knowing a project_key could see competitive intelligence or spam presence updates. Must add authentication - either API key (admin tier) or X-Project-ID header validation like other endpoints.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-10T10:43:04.090512+01:00","updated_at":"2025-12-13T19:24:43.265784+01:00","closed_at":"2025-12-13T19:24:43.265784+01:00","dependencies":[{"issue_id":"beadhub-d63j","depends_on_id":"beadhub-f5il","type":"discovered-from","created_at":"2025-12-10T10:43:04.092176+01:00","created_by":"juanre"}]}
{"id":"beadhub-d6gx","title":"Chat: session_id/message_id should not be timestamp-based","description":"chat.py generates session_id/message_id from datetime.now(...).timestamp() truncated to 6 decimals. Under concurrency this can collide, causing sporadic 500s on PK conflict (chat_sessions.session_id, chat_messages.message_id). Fix: use UUID (uuid4/uuid7) or ULID for both IDs; keep the existing chat_/msg_ prefixes if desired.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-13T23:11:56.84623+01:00","updated_at":"2025-12-13T23:38:16.444057+01:00","closed_at":"2025-12-13T23:38:16.444057+01:00","dependencies":[{"issue_id":"beadhub-d6gx","depends_on_id":"beadhub-ixss","type":"discovered-from","created_at":"2025-12-13T23:11:56.847483+01:00","created_by":"juanre"}]}
{"id":"beadhub-d7c7","title":"Update beadhub-mail-vs-chat.md to clarify Postgres storage","description":"Update source-of-truth/beadhub-mail-vs-chat.md line 105:\n\nCurrent (ambiguous):\n\u003e Mail: Uses the Agent Mail protocol. Messages are stored in BeadHub's database with read/ack status.\n\nChange to (explicit):\n\u003e Mail: Messages are stored permanently in Postgres with read/ack status. Unlike chat (which uses SSE for real-time delivery), mail provides a durable audit trail of async communication.\n\nFile: beadhub-sot/source-of-truth/beadhub-mail-vs-chat.md\n\nPart of epic beadhub-37yb","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T09:44:14.711535+01:00","updated_at":"2025-12-20T11:46:47.391973+01:00","closed_at":"2025-12-20T11:46:47.391973+01:00","close_reason":"Completed"}
{"id":"beadhub-d7gs","title":"Standardize on FastAPI Depends() pattern for header extraction","description":"## Problem\n\nHeader extraction mixes FastAPI dependency injection with manual extraction, creating inconsistent patterns.\n\n### Current Behavior\n\nSome routes use `Depends()`:\n```python\nasync def my_route(project_id: str = Depends(get_project_id)):\n    # project_id is automatically injected\n```\n\nOthers call functions directly:\n```python\nasync def my_route(request: Request, ...):\n    project_id = get_project_id(request)  # Manual extraction\n```\n\n### Impact\n\n- Inconsistent code patterns across routes\n- Manual approach requires passing `request` everywhere\n- Harder to test (can't easily override dependency)\n- Missing the benefits of FastAPI's dependency system\n\n### Solution\n\nStandardize on FastAPI `Depends()` everywhere:\n\n```python\n# auth.py - keep existing functions, they work as dependencies\n\n# routes/example.py\nfrom fastapi import Depends\nfrom ..auth import get_project_id, get_optional_project_id\n\n@router.get(\"/items\")\nasync def list_items(\n    project_id: str = Depends(get_project_id),  # Required\n    db: DatabaseInfra = Depends(get_db),\n):\n    # project_id already validated and extracted\n    ...\n\n@router.get(\"/public-items\")\nasync def list_public_items(\n    project_id: Optional[str] = Depends(get_optional_project_id),  # Optional\n    db: DatabaseInfra = Depends(get_db),\n):\n    ...\n```\n\n### Files to Update\n\n- All route files in `src/beadhub/routes/`\n- Audit each route for manual `request.headers.get()` or `get_project_id(request)` calls\n\n### Acceptance Criteria\n\n- [ ] All header extraction uses Depends()\n- [ ] No manual request.headers.get() for standard headers\n- [ ] Consistent pattern across all routes\n- [ ] Tests can override dependencies for isolation","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-08T12:42:22.271944+01:00","created_by":"juanre","updated_at":"2026-01-08T12:42:22.271944+01:00"}
{"id":"beadhub-dadn","title":"Backend: store hostname/cwd in Redis presence","description":"Pass hostname and cwd through to update_agent_presence() and store in Redis.\n\nFiles to modify:\n\n1. src/beadhub/presence.py - update_agent_presence():\n   - Add hostname and cwd parameters\n   - Add to fields dict stored in Redis\n\n2. src/beadhub/routes/bdh.py - bdh_command():\n   - Pass payload.hostname and payload.cwd to update_agent_presence()\n\nImplementation in presence.py:\n```python\nasync def update_agent_presence(\n    redis: Redis,\n    workspace_id: str,\n    alias: str,\n    # ... existing params ...\n    hostname: Optional[str] = None,\n    cwd: Optional[str] = None,\n    ttl_seconds: int = DEFAULT_PRESENCE_TTL_SECONDS,\n) -\u003e str:\n    # ...\n    fields = {\n        # ... existing fields ...\n        \"hostname\": hostname or \"\",\n        \"cwd\": cwd or \"\",\n    }\n```","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-13T21:09:53.622204+01:00","updated_at":"2025-12-13T21:09:53.622204+01:00","dependencies":[{"issue_id":"beadhub-dadn","depends_on_id":"beadhub-2q2d","type":"blocks","created_at":"2025-12-13T21:10:02.808901+01:00","created_by":"juanre","metadata":"{}"}]}
{"id":"beadhub-dcjm","title":"Update tests for Postgres-based messages","description":"Update test_messages.py to use Postgres fixtures instead of Redis mocks.\n\nChanges needed:\n1. Use db_manager fixture instead of redis fixture\n2. Remove Redis-specific test setup\n3. Add tests for message persistence (no TTL expiry)\n4. Verify FK constraints work (invalid workspace_id should fail)\n\nPart of epic beadhub-37yb","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T09:44:14.831758+01:00","updated_at":"2025-12-20T11:53:11.189654+01:00","closed_at":"2025-12-20T11:53:11.189654+01:00","close_reason":"Completed","dependencies":[{"issue_id":"beadhub-dcjm","depends_on_id":"beadhub-f0kk","type":"blocks","created_at":"2025-12-20T09:45:40.959428+01:00","created_by":"juanre"}]}
{"id":"beadhub-ddsf","title":"Remove session lifecycle code from chat.py","description":"Remove dead code related to ephemeral session model:\n\n1. Remove cleanup_on_initiator_disconnect function\n2. Remove _find_existing_session (replaced by DB constraint)\n3. Remove status checks (waiting/active/ended)\n4. Remove TTL/expires_at logic\n5. Remove pair_key functions and usage\n6. Remove join_session endpoint (no longer needed - just send messages)\n7. Remove end_session endpoint (sessions don't end)\n\nKeep: send_message, stream_session, get_pending, get_session_messages","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T20:25:32.104183+01:00","updated_at":"2025-12-14T00:23:02.105767+01:00","closed_at":"2025-12-14T00:23:02.105767+01:00","dependencies":[{"issue_id":"beadhub-ddsf","depends_on_id":"beadhub-ixss","type":"blocks","created_at":"2025-12-13T20:26:14.713505+01:00","created_by":"juanre"}]}
{"id":"beadhub-dehn","title":"Migrate test_cross_repo_messaging.py to db_infra fixture","description":"Convert from app_with_test_db to async tests using db_infra fixture.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-10T10:55:17.169828+01:00","created_by":"juanre","updated_at":"2026-01-10T12:01:17.280905+01:00","closed_at":"2026-01-10T12:01:17.280905+01:00","close_reason":"Converted 10 tests to use db_infra fixture - all pass","dependencies":[{"issue_id":"beadhub-dehn","depends_on_id":"beadhub-7wpr","type":"parent-child","created_at":"2026-01-10T10:55:50.238874+01:00","created_by":"juanre"}]}
{"id":"beadhub-dge7","title":"Implement role-based alias naming: {role}-NN","description":"## Problem\nCurrent alias naming is inconsistent (e.g., 'claude-main', 'backend-bot', 'maria-claude'). The program field already captures 'claude' vs 'aider', so aliases like 'claude-X' are redundant.\n\n## Solution\nNew naming scheme: `{role}-{NN}` (e.g., 'programmer-01', 'reviewer-02')\n- Server generates suggestions based on existing aliases in the project\n- Client can override but server always validates uniqueness\n- bdh never deals with project_id directly (tenant isolation)\n\n## Implementation Tasks\n1. Server: Add `POST /v1/workspaces/suggest-alias` endpoint\n   - Takes role, returns suggested alias (e.g., 'programmer-03')\n   - Queries existing aliases matching `{role}-*` pattern\n2. Server: Modify workspace registration to accept role as primary field\n3. bdh :init: Interactive prompts for role and alias in TTY mode\n   - Default role from BEADHUB_ROLE env var, fallback to 'agent'\n   - Show suggested alias, allow override\n4. Update .beadhub config file format\n\n## Tenant Isolation\nServer derives project from context (API key in SaaS, origin_url lookup in OSS).\nbdh never passes project_id explicitly.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-21T16:41:50.870086+01:00","updated_at":"2025-12-21T16:55:44.301635+01:00","closed_at":"2025-12-21T16:55:44.301635+01:00","close_reason":"Implemented role-based alias naming. Server: POST /v1/workspaces/suggest-alias endpoint. CLI: Interactive role/alias prompts in bdh :init. All 540 tests pass."}
{"id":"beadhub-did","title":"Defense-in-depth: validate repo paths in beads sync against allowed directories","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-06T21:34:30.046166+01:00","updated_at":"2025-12-08T09:55:14.204132+01:00","closed_at":"2025-12-08T09:55:14.204132+01:00"}
{"id":"beadhub-dijh","title":"Dashboard repo filter fails: REPO_NAME_PATTERN rejects dots in canonical origin format","description":"When filtering beads by repo (e.g. github.com/juanre/beadhub-cloud), the API returns 422 'Invalid repository name' because REPO_NAME_PATTERN in beads_sync.py:25 rejects dots. The pattern only allows alphanumeric + hyphen/underscore + one slash. This was designed for simple 'org/repo' format but workspaces use full canonical URLs.\n\nFiles:\n- src/beadhub/beads_sync.py:22-27 - REPO_NAME_PATTERN regex\n- src/beadhub/routes/beads.py:488-492 - Validation check\n\nScreenshot shows: 'Failed to load beads: Invalid repository name: github.com/juanre/beadhub-cloud'","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-10T09:04:10.037549+01:00","created_by":"juanre","updated_at":"2026-01-10T09:23:27.11329+01:00","closed_at":"2026-01-10T09:23:27.11329+01:00","close_reason":"Resolved as part of beadhub-v8px: replaced REPO_NAME_PATTERN with CANONICAL_ORIGIN_PATTERN which allows dots in domain names (e.g. github.com).","dependencies":[{"issue_id":"beadhub-dijh","depends_on_id":"beadhub-v8px","type":"blocks","created_at":"2026-01-10T09:06:11.926745+01:00","created_by":"juanre"}]}
{"id":"beadhub-dils","title":"Cloud: Owner/admin authorization for repo deletion","description":"Add authorization check to DELETE /api/v1/projects/{id}/repos/{repo_id}. Only project owner or members with admin role can delete repos. Editors and viewers get 403 Forbidden.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T15:58:06.715744+01:00","updated_at":"2025-12-21T18:08:21.590678+01:00","closed_at":"2025-12-21T18:08:21.590678+01:00","close_reason":"Implemented Cloud repos endpoints with owner/admin authorization","dependencies":[{"issue_id":"beadhub-dils","depends_on_id":"beadhub-1thq","type":"blocks","created_at":"2025-12-21T15:58:36.100322+01:00","created_by":"juanre"},{"issue_id":"beadhub-dils","depends_on_id":"beadhub-ufw9","type":"blocks","created_at":"2025-12-21T15:58:36.390922+01:00","created_by":"juanre"}]}
{"id":"beadhub-dir4","title":"Pending chat shows last_from as yourself when you sent the last message","description":"In chat.py get_pending(), the query for last_message/last_from gets the absolute last message in the session. But if YOU sent the last message, last_from will be you, which is confusing ('MESSAGES: from alice-coordinator' when you ARE alice-coordinator). Fix: add 'WHERE from_workspace \\!= $1' to the LATERAL join at line 671 to only show the last message from someone else.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-21T20:32:08.306646+01:00","updated_at":"2025-12-21T20:34:40.500803+01:00","closed_at":"2025-12-21T20:34:40.500803+01:00","close_reason":"Fixed LATERAL join to filter last message by from_workspace != current"}
{"id":"beadhub-dl7","title":"Rename llmring_api to beadhub_cloud throughout codebase","description":"Rename backend/src/llmring_api to backend/src/beadhub_cloud. Update all imports, pyproject.toml package name, test imports. Use find/sed for systematic replacement.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-03T08:20:54.480488+01:00","updated_at":"2025-12-03T08:31:15.24996+01:00","closed_at":"2025-12-03T08:31:15.24996+01:00","close_reason":"Renamed llmring_api to beadhub_cloud throughout codebase: directory, imports, config, docs, emails, schemas","dependencies":[{"issue_id":"beadhub-dl7","depends_on_id":"beadhub-fon","type":"blocks","created_at":"2025-12-03T08:21:01.056704+01:00","created_by":"juanre"}]}
{"id":"beadhub-dlpn","title":"Perf: add reproducible benchmark for /v1/workspaces and bdh ready/:who latency","description":"Add a reproducible way to detect performance regressions in coordination endpoints/commands.\n\nWhy:\n- The recent regression likely came from moving apex computation into `/v1/workspaces` and adding extra Redis operations.\n- We need a harness that makes it obvious when workspaces/claims scale poorly.\n\nImplementation outline:\n1) Add a script (or pytest benchmark) that:\n   - seeds a test DB with configurable N workspaces and M claims per workspace\n   - seeds beads_issues with a parent chain so apex exists\n   - measures the runtime of `GET /v1/workspaces` (and optionally `bdh ready` calling it)\n2) Define a non-flaky assertion:\n   - Prefer algorithmic assertions (no recursion, bounded queries) over strict time limits.\n   - Examples: ensure the endpoint executes a constant number of SQL queries; ensure it does not use `WITH RECURSIVE` (string check is a last resort).\n3) Document how to run the benchmark locally and what a â€œgoodâ€ output looks like.\n\nFiles:\n- likely `scripts/` + `tests/`\n\nNote:\n- If we canâ€™t do stable time-based checks in CI, still ship the script for local profiling.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T13:56:11.811542+01:00","updated_at":"2025-12-20T19:35:21.282052+01:00","closed_at":"2025-12-20T19:35:21.282052+01:00","close_reason":"Add workspaces benchmark + query guardrail to prevent recursive apex regressions","dependencies":[{"issue_id":"beadhub-dlpn","depends_on_id":"beadhub-o9h7","type":"parent-child","created_at":"2025-12-20T13:56:11.81265+01:00","created_by":"juanre"}]}
{"id":"beadhub-dmtk","title":"Add notification badges to Messages/Chat/Escalations in sidebar","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-09T22:46:45.939994+01:00","created_by":"juanre","updated_at":"2026-01-09T23:53:51.315465+01:00","closed_at":"2026-01-09T23:53:51.315465+01:00","close_reason":"Implemented notification badges showing unread mail count and pending chat count in sidebar navigation"}
{"id":"beadhub-dny","title":"Add POST /v1/beads/upload-jsonl endpoint accepting raw JSONL","description":"Accepts raw .beads/issues.jsonl content directly. Server parses JSONL (newline-delimited JSON) and converts to array for sync. Repo/branch passed via headers or query params. Enables shell script wrapper without jq dependency.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T12:03:48.603129+01:00","updated_at":"2025-12-07T17:48:35.552813+01:00","closed_at":"2025-12-07T17:48:35.552813+01:00"}
{"id":"beadhub-doq5","title":"MCP Agent Mail compatibility (drop-in subset)","description":"Make BeadHub closer to a drop-in host for MCP Agent Mail clients (per ../other/mcp_agent_mail), or explicitly scope what we support.\\n\\nScope (proposed):\\n- Implement MCP discovery endpoints (tools/list, resources/list/read) required by typical MCP clients and used heavily by mcp_agent_mail.\\n- Implement Agent Mail-compatible tool argument/return shapes for core mail workflows (project_key+agent_name addressing).\\n- Keep BeadHub-native workspace_id workflows working; add compatibility as an adapter layer.\\n\\nNon-goal (unless we decide otherwise): replicate the full Git-backed archival/storage model and UI from mcp_agent_mail.","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-06T19:15:21.389249Z","created_by":"juanre","updated_at":"2026-01-08T19:59:50.772032+01:00","labels":["component:agent-mail","component:mcp","phase:oss"]}
{"id":"beadhub-doq5.1","title":"MCP: implement tools/list + resources/list/read","description":"BeadHub currently supports only JSON-RPC tools/call at POST /mcp. Implement the rest of the MCP surface needed for discovery:\\n- tools/list\\n- resources/list\\n- resources/read\\n\\nPrioritize enough to support mcp_agent_mail clients (which expect resource://inbox/... etc).\\n\\nAcceptance:\\n- A generic MCP client can discover BeadHub tools via tools/list\\n- A generic MCP client can read resources via resources/list/read\\n- Existing tools/call behavior unchanged","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-06T19:15:30.767871Z","created_by":"juanre","updated_at":"2026-01-06T19:15:30.767871Z","labels":["component:agent-mail","component:mcp"],"dependencies":[{"issue_id":"beadhub-doq5.1","depends_on_id":"beadhub-doq5","type":"parent-child","created_at":"2026-01-06T19:15:30.768521Z","created_by":"juanre"}]}
{"id":"beadhub-doq5.2","title":"MCP: Agent Mail-compatible messaging adapter","description":"Implement Agent Mail-style tool signatures for messaging (project_key + agent_name addressing), matching mcp_agent_mail expectations:\\n- send_message(project_key, sender_name, to[], subject, body_md, ... )\\n- fetch_inbox(project_key, agent_name, ...)\\n- acknowledge_message(project_key, agent_name, message_id)\\n- mark_message_read(...) and reply_message(...) (at least stubs or full support)\\n\\nApproach: adapt to BeadHub's workspace_id model via src/beadhub/agent_mail_compat/identity.py resolution, and persist enough metadata to map back to Agent Mail fields.\\n\\nAcceptance:\\n- Agent Mail-style send/fetch/ack works end-to-end for basic flows\\n- BeadHub-native messaging remains intact","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-06T19:15:37.482702Z","created_by":"juanre","updated_at":"2026-01-06T19:15:37.482702Z","labels":["component:agent-mail","component:mcp"],"dependencies":[{"issue_id":"beadhub-doq5.2","depends_on_id":"beadhub-doq5","type":"parent-child","created_at":"2026-01-06T19:15:37.483592Z","created_by":"juanre"}]}
{"id":"beadhub-doq5.3","title":"MCP: expose ensure_project tool (Agent Mail signature)","description":"We have HTTP POST /v1/projects/ensure but no MCP tool. Add ensure_project(human_key|project_key) style tool for compatibility with mcp_agent_mail clients.\\n\\nAlso re-check old bead beadhub-zol (marked closed) and either supersede it or reopen with accurate status.\\n\\nAcceptance:\\n- Tool available via MCP and creates/returns project id/slug\\n- Does not break Cloud tenant isolation","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-06T19:15:42.187144Z","created_by":"juanre","updated_at":"2026-01-06T19:15:42.187144Z","labels":["component:agent-mail","component:mcp"],"dependencies":[{"issue_id":"beadhub-doq5.3","depends_on_id":"beadhub-doq5","type":"parent-child","created_at":"2026-01-06T19:15:42.187833Z","created_by":"juanre"}]}
{"id":"beadhub-dpav","title":"Add Error Boundaries to prevent full app crashes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T15:32:33.691804+01:00","updated_at":"2025-12-13T12:27:06.336452+01:00","closed_at":"2025-12-13T10:58:15.798138+01:00","dependencies":[{"issue_id":"beadhub-dpav","depends_on_id":"beadhub-7r4","type":"discovered-from","created_at":"2025-12-08T15:32:33.693264+01:00","created_by":"juanre"}]}
{"id":"beadhub-ds0","title":"Write tenant isolation integration tests","description":"Test that project A cannot see project B issues, same repo name in different projects works, uploads require project_id","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T22:29:09.409463+01:00","updated_at":"2025-12-07T22:57:46.186341+01:00","closed_at":"2025-12-07T22:57:46.186341+01:00","dependencies":[{"issue_id":"beadhub-ds0","depends_on_id":"beadhub-4mj","type":"discovered-from","created_at":"2025-12-07T22:29:09.41047+01:00","created_by":"juanre"}]}
{"id":"beadhub-dssf","title":"Claims model: store apex on bead_claims at write-time; remove read-time recursive apex computation","description":"Context\n- In the current merged baseline (`be`), `/v1/workspaces` computes per-claim apex using a recursive CTE over `beads.beads_issues` (walking `parent_id`). This scales poorly (superlinear with claims) and was the observed bottleneck at large workspace/claim counts.\n- We have not shipped. We want a clean, scalable contract where apex is fast to look up for every claim.\n\nGoal\n- Make claim apex lookup O(1) at read time by storing apex fields directly on `server.bead_claims` rows when claims are created/updated. Remove the read-time recursive apex computation from workspaces endpoints entirely.\n\nDesign\n- Extend `server.bead_claims` with apex reference columns:\n  - `apex_bead_id` (TEXT)\n  - `apex_repo_name` (TEXT)\n  - `apex_branch` (TEXT)\n- Optionally also store `apex_issue_type`/`apex_title` snapshots only if needed; preferred is to join titles/types from beads_issues at read time because it is a single-row lookup per claim and stays fresh.\n\nWrite-time computation\n- When a claim is created (bdh command / sync), compute apex once using the known bead_id and the beads_issues parent chain.\n- Store apex_{bead_id,repo_name,branch} on the claim row.\n- Provide a backfill job for existing claims (invoked during sync or a dedicated maintenance endpoint) so the schema remains consistent with no stale NULL apex fields.\n\nRead-time behavior\n- Workspaces endpoints must NOT use recursive SQL to compute apex. Instead:\n  - read apex fields from claim rows\n  - join `beads.beads_issues` (latest synced) only to fetch titles/types for the claim bead and the apex bead for display.\n\nIndexes\n- Ensure `bead_claims` has an index supporting workspace_id IN (...) + claimed_at ordering (composite recommended).\n\nValidation\n- Tests:\n  - claim creation stores apex for root and subtask beads\n  - backfill populates missing apex fields\n  - workspaces endpoints contain no `WITH RECURSIVE` and return apex from stored columns\n- Benchmark:\n  - 5k workspaces / 25k claims: `/v1/workspaces/team?limit=15` stays fast and response bounded.\n\nDone when\n- Apex is always available (or intentionally null when bead missing) without recursion in request handlers.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-21T13:34:30.055291+01:00","updated_at":"2025-12-21T16:36:39.669122+01:00","closed_at":"2025-12-21T16:36:39.669122+01:00","close_reason":"Add apex backfill coverage","dependencies":[{"issue_id":"beadhub-dssf","depends_on_id":"beadhub-s0qa","type":"discovered-from","created_at":"2025-12-21T13:34:30.056677+01:00","created_by":"juanre"}]}
{"id":"beadhub-dsxj","title":"Bug: /v1/reservations served by dashboard HTML (breaks bdh locks)","description":"Bug: `/v1/reservations` is returning the dashboard HTML instead of JSON, breaking bdh lock listing and auto-reserve.\n\nImpact\n- `bdh ready` prints: \"Auto-reserve: unable to list current locks (decoding response: invalid character '\u003c'...)\"\n- `bdh :who` fails because it attempts to call `GET /v1/reservations` to show locks.\n\nRepro\n- `curl -i http://localhost:8000/v1/reservations?workspace_id=\u003cuuid\u003e`\n  - Observed: 200 OK with `content-type: text/html` and dashboard index.html.\n\nLikely cause\n- Dashboard SPA fallback route is intercepting `/v1/*` paths.\n  - In FastAPI, a catch-all route like `/{path:path}` included before API routers can capture requests.\n  - Check router inclusion order in `src/beadhub/api.py` and any wildcard routes in `src/beadhub/routes/dashboard.py`.\n\nExpected\n- `/v1/reservations` must be served by `src/beadhub/routes/reservations.py` (JSON API) and never by dashboard.\n\nFix sketch\n- Ensure API routers are included before dashboard wildcard fallback OR restrict dashboard fallback to non-`/v1/` paths.\n- Add a regression test that `GET /v1/reservations` returns JSON (or at least content-type application/json).\n\n","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-02T13:43:41.148431Z","created_by":"juanre","updated_at":"2026-01-02T16:35:48.590388Z","closed_at":"2026-01-02T16:35:48.590388Z","close_reason":"Stale pycache - endpoints work after clearing __pycache__ and restarting server. Not a code bug.","dependencies":[{"issue_id":"beadhub-dsxj","depends_on_id":"beadhub-1tqa","type":"discovered-from","created_at":"2026-01-02T13:43:41.150966Z","created_by":"juanre"}]}
{"id":"beadhub-dtcl","title":"Real-time chat between agents","description":"# Real-time Chat Between Agents\n\n## Problem\nCurrent messaging is asynchronous (email-like):\n1. Agent A sends message via `bdh :send`\n2. Agent A continues working\n3. Agent B only sees message when running next bdh command\n4. No way to have quick back-and-forth synchronization\n\nThis causes coordination delays when agents need to clarify something quickly.\n\n## Solution\nBlocking chat commands using Server-Sent Events (SSE):\n- `bdh :chat \u003cagent\u003e \"message\"` sends and BLOCKS waiting for response\n- Both agents connect to same SSE stream\n- Messages flow in real-time while both are engaged\n- Graceful timeout with fallback to async message\n\n## User Flow\n\n### Initiating Chat\n```bash\nA1: bdh :chat agent-p2 \"Is project_id nullable?\"\n# [chat] agent-p2 last active 5s ago âœ“\n# [chat] Waiting for agent-p2 to join... (60s timeout)\n# [chat] agent-p2 joined\n# [chat] agent-p2: No, required. See schema.py:42\n```\n\n### Receiving Chat Request\nWhen A2 runs any bdh command while A1 is waiting:\n```\nðŸ”´ CHAT REQUEST from agent-p1 (45s remaining)\n   \"Is project_id nullable?\"\n   â†’ Join: bdh :chat agent-p1\n```\n\n### Responding\nEach response is a new command (agents can't type into running commands):\n```bash\nA2: bdh :chat agent-p1 \"No, required. See schema.py:42\"\n# [chat] Message sent\n# [chat] Waiting for agent-p1's response...\n```\n\n## Engagement Triggers\nSince agents can't listen passively, chat requests are noticed via:\n1. **Tool call hooks**: Configured to check for urgent chat requests\n2. **bdh output**: Chat notifications shown prominently in all bdh commands\n3. **Human prompt**: Human tells agent \"agent-p1 wants to chat\"\n\n## Technical Design\n\n### API Endpoints\n- POST /v1/chat/sessions - Create/join chat session\n- POST /v1/chat/sessions/{id}/join - Join existing session\n- POST /v1/chat/sessions/{id}/messages - Send message\n- GET /v1/chat/sessions/{id}/stream - SSE stream for messages\n- POST /v1/chat/sessions/{id}/end - End session\n- GET /v1/chat/pending - Get pending chat requests\n\n### Data Model (Redis)\n- `chat:session:{id}` - Session metadata (TTL 5 min)\n- `chat:messages:{id}` - Message list\n- `chat:pending:{workspace}` - Set of pending session IDs\n\n### CLI Commands\n- `bdh :chat \u003cagent\u003e \"message\"` - Start/continue chat\n- `bdh :chat \u003cagent\u003e --end \"bye\"` - End chat session\n- `bdh :chat --pending` - Show pending requests\n\n## Spec Document\nSee: beadhub-sot/source-of-truth/beadhub-chat-spec.md\n\n## Implementation Phases\n1. Core API (sessions, messages, SSE)\n2. CLI commands (bdh :chat)\n3. Notification integration (show in bdh output)\n4. Presence-aware initiation\n5. Timeout and async fallback","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-10T20:17:09.096719+01:00","updated_at":"2025-12-20T09:38:12.62819+01:00","closed_at":"2025-12-20T09:38:12.62819+01:00","close_reason":"Real-time chat feature complete: sessions API, messages API, SSE streaming, bdh :chat CLI, pending notifications, and presence checks all working. Timeout fallback to inbox was rejected as unnecessary - messages already persist in chat pending.","dependencies":[{"issue_id":"beadhub-dtcl","depends_on_id":"beadhub-w143","type":"blocks","created_at":"2025-12-10T20:37:53.421571+01:00","created_by":"juanre"},{"issue_id":"beadhub-dtcl","depends_on_id":"beadhub-fh23","type":"blocks","created_at":"2025-12-10T20:37:53.477144+01:00","created_by":"juanre"},{"issue_id":"beadhub-dtcl","depends_on_id":"beadhub-b37m","type":"blocks","created_at":"2025-12-10T20:37:53.534577+01:00","created_by":"juanre"},{"issue_id":"beadhub-dtcl","depends_on_id":"beadhub-q7c5","type":"blocks","created_at":"2025-12-10T20:37:53.590745+01:00","created_by":"juanre"},{"issue_id":"beadhub-dtcl","depends_on_id":"beadhub-0ari","type":"blocks","created_at":"2025-12-10T20:37:53.647728+01:00","created_by":"juanre"},{"issue_id":"beadhub-dtcl","depends_on_id":"beadhub-3vrt","type":"blocks","created_at":"2025-12-10T20:37:53.704093+01:00","created_by":"juanre"},{"issue_id":"beadhub-dtcl","depends_on_id":"beadhub-8n28","type":"blocks","created_at":"2025-12-10T20:37:53.762245+01:00","created_by":"juanre"}]}
{"id":"beadhub-e0am","title":"Increase success message display time (1500ms too fast)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T20:35:19.36572+01:00","updated_at":"2025-12-13T23:34:05.057786+01:00","closed_at":"2025-12-13T23:34:05.057786+01:00"}
{"id":"beadhub-e14","title":"Create GitHub repo and push beadhub-cloud","description":"Create private GitHub repo juanre/beadhub-cloud. Push initial commit with all setup complete. Add README explaining this is the SaaS layer for beadhub OSS.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-03T08:21:33.89992+01:00","updated_at":"2025-12-03T08:43:34.071288+01:00","closed_at":"2025-12-03T08:43:34.071288+01:00","close_reason":"Tracked in beadhub-cloud-ay1","dependencies":[{"issue_id":"beadhub-e14","depends_on_id":"beadhub-83t","type":"blocks","created_at":"2025-12-03T08:21:38.682509+01:00","created_by":"juanre"}]}
{"id":"beadhub-e1l1","title":"Stop docs/help from suggesting bd","description":"Ensure repo guidance always says to use `bdh` (not `bd`) and make `bdh \u003ccmd\u003e --help` display `bdh` in Usage/examples for passthrough commands.","status":"closed","priority":3,"issue_type":"task","assignee":"juanre","created_at":"2026-01-03T11:25:35.642838Z","created_by":"juanre","updated_at":"2026-01-03T11:26:01.553974Z","closed_at":"2026-01-03T11:26:01.553974Z","close_reason":"done"}
{"id":"beadhub-e2d5","title":"Allow bdh :send to use agent name instead of workspace UUID","description":"Current: bdh :send b4b65690-be26-4200-8f68-6dbe29caf626 'msg' - impossible to use. Better: bdh :send agent-p1 'msg' - lookup workspace by agent_name in project. Also add 'bdh :who' to list active workspaces.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-10T18:52:03.601548+01:00","updated_at":"2025-12-10T19:42:20.789536+01:00","closed_at":"2025-12-10T19:42:20.789536+01:00"}
{"id":"beadhub-e2s","title":"Add CORS configuration to FastAPI app","description":"beadhub api.py has no explicit CORS policy. Add CORSMiddleware with configurable allowed origins via BEADHUB_CORS_ORIGINS env var.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T22:17:23.420385+01:00","updated_at":"2025-12-08T08:34:25.802638+01:00","closed_at":"2025-12-08T08:34:25.802638+01:00"}
{"id":"beadhub-e3dy","title":"Server: make presence updates O(1) without Redis HGET for missing role","description":"Fix a hot-path latency regression: when clients omit `role`, `update_agent_presence` currently performs a Redis `HGET` to preserve the existing role.\n\nWhy:\n- `POST /v1/bdh/command` calls presence refresh for every bdh invocation.\n- An extra Redis round-trip per command adds noticeable latency and reduces throughput.\n\nImplementation outline (Python server):\n1) Change `update_agent_presence` so that when `role is None` it does NOT read Redis and does NOT set the `role` field in the presence hash.\n   - This preserves the previous value automatically.\n   - If we need to support clearing role, define an explicit mechanism (e.g., `role==\"\"` means clear) and document it.\n2) Audit all call sites (`routes/bdh.py`, `routes/agents.py`, `routes/mcp.py`) to ensure they pass `role` when available and rely on preservation when not.\n3) Add/restore a focused test verifying no Redis read is performed when role is absent (or simulate via a fake Redis and ensure HGET not called).\n\nFiles:\n- `src/beadhub/presence.py`\n- call sites in `src/beadhub/routes/*.py`\n\nExpected outcome:\n- Presence update becomes a single HSET + index SADDs, no extra reads in the default case.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T13:54:39.580172+01:00","updated_at":"2025-12-20T16:02:58.054086+01:00","closed_at":"2025-12-20T16:02:58.054086+01:00","close_reason":"Remove Redis HGET on missing role; preserve by omitting role field","dependencies":[{"issue_id":"beadhub-e3dy","depends_on_id":"beadhub-o9h7","type":"parent-child","created_at":"2025-12-20T13:54:39.581375+01:00","created_by":"juanre"}]}
{"id":"beadhub-e4vl","title":"Docs: update SOT for Workspaces API vNext + roles + apex","description":"Context\\n- The SOT specs still describe /v1/workspaces as an unbounded active-workspaces list and do not cover /v1/workspaces/team, apex-on-claims, or role usage in coordination outputs.\\n- Users do not see README.md; SOT docs must be self-contained.\\n\\nWork\\n- Update beadhub-specifications.md to reflect registry vs team-status endpoints, new params (include_claims, include_presence, limit, only_with_claims, always_include_workspace_id), and role/apex fields in responses.\\n- Update beadhub-bdh-design.md to show new endpoints, role field usage, and team-status logic for bdh ready/:who.\\n- Update data-model.md for apex-on-claims and role column (if not already aligned).\\n- Update beadhub-workspace-roles.md to match implementation (limits, semantics, propagation).\\n\\nHow to verify\\n- Doc changes align with implemented API; examples show bounded responses and role presence; no references to README for required info.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T15:01:46.418769+01:00","updated_at":"2025-12-21T16:15:52.637956+01:00","closed_at":"2025-12-21T16:15:52.637956+01:00","close_reason":"Update SOT for Workspaces API vNext + roles + apex","dependencies":[{"issue_id":"beadhub-e4vl","depends_on_id":"beadhub-o9h7","type":"discovered-from","created_at":"2025-12-21T15:01:46.420121+01:00","created_by":"juanre"}]}
{"id":"beadhub-e6e1","title":"test_policies.py: 25 tests failing with KeyError project_id","status":"closed","priority":1,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-01-16T18:28:41.06976+01:00","created_by":"Juan Reyero","updated_at":"2026-01-17T13:32:24.001514+01:00","closed_at":"2026-01-17T13:32:24.001514+01:00","close_reason":"Tests now pass - appears to have been fixed in v2kg work","dependencies":[{"issue_id":"beadhub-e6e1","depends_on_id":"beadhub-v2kg.10","type":"discovered-from","created_at":"2026-01-16T18:28:41.070663+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-e7z8","title":"Spec/implementation mismatch: human_name required in spec but optional in code","description":"Location: beadhub-specifications.md line 98-99 says human_name is Required. But routes/agents.py and presence.py treat it as optional (human_name=None is allowed). Dashboard filtering by human_name won't work reliably if agents don't register with it. Fix: Either make human_name required in the API request validation, or update the spec to say Optional.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-09T19:54:41.677086+01:00","updated_at":"2025-12-09T19:54:41.677086+01:00"}
{"id":"beadhub-ebki","title":"Add optimistic UI update for workspace deletion","description":"Frontend delete mutation invalidates queries but doesn't optimistically update UI. Workspace card remains visible until refetch completes, feels laggy. Add onMutate handler to immediately remove workspace from cache, with rollback on error.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-17T08:02:06.280772+01:00","updated_at":"2025-12-17T08:02:06.280772+01:00","dependencies":[{"issue_id":"beadhub-ebki","depends_on_id":"beadhub-lmtj","type":"discovered-from","created_at":"2025-12-17T08:02:06.281671+01:00","created_by":"juanre"}]}
{"id":"beadhub-efyp","title":"Frontend store mixes UI, filter, and context state","description":"Location: frontend/src/hooks/useStore.ts. Global Zustand store mixes: UI state (darkMode), filter state (projectKeyFilter, repoFilter, workspaceId), context state (projectId). These have different lifecycles and change frequencies. Fix: split into separate stores or use React Context for rarely-changing workspace/project IDs.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-08T18:26:00.704857+01:00","updated_at":"2025-12-08T18:26:00.704857+01:00"}
{"id":"beadhub-ehpp","title":"Multi-claim retest A","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-05T17:58:09.676116Z","created_by":"juanre","updated_at":"2026-01-05T17:58:30.631754Z","closed_at":"2026-01-05T17:58:30.631754Z","close_reason":"Testing multi-close fix"}
{"id":"beadhub-el1r","title":"Add unit tests for _compute_participant_hash function","description":"Add unit tests for the _compute_participant_hash() function in chat.py:\n\nTest cases needed:\n- Less than 2 participants raises ValueError\n- Duplicate participants raises ValueError  \n- Different orderings produce same hash (order independence)\n- Empty list raises ValueError\n- Single participant raises ValueError\n\nDiscovered during code review of beadhub-xthe.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T21:14:41.458725+01:00","updated_at":"2025-12-13T21:14:41.458725+01:00"}
{"id":"beadhub-em47","title":"Policy creation UX: no feedback after creating new version","description":"After creating a new policy version, dialog closes and user is left on 'Active Policy' tab showing the OLD version. No indication the new version was created. User must manually navigate to History tab to find and activate. Fix: auto-switch to History tab + show success banner with 'Activate Now' action.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-04T10:47:59.320773Z","created_by":"juanre","updated_at":"2026-01-04T11:10:20.488852Z","closed_at":"2026-01-04T11:10:20.488852Z","close_reason":"Fixed in PoliciesPage.tsx"}
{"id":"beadhub-eng","title":"Add branch column to beads_issues table","description":"Add branch column to beads_issues table. Edit migration 002_repo_id.sql to add 'branch' column and update unique constraint from (repo_name, bead_id) to (repo_name, branch, bead_id). Also update beads_sync.py and routes/beads.py to handle branch parameter in sync operations and queries.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T22:51:49.009075+01:00","updated_at":"2025-12-06T23:12:44.533248+01:00","closed_at":"2025-12-06T23:12:44.533248+01:00"}
{"id":"beadhub-enon","title":"Add repo filter to reservations, escalations, and status endpoints","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-08T16:52:35.326249+01:00","updated_at":"2025-12-08T16:55:24.455795+01:00","closed_at":"2025-12-08T16:55:24.455795+01:00"}
{"id":"beadhub-eof8","title":"Show pending chat notifications in bdh output","description":"Modify bdh wrapper to check for pending chats and display prominently:\n\nAfter every command response, if pending chats exist:\n\n\nCall GET /v1/chat/pending to check.\n\nPart of epic beadhub-dtcl","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T20:30:23.055482+01:00","updated_at":"2025-12-10T20:35:03.961407+01:00","closed_at":"2025-12-10T20:35:03.961407+01:00","dependencies":[{"issue_id":"beadhub-eof8","depends_on_id":"beadhub-8kfc","type":"blocks","created_at":"2025-12-10T20:30:43.809596+01:00","created_by":"juanre"}]}
{"id":"beadhub-eq30","title":"Make /v1/init truly atomic (transactional)","description":"Problem\n- /v1/init claims it is \"atomic\" (creates project/repo/workspace/api_key in one call), but it performs multiple DB writes without a DB transaction.\n- If any step fails mid-flow (unique constraint, transient DB error, bug), partial state can be left behind (e.g., project+repo created but workspace/api_key missing, or workspace created but API key insert failed).\n\nImpact\n- Retries can behave strangely (alias collisions, unexpected existing repos/projects).\n- Operators see confusing partial objects in the DB and may need manual cleanup.\n- The endpoint contract/documentation is misleading.","design":"Where\n- src/beadhub/routes/init.py:init_workspace (docstring + implementation).\n\nApproach\n- Wrap the full init mutation sequence in a single async transaction: async with server_db.transaction(): ...\n- Keep rate limiting and input parsing outside the transaction.\n- Ensure the transaction includes: ensure/create project, ensure/create repo, workspace creation/upsert, and api_keys insert.\n- If any operation cannot be transactional, update docs to remove \"atomic\" and document actual guarantees.","acceptance_criteria":"- POST /v1/init either creates all intended rows (project/repo/workspace/api_key) or creates none (no partial state) when an error occurs.\n- Add a test that forces an init failure mid-transaction (e.g., provoke a constraint violation during workspace creation or api_key insertion) and assert that the earlier rows are rolled back.\n- Documentation/comments for /v1/init match the implemented behavior.","status":"tombstone","priority":2,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-01-18T07:22:45.33328+01:00","created_by":"Juan Reyero","updated_at":"2026-01-18T07:30:11.3826+01:00","close_reason":"Duplicate of beadhub-zutx (existing /v1/init atomicity issue)","labels":["api","db","oss"],"deleted_at":"2026-01-18T07:30:11.3826+01:00","deleted_by":"batch delete","delete_reason":"batch delete","original_type":"bug"}
{"id":"beadhub-eqd9","title":"Test bead for double-claim scenario","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T15:56:54.467594+01:00","updated_at":"2025-12-13T19:09:48.85325+01:00","closed_at":"2025-12-13T19:09:48.85325+01:00"}
{"id":"beadhub-esm","title":"Create beadhub-cloud repo from llmring-api template","description":"Set up beadhub-cloud as a private SaaS layer that wraps beadhub OSS core. Use llmring-api as template since it has the multi-tenancy auth infrastructure we need.","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-03T08:20:31.475809+01:00","updated_at":"2025-12-03T08:41:43.2562+01:00","closed_at":"2025-12-03T08:41:43.2562+01:00","close_reason":"beadhub-cloud created from llmring-api template with all renames"}
{"id":"beadhub-ewdb","title":"Remove old mail commands (:send, :inbox, :ack)","description":"Remove the legacy mail commands that are being replaced by the unified :mail command.\n\n**Files to delete:**\n- bdh/internal/commands/send.go\n- bdh/internal/commands/send_test.go\n- bdh/internal/commands/inbox.go\n- bdh/internal/commands/inbox_test.go\n- bdh/internal/commands/ack.go\n- bdh/internal/commands/ack_test.go\n\n**Files to update:**\n- bdh/internal/commands/root.go - remove AddCommand calls for sendCmd, inboxCmd, ackCmd\n\n**Verification:**\n- `bdh :send` should error with \"unknown command\"\n- `bdh :inbox` should error with \"unknown command\"\n- `bdh :ack` should error with \"unknown command\"\n- `bdh :mail --send`, `bdh :mail --inbox`, `bdh :mail --ack` should work\n\nThis task depends on the :mail command being fully implemented and tested.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T14:01:55.530679+01:00","created_by":"juanre","updated_at":"2026-01-10T14:32:35.025434+01:00","closed_at":"2026-01-10T14:32:35.025434+01:00","close_reason":"Completed mail interface migration","dependencies":[{"issue_id":"beadhub-ewdb","depends_on_id":"beadhub-mg89","type":"blocks","created_at":"2026-01-10T14:01:59.335619+01:00","created_by":"juanre"},{"issue_id":"beadhub-ewdb","depends_on_id":"beadhub-waak","type":"parent-child","created_at":"2026-01-10T14:04:38.701141+01:00","created_by":"juanre"}]}
{"id":"beadhub-ewtl","title":"Add project_id to BeadIssue in /v1/beads/issues/all response","description":"The /v1/beads/issues/all endpoint returns issues without project_id. The single-issue endpoint /v1/beads/issues/{bead_id} requires X-Project-ID header. Frontend cannot fetch full issue details (with description) because it doesn't know which project the issue belongs to.\n\nFix: Add project_id field to BeadIssue response in /v1/beads/issues/all.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T13:08:30.929413+01:00","updated_at":"2025-12-13T13:39:03.883935+01:00","closed_at":"2025-12-13T13:39:03.883935+01:00"}
{"id":"beadhub-exm0","title":"Dead code in beads.py lock enrichment","description":"Location: src/beadhub/routes/beads.py:409-413. Creates unused variables locks=[] and current_lock=None with comment about not implementing lock scanning. Creates confusion about whether feature is implemented. Fix: remove dead code or implement the feature properly.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-08T18:26:01.06095+01:00","updated_at":"2025-12-08T18:26:01.06095+01:00"}
{"id":"beadhub-ezb","title":"Add SaaS auth tests","description":"Test coverage for SaaS auth: API key creation/validation/revocation, JWT issue/verify/refresh, project ownership checks, multi-tenant isolation (ensure project A cannot see project B data).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-03T08:10:02.435912+01:00","updated_at":"2025-12-03T08:41:46.234987+01:00","closed_at":"2025-12-03T08:41:46.234987+01:00","close_reason":"81 SaaS auth tests exist from template, all pass","dependencies":[{"issue_id":"beadhub-ezb","depends_on_id":"beadhub-271","type":"blocks","created_at":"2025-12-03T08:10:08.702456+01:00","created_by":"juanre"}]}
{"id":"beadhub-f0j1","title":"Add Ctrl+Enter keyboard shortcut to send message","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T20:35:18.135619+01:00","updated_at":"2025-12-14T00:17:17.931885+01:00","closed_at":"2025-12-14T00:05:10.929618+01:00"}
{"id":"beadhub-f0kk","title":"Update routes/messages.py to use Postgres","description":"Replace Redis operations with Postgres via pgdbm, adding tenant isolation.\n\n**Security requirements** (must match chat.py pattern):\n\n1. **Server-side project derivation** - Don't trust client-provided project_id:\n```python\nasync def _get_workspace_project_id(db, workspace_id) -\u003e Optional[str]:\n    row = await db.fetch_one(\n        'SELECT project_id FROM {{tables.workspaces}} WHERE workspace_id = $1',\n        workspace_id\n    )\n    return str(row['project_id']) if row else None\n```\n\n2. **Same-project validation** - Sender and recipient must be in same project:\n```python\nsender_project = await _get_workspace_project_id(db, from_workspace)\nrecipient_project = await _get_workspace_project_id(db, to_workspace)\nif sender_project \\!= recipient_project:\n    raise HTTPException(403, 'Cannot send messages across projects')\n```\n\n3. **All queries scoped by project_id**:\n```python\n# Inbox query\nawait db.fetch_all(\n    '''SELECT * FROM {{tables.messages}}\n       WHERE project_id = $1 AND to_workspace_id = $2\n       ORDER BY created_at DESC''',\n    project_id, workspace_id\n)\n```\n\n**Code changes:**\n1. Remove Redis imports and INBOX_TTL_SECONDS\n2. Add pgdbm database dependency (like chat.py)\n3. Add/reuse _get_workspace_project_id() helper\n4. Rewrite send_message() with project validation\n5. Rewrite fetch_inbox() with project scoping\n6. Rewrite inbox_count() with project scoping\n7. Rewrite acknowledge_message() with project validation\n8. Remove ACK_MESSAGE_SCRIPT Lua script\n\n**Keep Redis for:** Publishing MessageDeliveredEvent/MessageAcknowledgedEvent (real-time notifications only)\n\nPart of epic beadhub-37yb","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T09:44:14.478299+01:00","updated_at":"2025-12-20T11:05:45.285442+01:00","closed_at":"2025-12-20T11:05:45.285442+01:00","close_reason":"Completed","dependencies":[{"issue_id":"beadhub-f0kk","depends_on_id":"beadhub-8a5d","type":"blocks","created_at":"2025-12-20T09:44:22.130073+01:00","created_by":"juanre"}]}
{"id":"beadhub-f0v8","title":"Workspace re-registration with different alias should error clearly","description":"In src/beadhub/routes/workspaces.py register_workspace(), when a workspace already exists, it returns the EXISTING alias from DB, not the requested alias. If user runs 'bdh init --alias A' then later 'bdh init --alias B' in same dir, second call silently returns alias A with created=false. Should either error clearly or document this immutability.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-13T10:50:06.795171+01:00","updated_at":"2025-12-13T19:05:00.277321+01:00","closed_at":"2025-12-13T19:05:00.277321+01:00"}
{"id":"beadhub-f1na","title":"Unsafe Redis SCAN without pagination limits","description":"Location: routes/reservations.py:576-641, presence.py:106-113. Multiple endpoints use redis.scan_iter without pagination limits: list_reservations, list_agent_presences, get_workspace_ids_by_project_key. Can block Redis event loop (single-threaded), cause timeouts, consume excessive memory, lead to DoS as data grows. Fix: add configurable limits, pagination, or use Redis Sets/Sorted Sets for indexing.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-08T18:24:59.783436+01:00","updated_at":"2025-12-13T19:47:05.965182+01:00","closed_at":"2025-12-13T19:47:05.965182+01:00"}
{"id":"beadhub-f1ts","title":"Use UUID type validation for repo_id query params","description":"In status.py and escalations.py, repo_id uses string validation (min/max length 36) instead of proper UUID type. Change to: repo_id: Optional[UUID] = Query(None) - gives automatic validation, clear OpenAPI schema, better error messages. Locations: status.py line 25, escalations.py line 167.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T14:16:03.296329+01:00","updated_at":"2025-12-13T14:16:14.382263+01:00"}
{"id":"beadhub-f2c4","title":"Hierarchical bead display with sorting options","description":"Show beads hierarchically with sub-beads grouped under parent beads (epics/features). Add sorting options: chronological (most recently modified first/last) or hierarchical+chronological.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-06T18:58:11.67217Z","created_by":"juanre","updated_at":"2026-01-06T19:19:55.504946Z","closed_at":"2026-01-06T19:19:55.504946Z","close_reason":"Implemented hierarchical bead display with three sort modes: Flat (priority), By Type, and Hierarchical (blocker-based grouping with visual indentation)"}
{"id":"beadhub-f392","title":"Simplify notification system: one fetch, one format, always show all","description":"## Problem\n\nThe notification system has accumulated complexity from premature optimization. There are multiple code paths, multiple data sources for the same information, and options that serve no practical purpose.\n\n## Scope\n\nThis covers the NOTIFICATIONS section (WAITING, CHATS, MAIL, gone workspaces). \n\nFile reservations (YOUR RESERVED FILES) are **out of scope** - they are conceptually different (feedback about this command vs. external events from others) and the reservation system is already simple.\n\n## Current State Analysis\n\n### Two Parallel Notification Systems\n\n**1. Colon commands** (`:status`, `:send`, `:policy`, etc.):\n- Call `RefreshPresenceOnly(cfg)` to update presence\n- Call `DeferServerNotifications(cfg, opts)` to schedule fetch\n- At exit, `PrintDeferredServerNotifications` calls:\n  - `FetchServerNotifications` â†’ `GetPendingChats` API\n  - `FormatServerNotifications` â†’ outputs NOTIFICATIONS block\n\n**2. Passthrough commands** (`bd` commands via `bdh`):\n- Command API response includes `MessagesWaiting` in context\n- Separately calls `GetPendingChats` for `PendingConversations`\n- For `ready` only: calls `c.Inbox()` to fetch actual messages (but only uses `len()`)\n- `formatPassthroughOutput` â†’ `formatPassthroughNotifications`\n\n### Redundant Data Sources\n\n1. `MessagesWaiting` comes from Command API response context\n2. `MessagesWaiting` also comes from `GetPendingChats` response\n3. `InboxMessages` fetched for `ready` command but only `len()` is used in text output (JSON gets the actual messages)\n\n### Unnecessary Options\n\n`ServerContextDisplayOptions` has three flags:\n- `ShowWaiting` - always true in practice\n- `ShowChats` - always true in practice  \n- `ShowMail` - false only in `:inbox` (redundant since you are already there)\n\nThe only useful feature is `excludeChatAliases` to suppress the current chat participant.\n\n### Two Format Functions\n\n- `FormatServerNotifications` for colon commands\n- `formatPassthroughNotifications` for passthrough commands\n\nBoth produce identical output format.\n\n### Dead Code\n\n`InboxMessages` is fetched for `ready` but:\n- Text output: only uses `len(result.InboxMessages)` as count\n- Comment says \"detailed view\" but it is identical to \"summary view\"\n- Only JSON output uses the actual messages\n\n### Gone Workspace Detection\n\nOnly runs on `:status` command, should run everywhere.\n\n## Proposed Simplification\n\n### Unified Flow (all bdh commands)\n\n1. **One presence refresh** - `RefreshPresence(cfg)`\n2. **One notification fetch** - `FetchNotifications(cfg)` returns:\n   - `PendingConversations` (WAITING + CHATS)\n   - `MessagesWaiting` (MAIL count)\n   - `GoneWorkspaces` (cleaned up workspaces)\n3. **One format function** - `FormatNotifications(ctx, excludeAlias)`:\n   - Always shows WAITING, CHATS, MAIL\n   - Only option: exclude current chat participant\n4. **Print at end** - Always, for all commands\n\n### What To Remove\n\n1. `ServerContextDisplayOptions` struct (except excludeAlias)\n2. `FetchServerContext` vs `FetchServerNotifications` distinction\n3. `FormatServerContextPrefix` / `FormatServerContextSuffix` (unused complexity)\n4. `formatPassthroughNotifications` (merge into shared function)\n5. `InboxMessages` field and fetch (just use `MessagesWaiting`)\n6. Fetching `MessagesWaiting` from Command API (get it from `GetPendingChats` only)\n\n### Implementation Steps\n\n1. Create unified `NotificationContext` struct with all notification data\n2. Create single `FetchNotifications(cfg)` that:\n   - Calls `GetPendingChats` (gets chats + mail count)\n   - Calls `detectGoneWorkspaces` (gets gone workspaces)\n   - Refreshes presence\n3. Create single `FormatNotifications(ctx, excludeAlias string)` formatter\n4. Update passthrough to use shared fetch/format\n5. Update colon commands to use shared fetch/format\n6. Remove all the dead code listed above\n7. Update tests\n\n### Result\n\n- One way to fetch notifications\n- One way to format notifications\n- Every bdh command shows NOTIFICATIONS at end\n- Gone workspace detection happens on every command\n- Less code, less complexity, consistent behavior","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T09:51:48.557505+01:00","created_by":"juanre","updated_at":"2026-01-10T10:02:12.055937+01:00","closed_at":"2026-01-10T10:02:12.055937+01:00","close_reason":"Superseded by detailed implementation beads"}
{"id":"beadhub-f5il","title":"Add POST /v1/bdh/command endpoint","description":"Main coordination endpoint. Called by bdh before every bd command.\n\nRequest:\n{\n    workspace_id, agent_name, human_name, project_key,\n    command_line: \"update bd-42 --status in_progress\"\n}\n\nResponse (approved):\n{ approved: true, context: { messages_waiting, beads_in_progress } }\n\nResponse (rejected):\n{ approved: false, reason: \"...\", context: {...} }\n\nBackend logic:\n1. Auto-register workspace if first contact (upsert presence)\n2. Parse command_line to understand the command\n3. If claiming bead (update --status in_progress), check if already claimed\n4. If already claimed by another workspace, reject\n5. Return approval/rejection with context\n\nSee beadhub-bdh-design.md for full spec.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T09:34:47.112866+01:00","updated_at":"2025-12-10T10:32:10.122431+01:00","closed_at":"2025-12-10T10:32:10.122431+01:00","dependencies":[{"issue_id":"beadhub-f5il","depends_on_id":"beadhub-4trs","type":"parent-child","created_at":"2025-12-10T09:36:05.471528+01:00","created_by":"juanre"},{"issue_id":"beadhub-f5il","depends_on_id":"beadhub-6gfo","type":"blocks","created_at":"2025-12-10T09:36:15.09746+01:00","created_by":"juanre"},{"issue_id":"beadhub-f5il","depends_on_id":"beadhub-sp89","type":"blocks","created_at":"2025-12-10T09:36:15.15756+01:00","created_by":"juanre"}]}
{"id":"beadhub-f5qv","title":"Show workspace role in :who output and dashboard","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-14T21:27:53.637728+01:00","updated_at":"2025-12-14T21:28:07.296677+01:00","closed_at":"2025-12-14T21:28:07.296677+01:00"}
{"id":"beadhub-f5zv","title":"Harden messages since parsing and error responses","description":"Harden /v1/messages inbox since parsing to enforce timezone-aware values and consider generic errors for unknown workspaces to avoid existence leakage.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-20T11:20:38.748803+01:00","updated_at":"2025-12-20T11:26:25.482556+01:00","closed_at":"2025-12-20T11:26:25.482556+01:00","close_reason":"Completed","dependencies":[{"issue_id":"beadhub-f5zv","depends_on_id":"beadhub-f0kk","type":"discovered-from","created_at":"2025-12-20T11:20:38.749802+01:00","created_by":"juanre"}]}
{"id":"beadhub-f6yc","title":"Extract duplicate get_optional_project_id to shared auth module","description":"## Problem\n\nIdentical `get_optional_project_id` / `_get_optional_project_id` function is copy-pasted across 5+ route files, violating DRY principle.\n\n### Current Behavior\n\nThe same function appears in:\n- `src/beadhub/routes/messages.py:23-34`\n- `src/beadhub/routes/workspaces.py:43-65`\n- `src/beadhub/routes/status.py:25-47`\n- `src/beadhub/routes/claims.py:17-33`\n- `src/beadhub/routes/escalations.py`\n\nExample from messages.py:\n```python\ndef _get_optional_project_id(request: Request) -\u003e Optional[str]:\n    \"\"\"Extract X-Project-ID header if present, validating UUID format.\"\"\"\n    project_id = request.headers.get(\"X-Project-ID\")\n    if not project_id:\n        return None\n    try:\n        return str(UUID(project_id))\n    except ValueError:\n        raise HTTPException(\n            status_code=422,\n            detail=\"Invalid X-Project-ID header: expected UUID format\",\n        )\n```\n\n### Impact\n\n- Bug fixes must be applied to 5+ files\n- Inconsistencies can creep in between copies\n- Makes codebase harder to maintain\n\n### Solution\n\n1. Add `get_optional_project_id()` to `src/beadhub/auth.py` (already has `get_project_id()`)\n2. Remove duplicate functions from all route files\n3. Import from `auth` module\n\n```python\n# auth.py\ndef get_optional_project_id(request: Request) -\u003e Optional[str]:\n    \"\"\"Extract X-Project-ID header if present, validating UUID format.\n    \n    Returns None if header is missing, raises HTTPException if invalid format.\n    \"\"\"\n    project_id = request.headers.get(\"X-Project-ID\")\n    if not project_id:\n        return None\n    try:\n        return str(UUID(project_id))\n    except ValueError:\n        raise HTTPException(\n            status_code=422,\n            detail=\"Invalid X-Project-ID header: expected UUID format\",\n        )\n```\n\n### Files to Update\n\n- `src/beadhub/auth.py` - Add function\n- `src/beadhub/routes/messages.py` - Remove, import from auth\n- `src/beadhub/routes/workspaces.py` - Remove, import from auth\n- `src/beadhub/routes/status.py` - Remove, import from auth\n- `src/beadhub/routes/claims.py` - Remove, import from auth\n- `src/beadhub/routes/escalations.py` - Remove, import from auth\n\n### Acceptance Criteria\n\n- [ ] Single implementation in auth.py\n- [ ] All route files import from auth\n- [ ] No duplicate implementations remain\n- [ ] All existing tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-08T12:40:09.975829+01:00","created_by":"juanre","updated_at":"2026-01-09T19:31:41.519398+01:00","closed_at":"2026-01-09T19:31:41.519398+01:00","close_reason":"Already implemented. get_optional_project_id exists in auth.py:129-146 and all route files import from auth module."}
{"id":"beadhub-f83y","title":"SECURITY: Prevent symlink attacks in config file resolution","description":"## Problem\n\n`.beadhub` config file path resolution walks parent directories and could follow symlinks to read arbitrary files.\n\n### Current Behavior\n\nIn `bdh/internal/config/config.go:156-172`:\n```go\nfor {\n    candidate := filepath.Join(dir, FileName)\n    if _, err := os.Stat(candidate); err == nil {\n        return candidate, nil  // Found file - doesn't check if symlink\n    }\n    parent := filepath.Dir(dir)\n    if parent == dir { break }\n    dir = parent\n}\n```\n\n### Attack Vector\n\nIf attacker can place `.beadhub` symlink in a parent directory:\n1. Symlink points to sensitive file (e.g., `/etc/passwd`, `~/.ssh/id_rsa`)\n2. CLI reads/parses it as YAML\n3. May leak file contents via error messages or field values\n\n### Files Affected\n\n- `bdh/internal/config/config.go:129-172`\n\n### Solution\n\n```go\nfunc FindConfigPath() (string, error) {\n    // ... existing traversal logic ...\n    \n    for {\n        candidate := filepath.Join(dir, FileName)\n        \n        // Use Lstat to detect symlinks\n        info, err := os.Lstat(candidate)\n        if err == nil {\n            // Reject symlinks\n            if info.Mode()\u0026os.ModeSymlink != 0 {\n                return \"\", fmt.Errorf(\"security: %s is a symlink, refusing to read\", candidate)\n            }\n            return candidate, nil\n        }\n        \n        parent := filepath.Dir(dir)\n        if parent == dir { break }\n        dir = parent\n    }\n}\n```\n\nAdditional hardening:\n- Don't walk above git root (find .git first, stop there)\n- Reject absolute paths in config values\n- Validate config file permissions (not world-writable)\n\n### Acceptance Criteria\n\n- [ ] Symlinks are detected and rejected with clear error\n- [ ] Config search stops at git repository root\n- [ ] Config values with absolute paths are validated\n- [ ] Unit tests cover symlink attack scenarios","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-08T12:38:29.936322+01:00","created_by":"juanre","updated_at":"2026-01-17T15:12:58.876564+01:00","closed_at":"2026-01-17T15:12:58.876564+01:00","close_reason":"Won't fix: Attack requires local filesystem write access, at which point attacker has bigger problems. Not a Cloud concern (CLI runs on user machines). OSS users are on trusted machines."}
{"id":"beadhub-f8wh","title":"Release bead claims when workspace is deleted","description":"When workspace is soft-deleted, its bead claims remain in bead_claims table. Deleted workspace still appears as 'working on' beads indefinitely. Fix: Either release all claims on deletion, or filter out claims from deleted workspaces in queries.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-17T08:01:37.267719+01:00","updated_at":"2025-12-17T19:05:53.123306+01:00","closed_at":"2025-12-17T19:05:53.123306+01:00","close_reason":"Fixed: When workspace is soft-deleted, now also DELETE all bead_claims for that workspace. Added test to verify claims are released on deletion. Code review approved.","dependencies":[{"issue_id":"beadhub-f8wh","depends_on_id":"beadhub-lmtj","type":"discovered-from","created_at":"2025-12-17T08:01:37.26928+01:00","created_by":"juanre"}]}
{"id":"beadhub-f9rh","title":"Add repos table migration with canonical_origin normalization","description":"Create new migration (or edit existing) to add the repos table per data-model.md.\n\nTable: repos\nFields:\n- id (UUID, PK)\n- project_id (UUID, FK to projects, NOT NULL)\n- origin_url (TEXT, NOT NULL) - Full URL as provided\n- canonical_origin (TEXT, NOT NULL) - Normalized: \"github.com/org/repo\"\n- name (TEXT, NOT NULL) - Derived from canonical: \"repo\"\n- created_at (TIMESTAMPTZ)\n\nConstraints:\n- UNIQUE(project_id, canonical_origin)\n\nIndex:\n- idx_repos_project on (project_id)\n\nThis table tracks repositories within a project, identified by normalized origin URL.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T12:49:15.135073+01:00","updated_at":"2025-12-12T15:10:10.435728+01:00","closed_at":"2025-12-12T15:10:10.435728+01:00"}
{"id":"beadhub-fbvq","title":"P0 sync gap repro","status":"tombstone","priority":2,"issue_type":"task","created_at":"2026-01-07T16:49:16.307871+01:00","created_by":"juanre","updated_at":"2026-01-07T18:02:25.537895+01:00","deleted_at":"2026-01-07T18:02:25.537895+01:00","deleted_by":"juanre","delete_reason":"delete","original_type":"task"}
{"id":"beadhub-fdo","title":"Fix Redis connection leak in get_redis()","description":"**Problem**: `get_redis()` in `redis_client.py` creates a new Redis connection on every call but never closes it. This leaks connections until Redis refuses new ones.\n\n**File**: `redis_client.py`\n\n**Current code**:\n```python\ndef get_redis() -\u003e Redis:\n    settings = get_settings()\n    return redis_from_url(settings.redis_url, decode_responses=True)\n```\n\n**Fix**: Store Redis client in app state during lifespan, inject via dependency:\n```python\n@asynccontextmanager\nasync def lifespan(app: FastAPI):\n    redis = await async_redis_from_url(settings.redis_url, decode_responses=True)\n    app.state.redis = redis\n    # ...\n    try:\n        yield\n    finally:\n        await redis.close()\n        await db_infra.close()\n\ndef get_redis(request: Request) -\u003e Redis:\n    return request.app.state.redis\n```\n\n**Note**: This should be done together with beadhub-9i0 (async Redis).","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-02T19:44:27.636448+01:00","updated_at":"2025-12-02T21:37:11.073218+01:00","closed_at":"2025-12-02T21:37:11.073218+01:00","close_reason":"Fixed by async Redis migration - lifespan properly creates and closes Redis connection, no more leaked connections.","dependencies":[{"issue_id":"beadhub-fdo","depends_on_id":"beadhub-9i0","type":"blocks","created_at":"2025-12-02T19:44:27.638056+01:00","created_by":"juanre"}]}
{"id":"beadhub-fei6","title":"Mail-first agent coordination","description":"Redesign bdh coordination to be mail-first (async) with chat only for urgent matters. Key changes:\n\n1. bdh ready becomes coordination hub: shows inbox, team status, related work suggestions\n2. bdh :who includes bead descriptions of what each agent is working on\n3. bdh close prompts to notify related agents via mail\n4. Demote chat notifications: WAITING only after commands, mail at checkpoints\n5. Update AGENTS-template.md with mail-first guidance\n6. Add file reservation commands (:lock/:unlock)\n\nPhilosophy: Let agents focus. Mail for async updates, chat only when someone is blocked.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-15T18:22:48.826447+01:00","updated_at":"2025-12-16T22:26:21.535349+01:00","closed_at":"2025-12-16T22:26:21.535349+01:00"}
{"id":"beadhub-fh23","title":"Chat messages API - send and get messages","description":"Implement message sending within chat sessions:\n\n- POST /v1/chat/sessions/{id}/messages - Send message to session\n\nData model in Redis:\n- chat:messages:{session_id} - List of messages (LPUSH/LRANGE)\n\nMessage structure: {message_id, from_workspace, from_agent, body, timestamp}\n\nSee spec: beadhub-sot/source-of-truth/beadhub-chat-spec.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T20:33:22.23274+01:00","updated_at":"2025-12-10T21:13:29.451114+01:00","closed_at":"2025-12-10T21:13:29.451114+01:00","dependencies":[{"issue_id":"beadhub-fh23","depends_on_id":"beadhub-w143","type":"blocks","created_at":"2025-12-10T20:37:28.658289+01:00","created_by":"juanre"}]}
{"id":"beadhub-fh76","title":"bdh: fuzzy alias resolution for mail and chat","description":"When sending mail or chat to an alias that doesn't exist exactly, try to resolve it:\n\n1. Exact match: use it\n2. Unique prefix match: 'coord' â†’ 'coordinator' (if only one starts with 'coord')\n3. Unique substring match: 'main' â†’ 'claude-main' (if only one contains 'main')\n4. Multiple matches: prompt for disambiguation (if TTY) or error with suggestions\n5. No matches: error with 'did you mean?' suggestions\n\nImplementation:\n- Client-side in bdh (can prompt interactively)\n- Fetch workspace list, filter by pattern\n- Apply to :send, :chat, and any other alias-based commands\n\nMotivation: agent-03 sent mail to 'coordinator' expecting it to reach claude-main. With multiple coordinator-like aliases (coordinator, alice-coordinator), exact matching fails silently or goes to wrong recipient.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-21T18:00:47.596787+01:00","updated_at":"2025-12-21T18:47:33.523256+01:00","closed_at":"2025-12-21T18:47:33.523256+01:00","close_reason":"Implemented fuzzy alias resolution for :send and :chat commands with exact/prefix/substring matching and Levenshtein suggestions"}
{"id":"beadhub-fjpw","title":"Migrate test_subscriptions.py to db_infra fixture","description":"Convert from app_with_test_db to async tests using db_infra fixture.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-10T10:54:58.798724+01:00","created_by":"juanre","updated_at":"2026-01-10T12:15:34.63518+01:00","closed_at":"2026-01-10T12:15:34.63518+01:00","close_reason":"Migration complete - all 14 tests pass using db_infra fixture pattern","dependencies":[{"issue_id":"beadhub-fjpw","depends_on_id":"beadhub-7wpr","type":"parent-child","created_at":"2026-01-10T10:55:49.242466+01:00","created_by":"juanre"}]}
{"id":"beadhub-fjvf","title":"Add retry logic for failed message sends (transient failures)","description":"Sending messages from the dashboard currently fails â€œhardâ€ on transient network/server errors.\n\nFix:\n- Add limited retry to the SendMessageDialog mutation for transient failures (e.g., network errors or HTTP 5xx), without retrying on validation/auth errors (4xx).\n- Keep UX simple: users should either see success or a final error after retries.\n\nRelevant file:\n- `frontend/src/components/SendMessageDialog.tsx`\n","acceptance_criteria":"- Message send retries transient failures (bounded)\n- 4xx errors are not retried","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T20:35:19.667763+01:00","updated_at":"2026-01-03T18:40:36.972014Z"}
{"id":"beadhub-fmx9","title":"Self-chat ValueError becomes 500 instead of 400","description":"In create_session, if from_workspace equals one of the target workspace IDs, _compute_participant_hash raises ValueError('Cannot create chat session with duplicate participants'). This bubbles up as a 500 error instead of a proper 400 validation error. Should catch this and return HTTPException(400).","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-13T22:59:01.960689+01:00","updated_at":"2025-12-13T22:59:01.960689+01:00","dependencies":[{"issue_id":"beadhub-fmx9","depends_on_id":"beadhub-ixss","type":"discovered-from","created_at":"2025-12-13T22:59:01.961593+01:00","created_by":"juanre"}]}
{"id":"beadhub-fon","title":"Remove llmring-specific files from beadhub-cloud","description":"Delete: routers/conversations.py, routers/registry.py, services/conversations.py, models/conversations.py, jobs/retention_cleanup.py. Optionally remove frontend/ if not needed yet.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-03T08:20:48.699928+01:00","updated_at":"2025-12-03T08:24:51.959416+01:00","closed_at":"2025-12-03T08:24:51.959416+01:00","close_reason":"Removed llmring-specific files: conversations, registry, retention_cleanup, frontend, docs, misc planning files","dependencies":[{"issue_id":"beadhub-fon","depends_on_id":"beadhub-2jg","type":"blocks","created_at":"2025-12-03T08:20:54.416837+01:00","created_by":"juanre"}]}
{"id":"beadhub-fqj0","title":"SECURITY: Fix timing side-channel in workspace deletion","description":"## Problem\n\nWorkspace deletion endpoint validates tenant isolation AFTER checking workspace existence, creating a timing side-channel that leaks workspace existence across tenants.\n\n### Current Behavior\n\nIn `src/beadhub/routes/workspaces.py:542-562`:\n```python\n# Step 1: Fetch workspace (timing varies based on existence)\nexisting = await server_db.fetch_one(\n    \"SELECT ... WHERE workspace_id = $1\",\n    validated_id\n)\n\n# Step 2: Check if exists\nif not existing:\n    raise HTTPException(404, \"Workspace not found\")\n\n# Step 3: Auth check comes AFTER existence check\nif is_auth_enabled() and str(existing[\"project_id\"]) != header_project_id:\n    raise HTTPException(404, \"Workspace not found\")  # Same error message\n```\n\n### Attack Vector\n\nDifferent timing for:\n1. Non-existent workspace: Fast (fails at step 2)\n2. Wrong-project workspace: Slower (passes step 2, fails at step 3)\n\nError message is identical but timing differs, enabling enumeration of valid workspace IDs across all projects.\n\n### Files Affected\n\n- `src/beadhub/routes/workspaces.py:530-562` (delete endpoint)\n- Likely similar patterns in other routes\n\n### Solution\n\nFilter by project_id in the initial query (single DB round-trip):\n```python\nexisting = await server_db.fetch_one(\n    \"\"\"\n    SELECT workspace_id, project_id, ...\n    FROM {{tables.workspaces}}\n    WHERE workspace_id = $1 AND project_id = $2\n    \"\"\",\n    validated_id,\n    header_project_id  # Include in query, not post-filter\n)\n\nif not existing:\n    raise HTTPException(404, \"Workspace not found\")\n# No separate auth check needed - query already filtered\n```\n\n### Acceptance Criteria\n\n- [ ] All tenant-filtered queries include project_id in WHERE clause\n- [ ] No two-step fetch-then-filter pattern for tenant data\n- [ ] Audit other routes for similar patterns\n- [ ] Response timing is constant regardless of workspace existence in other projects","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-08T12:37:52.767513+01:00","created_by":"juanre","updated_at":"2026-01-09T19:07:38.678517+01:00","closed_at":"2026-01-09T19:07:38.678517+01:00","close_reason":"Already fixed in commit bd2963a. Audit of all routes confirms no timing side-channel vulnerabilities remain."}
{"id":"beadhub-frnp","title":"Improve pagination on GET /v1/workspaces with cursor support","description":"Update workspaces.py pagination:\n\nCurrent: Has limit parameter only, no cursor/offset\nTarget:\n- Add cursor query param for stable pagination\n- Keep limit param (default 50, max 200)\n- Return {items: [...], has_more: bool, next_cursor: str}\n- Order by created_at DESC\n\nUse the pagination helper module.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T10:30:56.134975+01:00","updated_at":"2025-12-22T12:09:09.413924+01:00","closed_at":"2025-12-22T12:09:09.413924+01:00","close_reason":"Added cursor-based pagination to GET /v1/workspaces endpoint with limit/cursor params, updated response schema with has_more/next_cursor, 4 pagination tests","dependencies":[{"issue_id":"beadhub-frnp","depends_on_id":"beadhub-v9wr","type":"blocks","created_at":"2025-12-22T10:32:21.342419+01:00","created_by":"juanre"},{"issue_id":"beadhub-frnp","depends_on_id":"beadhub-94q9","type":"blocks","created_at":"2025-12-22T10:36:52.164609+01:00","created_by":"juanre"}]}
{"id":"beadhub-ftmd","title":"Update policy documentation for :mail command","description":"Update the BeadHub policy documentation to reflect the new :mail command interface.\n\n**Files to update:**\n\n1. **src/beadhub/defaults/invariants/mail-first.md**\n   - Change `bdh :send \u003cagent\u003e \"message\"` to `bdh :mail --send \u003cagent\u003e \"message\"`\n   - Update examples\n\n2. **src/beadhub/defaults/invariants/communication.chat.md** (if it references mail)\n   - Ensure chat examples still reference :chat (no change needed)\n   - May need to add note about :mail for async communication\n\n3. **src/beadhub/defaults/roles/*.md**\n   - Update any role playbooks that mention :send, :inbox, or :ack\n\n**Verification:**\n- Run `bdh :policy` and verify all mail references use new syntax\n- Check that examples are consistent with actual command behavior\n\nThis task depends on the :mail command being implemented.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T14:02:06.670116+01:00","created_by":"juanre","updated_at":"2026-01-10T14:32:35.027547+01:00","closed_at":"2026-01-10T14:32:35.027547+01:00","close_reason":"Completed mail interface migration","dependencies":[{"issue_id":"beadhub-ftmd","depends_on_id":"beadhub-mg89","type":"blocks","created_at":"2026-01-10T14:02:09.9729+01:00","created_by":"juanre"},{"issue_id":"beadhub-ftmd","depends_on_id":"beadhub-waak","type":"parent-child","created_at":"2026-01-10T14:04:39.052665+01:00","created_by":"juanre"}]}
{"id":"beadhub-ftqd","title":"Chat create_session must validate from_workspace project + alias","description":"Bug (tenant isolation + impersonation): POST /v1/chat/sessions accepts {project_id, from_workspace, from_alias} but never verifies that from_workspace exists in server.workspaces for that project, nor that from_alias matches the workspace alias. Because chat_sessions.initiator_workspace is only FKed by workspace_id (no project_id in FK), a request can create a chat session row with project_id=A but initiator_workspace pointing at a workspace from project=B. Also inserts spoofed alias into chat_session_participants.alias and chat_messages.from_agent.\n\nWhy this matters:\n- Cross-project/tenant data integrity break.\n- Potential alias spoofing in history/SSE.\n- Cascades: deleting a workspace in project B can delete chat sessions in project A.\n\nRepro sketch:\n1) Create projects A and B.\n2) Register workspace wsB under project B.\n3) Register target workspace/alias under project A.\n4) Call POST /v1/chat/sessions with project_id=A, from_workspace=wsB, from_alias=\"admin\", to_aliases=[\"agent-in-A\"].\n5) Observe 200 OK; DB now has chat_sessions.project_id=A with initiator_workspace=wsB.\n\nFix:\n- Query server.workspaces WHERE project_id=$1 AND workspace_id=$2 for from_workspace; reject if missing.\n- Ensure payload.from_alias matches the workspace record (or ignore payload alias and always use DB alias).\n- Ensure all participant workspaces are in the same project.\n- Consider DB hardening: add UNIQUE(project_id, workspace_id) on workspaces and use composite FKs from chat tables to enforce same-project at the database layer.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-13T23:11:29.738209+01:00","updated_at":"2025-12-13T23:20:49.987878+01:00","closed_at":"2025-12-13T23:20:49.987878+01:00","dependencies":[{"issue_id":"beadhub-ftqd","depends_on_id":"beadhub-ixss","type":"discovered-from","created_at":"2025-12-13T23:11:29.739177+01:00","created_by":"juanre"}]}
{"id":"beadhub-fuom","title":"Add type filter to Issues page","description":"Add filter tabs or dropdown to filter issues by type: bug, feature, task, epic, chore. Currently only status filter exists.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T12:14:57.780719+01:00","updated_at":"2025-12-13T12:50:19.432053+01:00","closed_at":"2025-12-13T12:50:19.432053+01:00"}
{"id":"beadhub-fuql","title":"Update server to accept incremental sync requests","description":"Update beads_sync.py to handle incremental syncs:\n\nNew request format:\n{\n  \"sync_mode\": \"full\" | \"incremental\",\n  \"issues_jsonl\": \"...\",      // for full sync\n  \"changed_issues\": [...],    // for incremental\n  \"deleted_ids\": [...]        // for incremental\n}\n\nBehavior:\n- full: Current behavior (UPSERT all)\n- incremental: Only UPSERT changed_issues, DELETE deleted_ids\n- Skip issues not in request (unchanged)\n\nFiles: src/beadhub/beads_sync.py, src/beadhub/routes/beads.py","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T10:31:31.011083+01:00","updated_at":"2025-12-22T11:41:59.852563+01:00","closed_at":"2025-12-22T11:41:59.852563+01:00","close_reason":"Server now accepts incremental sync with sync_mode, changed_issues, deleted_ids fields. Added validation and proper error handling.","dependencies":[{"issue_id":"beadhub-fuql","depends_on_id":"beadhub-9v3g","type":"blocks","created_at":"2025-12-22T10:34:52.068192+01:00","created_by":"juanre"}]}
{"id":"beadhub-fw3g","title":"Extract duplicate workspace authorization logic to shared helper","description":"## Problem\n\nThe workspace authorization pattern (get project_id, verify workspace access) is repeated verbatim in many endpoints.\n\n### Current Behavior\n\nThis 15-line pattern appears multiple times in `messages.py` (lines 301-312, 417-428, 457-468) and other routes:\n\n```python\nscoped_project_id = (\n    get_project_id(request) if is_auth_enabled() else _get_optional_project_id(request)\n)\nworkspace_project_id = await _get_workspace_project_id(db, workspace_id)\nif workspace_project_id is None:\n    raise HTTPException(status_code=422, detail=\"Workspace not found\")\nif scoped_project_id and workspace_project_id != scoped_project_id:\n    raise HTTPException(\n        status_code=403,\n        detail=\"Workspace not found or does not belong to your project\",\n    )\nproject_id = scoped_project_id or workspace_project_id\n```\n\n### Impact\n\n- ~45+ lines of duplicate code across routes\n- Authorization logic changes require updates in multiple places\n- Risk of inconsistent error handling\n\n### Solution\n\nCreate a reusable dependency or helper function:\n\n```python\n# auth.py or new workspace_auth.py\n\nasync def verify_workspace_access(\n    request: Request,\n    workspace_id: str,\n    db_infra: DatabaseInfra,\n) -\u003e str:\n    \"\"\"Verify workspace access and return the effective project_id.\n    \n    Raises HTTPException if:\n    - Workspace doesn't exist (422)\n    - Workspace belongs to different project (403)\n    \n    Returns the project_id to use for subsequent queries.\n    \"\"\"\n    scoped_project_id = (\n        get_project_id(request) if is_auth_enabled() \n        else get_optional_project_id(request)\n    )\n    \n    server_db = db_infra.get_manager(\"server\")\n    row = await server_db.fetch_one(\n        \"\"\"\n        SELECT project_id\n        FROM {{tables.workspaces}}\n        WHERE workspace_id = $1 AND deleted_at IS NULL\n        \"\"\",\n        workspace_id,\n    )\n    \n    if row is None:\n        raise HTTPException(status_code=422, detail=\"Workspace not found\")\n    \n    workspace_project_id = str(row[\"project_id\"])\n    \n    if scoped_project_id and workspace_project_id != scoped_project_id:\n        raise HTTPException(\n            status_code=403,\n            detail=\"Workspace not found or does not belong to your project\",\n        )\n    \n    return scoped_project_id or workspace_project_id\n```\n\n### Files to Update\n\n- `src/beadhub/auth.py` - Add helper function\n- `src/beadhub/routes/messages.py` - Replace duplicate code\n- `src/beadhub/routes/workspaces.py` - Replace duplicate code\n- Other routes with similar patterns\n\n### Acceptance Criteria\n\n- [ ] Single implementation of workspace auth logic\n- [ ] All routes use the shared helper\n- [ ] Error messages are consistent\n- [ ] All existing tests pass","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-08T12:40:12.406341+01:00","created_by":"juanre","updated_at":"2026-01-09T19:33:58.512445+01:00","closed_at":"2026-01-09T19:33:58.512445+01:00","close_reason":"Added verify_workspace_access() helper to auth.py. Refactored 3 occurrences in messages.py (fetch_inbox, inbox_count, acknowledge_message)."}
{"id":"beadhub-fxze","title":"Test --claim flag","status":"closed","priority":3,"issue_type":"task","assignee":"juanre","created_at":"2026-01-05T12:40:06.48497Z","created_by":"juanre","updated_at":"2026-01-05T16:59:46.571757Z","closed_at":"2026-01-05T16:59:46.571757Z","close_reason":"Test beads for --claim bug fix verification"}
{"id":"beadhub-fzhr","title":"fix: close multiple beads releases only first claim","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-05T17:10:03.186974Z","created_by":"juanre","updated_at":"2026-01-05T17:10:17.332756Z","closed_at":"2026-01-05T17:10:17.332756Z","close_reason":"Fixed: parse_close_bead_ids now returns all bead IDs"}
{"id":"beadhub-g21","title":"Add tests for beads upload and branch-scoped sync","description":"Add integration tests for: 1) Upload endpoint accepts JSON and syncs correctly, 2) Branch scoping works (same bead_id on different branches stored separately), 3) Query endpoints filter by branch, 4) Cross-branch references resolve correctly.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-06T22:53:13.275067+01:00","updated_at":"2025-12-07T08:05:55.113421+01:00","closed_at":"2025-12-07T08:05:55.113421+01:00","dependencies":[{"issue_id":"beadhub-g21","depends_on_id":"beadhub-ya3","type":"blocks","created_at":"2025-12-06T22:54:28.45252+01:00","created_by":"juanre"},{"issue_id":"beadhub-g21","depends_on_id":"beadhub-zta","type":"blocks","created_at":"2025-12-06T22:54:28.50323+01:00","created_by":"juanre"}]}
{"id":"beadhub-g39h","title":"SQL injection risk via dynamic WHERE clause construction","description":"Location: src/beadhub/routes/escalations.py:230-238. Dynamic WHERE clause built via string concatenation. While conditions use params, the pattern is error-prone - future modifications could introduce injection. Risk: data breach, data loss, unauthorized access. Fix: use query builder or ORM, validate all condition generation defensively.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-08T18:24:14.553885+01:00","updated_at":"2025-12-15T18:46:02.442515+01:00","closed_at":"2025-12-15T18:46:02.442515+01:00"}
{"id":"beadhub-g3ii","title":"Repo filter bug: /v1/status?repo uses deprecated presence field","description":"Repo-scoped filters in OSS rely on presence fields that no longer exist.\n\nObserved:\n- Presence records now store `repo_id` (and there is an idx:repo_workspaces:{repo_id} secondary index), but `get_workspace_ids_by_repo()` still checks `data.get('repo')`.\n- This makes `GET /v1/status?repo=...` and any other repo-based filters incorrect; often they fall back to listing all presences.\n\nImpact:\n- Wrong status aggregation and UX confusion.\n- In Cloud/SaaS, this can broaden visibility beyond intended scope (even if requests are authenticated).\n\nFix:\n- Decide what the `repo` query param means (repo_id vs canonical_origin vs repo_name).\n- Prefer repo_id everywhere; consider renaming the query param to `repo_id`.\n- Update `beadhub/src/beadhub/presence.py:get_workspace_ids_by_repo` and route handlers that call it.\n\nRefs:\n- `beadhub/src/beadhub/presence.py:get_workspace_ids_by_repo`\n- `beadhub/src/beadhub/routes/status.py`","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T10:47:50.563371+01:00","updated_at":"2025-12-13T14:15:08.313902+01:00","closed_at":"2025-12-13T14:15:08.313902+01:00","dependencies":[{"issue_id":"beadhub-g3ii","depends_on_id":"beadhub-8qqk","type":"discovered-from","created_at":"2025-12-13T10:47:50.563918+01:00","created_by":"juanre"}]}
{"id":"beadhub-g3jb","title":"Policy page: Focus buttons on roles are unclear","description":"Focus buttons on role cards are unclear. User doesn't understand what 'Focus' means or why they'd use it. The feature keeps a role's playbook highlighted while browsing - useful for comparing but not discoverable. Options: 1) Better label/tooltip, 2) Remove if not useful, 3) Visual redesign to make purpose obvious.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-04T10:48:00.139729Z","created_by":"juanre","updated_at":"2026-01-04T11:10:20.493988Z","closed_at":"2026-01-04T11:10:20.493988Z","close_reason":"Fixed in PoliciesPage.tsx"}
{"id":"beadhub-g5go","title":"Increase presence TTL and ensure all bdh commands refresh presence","description":"Two changes needed: (1) Increase default presence TTL from 5 minutes to 30 minutes, (2) Have all :* commands (status, who, chat, escalate) call /v1/agents/register to refresh presence, not just passthrough commands.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-14T18:34:26.92219+01:00","updated_at":"2025-12-14T18:37:10.420438+01:00","closed_at":"2025-12-14T18:37:10.420438+01:00"}
{"id":"beadhub-g6h5","title":"Pre-existing test failure: test_beads_upload_rejects_malicious_repo_name assertion format mismatch","status":"closed","priority":2,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-01-16T10:54:23.156782+01:00","created_by":"Juan Reyero","updated_at":"2026-01-16T10:59:30.874189+01:00","closed_at":"2026-01-16T10:59:30.874189+01:00","close_reason":"Fixed. Updated test assertions to match actual error messages.","dependencies":[{"issue_id":"beadhub-g6h5","depends_on_id":"beadhub-2jy3","type":"discovered-from","created_at":"2026-01-16T10:54:23.15761+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-g98z","title":"chat.py: 3 functions missing deleted_at filter","description":"Lines 151, 177, 426: _validate_workspace_in_session, _get_workspace_project_id, and send_message sender lookup all query workspaces without deleted_at IS NULL filter. Deleted workspaces can still participate in chat.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-21T20:46:58.741076+01:00","updated_at":"2025-12-21T21:42:21.704865+01:00","closed_at":"2025-12-21T21:42:21.704865+01:00","close_reason":"Add deleted_at filters to chat workspace lookups"}
{"id":"beadhub-g9l6","title":"Dashboard messaging: send messages to workspaces from dashboard","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-13T19:26:42.506574+01:00","updated_at":"2025-12-14T08:53:08.267802+01:00","closed_at":"2025-12-13T20:17:39.206661+01:00"}
{"id":"beadhub-gaft","title":"Rename 'Agents' to 'Workspaces' throughout dashboard","description":"The data model uses 'workspace' as the primary identity, but the dashboard UI says 'Agents'. This is confusing because 'agent' is informal shorthand for the AI program running in a workspace, not a first-class entity.\n\nChanges needed:\n- StatusPage: 'AGENTS' stat card â†’ 'WORKSPACES'\n- StatusPage: 'Active Agents' card title â†’ 'Active Workspaces'\n- StatusPage: 'No agents connected' â†’ 'No workspaces connected'\n- Any other agent references in the dashboard","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-14T00:11:20.50988+01:00","updated_at":"2025-12-14T18:17:29.031424+01:00","closed_at":"2025-12-14T00:20:15.530709+01:00"}
{"id":"beadhub-gck7","title":"Add labels/tags and fuzzy title matching to related work detection","description":"The related work detection in bdh close currently supports: dependency relationships (blocks) and same parent epic. The original spec also mentions:\n- Same labels/tags (not implemented)\n- Similar titles - fuzzy match (optional, not implemented)\n\nThese are nice-to-have features that would improve related work detection.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-15T19:02:19.28718+01:00","updated_at":"2025-12-15T19:02:19.28718+01:00"}
{"id":"beadhub-gczq","title":"bdh :chat fails with 422 - missing initiator_agent/target_agent fields","description":"bdh :chat claude-fe \"message\" returns 422 error:\n- Missing field: initiator_agent\n- Missing field: target_agent  \n- target_workspace is empty string (validation fails)\n\nThe chat API expects fields that bdh isn't sending. Either bdh needs to send these fields, or the API schema needs adjustment.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T13:31:20.5533+01:00","updated_at":"2025-12-13T13:46:21.258132+01:00","closed_at":"2025-12-13T13:46:21.258132+01:00"}
{"id":"beadhub-gelm","title":"Migrate test_library_mode.py to db_infra fixture","description":"Convert 4 async tests from manual AsyncTestDatabase to db_infra fixture.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-10T10:54:37.93587+01:00","created_by":"juanre","updated_at":"2026-01-10T11:13:19.533778+01:00","closed_at":"2026-01-10T11:13:19.533778+01:00","close_reason":"Migrated 3 tests to use db_infra/db_infra_uninitialized fixtures. Removed all manual AsyncTestDatabase try/finally blocks.","dependencies":[{"issue_id":"beadhub-gelm","depends_on_id":"beadhub-7wpr","type":"parent-child","created_at":"2026-01-10T10:55:48.01167+01:00","created_by":"juanre"}]}
{"id":"beadhub-ggw7","title":"SSE connected indicator dot does not appear in dev mode (Vite proxy)","description":"In dev mode (Vite dev server on port 5173 proxying to backend on 8000), the SSE connected indicator dot never appears next to Event Feed, even though events flow correctly.\n\nRoot cause investigation:\n- Vite's http-proxy may not properly trigger EventSource.onopen for SSE connections\n- The proxy forwards data but lifecycle events don't fire as expected\n- Docker mode (direct connection) works correctly\n\nAttempted fixes that didn't work:\n- Setting connected=true in onmessage handler\n- The issue appears to be deeper in how Vite's proxy handles SSE\n\nWorkaround: Use Docker mode for testing SSE indicators.\n\nFiles: frontend/packages/dashboard/src/hooks/useSSE.ts, frontend/vite.config.ts","status":"open","priority":3,"issue_type":"bug","created_at":"2026-01-10T23:50:26.957457+01:00","created_by":"juanre","updated_at":"2026-01-10T23:50:36.285712+01:00"}
{"id":"beadhub-ghve","title":"Escalations get_escalation endpoint missing tenant isolation","description":"Location: routes/escalations.py:264-287. The get_escalation endpoint queries by escalation ID only (WHERE id = $1) without filtering by project_id. This may allow cross-tenant escalation access if escalation IDs can be guessed. Other endpoints like get_issue_by_bead_id correctly filter by project_id for tenant isolation. Verify if escalations should also enforce tenant isolation, and if so, add project_id filtering.","notes":"Merged and deployed tenant isolation across escalations endpoints (create/get/respond/list) and MCP tools; added regression tests.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-10T08:26:17.955325+01:00","updated_at":"2026-01-03T16:51:39.285693Z","closed_at":"2026-01-02T23:45:41.823706Z","close_reason":"Added tenant isolation to get_escalation and respond_escalation endpoints via X-Project-ID header + workspace join","dependencies":[{"issue_id":"beadhub-ghve","depends_on_id":"beadhub-5m0f","type":"discovered-from","created_at":"2025-12-10T08:26:17.956475+01:00","created_by":"juanre"}]}
{"id":"beadhub-gmc7","title":"Update AGENTS-template.md with bdh coordination instructions","description":"Update beadhub/AGENTS-template.md (the template for real agent testing) with bdh instructions:\n\n1. Use bdh instead of bd for all bead operations\n2. bdh init to set up workspace (explain when this happens)\n3. Workflow: bdh ready -\u003e bdh update --status in_progress -\u003e work -\u003e bdh close\n4. Handling rejections (bead already claimed)\n5. Messaging other agents (bdh inbox, bdh send)\n6. Escalating to human (bdh escalate)\n\nKeep it concise - agents don't need to know implementation details.\n\nThis is the template that will be used for real testing with Claude instances.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T09:35:32.81296+01:00","updated_at":"2025-12-10T15:55:19.441058+01:00","closed_at":"2025-12-10T15:55:19.441058+01:00","dependencies":[{"issue_id":"beadhub-gmc7","depends_on_id":"beadhub-4trs","type":"parent-child","created_at":"2025-12-10T09:36:05.899247+01:00","created_by":"juanre"},{"issue_id":"beadhub-gmc7","depends_on_id":"beadhub-uz09","type":"blocks","created_at":"2025-12-10T09:36:15.635582+01:00","created_by":"juanre"}]}
{"id":"beadhub-go0","title":"Create cloud beads sync endpoint with tenant scoping","description":"Add POST /api/v1/cloud/repos/{repo}/branches/{branch}/beads/sync endpoint in beadhub-cloud. Authenticate via API key, extract project_id from key. Upsert project_repos entry. Call OSS _sync_issues_to_db() with namespaced repo_key ({project_id}:{repo}). Return sync summary.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T22:52:37.040796+01:00","updated_at":"2025-12-07T08:54:51.795562+01:00","closed_at":"2025-12-07T08:54:51.795562+01:00","dependencies":[{"issue_id":"beadhub-go0","depends_on_id":"beadhub-ya3","type":"blocks","created_at":"2025-12-06T22:54:28.1371+01:00","created_by":"juanre"},{"issue_id":"beadhub-go0","depends_on_id":"beadhub-0q4","type":"blocks","created_at":"2025-12-06T22:54:28.191141+01:00","created_by":"juanre"}]}
{"id":"beadhub-go2o","title":"DB migration: add hostname and workspace_path columns","description":"Add hostname (varchar) and workspace_path (text) columns to workspaces table. Both nullable for backwards compatibility with existing workspaces.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T19:07:00.277848+01:00","updated_at":"2025-12-21T20:16:31.496726+01:00","closed_at":"2025-12-21T20:16:31.496726+01:00","close_reason":"Added hostname and workspace_path columns to workspaces table with proper immutability (NULLâ†’value allowed, value changes rejected). Updated trigger to preserve repo_id NULL-transition and auto-soft-delete logic. Added index for hostname-based queries.","dependencies":[{"issue_id":"beadhub-go2o","depends_on_id":"beadhub-5wir","type":"parent-child","created_at":"2025-12-17T19:07:00.279306+01:00","created_by":"juanre"}]}
{"id":"beadhub-gon","title":"Add metrics/observability (Prometheus, structured logging)","description":"Add minimal observability for production debugging and performance.\n\nScope proposal (keep small):\n1) Structured logging: request_id, route, status_code, latency_ms, workspace_id/project_id when available (no PII/secrets).\n2) Prometheus metrics endpoint (/metrics) with counters/histograms for HTTP requests and key subsystems (db, redis).\n3) Dashboard-friendly health/uptime metrics.\n\nNon-goals:\n- Full tracing (OpenTelemetry) unless needed later.\n\nDecision gate:\n- If we are not targeting production deployments soon, defer/close.","acceptance_criteria":"- /metrics endpoint exposed (behind API key or network restriction as appropriate)\n- Request logs include request_id + latency\n- Docs updated with how to enable/secure metrics\n- Basic tests for metrics endpoint","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-03T15:39:13.843195+01:00","updated_at":"2026-01-03T16:42:53.519023Z"}
{"id":"beadhub-gooj","title":"Remove bundled fonts from OSS dashboard","description":"Ensure no fonts are bundled in the OSS dashboard repo. Remove any font imports or embedded font files.","status":"closed","priority":1,"issue_type":"chore","created_at":"2026-01-06T18:58:11.985316Z","created_by":"juanre","updated_at":"2026-01-06T19:08:30.123041Z","closed_at":"2026-01-06T19:08:30.123041Z","close_reason":"Implemented"}
{"id":"beadhub-gpm","title":"Modify main.py to mount beadhub core app","description":"Update main.py to import beadhub.api.create_app and mount it. Remove llmring-server integration. The SaaS layer wraps the OSS core with auth middleware.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-03T08:21:08.046482+01:00","updated_at":"2025-12-03T08:33:00.108979+01:00","closed_at":"2025-12-03T08:33:00.108979+01:00","close_reason":"Rewrote main.py for beadhub-cloud: removed llmring-server integration, kept SaaS auth infrastructure. TODO: mount beadhub OSS routes once library mode is supported.","dependencies":[{"issue_id":"beadhub-gpm","depends_on_id":"beadhub-p4i","type":"blocks","created_at":"2025-12-03T08:21:13.365602+01:00","created_by":"juanre"}]}
{"id":"beadhub-grq9","title":"Beads API: server-side sort so new issues appear","description":"Problem (from eve-frontend):\n- \"Server-side sorting needed for beads API - new beads not appearing in frontend\"\n\nSymptoms\n- Frontend does not show newly created/updated beads reliably.\n- Likely triggered when the list endpoint returns a limited page ordered by priority/bead_id, causing recently-synced items to fall outside the first page.\n\nCurrent backend behavior\n- `GET /v1/beads/issues` in `src/beadhub/routes/beads.py` currently orders results as:\n  - `ORDER BY priority ASC, bead_id ASC LIMIT \u003climit\u003e`\n- This is deterministic but not â€œrecently changedâ€ friendly.\n\nExpected behavior\n- Default listing should surface new/updated/synced issues so the UI shows recent changes without requiring client-side hacks.\n\nSuspected fix direction\n- Change default ordering to something like \"most recently updated/synced first\" (e.g., `ORDER BY COALESCE(updated_at, synced_at) DESC NULLS LAST, bead_id ASC`).\n- If we need both behaviors, add an explicit `sort=` query param and have frontend request the intended sort.\n\nRepro (to fill in)\n- Create or update a bead, run sync, refresh frontend list; observe it missing until some manual action.\n- Confirm which endpoint/view is used (likely `GET /v1/beads/issues` or OSS `GET /v1/beads/issues/all`).","acceptance_criteria":"- Identify the exact endpoint + frontend view exhibiting the issue and write a minimal repro.\n- Backend returns a useful default order where newly updated/synced beads appear without requiring client-side sorting hacks.\n- Add/adjust a test to lock in ordering semantics.\n- Frontend confirms new beads appear in the expected view.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-07T06:56:12.179921Z","created_by":"juanre","updated_at":"2026-01-09T19:09:23.978874+01:00","closed_at":"2026-01-09T19:09:23.978874+01:00","close_reason":"All subtasks completed (grq9.1, grq9.2, grq9.3 all closed)","labels":["component:api","component:beads","component:dashboard"]}
{"id":"beadhub-grq9.1","title":"Confirm repro + which beads endpoint frontend uses","description":"Coordinate with frontend to confirm which endpoint/view is impacted and provide minimal repro steps + expected ordering.","acceptance_criteria":"- Confirm whether frontend calls /v1/beads/issues or /v1/beads/issues/all (or both)\n- Provide repro steps and sample before/after response ordering\n- Decide desired default sort and whether a sort= param is needed","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T06:59:52.855929Z","created_by":"juanre","updated_at":"2026-01-07T18:24:01.522764+01:00","closed_at":"2026-01-07T18:24:01.522765+01:00","labels":["component:beads","component:dashboard"],"dependencies":[{"issue_id":"beadhub-grq9.1","depends_on_id":"beadhub-grq9","type":"parent-child","created_at":"2026-01-07T06:59:52.856614Z","created_by":"juanre"}]}
{"id":"beadhub-grq9.2","title":"Backend: change default ordering to show recently updated/synced","description":"Update the relevant beads list query to order by recency (updated_at/synced_at) so newly changed beads appear near the top under the default limit.","acceptance_criteria":"- Default list ordering shows recently updated/synced beads first\n- Ordering is deterministic (tie-breakers defined)\n- No regression for filtering options","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T06:59:53.055875Z","created_by":"juanre","updated_at":"2026-01-07T18:19:00.29435+01:00","closed_at":"2026-01-07T18:19:00.294351+01:00","labels":["component:api","component:beads"],"dependencies":[{"issue_id":"beadhub-grq9.2","depends_on_id":"beadhub-grq9","type":"parent-child","created_at":"2026-01-07T06:59:53.056569Z","created_by":"juanre"},{"issue_id":"beadhub-grq9.2","depends_on_id":"beadhub-grq9.1","type":"blocks","created_at":"2026-01-07T06:59:53.058823Z","created_by":"juanre"}]}
{"id":"beadhub-grq9.3","title":"Tests: lock in beads list ordering","description":"Add a test that inserts multiple beads with different synced/updated timestamps and asserts the list endpoint returns them in the expected order.","acceptance_criteria":"- Test covers ordering under the default limit\n- Test fails if ordering regresses to priority/bead_id only","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T06:59:53.24514Z","created_by":"juanre","updated_at":"2026-01-07T18:24:06.6125+01:00","closed_at":"2026-01-07T18:24:06.612502+01:00","labels":["area:tests","component:beads"],"dependencies":[{"issue_id":"beadhub-grq9.3","depends_on_id":"beadhub-grq9","type":"parent-child","created_at":"2026-01-07T06:59:53.245816Z","created_by":"juanre"},{"issue_id":"beadhub-grq9.3","depends_on_id":"beadhub-grq9.2","type":"blocks","created_at":"2026-01-07T06:59:53.248083Z","created_by":"juanre"}]}
{"id":"beadhub-gtb0","title":"Dashboard seed script for test data","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T17:03:52.579194+01:00","updated_at":"2025-12-08T17:06:18.850234+01:00","closed_at":"2025-12-08T17:06:18.850234+01:00"}
{"id":"beadhub-gv2q","title":"Include notification context in all endpoint responses","description":"Every server endpoint that bdh calls should include context: {messages_waiting, pending_chats} in its response. No separate endpoint - just enrich existing responses. Client extracts and displays context from whatever endpoint it called.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T11:32:16.682386+01:00","updated_at":"2025-12-13T12:15:21.074324+01:00","closed_at":"2025-12-13T12:15:21.074324+01:00","dependencies":[{"issue_id":"beadhub-gv2q","depends_on_id":"beadhub-3r30","type":"parent-child","created_at":"2025-12-13T11:32:23.455356+01:00","created_by":"juanre"}]}
{"id":"beadhub-gwws","title":"Add loading skeletons instead of plain text loading states","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-08T15:32:34.771957+01:00","updated_at":"2025-12-08T15:32:34.771957+01:00","dependencies":[{"issue_id":"beadhub-gwws","depends_on_id":"beadhub-7r4","type":"discovered-from","created_at":"2025-12-08T15:32:34.772647+01:00","created_by":"juanre"}]}
{"id":"beadhub-gxuu","title":"TECH DEBT: Consolidate duplicate UI components in frontend","description":"## Problem\n\nUI components are duplicated between two locations in the frontend monorepo.\n\n### Current Behavior\n\nComponents exist in both:\n- `frontend/src/components/ui/` (7 components)\n- `frontend/packages/dashboard/src/components/ui/` (10 components)\n\n**Duplicated components:**\n- badge.tsx\n- button.tsx\n- card.tsx\n- dialog.tsx\n- input.tsx\n- select.tsx\n- separator.tsx\n- sheet.tsx\n- tabs.tsx\n- tooltip.tsx\n\n### Impact\n\n- Changes must be made in two places\n- Components may drift out of sync\n- Larger bundle size if both are included\n- Confusing for developers (which to import?)\n\n### Solution\n\nConsolidate to single location in the shared package:\n\n1. Keep components in `frontend/packages/dashboard/src/components/ui/`\n2. Remove duplicates from `frontend/src/components/ui/`\n3. Update imports in `frontend/src/` to use package\n\n```typescript\n// Before (frontend/src/components/SomeComponent.tsx)\nimport { Button } from \"./ui/button\"\n\n// After\nimport { Button } from \"@beadhub/dashboard/components/ui/button\"\n// Or re-export from package index\nimport { Button } from \"@beadhub/dashboard\"\n```\n\n### Files to Update\n\n- Delete `frontend/src/components/ui/*.tsx` (10 files)\n- Update imports in `frontend/src/components/` and `frontend/src/pages/`\n- Ensure package exports all UI components\n\n### Acceptance Criteria\n\n- [ ] Single location for each UI component\n- [ ] No duplicate component files\n- [ ] All imports updated to use shared package\n- [ ] Frontend builds and runs correctly\n- [ ] No visual regressions","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-08T12:43:00.370253+01:00","created_by":"juanre","updated_at":"2026-01-16T10:26:00.049922+01:00","closed_at":"2026-01-16T10:26:00.049922+01:00","close_reason":"Consolidated UI components to @beadhub/dashboard/components/ui. Deleted 12 duplicate files from frontend/src/components/ui/, updated all imports."}
{"id":"beadhub-h0bo","title":"Implement bdh :create-worktree command","description":"Implement the functionality of `scripts/create-worktree.sh` as a native bdh command.\n\n## Current state\n\nThe shell script `scripts/create-worktree.sh` is used frequently to create new agent worktrees. It:\n1. Queries BeadHub for the next available name prefix via `bdh :next-alias-prefix`\n2. Validates the prefix format (lowercase letters, optional -NN suffix)\n3. Creates a git worktree at `../\u003crepo-name\u003e-\u003cbranch\u003e/`\n4. Runs `bdh :init --alias \"$NAME_PREFIX-$ROLE\" --role \"$ROLE\"` in the new worktree\n5. Cleans up (removes worktree + branch) if init fails\n\n## Proposed command\n\n```\nbdh :create-worktree \u003crole\u003e [--alias \u003calias\u003e]\n```\n\n### Parameters\n- `role` (required, positional): The workspace role (e.g., \"coord\", \"backend\", \"full-stack\")\n- `--alias` (optional): Override the default alias. Default is `$NAME_PREFIX-$ROLE`\n\n### What it does NOT need\n- `--beadhub-url`: Inherited from main repo config\n- `--human`: Same human for all worktrees  \n- `--project`: Same project for all worktrees\n- `--inject-docs`: Not applicable (worktrees share repo files and .beads/)\n\n## Implementation approach\n\n**Option A (recommended): Use `os.Chdir()`**\n- Change to the new worktree directory before calling the existing `runInit()` logic\n- Simplest approach, reuses existing code\n- This is what the shell script does anyway\n\n**Git operations needed** (all simple `exec.Command` calls):\n```go\ngit rev-parse --show-toplevel     // find main repo\ngit rev-parse --verify \u003cbranch\u003e   // check if branch exists\ngit worktree add \u003cpath\u003e \u003cbranch\u003e  // create worktree (existing branch)\ngit worktree add \u003cpath\u003e -b \u003cbranch\u003e  // create worktree (new branch)\ngit worktree remove \u003cpath\u003e --force   // cleanup on failure\ngit branch -d \u003cbranch\u003e            // cleanup branch on failure\n```\n\n**Cleanup on failure:**\n- Remove the worktree directory\n- Delete the branch if it was newly created and has no commits ahead of main\n- Check `git worktree list` to ensure branch isn't used elsewhere before deleting\n\n## Files to create/modify\n\n- **New**: `bdh/internal/commands/create_worktree.go` (~150-200 lines)\n- **New**: `bdh/internal/commands/create_worktree_test.go` (~100-150 lines)\n- **Modify**: `bdh/internal/commands/root.go` (add command registration, 1 line)\n\n## Output format\n\nShould print step-by-step progress similar to the shell script:\n```\nQuerying BeadHub for next available name...\nCreating worktree for branch 'alice'...\n  Main repo: /path/to/repo\n  Worktree:  /path/to/repo-alice\n  Role:      coord\n  Alias:     alice-coord\n\nCreating git worktree...\n  Creating new branch 'alice'\nInitializing bdh...\n[... init output ...]\n\nDone! Worktree created at: /path/to/repo-alice\n\nTo use:\n  cd /path/to/repo-alice\n  bdh ready\n```\n\n## Edge cases to handle\n\n1. Directory already exists at worktree path\n2. Branch already exists (use it) vs needs creation\n3. `bdh :init` fails (full cleanup required)\n4. Alias already taken (suggest retry with new name)\n5. Repo not registered (error with helpful message)","status":"closed","priority":2,"issue_type":"feature","assignee":"frank-implementer","owner":"juan@juanreyero.com","created_at":"2026-01-18T09:14:38.916631+01:00","created_by":"Juan Reyero","updated_at":"2026-01-18T15:29:56.747098+01:00","closed_at":"2026-01-18T15:29:56.747098+01:00","close_reason":"Implemented bdh :create-worktree command with tests and security fixes from code review"}
{"id":"beadhub-h2bz","title":"Cloud: Cascade project deletion to OSS","description":"When Cloud project is deleted via DELETE /api/v1/projects/{id}, cascade to OSS by calling DELETE /v1/projects/{id}. This triggers the full cascade: hard-delete repos, soft-delete workspaces, release claims, clear presence.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T15:58:06.323472+01:00","updated_at":"2025-12-21T18:17:41.943815+01:00","closed_at":"2025-12-21T18:17:41.943815+01:00","close_reason":"Moved to beadhub-cloud as beadhub-cloud-u92","dependencies":[{"issue_id":"beadhub-h2bz","depends_on_id":"beadhub-1thq","type":"blocks","created_at":"2025-12-21T15:58:35.956993+01:00","created_by":"juanre"},{"issue_id":"beadhub-h2bz","depends_on_id":"beadhub-wyqv","type":"blocks","created_at":"2025-12-21T15:58:36.246911+01:00","created_by":"juanre"}]}
{"id":"beadhub-h48b","title":"Backend: Add created_at to beads API responses","description":"The frontend now expects created_at in BeadIssue responses, but the backend beads.py doesn't return it.\n\n## Files to fix\n`src/beadhub/routes/beads.py`:\n1. List endpoint: Add `created_at` to the SELECT and response dict\n2. Detail endpoint: Add `created_at` (and verify `updated_at`) to SELECT and response dict\n\nThe database schema already has these columns (see migrations).\n\n## Blocked by\nbeadhub-hdeo (frontend changes) - should merge frontend first, then this.\n\n## Related\nbeadhub-hdeo - frontend changes that display created_at","status":"closed","priority":2,"issue_type":"task","assignee":"alice-coordinator","owner":"juan@juanreyero.com","created_at":"2026-02-05T12:15:46.742594Z","created_by":"Juan Reyero","updated_at":"2026-02-05T12:24:25.401303Z","closed_at":"2026-02-05T12:24:25.401303Z","close_reason":"Backend fix complete - created_at and updated_at now returned in beads API"}
{"id":"beadhub-h4db","title":"Show issue title in Claims cards","description":"Claims cards only show bead_id. Should also show the issue title for context. May require fetching issue data or expanding the claims API response.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T12:14:58.307999+01:00","updated_at":"2025-12-13T12:51:24.770427+01:00","closed_at":"2025-12-13T12:51:24.770427+01:00"}
{"id":"beadhub-h63","title":"Improve CLI error handling and validation","description":"Network error handling, input validation, int conversion safety","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-03T06:38:50.29288+01:00","updated_at":"2025-12-03T19:31:50.655879+01:00","closed_at":"2025-12-03T19:31:50.655879+01:00"}
{"id":"beadhub-h7cc","title":"Add composite index on bead_claims (workspace_id, claimed_at DESC)","description":"Current index is just (workspace_id). A composite index would make ORDER BY claimed_at DESC LIMIT 1 queries faster. Used by _tool_whois and _tool_list_agents. Discovered during beadhub-oqdq review.","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-20T11:42:15.127252+01:00","updated_at":"2025-12-20T13:21:55.371002+01:00","closed_at":"2025-12-20T13:21:55.371002+01:00","close_reason":"Updated bead_claims workspace index to composite (workspace_id, claimed_at DESC); tests: uv run pytest tests/test_db_migrations.py::test_bead_claims_table tests/test_mcp.py::test_mcp_messaging_and_agents."}
{"id":"beadhub-h824","title":"OSS API: GET /v1/projects/{id} - get project details","description":"Add endpoint to get single project with details. Return project info plus counts of repos and workspaces.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T15:25:34.377352+01:00","updated_at":"2025-12-21T16:42:18.949064+01:00","closed_at":"2025-12-21T16:42:18.949064+01:00","close_reason":"Implemented GET /v1/projects, GET /v1/projects/{id}, and GET /v1/repos endpoints with tests","dependencies":[{"issue_id":"beadhub-h824","depends_on_id":"beadhub-1thq","type":"blocks","created_at":"2025-12-21T15:26:54.6511+01:00","created_by":"juanre"}]}
{"id":"beadhub-h9n2","title":"Prevent deleted workspace resurrection in /v1/bdh/command and /sync","description":"Critical: Deleted workspaces can resurrect by running bdh commands. upsert_workspace() in bdh.py doesn't check deleted_at before upserting. Fix: Check deleted_at IS NULL before allowing operations, return 410 Gone if deleted. Affects both /v1/bdh/command (line 682) and /v1/bdh/sync (line 916).","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-17T08:01:23.434467+01:00","updated_at":"2025-12-17T18:48:36.629965+01:00","closed_at":"2025-12-17T18:48:36.629965+01:00","dependencies":[{"issue_id":"beadhub-h9n2","depends_on_id":"beadhub-lmtj","type":"discovered-from","created_at":"2025-12-17T08:01:23.435248+01:00","created_by":"juanre"}]}
{"id":"beadhub-h9w","title":"ensure_workspace MCP tool needs auth bridge integration","description":"For cloud multi-tenant deployment, ensure_workspace MCP tool needs to be restricted. Currently it can look up/create workspaces without tenant authentication. In OSS single-tenant this is fine (self-registration). For cloud: derive project context from API key auth or restrict to admin scope.\n\nMoved from beadhub-02a (cloud-specific concern).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T08:34:48.978789+01:00","updated_at":"2025-12-08T08:34:54.845216+01:00","closed_at":"2025-12-08T08:34:54.845216+01:00"}
{"id":"beadhub-hbd5","title":"Make /v1/init transactional (DB atomicity)","acceptance_criteria":"All /v1/init DB changes commit or rollback as one unit; induced mid-flow failure leaves no partial project/repo/workspace/api_key rows; existing workspace init remains idempotent and returns existing workspace_id while issuing a new API key.","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-18T11:42:33.102428+01:00","created_by":"Juan Reyero","updated_at":"2026-01-18T11:43:12.332708+01:00","closed_at":"2026-01-18T11:43:12.332708+01:00","close_reason":"Implemented and validated (tests passing).","labels":["backend","db","oss"]}
{"id":"beadhub-hbld","title":"Chat scalability/isolation: avoid Redis SCAN + scope alias lookup by project","description":"Chat session discovery uses Redis SCAN across all sessions and aliasâ†’workspace resolution is not project-scoped.\n\nObserved:\n- `_find_session_by_alias()` scans `chat:session:*` and loads each session hash.\n- `_resolve_alias_to_workspace()` queries workspaces by `alias` without `project_id`, but aliases are only unique per project.\n\nImpact:\n- Scalability: O(total sessions) scans on hot paths.\n- Correctness: cross-project alias collisions can resolve the wrong workspace.\n- Tenancy risk in SaaS mode if chat is exposed per-project.\n\nFix:\n- Make alias resolution require project context: query `workspaces` by (project_id, alias).\n- Avoid SCAN by maintaining indexed keys:\n  - `chat:pair:{project_id}:{ws_a}:{ws_b}` -\u003e session_id, or\n  - `chat:active:{project_id}:{alias_a}:{alias_b}` -\u003e session_id.\n- Ensure all chat session operations enforce `project_id`.\n\nRefs:\n- `beadhub/src/beadhub/routes/chat.py`","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T10:48:18.69668+01:00","updated_at":"2025-12-13T14:26:28.921301+01:00","closed_at":"2025-12-13T14:26:28.921301+01:00","dependencies":[{"issue_id":"beadhub-hbld","depends_on_id":"beadhub-dtcl","type":"discovered-from","created_at":"2025-12-13T10:48:18.697552+01:00","created_by":"juanre"}]}
{"id":"beadhub-hbld.1","title":"Add project_id to _pair_key() for session isolation","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T14:20:05.449733+01:00","updated_at":"2025-12-13T14:23:04.371028+01:00","closed_at":"2025-12-13T14:23:04.371028+01:00","dependencies":[{"issue_id":"beadhub-hbld.1","depends_on_id":"beadhub-hbld","type":"parent-child","created_at":"2025-12-13T14:20:05.450291+01:00","created_by":"juanre"}]}
{"id":"beadhub-hbld.2","title":"Add project_id to _resolve_alias_to_workspace() - alias unique per project","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T14:20:05.72917+01:00","updated_at":"2025-12-13T14:23:04.371685+01:00","closed_at":"2025-12-13T14:23:04.371685+01:00","dependencies":[{"issue_id":"beadhub-hbld.2","depends_on_id":"beadhub-hbld","type":"parent-child","created_at":"2025-12-13T14:20:05.729647+01:00","created_by":"juanre"}]}
{"id":"beadhub-hbld.3","title":"Replace _find_session_by_alias() SCAN with pair key lookup","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T14:20:06.021172+01:00","updated_at":"2025-12-13T14:23:04.371944+01:00","closed_at":"2025-12-13T14:23:04.371944+01:00","dependencies":[{"issue_id":"beadhub-hbld.3","depends_on_id":"beadhub-hbld","type":"parent-child","created_at":"2025-12-13T14:20:06.021699+01:00","created_by":"juanre"}]}
{"id":"beadhub-hbld.4","title":"Add tests for project-scoped chat session isolation","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T14:20:06.306085+01:00","updated_at":"2025-12-13T14:23:04.372171+01:00","closed_at":"2025-12-13T14:23:04.372171+01:00","dependencies":[{"issue_id":"beadhub-hbld.4","depends_on_id":"beadhub-hbld","type":"parent-child","created_at":"2025-12-13T14:20:06.306633+01:00","created_by":"juanre"}]}
{"id":"beadhub-hdeo","title":"Frontend: creation dates missing from beads list and detail view","description":"**Frontend regression**: `created_at` missing from beads views.\n\n## Root cause\nThe `BeadIssue` TypeScript interface in `frontend/packages/dashboard/src/lib/api.ts` does not include `created_at`, even though the backend API returns it.\n\n## Files to fix\n\n1. **api.ts** (line ~74): Add `created_at?: string | null` to BeadIssue interface\n\n2. **IssuesPage.tsx** (IssueCard component): Add created_at display similar to how updated_at is shown (lines 215-223)\n\n3. **IssueDetailSheet.tsx**: Add \"Created\" section similar to \"Last Updated\" section (lines 232-248)\n\n## Reference\nClaimsPage.tsx correctly shows `claimed_at` (lines 176-179) - use same pattern with `formatRelativeTime()`.","status":"closed","priority":2,"issue_type":"bug","assignee":"frank-frontend","owner":"juan@juanreyero.com","created_at":"2026-02-05T11:34:33.486524Z","created_by":"Juan Reyero","updated_at":"2026-02-05T12:20:57.134462Z","closed_at":"2026-02-05T12:20:57.134462Z","close_reason":"Merged to main (9acaeb7). Backend task beadhub-h48b needed for dates to actually display."}
{"id":"beadhub-hdtd","title":"Resolve race condition in bead claim approval","description":"Race condition: Two workspaces can both get 'approved' for the same bead if they call /v1/bdh/command simultaneously before either syncs. The database UNIQUE constraint catches this but only AFTER both agents think they have approval. Options: 1) Make endpoint transactional (create claim immediately) 2) Add optimistic lock token 3) Make pre-flight advisory-only. Currently documented but not resolved.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T10:43:04.653734+01:00","updated_at":"2025-12-10T10:43:04.653734+01:00","dependencies":[{"issue_id":"beadhub-hdtd","depends_on_id":"beadhub-f5il","type":"discovered-from","created_at":"2025-12-10T10:43:04.65461+01:00","created_by":"juanre"}]}
{"id":"beadhub-hdyd","title":"Dashboard: StatusPage SSE connects without filter when no filter selected","description":"## Problem\n\nIn `frontend/src/pages/StatusPage.tsx:197-205`, when no workspace/project filter is active, the dashboard connects to SSE without any filter:\n\n```tsx\nconst { connected } = useSSE({\n    workspaceId: workspaceId || undefined,\n    projectSlug: \\!workspaceId ? projectSlugFilter || undefined : undefined,\n    enabled: true,\n    // No filter â†’ tries to subscribe to ALL workspaces\n```\n\nCombined with the server now querying ALL workspaces from database (beadhub-up58), this means every dashboard session tries to subscribe to potentially thousands of workspace channels.\n\n## Location\n\n`frontend/src/pages/StatusPage.tsx:197-205`\n\n## Fix Required\n\n1. Dashboard should always pass a project filter (project_id from DashboardIdentity or project_slug from config)\n2. Alternatively, show a 'select project' prompt before connecting SSE\n3. For OSS single-project deployments, auto-detect the single project\n\n## Related\n\n- beadhub-up58: SSE needs limit\n- beadhub-qmp0: project_slug filter uses Redis","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-21T09:48:46.02258+01:00","updated_at":"2025-12-21T12:47:02.83059+01:00","closed_at":"2025-12-21T12:47:02.83059+01:00","close_reason":"Implemented project_id filter for SSE. Dashboard now uses dashboardIdentity.project_id as default filter. Security: project_id query param rejected in Cloud mode (auth enabled), only allowed in OSS mode. Added tests for validation and security.","dependencies":[{"issue_id":"beadhub-hdyd","depends_on_id":"beadhub-up58","type":"blocks","created_at":"2025-12-21T09:49:04.852926+01:00","created_by":"juanre"},{"issue_id":"beadhub-hdyd","depends_on_id":"beadhub-tyf3","type":"blocks","created_at":"2025-12-21T09:49:28.261282+01:00","created_by":"juanre"}]}
{"id":"beadhub-hi0g","title":"Sender: Only append \\n. when --no-wait or message is just '.'","description":"In bdh/internal/commands/chat.go sendMessage():\n\nWhen --no-wait is set (chatNoWait || chatWait == 0):\n- Append \\n.[bdh-signing-off] to message before sending\n- Exit immediately after POST succeeds\n\nRegular messages (no --no-wait):\n- Send message as-is\n- Wait for reply via SSE","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-14T11:08:39.696308+01:00","updated_at":"2025-12-14T11:39:05.53941+01:00","closed_at":"2025-12-14T11:39:05.53941+01:00"}
{"id":"beadhub-hj4v","title":"CLI-first onboarding + OSS program join flow","description":"## Problem\n\nBeadHub Cloud onboarding currently has too much friction for â€œclone a repo and start coordinating immediatelyâ€, especially for OSS contributions.\nWe want a CLI-first onboarding path where a contributor can install `bdh`, run `bdh :init`, and quickly reach a useful read-only coordination view, then request write access that maintainers can approve.\n\nWe also need to prevent â€œghost workspacesâ€ where Redis presence exists without a durable SQL workspace row, which breaks dashboard filtering and tenant isolation.\n\n## Goals\n\n1. CLI-first onboarding for OSS program repos: clone â†’ install â†’ `bdh :init` reaches value quickly.\n2. Deterministic repo â†’ project resolution for OSS onboarding.\n3. Read-only until maintainer approval; maintainers control all write access.\n4. No anonymous/public write surfaces.\n5. Strong tenant isolation and no partial/ghost state.\n\n## Non-goals (v1)\n\n- Full OAuth/device-code browser login in `bdh`.\n- Public indexing of raw chat/inbox/escalation bodies.\n- Allowing anonymous â€œcomment to agentâ€ or other public write endpoints.\n\n## Key concept: Official Public Project registry\n\nIn BeadHubâ€™s tenant model, the same `canonical_origin` may exist in multiple private projects (different teams coordinating privately on the same upstream repo). For OSS onboarding to be deterministic, the OSS program designates **exactly one** official public Cloud project per `canonical_origin`.\n\nInvariant:\n- For OSS program repos, `canonical_origin â†’ public_project_id` is unique and stable.\n\n## User-facing flow (OSS contributor)\n\nTarget:\n\n```bash\ncurl -fsSL https://raw.githubusercontent.com/beadhub/beadhub/main/bdh/install.sh | sh\nbdh :init\n```\n\nFlow:\n1. `bdh :init` defaults `BEADHUB_URL` to `https://app.beadhub.ai`.\n2. `bdh :init` reads git origin and computes `canonical_origin`.\n3. `bdh :init` resolves `canonical_origin` â†’ official public project.\n   - If not enrolled: exit with â€œrepo not enrolledâ€ + link/instructions.\n4. `bdh :init` creates/updates local `.beadhub` identity:\n   - `workspace_id` (new)\n   - `beadhub_url`\n   - `project_slug` (or `project_id` if available)\n   - `alias`, `human_name`, `role`\n   - `repo_origin`, `canonical_origin`\n5. CLI prompts for email (unless already authenticated) and creates a join request.\n6. User verifies email (â‰¤ 1 hour). Until verified, the join request expires.\n7. After verification, user is granted read-only access to the official public project.\n8. Project admins/maintainers receive a notification and can approve/deny.\n9. After approval, user gains write permissions (chat/mail, claims, locks) per RBAC.\n\n## Maintainer flow\n\n- Enroll repo in OSS program by declaring the official public project for a `canonical_origin`.\n- Receive join request notification (email + dashboard view).\n- Approve/deny.\n\n## Permissions model\n\nStates:\n- **Pending (unverified):** no access.\n- **Verified, not approved:** read-only access to official public project.\n- **Approved member:** write access per RBAC.\n\nRead-only surfaces (verified, not approved):\n- workspaces list (alias/role/last_seen; no `workspace_id`)\n- claims list (bead_id + who)\n- locks summary (counts; optionally file paths if project enables)\n- beads/issues list (titles/status; descriptions optional toggle)\n- messages/chat/escalation bodies: NOT visible\n\nWrite surfaces (approved only):\n- send mail/chat\n- claim beads\n- reserve/renew/release locks\n\n## Backend deliverables (v1)\n\n1) Official public project registry\n- Suggested table: `oss_public_projects(canonical_origin PRIMARY KEY, project_id, repo_id, enabled, created_at, updated_at)`\n- Admin endpoints to set/clear mapping.\n- Public resolution endpoint:\n  - `GET /api/v1/oss/resolve?canonical_origin=...` â†’ minimal project info for init + join.\n\n2) Join request workflow\n- `POST /api/v1/oss/join/request`:\n  - Input: canonical_origin, email, requested_alias?, human_name?\n  - Behavior: create pending join request; send verification email; rate-limit + dedupe.\n- `GET /api/v1/oss/join/verify?token=...`:\n  - Behavior: verify email, activate read-only access, notify project admins.\n\n3) Maintainer approval endpoints\n- `POST /api/v1/projects/{project_id}/join-requests/{id}/approve`\n- `POST /api/v1/projects/{project_id}/join-requests/{id}/deny`\n\n4) Cloud onboarding invariant (no ghost workspaces)\n- In Cloud mode, any presence/heartbeat/SSE connect that writes Redis presence must first upsert the workspace row in SQL (auth-derived project_id) or reject.\n\n## CLI deliverables (v1)\n\n- `bdh :init` supports OSS join mode when no `BEADHUB_API_KEY` is present.\n- `bdh :init` performs canonical_origin resolution + join request creation.\n- `bdh` provides a clear read-only UX when verified-but-not-approved.\n- `.beadhub` includes `repo_origin` + `canonical_origin`.\n- On each command, detect repo mismatch (git remote differs from stored canonical_origin) and fail closed (â€œre-init requiredâ€).\n\n## Abuse controls\n\n- Rate limit join requests per IP + per email + per canonical_origin.\n- Dedupe join requests to avoid spamming maintainers.\n- Verification tokens hashed-at-rest; never log tokens.\n- TTL cleanup for unverified pending accounts/join requests (1 hour).\n\n## Related / dependencies\n\n- `beadhub-qp4p`: Go bdh init: handle 409 from repos/lookup (ambiguous repo)\n- `beadhub-iqxh`: Review bdh init UX: consider interactive input instead of env vars\n","design":"Design notes / open questions\n\n- Auth shape for OSS join flow:\n  - Option 1: verification link returns a short-lived read-only token for the official public project (stored in .beadhub as a viewer_token).\n  - Option 2: read-only endpoints for official public projects are public (no auth) and we only use verification/approval for write permissions.\n  Recommendation: Option 1 (token) to reduce scraping/DoS and keep â€˜no enumerationâ€™ patterns consistent; still make status pages optionally indexable.\n\n- UX copy: keep it explicit that before approval you are read-only and cannot message/claim/lock.\n\n- Implementation order: first fix Cloud invariant â€œno Redis-only workspacesâ€ (presence/heartbeat/SSE connect upserts SQL) to avoid ghost UX.\n\n- Do not couple this epic to full OAuth/device-code in v1; keep v1 as email verification + approval.","acceptance_criteria":"- CLI-first join flow works for enrolled OSS repo\n- Official public project is deterministic per canonical_origin\n- Unverified pending accounts expire\n- Read-only until maintainer approval\n- No anonymous write surfaces\n- Cloud presence never exists without SQL workspace row","status":"tombstone","priority":2,"issue_type":"epic","created_at":"2026-01-06T20:50:18.381046Z","created_by":"juanre","updated_at":"2026-01-07T15:26:46.522044+01:00","deleted_at":"2026-01-07T15:26:46.522044+01:00","deleted_by":"juanre","delete_reason":"Migrated to beadhub-cloud-dc1","original_type":"epic"}
{"id":"beadhub-hj7e","title":"Add mail section to AGENTS-template.md","description":"Add comprehensive mail documentation to docs/AGENTS-template.md alongside chat. Include: (1) When to use mail vs chat, (2) bdh :inbox command, (3) bdh :send command, (4) bdh :ack command, (5) Examples of async communication patterns.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-15T17:40:08.265518+01:00","updated_at":"2025-12-15T17:51:02.558971+01:00","closed_at":"2025-12-15T17:51:02.558971+01:00"}
{"id":"beadhub-hk3e","title":"Frontend dashboard doesn't display lock events in event stream","description":"The SSE lock events (lock.acquired, lock.released, lock.renewed) are being published correctly by the backend, but the frontend dashboard is not displaying them. Likely caused by frontend filtering that doesn't include the 'lock' event type.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-17T22:00:11.129605+01:00","updated_at":"2025-12-20T12:36:06.319632+01:00","closed_at":"2025-12-20T12:36:06.319632+01:00","close_reason":"Lock events display correctly when a project/workspace filter is selected. SSE only enables with a filter."}
{"id":"beadhub-hkga","title":"Duplicate validation helper functions across routes","description":"Location: routes/reservations.py, messages.py, escalations.py, subscriptions.py, agents.py. _validate_workspace_id_field and _validate_agent_name_field are copy-pasted across multiple files. Fix: extract to a shared validation module.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-08T18:25:59.981778+01:00","updated_at":"2025-12-08T18:25:59.981778+01:00"}
{"id":"beadhub-ho1k","title":"Add canonical_origin validation in repo lookup path","description":"In bdh/internal/commands/init.go, the ensure path validates canonical_origin is not empty (line 164-172), but the lookup path (lines 106-123) does not. If lookup returns a repo with empty canonical_origin (data corruption), validation is bypassed. Add same validation after line 123.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T10:50:06.541469+01:00","updated_at":"2025-12-13T16:26:59.40058+01:00","closed_at":"2025-12-13T16:26:59.40058+01:00"}
{"id":"beadhub-hp7z","title":"bdh ready: show recent focus apex when no active claims","description":"Update bdh (Go) output for 'bdh ready' to show the last focus apex when the workspace has no active claims.\n\nCurrent behavior:\n- WORKING ON is only printed when MyClaims is non-empty (claims-derived apex).\n\nDesired behavior:\n- If MyClaims non-empty: keep current WORKING ON from active claims.\n- Else if focus apex exists: print a fallback section (e.g., 'RECENT CONTEXT:' or 'LAST APEX:') showing apex id + title.\n- Must be clearly labeled as not an active claim.\n\nTests:\n- Add/update passthrough tests to cover the fallback display.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T19:38:42.671994+01:00","updated_at":"2025-12-21T20:03:49.902681+01:00","closed_at":"2025-12-21T20:03:49.902681+01:00","close_reason":"Show recent focus in bdh ready","dependencies":[{"issue_id":"beadhub-hp7z","depends_on_id":"beadhub-s35l","type":"parent-child","created_at":"2025-12-21T19:38:42.673329+01:00","created_by":"juanre"}]}
{"id":"beadhub-hque","title":"Include role in /v1/messages/inbox response","description":"Add from_role field to inbox messages showing sender's role","status":"closed","priority":1,"issue_type":"task","assignee":"dave-agent","created_at":"2025-12-14T09:06:36.845325+01:00","updated_at":"2026-01-03T18:22:36.857315Z","closed_at":"2026-01-03T18:22:36.857315Z","close_reason":"Added from_role to /v1/messages/inbox via workspaces join; updated tests.","dependencies":[{"issue_id":"beadhub-hque","depends_on_id":"beadhub-089o","type":"blocks","created_at":"2025-12-14T09:06:55.900851+01:00","created_by":"juanre"},{"issue_id":"beadhub-hque","depends_on_id":"beadhub-161u","type":"parent-child","created_at":"2025-12-14T09:24:11.302101+01:00","created_by":"juanre","metadata":"{}"}]}
{"id":"beadhub-hrq5","title":"Server: optimize presence merge for /v1/workspaces (no global presence scan)","description":"Context\n- In branch `be`, `/v1/workspaces` and `/v1/status` still merge presence by calling `list_agent_presences(redis)` (global), which is O(total_active_workspaces) and violates the SOT scaling rule for request handlers.\n- For the new Workspaces API vNext (beadhub-qrnr), presence merge must be strictly O(result_size).\n\nGoal\n- Introduce a presence lookup helper that fetches presence hashes for a specific list of workspace_ids (pipeline HGETALL), and migrate workspaces endpoints to use it.\n\nWork\n1) Add helper in `src/beadhub/presence.py`\n   - `list_agent_presences_by_workspace_ids(redis, workspace_ids: list[str]) -\u003e list[dict[str,str]]`\n   - Must be safe with empty lists and missing keys.\n\n2) Update endpoints\n- `/v1/workspaces` and `/v1/workspaces/team` (new) must use the bounded helper, never the global presence list.\n- If we keep `/v1/status` (snapshot) for â€œall workspacesâ€ views, it can retain the global list, but any filtered/bounded path should use the bounded helper.\n\nValidation\n- Unit test uses FakeRedis to assert only requested keys are accessed (no SMEMBERS idx:all_workspaces and no presence:* scans).\n- Ensure functional parity: online/offline status still correct for returned workspaces.\n\nDone when\n- Presence fetch cost scales with the number of workspaces returned, not the number of active workspaces overall.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T08:51:10.19611+01:00","updated_at":"2025-12-21T16:46:47.907228+01:00","closed_at":"2025-12-21T16:46:47.907228+01:00","close_reason":"Add bounded presence helper guard test","dependencies":[{"issue_id":"beadhub-hrq5","depends_on_id":"beadhub-o9h7","type":"discovered-from","created_at":"2025-12-21T08:51:10.197351+01:00","created_by":"juanre"}]}
{"id":"beadhub-hs99","title":"Epic: Split BeadHub into aweb + beadhub (v1)","description":"Deliver aweb as standalone coordination substrate and make beadhub depend on it. Spec: ../beadhub-sot/source-of-truth/beadhub-aweb-split.md","acceptance_criteria":"All conformance tests pass; aweb and beadhub can run as two services; bdh coordination commands use aweb; beadhub no longer owns API key verification.","status":"open","priority":1,"issue_type":"epic","owner":"juan@juanreyero.com","created_at":"2026-01-20T11:34:37.128654+01:00","created_by":"Juan Reyero","updated_at":"2026-01-20T11:34:37.128654+01:00"}
{"id":"beadhub-hs99.1","title":"aweb: Conformance test harness","description":"Build black-box tests that validate aweb HTTP+SSE behavior against AWEB_URL.","acceptance_criteria":"Runner can target a URL, set auth, and assert required responses/events deterministically.","status":"closed","priority":1,"issue_type":"chore","owner":"juan@juanreyero.com","created_at":"2026-01-20T11:37:04.620042+01:00","created_by":"Juan Reyero","updated_at":"2026-01-20T11:44:18.060131+01:00","closed_at":"2026-01-20T11:44:18.060131+01:00","close_reason":"Add black-box aweb conformance harness skeleton under tests/aweb_conformance (skipped unless AWEB_CONFORMANCE=1).","dependencies":[{"issue_id":"beadhub-hs99.1","depends_on_id":"beadhub-hs99","type":"parent-child","created_at":"2026-01-20T11:37:04.621255+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.10","title":"beadhubâ†’aweb: Move chat implementation (incl SSE) behind aweb boundary","description":"Implement aweb-native Chat (agent-centric /v1/chat/* + SSE) per ../beadhub-sot/source-of-truth/beadhub-aweb-split.md. Clean start: sessions + messages are keyed by agent_id (not workspace_id) and are strictly project-scoped. Preserve user-facing semantics: persistent session per participant set, unread tracking, targets_left, and SSE wait/read_receipt events.","acceptance_criteria":"- aweb implements /v1/chat endpoints per beadhub-aweb-split.md (sessions, pending, messages, read, stream) using agent_id + project scoping\\n- aweb schema includes chat tables (src/aweb/migrations/aweb/003_chat.sql)\\n- In-process tests pass (tests/test_aweb_chat.py)\\n- Black-box conformance tests will be executed as part of aweb standalone packaging/CI harness (beadhub-hs99.18/beadhub-hs99.21)","notes":"Start aweb-native chat schema + endpoints + in-process tests (follow BeadHub pgdbm patterns).","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-20T11:37:06.172345+01:00","created_by":"Juan Reyero","updated_at":"2026-01-20T16:33:10.30604+01:00","closed_at":"2026-01-20T16:33:10.30604+01:00","close_reason":"Implemented aweb-native chat schema + endpoints (incl SSE) and added in-process tests. Black-box conformance will be exercised once aweb is packaged/CI harness exists.","dependencies":[{"issue_id":"beadhub-hs99.10","depends_on_id":"beadhub-hs99","type":"parent-child","created_at":"2026-01-20T11:37:06.173263+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-hs99.10","depends_on_id":"beadhub-hs99.3","type":"blocks","created_at":"2026-01-20T11:37:09.345158+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-hs99.10","depends_on_id":"beadhub-hs99.4","type":"blocks","created_at":"2026-01-20T11:37:09.488221+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.11","title":"beadhubâ†’aweb: Move reservations into aweb boundary","description":"Make reservations aweb-owned; treat resource_key as opaque.","acceptance_criteria":"- aweb implements /v1/reservations (acquire, renew, release, list) per beadhub-aweb-split.md using opaque resource_key and agent_id scoping\\n- aweb schema includes reservations table (src/aweb/migrations/aweb/004_reservations.sql)\\n- In-process tests pass (tests/test_aweb_reservations.py)\\n- Black-box conformance tests will be executed as part of aweb standalone packaging/CI harness (beadhub-hs99.18/beadhub-hs99.21)","notes":"Implement aweb-native reservations schema + endpoints + in-process tests (pgdbm patterns).","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-20T11:37:06.356928+01:00","created_by":"Juan Reyero","updated_at":"2026-01-20T16:37:29.649353+01:00","closed_at":"2026-01-20T16:37:29.649353+01:00","close_reason":"Implemented aweb-native reservations schema + endpoints and added in-process tests. Black-box conformance will be exercised once aweb is packaged/CI harness exists.","dependencies":[{"issue_id":"beadhub-hs99.11","depends_on_id":"beadhub-hs99","type":"parent-child","created_at":"2026-01-20T11:37:06.358405+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-hs99.11","depends_on_id":"beadhub-hs99.5","type":"blocks","created_at":"2026-01-20T11:37:09.63912+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.12","title":"beadhubâ†’aweb: Move policies + escalations behind aweb boundary","description":"Move policy bundle storage and escalation flows into aweb boundary.","acceptance_criteria":"Endpoints and CLI continue to work; beadhub no longer owns these concepts.","status":"open","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-20T11:37:06.533805+01:00","created_by":"Juan Reyero","updated_at":"2026-01-20T11:37:06.533805+01:00","dependencies":[{"issue_id":"beadhub-hs99.12","depends_on_id":"beadhub-hs99","type":"parent-child","created_at":"2026-01-20T11:37:06.534719+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.13","title":"beadhubâ†’aweb: Enforce dependency direction","description":"Add CI/lint guardrails: aweb must not import beadhub.","acceptance_criteria":"Import-cycle/forbidden-import checks fail CI when violated.","notes":"Start: fix circular import and enforce aweb must not import beadhub.","status":"closed","priority":2,"issue_type":"chore","owner":"juan@juanreyero.com","created_at":"2026-01-20T11:37:06.70925+01:00","created_by":"Juan Reyero","updated_at":"2026-01-20T14:51:34.167555+01:00","closed_at":"2026-01-20T14:51:34.167555+01:00","close_reason":"Removed awebâ†’beadhub imports (aweb.api is standalone), eliminated circular import, and restored beadhub route registration.","dependencies":[{"issue_id":"beadhub-hs99.13","depends_on_id":"beadhub-hs99","type":"parent-child","created_at":"2026-01-20T11:37:06.710354+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.14","title":"beadhub: Introduce aweb client boundary (Python)","description":"Define aweb client interface used by beadhub (even when mounted in-process).","acceptance_criteria":"beadhub calls aweb through client/service interface; swapping to remote aweb is mechanical.","notes":"Initial aweb client boundary landed via beadhub.aweb_introspection (auth scoping).","status":"closed","priority":2,"issue_type":"chore","owner":"juan@juanreyero.com","created_at":"2026-01-20T11:37:06.879912+01:00","created_by":"Juan Reyero","updated_at":"2026-01-20T17:35:37.524345+01:00","closed_at":"2026-01-20T17:35:37.524345+01:00","close_reason":"Added minimal aweb HTTP client (introspection) used by beadhub; improved aweb CLI seed, local conformance runner + docs; verified conformance suite passes against standalone aweb service.","dependencies":[{"issue_id":"beadhub-hs99.14","depends_on_id":"beadhub-hs99","type":"parent-child","created_at":"2026-01-20T11:37:06.880875+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.15","title":"aweb: Add token introspection endpoint for beadhub","description":"Expose endpoint validating Bearer token and returning {project_id, agent_id, alias}.","acceptance_criteria":"Beadhub can authenticate solely via aweb introspection; caching guidance documented.","notes":"Implement aweb token introspection endpoint (clean-start contract for beadhubâ†’aweb auth).","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-20T11:37:07.050107+01:00","created_by":"Juan Reyero","updated_at":"2026-01-20T14:54:02.244995+01:00","closed_at":"2026-01-20T14:54:02.244995+01:00","close_reason":"Added /v1/auth/introspect (aweb router) and wired it into app via aweb.api.include_aweb_routers without awebâ†’beadhub imports.","dependencies":[{"issue_id":"beadhub-hs99.15","depends_on_id":"beadhub-hs99","type":"parent-child","created_at":"2026-01-20T11:37:07.051131+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.16","title":"beadhub: Switch auth middleware to aweb introspection","description":"Update beadhub to validate requests by calling aweb introspection.","acceptance_criteria":"- When AWEB_URL is configured, BeadHub validates Bearer tokens by calling aweb /v1/auth/introspect\\n- BeadHub no longer derives project_id by reading its own api_keys table in that mode\\n- Existing monolith test suite continues to pass via local fallback until init/auth are fully extracted","notes":"Implement beadhub auth scoping via aweb introspection when AWEB_URL is configured; keep local fallback for current test suite.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-20T11:37:07.221464+01:00","created_by":"Juan Reyero","updated_at":"2026-01-20T16:43:24.372069+01:00","closed_at":"2026-01-20T16:43:24.372069+01:00","close_reason":"Added beadhub auth scoping via aweb introspection (AWEB_URL mode) and updated all routes to use it; added a unit test for the delegation path.","dependencies":[{"issue_id":"beadhub-hs99.16","depends_on_id":"beadhub-hs99","type":"parent-child","created_at":"2026-01-20T11:37:07.222397+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-hs99.16","depends_on_id":"beadhub-hs99.15","type":"blocks","created_at":"2026-01-20T11:37:09.779427+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.17","title":"aweb/beadhub: v1 identity compatibility mapping","description":"Ship split with agent_id == existing workspace_id; document v2 separation.","acceptance_criteria":"No breaking changes to existing clients; mapping documented; follow-up epic created.","status":"open","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-20T11:37:07.391263+01:00","created_by":"Juan Reyero","updated_at":"2026-01-20T11:37:07.391263+01:00","dependencies":[{"issue_id":"beadhub-hs99.17","depends_on_id":"beadhub-hs99","type":"parent-child","created_at":"2026-01-20T11:37:07.392295+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.18","title":"aweb: Standalone service packaging","description":"Make aweb runnable as its own service with its own entrypoint/config/migrations.","acceptance_criteria":"Conformance suite runs against aweb service alone.","notes":"Package aweb as standalone service (config, entrypoint, docker compose wiring) so it can run independently and be targeted by conformance suite.","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-20T11:37:07.562861+01:00","created_by":"Juan Reyero","updated_at":"2026-01-20T17:35:37.52763+01:00","closed_at":"2026-01-20T17:35:37.52763+01:00","close_reason":"Added minimal aweb HTTP client (introspection) used by beadhub; improved aweb CLI seed, local conformance runner + docs; verified conformance suite passes against standalone aweb service.","dependencies":[{"issue_id":"beadhub-hs99.18","depends_on_id":"beadhub-hs99","type":"parent-child","created_at":"2026-01-20T11:37:07.563908+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-hs99.18","depends_on_id":"beadhub-hs99.14","type":"blocks","created_at":"2026-01-20T11:37:09.91956+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.19","title":"beadhub: Standalone service depending on AWEB_URL","description":"Make beadhub runnable as its own service, configured with AWEB_URL for auth/coordination.","acceptance_criteria":"Beadhub runs with bead DB + calls to aweb; coordination DB access removed.","notes":"Started implementing split mode: aweb init + project endpoints; disable BeadHub legacy init/coordination endpoints when AWEB_URL set; move BH internal auth parsing into BeadHub.","status":"closed","priority":2,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-20T11:37:07.734905+01:00","created_by":"Juan Reyero","updated_at":"2026-01-21T12:10:09.541057+01:00","closed_at":"2026-01-21T12:10:09.541057+01:00","close_reason":"BeadHub split-mode now boots via aweb identity: aweb init + agent-scoped API keys; BeadHub /v1/bootstrap registers project/repo/workspace using aweb introspection; legacy coordination endpoints/tools disabled when AWEB_URL set; targeted tests pass.","dependencies":[{"issue_id":"beadhub-hs99.19","depends_on_id":"beadhub-hs99","type":"parent-child","created_at":"2026-01-20T11:37:07.735987+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-hs99.19","depends_on_id":"beadhub-hs99.18","type":"blocks","created_at":"2026-01-20T11:37:10.062229+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.2","title":"aweb: Conformance tests for mail","description":"Test /v1/messages send/inbox/ack incl. auth scoping and pagination.","acceptance_criteria":"Covers send, unread filtering, ack semantics, and cursor pagination.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-20T11:37:04.79331+01:00","created_by":"Juan Reyero","updated_at":"2026-01-20T11:47:53.636627+01:00","closed_at":"2026-01-20T11:47:53.636627+01:00","close_reason":"Add aweb mail conformance tests for the clean-start aweb protocol (from_agent_id/to_agent_id) and remove any /v1/init bootstrap fallback from the conformance harness.","dependencies":[{"issue_id":"beadhub-hs99.2","depends_on_id":"beadhub-hs99","type":"parent-child","created_at":"2026-01-20T11:37:04.794356+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.20","title":"dev: Two-service local runner","description":"Add local dev runner to start aweb + beadhub consistently.","acceptance_criteria":"One command starts both services; env wiring documented.","status":"open","priority":3,"issue_type":"chore","owner":"juan@juanreyero.com","created_at":"2026-01-20T11:37:07.915617+01:00","created_by":"Juan Reyero","updated_at":"2026-01-20T11:37:07.915617+01:00","dependencies":[{"issue_id":"beadhub-hs99.20","depends_on_id":"beadhub-hs99","type":"parent-child","created_at":"2026-01-20T11:37:07.916614+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.21","title":"ci: Run conformance suite against monolith and two-service","description":"Add CI job running conformance tests against (A) mount and (B) split services.","acceptance_criteria":"CI blocks regressions; both modes pass.","status":"open","priority":2,"issue_type":"chore","owner":"juan@juanreyero.com","created_at":"2026-01-20T11:37:08.087865+01:00","created_by":"Juan Reyero","updated_at":"2026-01-20T11:37:08.087865+01:00","dependencies":[{"issue_id":"beadhub-hs99.21","depends_on_id":"beadhub-hs99","type":"parent-child","created_at":"2026-01-20T11:37:08.088859+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-hs99.21","depends_on_id":"beadhub-hs99.1","type":"blocks","created_at":"2026-01-20T11:37:10.206281+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.22","title":"aweb: Extract aweb-go client library","description":"Extract coordination HTTP+SSE client code into aweb-go (no bead concepts).","acceptance_criteria":"Library supports mail/chat/reservations/policies; used by aw and bdh.","status":"closed","priority":3,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-20T11:37:08.260003+01:00","created_by":"Juan Reyero","updated_at":"2026-01-21T11:19:36.177674+01:00","closed_at":"2026-01-21T11:19:36.177674+01:00","close_reason":"Added extractable Go module aweb-go with minimal HTTP client (auth introspect, mail, chat incl SSE decoder, reservations) and unit tests; verified go test passes in aweb-go.","dependencies":[{"issue_id":"beadhub-hs99.22","depends_on_id":"beadhub-hs99","type":"parent-child","created_at":"2026-01-20T11:37:08.261105+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.23","title":"aweb: Implement aw CLI","description":"Create aw CLI for aweb coordination commands.","acceptance_criteria":"aw operates standalone against AWEB_URL; matches conformance expectations.","status":"closed","priority":3,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-20T11:37:08.430213+01:00","created_by":"Juan Reyero","updated_at":"2026-01-21T11:22:53.117537+01:00","closed_at":"2026-01-21T11:22:53.117537+01:00","close_reason":"Implemented minimal aw CLI under aweb-go/cmd/aw (no extra deps) for introspect, mail, chat, and locks; added smoke test that builds and runs aw against an httptest server; go test passes in aweb-go.","dependencies":[{"issue_id":"beadhub-hs99.23","depends_on_id":"beadhub-hs99","type":"parent-child","created_at":"2026-01-20T11:37:08.431484+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.24","title":"bdh: Delegate :mail/:chat/:lock to aweb","description":"Refactor bdh coordination commands to call aweb-go (or wrap aw).","acceptance_criteria":"CLI UX unchanged; coordination commands behave identically.","status":"open","priority":3,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-20T11:37:08.599084+01:00","created_by":"Juan Reyero","updated_at":"2026-01-20T11:37:08.599084+01:00","dependencies":[{"issue_id":"beadhub-hs99.24","depends_on_id":"beadhub-hs99","type":"parent-child","created_at":"2026-01-20T11:37:08.600065+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.25","title":"v2: Separate aweb agents from beadhub workspaces","description":"Optional follow-up: introduce true aweb agents and beadhub_workspaces referencing them.","acceptance_criteria":"Migration plan executed; protocols evolve from workspace_id to agent_id without breaking clients.","status":"open","priority":4,"issue_type":"epic","owner":"juan@juanreyero.com","created_at":"2026-01-20T11:37:08.772271+01:00","created_by":"Juan Reyero","updated_at":"2026-01-20T11:37:08.772271+01:00","dependencies":[{"issue_id":"beadhub-hs99.25","depends_on_id":"beadhub-hs99","type":"parent-child","created_at":"2026-01-20T11:37:08.773221+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.26","title":"aweb: pgdbm DatabaseInfra + initial migrations + migration tests","description":"Add aweb database infrastructure patterned after beadhub.db.DatabaseInfra using pgdbm shared-pool + schema isolation. Add initial aweb migrations (projects/agents/api_keys/etc.) and a migration-apply test mirroring tests/test_db_migrations.py.","acceptance_criteria":"- src/aweb/db.py provides DatabaseInfra with shared_pool support and runs aweb migrations\\n- src/aweb/migrations/aweb/001_initial.sql creates core tables using {{tables.*}} syntax\\n- tests/test_aweb_db_migrations.py applies migrations on test_db_with_schema and can insert/select core rows\\n- No aweb imports from beadhub","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-20T15:05:50.374394+01:00","created_by":"Juan Reyero","updated_at":"2026-01-20T15:07:41.609067+01:00","closed_at":"2026-01-20T15:07:41.609067+01:00","close_reason":"Added aweb pgdbm DatabaseInfra, initial aweb migrations, and migration-apply test mirroring BeadHub patterns; removed last awebâ†’beadhub type import.","dependencies":[{"issue_id":"beadhub-hs99.26","depends_on_id":"beadhub-hs99","type":"parent-child","created_at":"2026-01-20T15:05:50.375633+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.27","title":"SOT: align auth/tenancy docs with always-API-key model","description":"Update BeadHub + aweb split source-of-truth docs to reflect the new model:\\n- All client interactions authenticate via API keys (linked to project + user)\\n- .beadhub does not store project_id; project scope derived from API key\\n- Cloud wrapper injects X-Project-ID / X-User-ID to OSS core as needed\\n- Remove/mark-deprecated any 'auth disabled' OSS mode references if they no longer apply\\n\\nFiles likely impacted:\\n- ../beadhub-sot/source-of-truth/beadhub-architecture.md\\n- ../beadhub-sot/source-of-truth/security-patterns.md\\n- ../beadhub-sot/source-of-truth/beadhub-aweb-split.md","acceptance_criteria":"SOT docs no longer describe project_id stored in .beadhub; they describe API-key-derived project scope and optional Cloud proxy header injection; aweb split doc mentions keys can be linked to user_id for Cloud.","status":"closed","priority":2,"issue_type":"chore","owner":"juan@juanreyero.com","created_at":"2026-01-21T10:19:56.92429+01:00","created_by":"Juan Reyero","updated_at":"2026-01-21T10:31:34.673136+01:00","closed_at":"2026-01-21T10:31:34.673136+01:00","close_reason":"Updated BeadHub SOT docs to reflect always-API-key model (no project_id in .beadhub), clarified Cloud/internal auth context headers (X-BH-Auth/X-Project-ID/X-User-ID), and updated beadhub-aweb-split auth notes.","dependencies":[{"issue_id":"beadhub-hs99.27","depends_on_id":"beadhub-hs99","type":"parent-child","created_at":"2026-01-21T10:19:56.925312+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.28","title":"beadhub: Clean-slate split (remove legacy coordination + finalize bootstrap API)","description":"Remove BeadHub-owned coordination (mail/chat/reservations/bdh-coordination) and transitional split-mode guardrails. Finalize the split bootstrap surface so BeadHub can be used cleanly with aweb-owned identity/auth.","acceptance_criteria":"- BeadHub server does not ship /v1/messages, /v1/chat, /v1/reservations, /v1/bdh, or MCP mail/lock tools\\n- BeadHub DB schema/migrations/tests contain no mail/chat/reservation tables\\n- BeadHub init flow is clean-slate: no /v1/init; workspace registration derives project_id/workspace_id/alias from aweb auth\\n- aweb remains source of truth for projects/agents/api keys\\n- Targeted tests updated and passing","notes":"Completed clean-slate split: removed legacy coordination routes/tests, finalized /v1/workspaces/register, aweb embedded via shared pgdbm pool, notifications via aweb mail, migrations cleaned; uv run pytest passes.","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-21T12:19:26.751874+01:00","created_by":"Juan Reyero","updated_at":"2026-01-21T14:17:21.08688+01:00","closed_at":"2026-01-21T14:17:21.086882+01:00","dependencies":[{"issue_id":"beadhub-hs99.28","depends_on_id":"beadhub-hs99","type":"parent-child","created_at":"2026-01-21T12:19:26.753096+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.29","title":"Polish: cloud wrapper test fidelity + aweb-cloud header docs","description":"Clean up post-pivot tech debt in beadhub-cloud + SOT so future aweb-cloud can reuse the same trust-boundary patterns.","acceptance_criteria":"beadhub-cloud tests apply OSS/aweb migrations with production module_name values; Cloud test app exposes aweb manager; SOT aweb-cloud spec uses the actual proxy header name; pytest runs without deprecation warnings","status":"closed","priority":2,"issue_type":"chore","owner":"juan@juanreyero.com","created_at":"2026-02-01T18:17:08.508573Z","created_by":"Juan Reyero","updated_at":"2026-02-01T18:17:38.156263Z","closed_at":"2026-02-01T18:17:38.156263Z","close_reason":"Applied production module_name values in beadhub-cloud test fixtures; ensured test apps expose aweb manager; updated aweb-cloud spec to use X-BH-Auth; removed httpx per-request cookie deprecation warnings; beadhub-cloud pytest green.","labels":["work:in-progress"],"dependencies":[{"issue_id":"beadhub-hs99.29","depends_on_id":"beadhub-hs99","type":"parent-child","created_at":"2026-02-01T18:17:08.509904Z","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.29.1","title":"State change: work â†’ in-progress","description":"Set work to in-progress\n\nReason: Starting cleanup work","status":"closed","priority":4,"issue_type":"event","created_at":"2026-02-01T18:17:22.387086Z","created_by":"Juan Reyero","updated_at":"2026-02-01T18:17:22.387086Z","closed_at":"2026-02-01T18:17:23.387086Z","dependencies":[{"issue_id":"beadhub-hs99.29.1","depends_on_id":"beadhub-hs99.29","type":"parent-child","created_at":"2026-02-01T18:17:22.387912Z","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.3","title":"aweb: Conformance tests for chat (non-SSE)","description":"Test chat sessions/pending/history/read incl. targets_left semantics.","acceptance_criteria":"Validates session uniqueness by participant set and unread tracking via read receipts.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-20T11:37:04.967035+01:00","created_by":"Juan Reyero","updated_at":"2026-01-20T11:50:40.362296+01:00","closed_at":"2026-01-20T11:50:40.362296+01:00","close_reason":"Add clean-start aweb chat conformance tests (non-SSE): session creation, session uniqueness by participant set, pending+mark-read flow, and targets_left semantics.","dependencies":[{"issue_id":"beadhub-hs99.3","depends_on_id":"beadhub-hs99","type":"parent-child","created_at":"2026-01-20T11:37:04.96808+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.30","title":"beadhub-cloud: align Database helper migrations module_name","description":"Remove lingering module_name mismatch in beadhub_cloud/database.py so migration history matches runtime expectations (clean slate).","acceptance_criteria":"Database.connect uses module_name=beadhub_cloud; no duplicate migration tracking","status":"closed","priority":3,"issue_type":"chore","owner":"juan@juanreyero.com","created_at":"2026-02-01T18:23:32.908638Z","created_by":"Juan Reyero","updated_at":"2026-02-01T18:23:56.864253Z","closed_at":"2026-02-01T18:23:56.864253Z","close_reason":"Updated beadhub_cloud/database.py to use module_name=beadhub_cloud and verified via targeted pytest.","labels":["work:in-progress"],"dependencies":[{"issue_id":"beadhub-hs99.30","depends_on_id":"beadhub-hs99","type":"parent-child","created_at":"2026-02-01T18:23:32.909834Z","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.30.1","title":"State change: work â†’ in-progress","description":"Set work to in-progress\n\nReason: Applying module_name fix","status":"closed","priority":4,"issue_type":"event","created_at":"2026-02-01T18:23:46.551432Z","created_by":"Juan Reyero","updated_at":"2026-02-01T18:23:46.551432Z","closed_at":"2026-02-01T18:23:47.551432Z","dependencies":[{"issue_id":"beadhub-hs99.30.1","depends_on_id":"beadhub-hs99.30","type":"parent-child","created_at":"2026-02-01T18:23:46.55242Z","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.31","title":"Dev tooling: Makefile targets for bdh build + aweb","description":"Restore smooth workflow via make: bdh build should work in restricted environments by overriding GOCACHE; aweb should have a minimal Makefile wrapper around uv.","acceptance_criteria":"make bdh works; bdh exposes :aweb commands after build; aweb has make test/serve/check targets","status":"closed","priority":3,"issue_type":"chore","owner":"juan@juanreyero.com","created_at":"2026-02-01T20:10:18.364412Z","created_by":"Juan Reyero","updated_at":"2026-02-01T20:11:11.23392Z","closed_at":"2026-02-01T20:11:11.23392Z","close_reason":"Added aweb Makefile and fixed beadhub Makefile bdh target to set GOCACHE so builds work; verified bdh :aweb works after make bdh","labels":["work:in-progress"],"dependencies":[{"issue_id":"beadhub-hs99.31","depends_on_id":"beadhub-hs99","type":"parent-child","created_at":"2026-02-01T20:10:18.365676Z","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.31.1","title":"State change: work â†’ in-progress","description":"Set work to in-progress\n\nReason: Makefile workflow fix in progress","status":"open","priority":4,"issue_type":"event","created_at":"2026-02-01T20:11:11.151928Z","created_by":"Juan Reyero","updated_at":"2026-02-01T20:11:11.151928Z","dependencies":[{"issue_id":"beadhub-hs99.31.1","depends_on_id":"beadhub-hs99.31","type":"parent-child","created_at":"2026-02-01T20:11:11.15264Z","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.4","title":"aweb: Conformance tests for chat SSE","description":"Test /v1/chat/.../stream SSE (replay+live, message/read_receipt event shapes).","acceptance_criteria":"Validates replay ordering, event payload shape, and waiting metadata behavior.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-20T11:37:05.140601+01:00","created_by":"Juan Reyero","updated_at":"2026-01-20T11:52:58.718052+01:00","closed_at":"2026-01-20T11:52:58.718052+01:00","close_reason":"Add aweb chat SSE conformance tests: replay of recent history, live message delivery after connect, and read_receipt event emission when the recipient marks messages read.","dependencies":[{"issue_id":"beadhub-hs99.4","depends_on_id":"beadhub-hs99","type":"parent-child","created_at":"2026-01-20T11:37:05.141577+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.5","title":"aweb: Conformance tests for reservations","description":"Test reservations acquire/renew/release/list, conflicts, TTL clamping.","acceptance_criteria":"Conflicts return holder info; renew/release require ownership.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-20T11:37:05.310776+01:00","created_by":"Juan Reyero","updated_at":"2026-01-20T12:00:40.753331+01:00","closed_at":"2026-01-20T12:00:40.753331+01:00","close_reason":"Add aweb reservations conformance tests: acquire/conflict/release, renew ownership requirement, and list-by-prefix filtering.","dependencies":[{"issue_id":"beadhub-hs99.5","depends_on_id":"beadhub-hs99","type":"parent-child","created_at":"2026-01-20T11:37:05.31181+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.6","title":"aweb: Conformance tests for auth + project scoping","description":"Test cross-project operations are rejected; writes don't accept project selectors.","acceptance_criteria":"Cross-project send/chat/reserve denied; invalid token denied; scoping invariants enforced.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-20T11:37:05.48436+01:00","created_by":"Juan Reyero","updated_at":"2026-01-20T12:20:25.674569+01:00","closed_at":"2026-01-20T12:20:25.674569+01:00","close_reason":"Add aweb auth+tenant isolation conformance tests: invalid Bearer token rejection, cross-project mail/chat rejection, reservation namespace isolation across projects, and rejection of client-supplied project selector fields in write requests.","dependencies":[{"issue_id":"beadhub-hs99.6","depends_on_id":"beadhub-hs99","type":"parent-child","created_at":"2026-01-20T11:37:05.4853+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.7","title":"beadhubâ†’aweb: Create in-process package boundary","description":"Introduce aweb module boundary and mount coordination routers from there (bridge step).","acceptance_criteria":"Coordination code lives under aweb boundary; beadhub depends on it; no behavior change.","status":"closed","priority":1,"issue_type":"chore","owner":"juan@juanreyero.com","created_at":"2026-01-20T11:37:05.656464+01:00","created_by":"Juan Reyero","updated_at":"2026-01-20T12:34:20.446838+01:00","closed_at":"2026-01-20T12:34:20.446838+01:00","close_reason":"Introduce an in-process aweb package boundary: add src/aweb/api.py with include_aweb_routers() and refactor src/beadhub/api.py to install coordination routers via aweb first, then add bead-specific routers.","dependencies":[{"issue_id":"beadhub-hs99.7","depends_on_id":"beadhub-hs99","type":"parent-child","created_at":"2026-01-20T11:37:05.657554+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-hs99.7","depends_on_id":"beadhub-hs99.1","type":"blocks","created_at":"2026-01-20T11:37:08.914739+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.8","title":"beadhubâ†’aweb: Move auth/identity authority behind aweb boundary","description":"Move API key verification + project scoping logic under aweb boundary.","acceptance_criteria":"beadhub no longer verifies API keys directly; auth is provided by aweb layer.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-20T11:37:05.828396+01:00","created_by":"Juan Reyero","updated_at":"2026-01-20T14:04:01.788867+01:00","closed_at":"2026-01-20T14:04:01.788867+01:00","close_reason":"Move auth/identity authority into aweb: add src/aweb/auth.py and switch all routers/tests to import from aweb.auth; keep beadhub.auth as a thin compatibility shim. Also align workspace_id validation and workspace access error semantics with existing test expectations (404 not found, 410 deleted, 403 wrong project).","dependencies":[{"issue_id":"beadhub-hs99.8","depends_on_id":"beadhub-hs99","type":"parent-child","created_at":"2026-01-20T11:37:05.829387+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-hs99.8","depends_on_id":"beadhub-hs99.1","type":"blocks","created_at":"2026-01-20T11:37:09.058551+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-hs99.9","title":"beadhubâ†’aweb: Move mail implementation behind aweb boundary","description":"Implement aweb-native Mail (agent-centric /v1/messages) per ../beadhub-sot/source-of-truth/beadhub-aweb-split.md. Clean start: aweb mail MUST be scoped by authenticated project_id and MUST NOT rely on beadhub workspace_id semantics. beadhub should not contain mail storage logic.","acceptance_criteria":"- aweb implements POST /v1/messages, GET /v1/messages/inbox, POST /v1/messages/{message_id}/ack using agent_id/from_agent_id fields\\n- aweb schema includes messages table (src/aweb/migrations/aweb/002_mail.sql)\\n- Internal in-process tests pass (tests/test_aweb_mail.py)\\n- Black-box conformance tests will be executed as part of aweb standalone packaging/CI harness (beadhub-hs99.18/beadhub-hs99.21)","notes":"Implement aweb-native mail endpoints + schema/migrations + internal tests matching BeadHub/pgdbm patterns.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-20T11:37:06.00093+01:00","created_by":"Juan Reyero","updated_at":"2026-01-20T16:18:11.488447+01:00","closed_at":"2026-01-20T16:18:11.488447+01:00","close_reason":"Implemented aweb-native mail endpoints + aweb schema migrations and added in-process mail tests. Black-box conformance will be exercised once aweb is packaged/CI harness exists.","dependencies":[{"issue_id":"beadhub-hs99.9","depends_on_id":"beadhub-hs99","type":"parent-child","created_at":"2026-01-20T11:37:06.001993+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-hs99.9","depends_on_id":"beadhub-hs99.2","type":"blocks","created_at":"2026-01-20T11:37:09.199844+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-htpr","title":"Add exponential backoff to SSE reconnection logic","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-08T15:32:35.149356+01:00","updated_at":"2025-12-08T15:32:35.149356+01:00","dependencies":[{"issue_id":"beadhub-htpr","depends_on_id":"beadhub-7r4","type":"discovered-from","created_at":"2025-12-08T15:32:35.150105+01:00","created_by":"juanre"}]}
{"id":"beadhub-hukz","title":"Include role in /v1/status response","description":"GET /v1/status should include role in workspace info within aggregate status","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-14T09:06:36.175838+01:00","updated_at":"2025-12-15T15:35:00.600291+01:00","closed_at":"2025-12-15T15:18:04.277273+01:00","dependencies":[{"issue_id":"beadhub-hukz","depends_on_id":"beadhub-089o","type":"blocks","created_at":"2025-12-14T09:06:55.744475+01:00","created_by":"juanre"},{"issue_id":"beadhub-hukz","depends_on_id":"beadhub-161u","type":"parent-child","created_at":"2025-12-14T09:24:11.177339+01:00","created_by":"juanre"}]}
{"id":"beadhub-hvds","title":"Update project documentation for :mail command","description":"Update project documentation outside of policy to reflect the new :mail command interface.\n\n**Files to update:**\n\n1. **CLAUDE.md** (project root)\n   - Update \"Start every session\" examples if they reference :send/:inbox\n   - Update any mail command examples\n\n2. **../beadhub-sot/source-of-truth/beadhub-bdh-design.md**\n   - Update command reference section\n   - Update usage examples\n\n3. **../beadhub-sot/source-of-truth/beadhub-specifications.md**\n   - Update any mail-related specifications\n\n4. **bdh/internal/commands/constants.go** (if mail help text is there)\n   - Update any help text or usage strings\n\n**Search for references:**\n```bash\ngrep -r \":send\" --include=\"*.md\" .\ngrep -r \":inbox\" --include=\"*.md\" .\ngrep -r \":ack\" --include=\"*.md\" .\n```\n\nThis task can run in parallel with policy documentation update after :mail is implemented.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T14:02:18.79755+01:00","created_by":"juanre","updated_at":"2026-01-10T14:32:35.029477+01:00","closed_at":"2026-01-10T14:32:35.029477+01:00","close_reason":"Completed mail interface migration","dependencies":[{"issue_id":"beadhub-hvds","depends_on_id":"beadhub-mg89","type":"blocks","created_at":"2026-01-10T14:02:27.589734+01:00","created_by":"juanre"},{"issue_id":"beadhub-hvds","depends_on_id":"beadhub-waak","type":"parent-child","created_at":"2026-01-10T14:04:39.411644+01:00","created_by":"juanre"}]}
{"id":"beadhub-hxcg","title":"bdh :projects delete missing confirmation and ownership check","description":"SECURITY: The :projects delete command in bdh/internal/commands/projects.go:138-179 allows project deletion without confirmation or ownership verification.\n\nPer data-model.md: 'Project deletion is catastrophic and irreversibleâ€”only the owner should have that power.'\n\nIssues:\n1. No --confirm flag required\n2. No verification that user has permission to delete\n3. No preview of what will be deleted (repos, workspaces count)\n\nProject deletion cascades to hard-delete repos, which soft-deletes all workspaces. In SaaS mode, this could delete customer data.\n\nFix:\n1. Add --confirm flag requirement\n2. Show cascade impact before confirming\n3. Server should enforce owner role check (may already exist)","notes":"Track under beadhub-oy60 epic","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-06T09:20:12.028364Z","created_by":"juanre","updated_at":"2026-01-06T10:02:34.553624Z","closed_at":"2026-01-06T09:59:25.021149Z","close_reason":"Fixed - now requires --confirm flag, shows cascade impact before deletion, warns about irreversibility","dependencies":[{"issue_id":"beadhub-hxcg","depends_on_id":"beadhub-oy60","type":"parent-child","created_at":"2026-01-06T10:02:34.554281Z","created_by":"juanre"}]}
{"id":"beadhub-hxlv","title":"bdh: Read .role file and include in requests","description":"bdh should read .role file (if exists) and include role in command/registration requests","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-14T09:06:37.192838+01:00","updated_at":"2025-12-14T09:58:24.428845+01:00","closed_at":"2025-12-14T09:58:24.428845+01:00","dependencies":[{"issue_id":"beadhub-hxlv","depends_on_id":"beadhub-161u","type":"parent-child","created_at":"2025-12-14T09:24:11.369878+01:00","created_by":"juanre"}]}
{"id":"beadhub-hymw","title":"Simplify SSE streaming - remove lifecycle events","description":"Simplify stream_session endpoint:\n\n1. Remove session status checks (just verify workspace is participant)\n2. Remove joined/ended/timeout events\n3. Keep only message events\n4. Remove _stream_with_cleanup wrapper (no cleanup needed)\n\nSSE is now purely for real-time message delivery, not session state.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T20:25:33.020359+01:00","updated_at":"2025-12-14T00:53:01.265693+01:00","closed_at":"2025-12-14T00:53:01.265693+01:00","dependencies":[{"issue_id":"beadhub-hymw","depends_on_id":"beadhub-ddsf","type":"blocks","created_at":"2025-12-13T20:26:14.943973+01:00","created_by":"juanre"}]}
{"id":"beadhub-i2cb","title":"Handle dialog close during pending send mutation","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T20:35:06.583141+01:00","updated_at":"2025-12-13T23:46:37.675101+01:00","closed_at":"2025-12-13T23:46:37.675101+01:00"}
{"id":"beadhub-i8qj","title":"Update events.py dataclasses: agent_name to alias","description":"Update src/beadhub/events.py for new data model.\n\nDataclass changes:\n- LockAcquiredEvent: agent_name â†’ alias\n- LockReleasedEvent: agent_name â†’ alias\n- LockRenewedEvent: agent_name â†’ alias\n- MessageDeliveredEvent: from_agent_name â†’ from_alias\n- EscalationCreatedEvent: agent_name â†’ alias\n\nThis is a pure rename with no structural changes.\nAll consuming code (routes, SSE handlers) will need updates to match.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T12:51:10.186568+01:00","updated_at":"2025-12-12T15:45:35.190985+01:00","closed_at":"2025-12-12T15:45:35.190985+01:00"}
{"id":"beadhub-i9bf","title":"Add cursor-based pagination to GET /v1/chat/admin/sessions","description":"Update chat.py admin sessions endpoint to use cursor-based pagination:\n\nCurrent: Returns ALL chat sessions with no pagination\nTarget:\n- Add limit and cursor query params\n- Order by updated_at DESC (most recent activity first)\n- Return {items: [...], has_more: bool, next_cursor: str}\n- Default limit 50, max 200\n\nUse the pagination helper module.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T10:30:41.098599+01:00","updated_at":"2025-12-22T11:41:46.123735+01:00","closed_at":"2025-12-22T11:41:46.123735+01:00","close_reason":"Added cursor-based pagination to GET /v1/chat/admin/sessions endpoint with limit/cursor params, updated response schema with has_more/next_cursor, 4 pagination tests","dependencies":[{"issue_id":"beadhub-i9bf","depends_on_id":"beadhub-v9wr","type":"blocks","created_at":"2025-12-22T10:32:21.17485+01:00","created_by":"juanre"},{"issue_id":"beadhub-i9bf","depends_on_id":"beadhub-94q9","type":"blocks","created_at":"2025-12-22T10:36:52.003734+01:00","created_by":"juanre"}]}
{"id":"beadhub-ich1","title":"Dashboard: show-all-by-default redesign","description":"Redesign the dashboard to show all data by default instead of requiring workspace ID input.\n\nCurrent (wrong):\n- Status page: requires workspace ID to see anything\n- Locks page: requires workspace ID\n- Escalations page: requires workspace ID\n- Issues page: requires workspace + project ID\n\nShould be:\n- Status page: shows all workspaces, all locks, pending escalations count for current project\n- Workspaces page: already correct (shows all)\n- Locks page: shows all active locks in project, grouped by file/repo\n- Escalations page: shows all pending escalations in project\n- Issues page: shows all issues in project (once beads are synced)\n\nThe dashboard is for humans watching what agents are doing, not for a single agent's view.\n\nDepends on: beadhub-t7p3 (human_name), beadhub-k14u (projects)","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-08T16:21:51.242016+01:00","updated_at":"2025-12-08T17:01:16.531779+01:00","closed_at":"2025-12-08T17:01:16.531779+01:00","dependencies":[{"issue_id":"beadhub-ich1","depends_on_id":"beadhub-t7p3","type":"blocks","created_at":"2025-12-08T16:21:51.243311+01:00","created_by":"juanre"},{"issue_id":"beadhub-ich1","depends_on_id":"beadhub-k14u","type":"blocks","created_at":"2025-12-08T16:21:51.244015+01:00","created_by":"juanre"}]}
{"id":"beadhub-iekm","title":"bdh client: fix response size limiting (read max+1, allow exact max)","description":"client.post/get uses io.ReadAll(io.LimitReader(..., maxResponseSize)) then errors if len \u003e= maxResponseSize. This rejects exact-max responses and canâ€™t distinguish exact-max vs truncated. Read maxResponseSize+1 bytes and error only if \u003e max; keep the returned body capped.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T12:52:10.022364+01:00","updated_at":"2025-12-13T17:53:53.493381+01:00","closed_at":"2025-12-13T17:53:53.493381+01:00","dependencies":[{"issue_id":"beadhub-iekm","depends_on_id":"beadhub-t265","type":"discovered-from","created_at":"2025-12-13T12:52:10.023283+01:00","created_by":"juanre"}]}
{"id":"beadhub-iemj","title":"Fix httpx per-request cookies deprecation warnings","description":"Update beadhub-cloud tests to avoid passing cookies= per request (httpx deprecation). Set cookies on the AsyncClient instance instead.","acceptance_criteria":"beadhub-cloud tests run without httpx per-request cookies DeprecationWarning","status":"closed","priority":3,"issue_type":"chore","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-26T17:06:58.422727+01:00","created_by":"Juan Reyero","updated_at":"2026-01-26T18:34:40.132569+01:00","closed_at":"2026-01-26T18:34:40.132569+01:00","close_reason":"Replaced per-request cookies= usage with Cookie header; beadhub-cloud tests run without httpx deprecation warnings","labels":["area:tests","component:cloud"]}
{"id":"beadhub-ifdj","title":"Align gone workspace detection with mail/chat notification triggers","description":"## Problem\n\nGone workspace detection (checking if workspace paths still exist on disk and soft-deleting if not) only runs on `bdh :status`. This means stale workspaces can linger indefinitely if agents never run `:status`.\n\n## Current State\n\n### Chat notifications (sync)\n- Checked on ALL bdh commands via `GetPendingChats`\n- Passthrough commands: `passthrough.go:301-307`\n- Colon commands via `DeferServerNotifications`\n\n### Mail notifications (async)  \n- Mail **count** returned in Command API response for all passthrough commands\n- Actual **inbox messages** only fetched on `bdh ready`\n- `DeferServerNotifications` with `ShowMail: true` shows count\n\n### Gone workspace detection\n- **Only** runs on `bdh :status` (`status.go:88`)\n\n## Proposal\n\nAlign gone workspace detection with mail/chat notification triggers. At minimum, run it on:\n- `bdh :status` (current)\n- `bdh ready` (agents call this to find work)\n\nConsider whether other coordination commands should also trigger it:\n- `:policy`, `:who`, `:send`, etc.\n\n## Implementation Notes\n\n`detectAndCleanGoneWorkspaces` is already factored out and returns a list of cleaned workspaces. Just needs to be called from additional commands and optionally displayed.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T09:41:47.5388+01:00","created_by":"juanre","updated_at":"2026-01-10T09:51:55.093334+01:00","closed_at":"2026-01-10T09:51:55.093334+01:00","close_reason":"Superseded by beadhub-f392 which addresses this as part of broader notification simplification"}
{"id":"beadhub-ifhy","title":"Chat: expired sessions block new session creation (pair_key not cleaned up)","description":"_find_existing_session() in chat.py finds pair_key and returns session with status='active', but doesn't check if expires_at has passed. Result: expired sessions continue to block new session creation between the same workspace pair. Fix: check expires_at in _find_existing_session() and clean up pair_key if session expired.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T19:55:25.771035+01:00","updated_at":"2025-12-13T20:10:27.326434+01:00","closed_at":"2025-12-13T20:10:27.326434+01:00"}
{"id":"beadhub-ifvi","title":"SECURITY: Add Content-Security-Policy headers","description":"## Problem\n\nNo CSP headers observed in backend code, reducing defense against XSS attacks.\n\n### Current Behavior\n\nFastAPI backend serves frontend without security headers.\n\n### Impact\n\nWithout CSP:\n- XSS attacks have broader impact (can load external scripts)\n- Stolen credentials possible via injected scripts\n- Session hijacking easier\n\n### Solution\n\nAdd security middleware to FastAPI:\n\n```python\nfrom fastapi import FastAPI\nfrom starlette.middleware import Middleware\nfrom starlette.middleware.base import BaseHTTPMiddleware\n\nclass SecurityHeadersMiddleware(BaseHTTPMiddleware):\n    async def dispatch(self, request, call_next):\n        response = await call_next(request)\n        response.headers[\"Content-Security-Policy\"] = (\n            \"default-src 'self'; \"\n            \"script-src 'self'; \"\n            \"style-src 'self' 'unsafe-inline'; \"\n            \"img-src 'self' data:; \"\n            \"connect-src 'self'\"\n        )\n        response.headers[\"X-Content-Type-Options\"] = \"nosniff\"\n        response.headers[\"X-Frame-Options\"] = \"DENY\"\n        response.headers[\"X-XSS-Protection\"] = \"1; mode=block\"\n        return response\n\napp = FastAPI()\napp.add_middleware(SecurityHeadersMiddleware)\n```\n\n### Acceptance Criteria\n\n- [ ] CSP header restricts script sources to self\n- [ ] X-Content-Type-Options: nosniff set\n- [ ] X-Frame-Options prevents clickjacking\n- [ ] Headers configurable for different environments\n- [ ] Frontend still works with CSP restrictions","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-08T12:39:19.116691+01:00","created_by":"juanre","updated_at":"2026-01-08T12:39:19.116691+01:00"}
{"id":"beadhub-igwn","title":"Prevent focus apex being cleared by unknown-bead claims","description":"Bug: upsert_bead_claim currently updates workspaces.focus_apex_* even when resolve_claim_apex returns NULLs (bead not present in beads_issues). This can wipe a workspace's last known focus apex, defeating the 'remember last epic' goal.\n\nFix: only update focus_apex_* when apex_bead_id is non-null. Keep focus unchanged for unknown beads.\n\nAdd test: create focus via known claim, then claim unknown bead, verify focus remains.\n\nDone when: pytest passes, focus not cleared.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-21T20:23:35.45692+01:00","updated_at":"2025-12-21T20:24:34.631532+01:00","closed_at":"2025-12-21T20:24:34.631532+01:00","close_reason":"Guard focus update when apex unknown; add regression test","dependencies":[{"issue_id":"beadhub-igwn","depends_on_id":"beadhub-s35l","type":"discovered-from","created_at":"2025-12-21T20:23:35.457984+01:00","created_by":"juanre"}]}
{"id":"beadhub-ih4a","title":"bdh heartbeat.go and projects.go need test coverage","description":"New files from yesterday's commits lack test coverage:\n\n- heartbeat.go (177 lines) - no tests\n- projects.go (179 lines) - no tests\n\nSpecific test cases needed:\n\nheartbeat.go:\n- canonicalizeOriginURL() edge cases (SSH ports, case sensitivity, malformed URLs)\n- validateRepoOriginMatchesCurrent() error paths\n- currentGitBranch() timeout behavior\n- Cloud heartbeat fallback (404/405 vs other errors)\n\nprojects.go:\n- List with pagination\n- Delete with confirmation\n- Error handling for missing config\n\nPer review: overall test coverage is good (11K lines) but these new files are gaps.","notes":"Track under beadhub-oy60 epic","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T09:20:51.517939Z","created_by":"juanre","updated_at":"2026-01-06T10:14:18.28301Z","closed_at":"2026-01-06T10:14:18.28301Z","close_reason":"Added heartbeat_test.go (21 URL tests + validation tests) and projects_test.go (format output tests). Commit f46d226.","dependencies":[{"issue_id":"beadhub-ih4a","depends_on_id":"beadhub-oy60","type":"parent-child","created_at":"2026-01-06T10:02:34.560605Z","created_by":"juanre"}]}
{"id":"beadhub-ikcx","title":"Fix bdh :chat stale output after send","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-04T19:43:07.201267Z","created_by":"juanre","updated_at":"2026-01-04T20:39:34.533484Z","closed_at":"2026-01-04T20:39:34.533484Z","close_reason":"Fixed chat SSE replay staleness + improved notifications (df9d4c3)","external_ref":"beadhub-cloud-ol6"}
{"id":"beadhub-il2k","title":"Alias collision check returns deleted workspaces","description":"In bdh.py check_alias_collision(), the query doesn't filter by deleted_at IS NULL. When a workspace is deleted and recreated with the same alias, the old deleted workspace causes a 409 collision. Same bug pattern as beadhub-6qya. Fix: add 'AND deleted_at IS NULL' to line 672.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-21T20:42:15.55133+01:00","updated_at":"2025-12-21T20:42:45.451683+01:00","closed_at":"2025-12-21T20:42:45.451683+01:00","close_reason":"Added deleted_at IS NULL filter to check_alias_collision query"}
{"id":"beadhub-ilzf","title":"Frontend: add hostname/cwd to WorkspacePresence type","description":"Add hostname and cwd fields to the TypeScript interface.\n\nFile: frontend/src/lib/api.ts\n\n```typescript\nexport interface WorkspacePresence {\n  // ... existing fields ...\n  hostname: string | null\n  cwd: string | null\n}\n```","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-13T21:09:54.269099+01:00","updated_at":"2025-12-13T21:09:54.269099+01:00","dependencies":[{"issue_id":"beadhub-ilzf","depends_on_id":"beadhub-qx14","type":"blocks","created_at":"2025-12-13T21:10:02.964531+01:00","created_by":"juanre","metadata":"{}"}]}
{"id":"beadhub-inyh","title":"Update beadhub-architecture.md for messages in Postgres","description":"Update source-of-truth/beadhub-architecture.md to fix the contradiction:\n\n**Current contradiction:**\n- Lines 374-390: Documents Redis inbox with 7-day TTL\n- Lines 799-801: Claims 'all queries filtered by project_id' for data isolation\n- These cannot both be true - Redis impl has NO project_id\n\n**Required changes:**\n\n1. Remove Redis Message Inbox section (lines 374-390):\n```\n**Message Inbox**\nKey: inbox:{workspace_id}\nType: Hash (message_id â†’ JSON)\nTTL: 7 days\n...\n```\n\n2. Add messages table to Postgres section (after line 500, in server schema):\n```sql\n-- Messages (async mail between workspaces)\nCREATE TABLE messages (\n    id UUID PRIMARY KEY,\n    project_id UUID NOT NULL REFERENCES projects(id),\n    from_workspace_id UUID NOT NULL REFERENCES workspaces(workspace_id),\n    to_workspace_id UUID NOT NULL REFERENCES workspaces(workspace_id),\n    ...\n);\n```\n\n3. Ensure Data Isolation section (lines 799-801) is now accurate for ALL data\n\nFile: beadhub-sot/source-of-truth/beadhub-architecture.md\n\nPart of epic beadhub-37yb","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T09:53:00.258186+01:00","updated_at":"2025-12-20T11:08:19.397453+01:00","closed_at":"2025-12-20T11:08:19.397453+01:00","close_reason":"Completed"}
{"id":"beadhub-iod7","title":"Beads: search issues (API + dashboard)","description":"Add first-class bead search so users can quickly find issues by ID/title/metadata.\n\nProblem\n- Today the dashboard and API primarily support filtering (repo/branch/status/etc) but not free-text search.\n- This makes large projects painful: users canâ€™t quickly jump to a bead without knowing its exact position in a sorted list.\n\nScope (v1)\n- API: add a query parameter `q` to issue listing endpoints to search across key fields.\n  - Primary use cases: search by `bead_id` (exact/prefix), `title` (substring), optionally `assignee` and `labels`.\n  - Must be tenant-scoped by `project_id` and respect existing filters.\n- Dashboard: add a search box wired to the API.\n\nNon-goals (v1)\n- Advanced relevance ranking, stemming, multi-field query language.\n- Cross-project search in Cloud mode.\n\nNotes\n- Start with safe, simple SQL (ILIKE/prefix match) and add indexes/FTS only if needed.\n- Ensure search is deterministic and paginated/limited.","acceptance_criteria":"- A user can enter a query and see matching beads in the dashboard.\n- API supports `q` search and combines correctly with filters (repo/branch/status/type/label/assignee).\n- Search supports at least: bead_id (exact/prefix) and title substring.\n- Results are tenant-scoped (project_id) and returned in a useful deterministic order.\n- Tests cover the API search behavior.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-07T07:04:01.678903Z","created_by":"juanre","updated_at":"2026-01-09T20:46:54.465295+01:00","closed_at":"2026-01-09T20:46:54.465295+01:00","close_reason":"All subtasks complete: API search (q=), dashboard UI, tests, DB indexes, and docs","labels":["component:api","component:beads","component:dashboard"]}
{"id":"beadhub-iod7.1","title":"API: add q= search to /v1/beads/issues and /v1/beads/issues/all","description":"Implement query parameter q for free-text search across bead_id/title (v1), combined with existing filters and project scoping.","acceptance_criteria":"- /v1/beads/issues?q=... returns matches scoped to X-Project-ID\n- /v1/beads/issues/all?q=... supports OSS dashboard usage (no headers)\n- Search supports bead_id exact/prefix and title substring\n- Query length is bounded and safely handled","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T07:04:21.137982Z","created_by":"juanre","updated_at":"2026-01-09T19:58:08.023615+01:00","closed_at":"2026-01-09T19:58:08.023615+01:00","close_reason":"Implemented q= search parameter for bead_id prefix and title substring on both /issues and /issues/all endpoints","labels":["component:api","component:beads"],"dependencies":[{"issue_id":"beadhub-iod7.1","depends_on_id":"beadhub-iod7","type":"parent-child","created_at":"2026-01-07T07:04:21.138738Z","created_by":"juanre"}]}
{"id":"beadhub-iod7.2","title":"DB: add indexes to keep search fast","description":"Add minimal indexes (or FTS) to keep bead search performant as data grows.","acceptance_criteria":"- Search queries avoid sequential scans for common cases (bead_id prefix, title substring where feasible)\n- Migration is safe/idempotent and documented","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T07:04:21.322084Z","created_by":"juanre","updated_at":"2026-01-09T20:46:41.562615+01:00","closed_at":"2026-01-09T20:46:41.562615+01:00","close_reason":"Added pg_trgm GIN indexes for bead_id and title search performance","labels":["component:beads","component:db"],"dependencies":[{"issue_id":"beadhub-iod7.2","depends_on_id":"beadhub-iod7","type":"parent-child","created_at":"2026-01-07T07:04:21.322778Z","created_by":"juanre"},{"issue_id":"beadhub-iod7.2","depends_on_id":"beadhub-iod7.1","type":"blocks","created_at":"2026-01-07T07:04:21.325142Z","created_by":"juanre"}]}
{"id":"beadhub-iod7.3","title":"Dashboard: add search box + wire to beads list","description":"Add a search input to the beads list UI and call the API with q=, preserving existing filters.","acceptance_criteria":"- User can type a query and see results update (submit or debounce)\n- Query is reflected in URL/state for shareability\n- Works with existing repo/branch/status filters","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T07:04:21.511915Z","created_by":"juanre","updated_at":"2026-01-09T20:03:23.370247+01:00","closed_at":"2026-01-09T20:03:23.370247+01:00","close_reason":"Implemented search box in IssuesPage with URL state, debouncing, and API wiring","labels":["component:dashboard"],"dependencies":[{"issue_id":"beadhub-iod7.3","depends_on_id":"beadhub-iod7","type":"parent-child","created_at":"2026-01-07T07:04:21.512595Z","created_by":"juanre"},{"issue_id":"beadhub-iod7.3","depends_on_id":"beadhub-iod7.1","type":"blocks","created_at":"2026-01-07T07:04:21.514912Z","created_by":"juanre"}]}
{"id":"beadhub-iod7.4","title":"Tests: API bead search","description":"Add tests that create sample beads and assert q= searches return expected results and remain project-scoped.","acceptance_criteria":"- Test: bead_id prefix match\n- Test: title substring match\n- Test: project scoping enforced\n- Test: q combines with at least one filter (e.g., status)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T07:04:21.704204Z","created_by":"juanre","updated_at":"2026-01-09T19:58:08.449174+01:00","closed_at":"2026-01-09T19:58:08.449174+01:00","close_reason":"Added 6 tests covering bead_id prefix search, title substring search, filter combinations, and edge cases","labels":["area:tests","component:beads"],"dependencies":[{"issue_id":"beadhub-iod7.4","depends_on_id":"beadhub-iod7","type":"parent-child","created_at":"2026-01-07T07:04:21.70493Z","created_by":"juanre"},{"issue_id":"beadhub-iod7.4","depends_on_id":"beadhub-iod7.1","type":"blocks","created_at":"2026-01-07T07:04:21.707698Z","created_by":"juanre"}]}
{"id":"beadhub-iod7.5","title":"Docs: document q= search","description":"Update docs/api-reference.md with q= param and examples.","acceptance_criteria":"- docs/api-reference.md includes q parameter + examples for both endpoints","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-07T07:04:21.897935Z","created_by":"juanre","updated_at":"2026-01-09T20:46:42.312966+01:00","closed_at":"2026-01-09T20:46:42.312966+01:00","close_reason":"Documented q= search parameter in docs/api-reference.md","labels":["area:docs","component:beads"],"dependencies":[{"issue_id":"beadhub-iod7.5","depends_on_id":"beadhub-iod7","type":"parent-child","created_at":"2026-01-07T07:04:21.898567Z","created_by":"juanre"},{"issue_id":"beadhub-iod7.5","depends_on_id":"beadhub-iod7.1","type":"blocks","created_at":"2026-01-07T07:04:21.901014Z","created_by":"juanre"}]}
{"id":"beadhub-iqxh","title":"Review bdh init UX: consider interactive input instead of env vars","description":"Consider changing bdh init to use interactive prompts instead of environment variables for human_name and project_key. Current design uses BEADHUB_HUMAN and BEADHUB_PROJECT env vars with defaults (juanre and directory name). The .beadhub file should be the source of truth, env vars may just add noise. Options: 1) Interactive prompts during init 2) Keep defaults and let user edit .beadhub 3) Flag arguments (--human-name, --project-key)","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-10T10:30:56.711012+01:00","updated_at":"2025-12-10T10:31:06.566955+01:00","dependencies":[{"issue_id":"beadhub-iqxh","depends_on_id":"beadhub-r0xm","type":"discovered-from","created_at":"2025-12-10T10:30:56.712056+01:00","created_by":"juanre"}]}
{"id":"beadhub-ixrf","title":"Move default policy bundle to editable markdown files","description":"## Problem\n\nThe DEFAULT_POLICY_BUNDLE in src/beadhub/routes/policies.py:34-131 is:\n1. Hardcoded Python dicts - hard to edit, review, or iterate on\n2. Sparse and outdated - e.g., chat invariant doesn't mention verb-based interface (--open, --reply, --pending, --history), --start-conversation, --no-wait, or wait/timeout behavior\n3. Not connected to source-of-truth - detailed specs exist in beadhub-sot but aren't reflected\n\n## Solution\n\nStore defaults as markdown files with YAML frontmatter:\n\n```\nsrc/beadhub/defaults/\nâ”œâ”€â”€ invariants/\nâ”‚   â”œâ”€â”€ tracking-bdh-only.md\nâ”‚   â”œâ”€â”€ communication-mail-first.md\nâ”‚   â”œâ”€â”€ communication-chat.md          # New - detailed chat guidance\nâ”‚   â”œâ”€â”€ identity-no-impersonation.md\nâ”‚   â”œâ”€â”€ docs-keep-current.md\nâ”‚   â””â”€â”€ outcome-drive-to-goal.md\nâ””â”€â”€ roles/\n    â”œâ”€â”€ coordinator.md\n    â”œâ”€â”€ implementer.md\n    â””â”€â”€ reviewer.md\n```\n\nEach file has frontmatter for metadata:\n```markdown\n---\nid: communication.chat\ntitle: Chat for synchronous coordination\n---\n\nBody content here...\n```\n\n## Implementation\n\n1. Create defaults directory structure with markdown files\n2. Write loader that parses frontmatter + body into PolicyBundle\n3. Cache parsed bundle in memory at server startup\n4. Update get_active_policy() bootstrap path to use cached bundle\n5. Remove hardcoded DEFAULT_POLICY_BUNDLE dict\n\n## Scaling\n\n- Markdown read once at startup, cached in memory\n- Bootstrap uses cached bundle (no file I/O per request)\n- Postgres remains runtime source of truth\n- No impact on 10k+ user scenarios","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-08T20:07:50.749983+01:00","created_by":"juanre","updated_at":"2026-01-08T20:27:26.084616+01:00","closed_at":"2026-01-08T20:27:26.084616+01:00","close_reason":"Implemented markdown defaults with thread-safe caching"}
{"id":"beadhub-ixss","title":"Refactor create_session to find-or-create pattern","description":"Modify POST /v1/chat/sessions to:\n\n1. Find existing session by (project_id, sorted_workspaces) or create new\n2. Always append message to session (no TTL checks)\n3. Remove status field usage (waiting/active/ended)\n4. Remove pair_key Redis operations\n5. Return session_id and sse_url\n\nUse INSERT ... ON CONFLICT DO NOTHING + SELECT pattern for atomic find-or-create.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T20:25:31.809714+01:00","updated_at":"2025-12-13T22:59:25.458097+01:00","closed_at":"2025-12-13T22:59:25.458097+01:00","dependencies":[{"issue_id":"beadhub-ixss","depends_on_id":"beadhub-xthe","type":"blocks","created_at":"2025-12-13T20:26:14.635133+01:00","created_by":"juanre"}]}
{"id":"beadhub-j02i","title":"Missing /v1/beads/issues/{bead_id} endpoint for single-issue lookup","description":"Location: routes/beads.py, routes/mcp.py:476-485. The MCP get_issue tool needs to fetch a single issue by bead_id. Currently it calls beads_issues with limit=1000 and filters client-side. Add a dedicated GET /v1/beads/issues/{bead_id}?repo=X\u0026branch=Y endpoint that does a direct indexed query. Required params: project_id (from header), repo, branch, bead_id. Uses the unique index (project_id, repo_name, branch, bead_id).","status":"closed","priority":1,"issue_type":"feature","assignee":"dave-agent","created_at":"2025-12-09T19:55:12.474931+01:00","updated_at":"2026-01-03T18:42:14.777978Z","closed_at":"2026-01-03T18:42:14.777978Z","close_reason":"Added repo/branch params for O(1) indexed lookup with format validation"}
{"id":"beadhub-j1b0","title":"TECH DEBT: Remove deprecated alias parameter from get_agent_presence","description":"## Problem\n\nDeprecated parameter still in function signature but documented as ignored.\n\n### Current Behavior\n\nIn `src/beadhub/presence.py:156`:\n```python\nasync def get_agent_presence(\n    redis: Redis,\n    workspace_id: str,\n    alias: Optional[str] = None,  # Deprecated parameter, ignored\n):\n```\n\n### Impact\n\n- API surface includes dead parameter\n- Callers may pass alias expecting it to work\n- Documentation/code mismatch\n\n### Solution\n\nRemove the deprecated parameter:\n\n```python\nasync def get_agent_presence(\n    redis: Redis,\n    workspace_id: str,\n) -\u003e Optional[PresenceData]:\n    \"\"\"Get presence data for a workspace.\n    \n    Args:\n        redis: Redis client\n        workspace_id: UUID of the workspace\n        \n    Returns:\n        PresenceData if workspace has active presence, None otherwise\n    \"\"\"\n    ...\n```\n\n### Migration\n\n1. Search for callers passing `alias` parameter\n2. Update callers to remove the argument\n3. Remove parameter from function\n\n### Files to Update\n\n- `src/beadhub/presence.py`\n- Any callers of get_agent_presence\n\n### Acceptance Criteria\n\n- [ ] Deprecated parameter removed\n- [ ] No callers pass the removed parameter\n- [ ] All tests pass","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-09T08:31:48.280588+01:00","created_by":"juanre","updated_at":"2026-01-10T23:20:43.098454+01:00","closed_at":"2026-01-10T23:20:43.098454+01:00","close_reason":"Removed deprecated alias parameter from get_agent_presence and updated caller in mcp.py"}
{"id":"beadhub-j1ro","title":"P0 sync gap repro 2","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T16:56:45.69591+01:00","created_by":"juanre","updated_at":"2026-01-07T17:01:42.290062+01:00","closed_at":"2026-01-07T17:01:42.290062+01:00","close_reason":"Repro for bdh sync P0 (daemon export timing)"}
{"id":"beadhub-j2dv","title":"Document Redis security requirements (AUTH, network isolation)","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-09T18:50:08.751153+01:00","created_by":"juanre","updated_at":"2026-01-09T18:51:16.170912+01:00","closed_at":"2026-01-09T18:51:16.170912+01:00","close_reason":"Documented in beadhub-sot/source-of-truth/security-patterns.md - added Redis Security section with requirements, trust model, and deployment checklist."}
{"id":"beadhub-j62p","title":"/v1/workspaces endpoint missing tenant isolation - must scope by X-Project-ID when present","description":"The /v1/workspaces endpoint uses project_slug filter without checking X-Project-ID header, violating tenant isolation in Cloud mode.\n\n**Current behavior:** Filters by project_slug directly, which is NOT globally unique in Cloud (multiple tenants can have same slug).\n\n**Fix pattern:**\n- When X-Project-ID header is present (Cloud mode): scope query by project_id, ignore project_slug\n- When X-Project-ID is absent (OSS mode): use project_slug for filtering (globally unique in single-tenant)\n\n**Security assumption:** X-Project-ID is trusted when present because Cloud middleware validates it before forwarding to OSS.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-21T12:01:52.20062+01:00","updated_at":"2025-12-21T12:09:08.317129+01:00","closed_at":"2025-12-21T12:09:08.317129+01:00","close_reason":"Implemented X-Project-ID tenant isolation for /v1/workspaces endpoint. Added get_optional_project_id helper and modified query to scope by project_id when header is present. Added 3 tests for tenant isolation."}
{"id":"beadhub-j86m","title":"OSS API: DELETE /v1/repos/{id} - soft-delete repo","description":"Add endpoint to soft-delete a repo. Set deleted_at. Cascade soft-delete workspaces. Release claims. Clear Redis presence.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T15:25:35.668687+01:00","updated_at":"2025-12-21T16:55:53.204323+01:00","closed_at":"2025-12-21T16:55:53.204323+01:00","close_reason":"Implemented DELETE endpoints with cascade logic","dependencies":[{"issue_id":"beadhub-j86m","depends_on_id":"beadhub-1thq","type":"blocks","created_at":"2025-12-21T15:26:55.083375+01:00","created_by":"juanre"},{"issue_id":"beadhub-j86m","depends_on_id":"beadhub-9w1n","type":"blocks","created_at":"2025-12-21T15:27:04.230701+01:00","created_by":"juanre"}]}
{"id":"beadhub-jamt","title":"Migrate test_mcp.py to db_infra fixture","description":"Convert from app_with_test_db to async tests using db_infra fixture.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-10T10:54:48.098354+01:00","created_by":"juanre","updated_at":"2026-01-10T11:28:35.596467+01:00","closed_at":"2026-01-10T11:28:35.596467+01:00","close_reason":"Migrated 17 tests to use db_infra fixture","dependencies":[{"issue_id":"beadhub-jamt","depends_on_id":"beadhub-7wpr","type":"parent-child","created_at":"2026-01-10T10:55:48.468072+01:00","created_by":"juanre"}]}
{"id":"beadhub-jb5q","title":"Add sender_waiting to PendingConversation response","description":"Update pending endpoint to check SISMEMBER for last message sender. Add sender_waiting: bool to PendingConversation model.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-14T17:07:18.448227+01:00","updated_at":"2025-12-14T17:10:52.43305+01:00","closed_at":"2025-12-14T17:10:52.43305+01:00","dependencies":[{"issue_id":"beadhub-jb5q","depends_on_id":"beadhub-2s14","type":"blocks","created_at":"2025-12-14T17:07:26.784941+01:00","created_by":"juanre"},{"issue_id":"beadhub-jb5q","depends_on_id":"beadhub-z6pe","type":"blocks","created_at":"2025-12-14T17:07:27.185638+01:00","created_by":"juanre"}]}
{"id":"beadhub-jbon","title":"Add htmlFor attributes to form labels (SendMessageDialog a11y)","description":"SendMessageDialog uses `\u003clabel\u003e` elements without `htmlFor`, and corresponding inputs have no stable `id`.\n\nFix:\n- Add stable `id` attributes for the â€œToâ€, â€œSubjectâ€, â€œMessageâ€, and â€œPriorityâ€ controls.\n- Add matching `htmlFor` attributes on labels.\n\nRelevant file:\n- `frontend/src/components/SendMessageDialog.tsx`\n","acceptance_criteria":"- All labels in SendMessageDialog have htmlFor matching an input/textarea/select id","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T20:35:17.829518+01:00","updated_at":"2026-01-03T18:40:16.267636Z"}
{"id":"beadhub-jdqf","title":"Add POST /v1/projects/ensure endpoint","description":"Add endpoint for getting or creating project by slug. Used by bdh init in OSS mode.\n\nRequest:\n```json\n{\n    \"slug\": \"beadhub\",\n    \"name\": \"BeadHub Project\"\n}\n```\n\nResponse:\n```json\n{\n    \"project_id\": \"uuid-xxx\",\n    \"slug\": \"beadhub\",\n    \"name\": \"BeadHub Project\",\n    \"created\": false\n}\n```\n\nLogic:\n1. Validate slug format\n2. Look up existing project by slug\n3. If exists, return it with created=false\n4. If not, create and return with created=true\n\nSee beadhub-specifications.md for full spec.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T12:27:59.235844+01:00","updated_at":"2025-12-10T13:17:47.870834+01:00","closed_at":"2025-12-10T13:17:47.870834+01:00","dependencies":[{"issue_id":"beadhub-jdqf","depends_on_id":"beadhub-4trs","type":"parent-child","created_at":"2025-12-10T12:27:59.23704+01:00","created_by":"juanre"},{"issue_id":"beadhub-jdqf","depends_on_id":"beadhub-bkkz","type":"blocks","created_at":"2025-12-10T12:27:59.237644+01:00","created_by":"juanre"}]}
{"id":"beadhub-jdur","title":"Fix alias collision check to be per-project instead of global","description":"The check_alias_collision function in bdh.py was incorrectly checking for global alias uniqueness instead of per-project uniqueness. This caused 409 Conflict errors when the same alias (e.g., alice-coordinator) was used in different projects. Fixed by adding project_id filter to the workspaces table query. Per data-model.md Decision #6: 'Aliases must be unique within a project, but different projects can have same aliases.'","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-31T16:51:19.630447Z","created_by":"juanre","updated_at":"2025-12-31T16:51:24.834596Z","closed_at":"2025-12-31T16:51:24.834596Z","close_reason":"Fixed by adding project_id filter to workspaces table query in check_alias_collision function"}
{"id":"beadhub-jdzs","title":"repos/lookup ambiguity: handle multiple projects sharing canonical_origin","description":"src/beadhub/routes/repos.py POST /v1/repos/lookup selects the first repo by canonical_origin across ALL projects. In multi-project setups, the same canonical_origin can exist in multiple projects (unique is per project). bdh init could auto-detect and bind to the wrong project. Fix options: (1) require project context for lookup, (2) return 409 with list of candidate projects, or (3) enforce global uniqueness of canonical_origin if that's intended.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T15:36:41.021733+01:00","updated_at":"2025-12-13T16:01:49.46339+01:00","closed_at":"2025-12-13T16:01:49.46339+01:00","dependencies":[{"issue_id":"beadhub-jdzs","depends_on_id":"beadhub-g3ii","type":"discovered-from","created_at":"2025-12-13T15:36:41.022828+01:00","created_by":"juanre"}]}
{"id":"beadhub-je0h","title":"Update Go bdh client.go: all request/response structs","description":"Update bdh/internal/client/client.go for new data model.\n\nRequest struct changes:\n- CommandRequest: AgentName â†’ Alias, add RepoOrigin\n- SyncRequest: AgentName â†’ Alias, add RepoOrigin\n- SendRequest: FromAgentName â†’ FromAlias\n- EscalateRequest: AgentName â†’ Alias\n- CreateChatSessionRequest: InitiatorAgent â†’ InitiatorAlias, TargetAgent â†’ TargetAlias\n- JoinChatSessionRequest: AgentName â†’ Alias\n- SendChatMessageRequest: AgentName â†’ Alias\n\nResponse struct changes:\n- Message: FromAgentName â†’ FromAlias\n- Workspace: AgentName â†’ Alias, ProjectKey â†’ ProjectSlug\n- StatusAgent: Name (check if should be Alias)\n- BeadInProgress: AgentName â†’ Alias\n- PendingChatRequest: FromAgent â†’ FromAlias\n\nJSON tag changes to match Python API:\n- \"agent_name\" â†’ \"alias\"\n- \"from_agent_name\" â†’ \"from_alias\"\n- \"initiator_agent\" â†’ \"initiator_alias\"\n- \"target_agent\" â†’ \"target_alias\"\n- \"project_key\" â†’ \"project_slug\" (align with .beadhub file and specs)\n- Add \"repo_origin\" tags\n\nQuery parameter changes:\n- project_key â†’ project_slug in URL query params (lines 517, 530)\n\nDepends on: config.go changes","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T12:51:48.635126+01:00","updated_at":"2025-12-12T18:32:05.642659+01:00","closed_at":"2025-12-12T18:32:05.642659+01:00","dependencies":[{"issue_id":"beadhub-je0h","depends_on_id":"beadhub-lhx4","type":"blocks","created_at":"2025-12-12T12:51:57.333112+01:00","created_by":"juanre"}]}
{"id":"beadhub-jelm","title":"Chat system: multiple bugs causing inter-agent communication failures","description":"## Summary\nInter-agent chat between claude-fe and claude-be repeatedly fails. Messages sent via :chat don't appear in the recipient's :chat --pending output.\n\n## Root Cause Analysis\nThe ephemeral session model has fundamental state synchronization issues between:\n1. Session state (waiting/active/ended)\n2. SSE connection state (connected/disconnected)\n3. TTL-based expiration\n\n## Fix\nbeadhub-k8t9: Refactor to persistent session model (v2.0)\nSee beadhub-chat-spec.md v2.0\n\n## Original Bug Details\nSee bead description history for original debugging notes.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-13T20:10:01.92311+01:00","updated_at":"2025-12-14T08:48:51.611961+01:00","closed_at":"2025-12-14T08:48:51.611961+01:00"}
{"id":"beadhub-jes","title":"SQL injection via f-string LIMIT in beads.py:247,317 - use parameterized queries","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-03T15:38:30.567837+01:00","updated_at":"2025-12-03T17:18:26.827416+01:00","closed_at":"2025-12-03T17:18:26.827416+01:00"}
{"id":"beadhub-jf2w","title":"Clarify '(you)' in notification messages to indicate agent, not human","description":"## Problem\n\nNotification messages show \\\"(you)\\\" after the workspace alias, which is confusing because humans reading the output may think it refers to them:\n\n```\nNOTIFICATIONS:\n  MAILS: 4 unread for dave-planner (you) â€” Run \"bdh :inbox\"\n```\n\nThe \\\"(you)\\\" refers to the agent workspace, not the human user. This caused confusion when the human thought they had emails.\n\n## Root Cause\n\nThe `aliasClause` is constructed with `(you)` in 4 places:\n\n1. `bdh/internal/commands/passthrough.go:1013`\n   ```go\n   aliasClause = fmt.Sprintf(\\\" for %s (you)\\\", result.RecipientAlias)\n   ```\n\n2. `bdh/internal/commands/passthrough.go:1188`\n   ```go\n   aliasClause = fmt.Sprintf(\\\" for %s (you)\\\", result.RecipientAlias)\n   ```\n\n3. `bdh/internal/commands/context.go:174`\n   ```go\n   aliasClause = fmt.Sprintf(\\\" for %s (you)\\\", ctx.CurrentAlias)\n   ```\n\n4. `bdh/internal/commands/context.go:249`\n   ```go\n   aliasClause = fmt.Sprintf(\\\" for %s (you)\\\", ctx.CurrentAlias)\n   ```\n\n## Solution\n\nChange \\\"(you)\\\" to \\\"(your agent)\\\" or \\\"(you, the agent)\\\" to make it clear the message refers to the agent workspace, not the human:\n\n```\nMAILS: 4 unread for dave-planner (your agent) â€” Run \"bdh :inbox\"\n```\n\n## Tests to Update\n\n- `bdh/internal/commands/passthrough_test.go` - lines 2533, 2545, 2562, 2570\n- `bdh/internal/commands/context_test.go` - lines 131, 138, 150, 157","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-09T23:51:22.748633+01:00","created_by":"juanre","updated_at":"2026-01-10T08:59:31.821153+01:00","closed_at":"2026-01-10T08:59:31.821153+01:00","close_reason":"Changed (you) to (you, the agent) in notifications"}
{"id":"beadhub-jj00","title":"Update data-model.md for messages in Postgres","description":"Update source-of-truth/data-model.md:\n\n1. Remove Redis inbox section (lines 245-254):\n```\n### Message Inbox\nKey: inbox:{workspace_id}\nTTL: 7 days\n```\n\n2. Add messages table to 'New Tables for Coordination' section alongside repos/workspaces\n\nFile: beadhub-sot/source-of-truth/data-model.md\n\nPart of epic beadhub-37yb","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T09:44:14.596044+01:00","updated_at":"2025-12-20T11:31:44.914964+01:00","closed_at":"2025-12-20T11:31:44.914964+01:00","close_reason":"Completed"}
{"id":"beadhub-jkx5","title":"Chat get_session_messages should support since/limit query params","description":"beadhub-chat-spec.md v2.1 specifies GET /v1/chat/sessions/{session_id}/messages supports since and limit. Go client already sends Since/Limit fields in GetMessagesRequest. Server endpoint currently only accepts workspace_id and returns full history.\n\nFix: add since (ISO timestamp) and limit params; apply them in SQL with ORDER BY created_at ASC and LIMIT; validate and default limit (e.g., 50).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-14T08:50:59.428878+01:00","updated_at":"2025-12-14T09:26:24.019838+01:00","closed_at":"2025-12-14T09:26:24.019838+01:00"}
{"id":"beadhub-jm3","title":"Create example files - sample issues.jsonl, multi-repo setup","description":"Add to examples/: 1) Sample .beads/issues.jsonl showing typical issue structure, 2) Multi-repo setup example with frontend/backend repos, 3) Cross-repo dependency example (frontend:fd-123 blocked by backend:bd-456), 4) Subscription example showing fire-and-forget coordination","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-03T20:52:18.444492+01:00","updated_at":"2025-12-06T21:39:13.202645+01:00","closed_at":"2025-12-06T21:39:13.202645+01:00"}
{"id":"beadhub-js9f","title":"Add input validation for workspace/project IDs in dashboard","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-08T15:32:34.053213+01:00","updated_at":"2025-12-08T15:32:34.053213+01:00","dependencies":[{"issue_id":"beadhub-js9f","depends_on_id":"beadhub-7r4","type":"discovered-from","created_at":"2025-12-08T15:32:34.054002+01:00","created_by":"juanre"}]}
{"id":"beadhub-jv2g","title":"Add POST /v1/bdh/sync endpoint","description":"Post-mutation sync endpoint. Called by bdh after successful mutation commands (create, update, close).\n\n## Architectural Decision (2025-12-10)\n\n**project_id (UUID) is the partition key everywhere.** This unifies OSS and SaaS:\n\n- OSS: `.beadhub` stores `project_id` (obtained via `bdh init` which calls backend)\n- SaaS: `.beadhub` stores `project_slug` only; `project_id` derived from API key at runtime\n\nRenamed: `project_key` â†’ `project_slug` for clarity (it's a human-readable slug, not a key).\n\n## Request\n\nOSS mode (no API key):\n```json\n{\n    \"workspace_id\": \"uuid\",\n    \"project_id\": \"uuid\",\n    \"issues_jsonl\": \"\u003ccontents of .beads/issues.jsonl\u003e\"\n}\n```\n\nSaaS mode (with API key in X-API-Key header):\n```json\n{\n    \"workspace_id\": \"uuid\",\n    \"issues_jsonl\": \"\u003ccontents of .beads/issues.jsonl\u003e\"\n}\n```\n(project_id extracted from API key by middleware)\n\n## Response\n```json\n{ \"synced\": true, \"issues_count\": 15 }\n```\n\n## Backend Logic\n1. Get project_id (from body in OSS, from API key in SaaS)\n2. Parse issues from JSONL\n3. Update BeadHub's issue store (beads.beads_issues table)\n4. Update bead_claims based on status changes:\n   - in_progress â†’ upsert claim for this workspace\n   - open or closed â†’ delete claim\n5. Return sync result\n\n## Prerequisites\n- OSS needs `server.projects` table: `(id UUID, slug TEXT UNIQUE, name TEXT, created_at)`\n- OSS needs `/v1/projects/ensure` endpoint for `bdh init` to get project_id from slug\n\nSee beadhub-bdh-design.md for full spec (to be updated).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T09:35:14.742915+01:00","updated_at":"2025-12-10T13:00:11.333712+01:00","closed_at":"2025-12-10T13:00:11.333712+01:00","dependencies":[{"issue_id":"beadhub-jv2g","depends_on_id":"beadhub-4trs","type":"parent-child","created_at":"2025-12-10T09:36:05.533153+01:00","created_by":"juanre"},{"issue_id":"beadhub-jv2g","depends_on_id":"beadhub-6gfo","type":"blocks","created_at":"2025-12-10T09:36:15.220258+01:00","created_by":"juanre"},{"issue_id":"beadhub-jv2g","depends_on_id":"beadhub-bkkz","type":"blocks","created_at":"2025-12-10T12:28:23.701335+01:00","created_by":"juanre"},{"issue_id":"beadhub-jv2g","depends_on_id":"beadhub-9ibq","type":"blocks","created_at":"2025-12-10T12:28:32.150446+01:00","created_by":"juanre"}]}
{"id":"beadhub-jwbz","title":"Migrate test_workspaces_team.py to db_infra fixture","description":"Convert from app_with_test_db to async tests using db_infra fixture. Also has one async test with manual try/finally.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-10T10:54:49.325136+01:00","created_by":"juanre","updated_at":"2026-01-10T12:40:20.396294+01:00","closed_at":"2026-01-10T12:40:20.396294+01:00","close_reason":"Migration complete: all 8 tests pass, code-reviewer approved","dependencies":[{"issue_id":"beadhub-jwbz","depends_on_id":"beadhub-7wpr","type":"parent-child","created_at":"2026-01-10T10:55:48.778638+01:00","created_by":"juanre"}]}
{"id":"beadhub-jx5m","title":"bdh: Add :set-role command","description":"Add a `bdh :set-role` command to make workspace role updates easy.\n\nCurrent state:\n- Role is read from `.role` and sent during registration/commands.\n- Updating role requires manually editing `.role` and/or re-running init/update flows.\n\nDesired behavior:\n- `bdh :set-role \"\u003crole\u003e\"` writes `.role` (validated) in the current repo root.\n- Optionally supports `--clear` to remove the role.\n- Prints next step (e.g., run `bdh :init --update`) if server-side update is not done inline.\n\nRelevant code:\n- `bdh/internal/commands` (new subcommand)\n- `bdh/internal/config` (role validation/reuse)\n","acceptance_criteria":"- bdh :set-role writes/clears .role with validation\n- Role is reflected in subsequent bdh commands","status":"tombstone","priority":2,"issue_type":"task","created_at":"2025-12-14T09:06:37.852951+01:00","updated_at":"2026-01-08T20:07:09.874834+01:00","dependencies":[{"issue_id":"beadhub-jx5m","depends_on_id":"beadhub-161u","type":"parent-child","created_at":"2025-12-14T09:24:11.433729+01:00","created_by":"juanre","metadata":"{}"}],"deleted_at":"2026-01-08T20:07:09.874834+01:00","deleted_by":"daemon","delete_reason":"Not needed - role can be set via bdh init or editing .beadhub directly","original_type":"task"}
{"id":"beadhub-jy8","title":"Update migrations for beadhub-cloud schema","description":"Remove conversation-related migrations. Keep users, projects, api_keys, project_members tables. Update table names if needed. Ensure migrations work with pgdbm.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-03T08:21:13.429419+01:00","updated_at":"2025-12-03T08:35:04.927367+01:00","closed_at":"2025-12-03T08:35:04.927367+01:00","close_reason":"Removed conversation_metadata table and trigger from 001_initial.sql","dependencies":[{"issue_id":"beadhub-jy8","depends_on_id":"beadhub-gpm","type":"blocks","created_at":"2025-12-03T08:21:18.8649+01:00","created_by":"juanre"}]}
{"id":"beadhub-jz7a","title":"Fix subscriptions table schema: add repo_id FK","description":"The subscriptions table needs updating per data model:\n- Add repo_id UUID FK to repos table\n- Ensure project_id is correctly typed and has FK to projects\n\nSee data-model.md and beadhub-architecture.md for correct schema.\n\nUpdated 2025-12-12: terminology changed from project_key to project_id, added repo_id per data model.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-10T12:54:52.180729+01:00","updated_at":"2025-12-12T12:41:02.77052+01:00"}
{"id":"beadhub-k14u","title":"Projects support in OSS","description":"Add full projects support to OSS (same as Cloud, minus auth/billing).\n\nHierarchy:\n- Project (e.g., 'beadhub-all') \n  - has human-readable slug\n  - contains multiple repos\n- Repo (e.g., 'beadhub', 'beadhub-cloud')\n  - belongs to a project\n  - workspaces register with repo\n- Workspace\n  - belongs to a repo (implicitly to a project)\n\nChanges needed:\n- Projects table/storage in Postgres (already exists in schema, verify it works)\n- API to create/list projects (minimal CRUD)\n- Repo-to-project association on agent registration\n- project_key field in .beadhub (human-readable slug like 'beadhub-all')\n- All dashboard queries default to showing everything in the current project\n- GET /v1/status, /v1/reservations, /v1/escalations support optional project filter","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-08T16:21:34.329251+01:00","updated_at":"2025-12-08T16:49:24.497208+01:00","closed_at":"2025-12-08T16:49:24.497208+01:00"}
{"id":"beadhub-k3jq","title":"API endpoint: POST /v1/dashboard/identity","description":"Implement endpoint that creates or retrieves a dashboard workspace for a human in a project. Input: project_id, human_name, alias (optional). Output: workspace_id, alias, human_name, project_id, created. Lookup by project_id + human_name where workspace_type='dashboard'.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T19:27:03.861483+01:00","updated_at":"2025-12-13T20:15:24.277568+01:00","closed_at":"2025-12-13T20:04:56.618316+01:00","dependencies":[{"issue_id":"beadhub-k3jq","depends_on_id":"beadhub-1b04","type":"blocks","created_at":"2025-12-13T19:27:36.959521+01:00","created_by":"juanre"},{"issue_id":"beadhub-k3jq","depends_on_id":"beadhub-g9l6","type":"parent-child","created_at":"2025-12-13T19:27:52.209326+01:00","created_by":"juanre"}]}
{"id":"beadhub-k4j0","title":"Mobile layout is broken - sidebar/content overlap and poor responsiveness","description":"Mobile layout issues on Status page:\n\n1. Stats cards grid broken - 'Active Claims' card orphaned at half-width while others share row. Should stack vertically (full-width) on mobile.\n\n2. Filter bar takes 3 visual rows - too much vertical space. Consider collapsing to single row or hiding behind 'Filter' button on mobile.\n\n3. Excessive padding/margins on cards - wasted horizontal space on narrow screens.\n\n4. Overall visual imbalance - layout looks unfinished.","status":"closed","priority":2,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-01-17T11:48:19.813682+01:00","created_by":"Juan Reyero","updated_at":"2026-01-17T14:50:13.086219+01:00","closed_at":"2026-01-17T14:50:13.086219+01:00","close_reason":"Fixed: stats grid stacks on mobile, filter bar collapses to toggle, reduced padding, added a11y attributes"}
{"id":"beadhub-k571","title":"Add apex field to workspace API response","description":"Server-side: Add optional 'apex_bead_id' and 'apex_bead_title' fields to WorkspaceInfo response from /v1/bdh/command and workspace list endpoints. Client sends apex with command requests. This allows :who to show apex without client-side lookup. Update client.go types and passthrough to send apex.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T21:59:19.752475+01:00","updated_at":"2025-12-20T11:09:57.348677+01:00","closed_at":"2025-12-20T11:09:57.348677+01:00","close_reason":"Implemented apex field in workspace API. Added tests for apex preservation.","dependencies":[{"issue_id":"beadhub-k571","depends_on_id":"beadhub-npuh","type":"parent-child","created_at":"2025-12-17T21:59:33.390375+01:00","created_by":"juanre"}]}
{"id":"beadhub-k6u7","title":"aweb/beadhub split: ship-ready OSS cores","description":"Goal: make the clean-slate split shippable and easy to extract into separate repos (../aweb and ../beadhub) without legacy baggage.\n\nScope:\n- aweb is an OSS protocol + reference implementation for identity/auth + mail/chat/reservations/presence\n- beadhub is an OSS application that IMPLEMENTS the aweb protocol (aweb routes are embedded in-process) and adds beads/repos/workspaces/etc\n- No legacy coordination command surfaces remain; the only coordination UX is via aweb protocol commands (bdh :aweb ...)\n\nNotes:\n- Follow SOT docs under ../beadhub-sot/source-of-truth/\n- Cloud products live in separate repos (beadhub-cloud and future aweb-cloud); keep OSS boundaries clean here.\n- Announcement readiness: ../beadhub-sot/source-of-truth/aweb-beadhub-announcement-checklist.md","acceptance_criteria":"- aweb OSS core is runnable standalone and as an embedded library (same protocol)\n- beadhub OSS core runs with embedded aweb by default (no external aweb dependency)\n- Go protocol CLI naming decision captured (aw) and implementation matches\n- All tests green via uv + local pg/redis fixtures\n- Repo split/extraction checklist exists (no hidden coupling)\n- Announcement readiness checklist exists","status":"closed","priority":1,"issue_type":"epic","owner":"juan@juanreyero.com","created_at":"2026-01-22T10:06:36.966725+01:00","created_by":"Juan Reyero","updated_at":"2026-01-22T16:06:57.011376+01:00","closed_at":"2026-01-22T16:06:57.011376+01:00","close_reason":"Closed"}
{"id":"beadhub-k6u7.1","title":"aweb Go client + CLI naming/packaging (aw vs ab)","description":"Decide the public Go surface for aweb and implement the minimal packaging that makes it easy for users to install and use.\\n\\nScope:\\n- Choose CLI binary name (aw vs ab) and module naming (aweb-go vs aw-go).\\n- Document the decision in ../beadhub-sot/source-of-truth/ (and repo README if appropriate).\\n- Ensure the CLI can be installed with: go install \u003cmodule_path\u003e/cmd/\u003cbinary\u003e@latest (once extracted to ../aweb).\\n- Ensure BeadHub's Go CLI can depend on the Go client library for :mail/:chat/:lock without importing server code.\\n","acceptance_criteria":"- CLI binary name decision recorded in SOT (aw) with rationale\\n- Go module naming decision recorded in SOT (aweb-go) with intended publish path\\n- go test ./... passes in aweb-go","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-22T10:11:02.327811+01:00","created_by":"Juan Reyero","updated_at":"2026-01-22T10:40:28.051083+01:00","closed_at":"2026-01-22T10:40:28.051083+01:00","close_reason":"Closed","labels":["area:packaging","component:cli","component:go"],"dependencies":[{"issue_id":"beadhub-k6u7.1","depends_on_id":"beadhub-k6u7","type":"parent-child","created_at":"2026-01-22T10:11:02.329183+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-k6u7.10","title":"bdh: implement :aweb command group (aw-style syntax)","description":"Align bdh CLI with SOT: aweb commands should be invoked as 'bdh :aweb \u003csubcommand\u003e' (e.g. 'bdh :aweb who'), and the legacy 'bdh :who', 'bdh :mail', 'bdh :chat', 'bdh :reservations' surfaces should be removed (clean slate).\\n\\nScope:\\n- Add ':aweb' root command with subcommands: who, status, mail, chat, lock/locks\\n- Rewire existing command implementations under this group\\n- Update bdh help text and docs (README + docs/bdh.md)\\n- Update Go tests under bdh/internal/commands\\n\\n","acceptance_criteria":"- 'bdh :aweb who' etc work; legacy 'bdh :who' etc are gone\\n- Go tests pass: cd bdh \u0026\u0026 go test ./...\\n- Docs updated to show the new syntax","notes":"Proceeding with approach A: implement bdh :aweb commands using aweb-go (mail/chat/reservations) and remove legacy :mail/:chat/:reservations/:who/:status.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-22T12:37:33.256864+01:00","created_by":"Juan Reyero","updated_at":"2026-01-22T14:55:45.381966+01:00","closed_at":"2026-01-22T14:55:45.381966+01:00","close_reason":"Implemented bdh :aweb command group; removed legacy :who/:chat/:mail/:reservations; migrated bdh to aweb-go for locks/mail/chat notifications; updated docs and tests.","labels":["area:docs","area:tests","component:bdh"],"dependencies":[{"issue_id":"beadhub-k6u7.10","depends_on_id":"beadhub-k6u7","type":"parent-child","created_at":"2026-01-22T12:37:33.257906+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-k6u7.11","title":"Remove internal aweb HTTP client path","description":"BeadHub embeds the aweb protocol in-process. Remove any internal HTTP client usage (AwebClient + app.state aweb_* wiring) from BeadHub runtime and deliver notifications by calling local aweb logic directly.","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-22T15:06:38.684618+01:00","created_by":"Juan Reyero","updated_at":"2026-01-22T15:20:36.431399+01:00","closed_at":"2026-01-22T15:20:36.431399+01:00","close_reason":"Closed","dependencies":[{"issue_id":"beadhub-k6u7.11","depends_on_id":"beadhub-k6u7","type":"parent-child","created_at":"2026-01-22T15:06:38.685553+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-k6u7.2","title":"Repo split/extraction checklist (beadhub â†” aweb)","description":"Write a step-by-step extraction checklist to move the aweb OSS core to ../aweb (and later create ../aweb-cloud) without breaking beadhub OSS.\\n\\nInclude:\\n- What code moves where (directories, modules, Go module)\\n- How to keep pgdbm schemas separated (no cross-schema FKs)\\n- Required env vars and run modes (embedded vs remote)\\n- How to preserve test patterns (local Postgres + Redis; pgdbm fixtures; no Docker)\\n- Release checklist for announcing aweb + beadhub OSS cores","acceptance_criteria":"- New SOT doc exists and is self-contained\\n- Checklist is actionable with commands and expected outcomes\\n- Explicitly calls out forbidden couplings and how to detect them","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-22T10:11:30.225387+01:00","created_by":"Juan Reyero","updated_at":"2026-01-22T10:47:14.902192+01:00","closed_at":"2026-01-22T10:47:14.902192+01:00","close_reason":"Closed","labels":["area:docs","area:packaging"],"dependencies":[{"issue_id":"beadhub-k6u7.2","depends_on_id":"beadhub-k6u7","type":"parent-child","created_at":"2026-01-22T10:11:30.226705+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-k6u7.3","title":"User-facing docs refresh (aweb/beadhub split)","description":"Update OSS documentation so a new developer can run and understand the split without tribal knowledge.\n\nScope:\n- Update user-facing docs to reflect the pivot: aweb is a protocol; beadhub implements it (aweb routes are embedded in beadhub)\n- Ensure coordination commands use the new escape hatch: bdh :aweb (who/whoami/mail/chat/locks)\n- Update policy defaults under src/beadhub/defaults/ to remove legacy :who/:status/:chat/:mail/:reservations references\n- Document auth modes that exist in OSS core: (1) Cloud proxy headers (X-BH-Auth) and (2) local bearer API keys (aw_sk_*) validated in-process\n- Avoid mentioning two-service deployments or any server-side AWEB_URL mode","acceptance_criteria":"- No docs/policy defaults mention legacy coordination commands (:who/:status/:chat/:mail/:reservations)\n- Docs align with SOT in ../beadhub-sot/source-of-truth/ (aweb is protocol; embedded is default)\n- Quickstart uses uv and local DB fixtures","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-22T10:11:46.593529+01:00","created_by":"Juan Reyero","updated_at":"2026-01-22T15:47:47.540033+01:00","closed_at":"2026-01-22T15:47:47.540033+01:00","close_reason":"Closed","labels":["area:docs"],"dependencies":[{"issue_id":"beadhub-k6u7.3","depends_on_id":"beadhub-k6u7","type":"parent-child","created_at":"2026-01-22T10:11:46.594555+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-k6u7.4","title":"Tenancy isolation + auth conformance tests (aweb + beadhub)","description":"Add/confirm test coverage for tenant isolation and auth patterns across both aweb and beadhub surfaces, following existing beadhub fixture patterns (pgdbm + local Postgres/Redis; no Docker).\\n\\nScope:\\n- Direct API key mode derives project_id from Bearer token; rejects client project selectors\\n- Proxy header mode trusts X-Project-ID only when X-BH-Auth validates\\n- Embedded mode validates Bearer token locally via embedded aweb infra\\n- Cross-project access attempts are rejected for mail/chat/reservations/beads/workspaces","acceptance_criteria":"- Tests cover the three auth modes end-to-end\\n- Tests cover negative cases (missing auth, invalid signature, mismatched project)\\n- uv run pytest passes locally","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-22T10:12:02.204029+01:00","created_by":"Juan Reyero","updated_at":"2026-01-22T15:59:02.764926+01:00","closed_at":"2026-01-22T15:59:02.764926+01:00","close_reason":"Closed","labels":["area:tests","component:auth"],"dependencies":[{"issue_id":"beadhub-k6u7.4","depends_on_id":"beadhub-k6u7","type":"parent-child","created_at":"2026-01-22T10:12:02.204992+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-k6u7.5","title":"pgdbm schema/migration audit for extraction","description":"Audit pgdbm usage and migrations to ensure aweb and beadhub can be extracted cleanly into separate repos sharing the same Postgres instance when embedded, and using separate services when remote.\\n\\nScope:\\n- Confirm how pgdbm template-based manager naming works for multiple apps\\n- Ensure aweb tables live in their own schema/manager name and beadhub tables do not FK across boundaries\\n- Document how to run migrations for aweb-only vs beadhub-only","acceptance_criteria":"- Doc or notes in SOT explain the pgdbm multi-app pattern\\n- No cross-boundary foreign keys\\n- Migration commands are documented and tested","status":"closed","priority":2,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-22T10:12:17.581993+01:00","created_by":"Juan Reyero","updated_at":"2026-01-22T15:42:37.086203+01:00","closed_at":"2026-01-22T15:42:37.086203+01:00","close_reason":"Closed","labels":["area:migrations","component:db"],"dependencies":[{"issue_id":"beadhub-k6u7.5","depends_on_id":"beadhub-k6u7","type":"parent-child","created_at":"2026-01-22T10:12:17.583018+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-k6u7.6","title":"Announcement readiness checklist (aweb + beadhub OSS cores)","description":"Create a small checklist of what needs to be true before publicly announcing aweb and the new beadhub boundary.\\n\\nInclude:\\n- Repo state: what lives in beadhub OSS vs what moves to ../aweb\\n- Docs complete and consistent with SOT\\n- Minimal install/run instructions for both services\\n- CI/tests status\\n- Naming (aw vs ab) finalized","acceptance_criteria":"- Checklist exists and is referenced from the epic\\n- Owners can use it to decide when to announce","status":"closed","priority":2,"issue_type":"chore","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-22T10:12:34.029253+01:00","created_by":"Juan Reyero","updated_at":"2026-01-22T16:05:41.686919+01:00","closed_at":"2026-01-22T16:05:41.686919+01:00","close_reason":"Closed","labels":["area:release"],"dependencies":[{"issue_id":"beadhub-k6u7.6","depends_on_id":"beadhub-k6u7","type":"parent-child","created_at":"2026-01-22T10:12:34.030273+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-k6u7.7","title":"Pivot: beadhub implements aweb protocol at /v1 (remove /aweb mount)","description":"Align codebase with updated SOT: aweb is a protocol; beadhub is an aweb server (default).\\n\\nScope:\\n- Serve aweb routes directly from beadhub at /v1/* (no /aweb prefix)\\n- Make local/embedded auth the default path (single server, single API key)\\n- Keep AWEB_URL + remote introspection only for rare two-service deployments\\n- Update fixtures/tests that previously used /aweb/v1/*\\n- Ensure pgdbm migrations include aweb schema in beadhub DB infra\\n","acceptance_criteria":"- beadhub serves /v1/init, /v1/auth/introspect, /v1/messages, /v1/chat, /v1/reservations\\n- All beadhub endpoints resolve project scope via local aweb auth by default\\n- Tests pass with uv run pytest\\n- No stale /aweb mount path remains in code/tests","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-22T10:56:58.658981+01:00","created_by":"Juan Reyero","updated_at":"2026-01-22T11:10:58.14525+01:00","closed_at":"2026-01-22T11:10:58.14525+01:00","close_reason":"Closed","labels":["area:tests","component:auth","component:routes"],"dependencies":[{"issue_id":"beadhub-k6u7.7","depends_on_id":"beadhub-k6u7","type":"parent-child","created_at":"2026-01-22T10:56:58.660648+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-k6u7.8","title":"Remove AWEB_URL/two-service mode from beadhub (aweb is protocol)","description":"Align implementation with updated SOT: beadhub always implements the aweb protocol and never delegates to an external aweb server.\\n\\nScope:\\n- Remove AWEB_URL handling from beadhub runtime code (api.py, aweb_introspection.py, aweb_context.py)\\n- Always serve aweb routes at /v1/* from beadhub\\n- Keep only auth modes: (1) cloud proxy headers X-BH-Auth + X-Project-ID, (2) local verify_bearer_token against aweb schema\\n- Update tests that referenced AWEB_URL / remote introspection paths\\n- Ensure uv run pytest passes\\n","acceptance_criteria":"- No AWEB_URL references in beadhub server code\\n- aweb routes always present in beadhub at /v1/*\\n- All tests green via uv run pytest\\n- SOT docs in ../beadhub-sot/source-of-truth/ contain no beadhub AWEB_URL/two-service mode","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-22T11:21:44.589278+01:00","created_by":"Juan Reyero","updated_at":"2026-01-22T11:32:13.794224+01:00","closed_at":"2026-01-22T11:32:13.794224+01:00","close_reason":"Closed","labels":["area:tests","component:auth","component:routes"],"dependencies":[{"issue_id":"beadhub-k6u7.8","depends_on_id":"beadhub-k6u7","type":"parent-child","created_at":"2026-01-22T11:21:44.590491+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-k6u7.9","title":"Implement beadhub /v1/init (identity + workspace)","description":"Implement the beadhub /v1/init endpoint per SOT (aweb-beadhub-integration.md): one call that creates/ensures project + agent + API key (aweb schema) and repo + workspace (beadhub schema).\\n\\nRequirements:\\n- Works without prior auth (bootstraps aw_sk_*)\\n- Enforces init rate limit (Redis)\\n- Supports project_slug inference from existing repo when omitted; otherwise returns a project_not_found-style error\\n- Returns InitResponse compatible with bdh client (api_key, project_id, project_slug, repo_id, canonical_origin, workspace_id, alias, created)\\n- Keeps aweb reference implementation intact for standalone aweb server\\n\\n","acceptance_criteria":"- POST /v1/init works end-to-end with bdh init flow\\n- uv run pytest passes\\n- Added tests for new /v1/init semantics","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-22T12:22:56.038258+01:00","created_by":"Juan Reyero","updated_at":"2026-01-22T12:34:09.627952+01:00","closed_at":"2026-01-22T12:34:09.627952+01:00","close_reason":"Closed","labels":["area:tests","component:auth","component:init"],"dependencies":[{"issue_id":"beadhub-k6u7.9","depends_on_id":"beadhub-k6u7","type":"parent-child","created_at":"2026-01-22T12:22:56.039394+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-k8n2","title":"Include role in /v1/bdh/command rejection context","description":"When claim is rejected, include role of claiming workspace in context.claimed_by and context.beads_in_progress","status":"closed","priority":1,"issue_type":"task","assignee":"frank-agent","created_at":"2025-12-14T09:06:36.515216+01:00","updated_at":"2026-01-03T18:22:37.038593Z","closed_at":"2026-01-03T18:22:37.038593Z","close_reason":"Included workspace role in /v1/bdh/command rejection context (claimed_by) and added regression test.","dependencies":[{"issue_id":"beadhub-k8n2","depends_on_id":"beadhub-089o","type":"blocks","created_at":"2025-12-14T09:06:55.823092+01:00","created_by":"juanre"},{"issue_id":"beadhub-k8n2","depends_on_id":"beadhub-161u","type":"parent-child","created_at":"2025-12-14T09:24:11.238905+01:00","created_by":"juanre","metadata":"{}"}]}
{"id":"beadhub-k8t9","title":"Refactor chat to persistent session model (v2.0)","description":"Replace ephemeral session model with persistent sessions per participant set. See beadhub-chat-spec.md v2.1.\n\nKey changes:\n- Sessions never expire (one per participant set per project)\n- Supports N participants (1-1 and group chats)\n- No waiting/active/ended states\n- Redis for pub/sub only, Postgres is primary\n- Add read receipts for unread tracking\n- Add chat_session_participants table for N-party support\n- Remove pair_key, cleanup_on_initiator_disconnect, TTL logic","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-13T20:25:03.72448+01:00","updated_at":"2025-12-14T16:28:55.387775+01:00","closed_at":"2025-12-14T16:28:55.387775+01:00","dependencies":[{"issue_id":"beadhub-k8t9","depends_on_id":"beadhub-r2dv","type":"blocks","created_at":"2025-12-13T20:27:54.3701+01:00","created_by":"juanre"},{"issue_id":"beadhub-k8t9","depends_on_id":"beadhub-xhok","type":"blocks","created_at":"2025-12-14T08:55:51.416747+01:00","created_by":"juanre"},{"issue_id":"beadhub-k8t9","depends_on_id":"beadhub-qakm","type":"blocks","created_at":"2025-12-14T08:55:52.157095+01:00","created_by":"juanre"},{"issue_id":"beadhub-k8t9","depends_on_id":"beadhub-5t7p","type":"blocks","created_at":"2025-12-14T08:56:51.865467+01:00","created_by":"juanre"},{"issue_id":"beadhub-k8t9","depends_on_id":"beadhub-uqt0","type":"blocks","created_at":"2025-12-14T08:56:52.055477+01:00","created_by":"juanre"},{"issue_id":"beadhub-k8t9","depends_on_id":"beadhub-jkx5","type":"blocks","created_at":"2025-12-14T08:56:52.247976+01:00","created_by":"juanre"},{"issue_id":"beadhub-k8t9","depends_on_id":"beadhub-rl0m","type":"blocks","created_at":"2025-12-14T08:56:52.437435+01:00","created_by":"juanre"}]}
{"id":"beadhub-k8tm","title":"Chat pending field mismatch: API returns from_agent but Go client expects from_alias","description":"In bdh/internal/client/client.go:509, PendingChatRequest uses json tag 'from_alias' but the API /v1/chat/pending returns 'from_agent'. This causes the match at chat.go:176 to fail (p.FromAlias is always empty), so agents create new sessions instead of joining existing ones. Fix: Change json tag to 'from_agent' in client.go.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-13T15:03:23.896261+01:00","updated_at":"2025-12-13T15:08:19.732118+01:00","closed_at":"2025-12-13T15:08:19.732118+01:00"}
{"id":"beadhub-kcc3","title":"Ensure Codex receives beads workflow content","description":"## Problem\n\nCodex doesn't have startup hooks, so it never sees `.beads/PRIME.md`. This means it misses the beads workflow content that `bd prime --export` provides (issue tracking commands, workflow guidance).\n\nClaude Code sees this content via the PRIME.md startup hook.\n\n## Goal\n\nEnsure Codex receives the beads workflow info, with `bd` references replaced with `bdh`.\n\n## Options\n\n### 1. Detect Codex via parent process\nWalk up the process tree looking for \"codex\" in any ancestor name. If detected, include beads prime content in `bdh :policy` output.\n\n```go\nfunc isCalledByCodex() bool {\n    pid := os.Getppid()\n    for pid \u003e 1 {\n        // use ps -o comm= -p \u003cpid\u003e on macOS\n        // if contains \"codex\" return true\n        // get parent pid, continue\n    }\n    return false\n}\n```\n\nPros: No redundancy for Claude Code\nCons: Fragile - depends on Codex process naming; needs testing\n\n### 2. Check environment variables\nCodex might set identifying env vars like `OPENAI_*` or `CODEX_*`.\n\nPros: Clean detection if vars exist\nCons: Unknown if Codex sets any; needs testing\n\n### 3. Always include beads prime in :policy\nJust append `bd prime --export` content (with bdâ†’bdh replacements) to `:policy` output regardless of caller.\n\nPros: Simple, guaranteed to work\nCons: Redundant for Claude Code (already saw it in PRIME.md)\n\n## Recommendation\n\nStart with option 3 (always include) for simplicity. The redundancy is acceptable since :policy is only read once per session.","status":"closed","priority":3,"issue_type":"feature","created_at":"2026-01-10T15:22:40.018641+01:00","created_by":"juanre","updated_at":"2026-01-10T15:32:22.836475+01:00","closed_at":"2026-01-10T15:32:22.836475+01:00","close_reason":"Implemented option 3: beads workflow content is now always appended to :policy output"}
{"id":"beadhub-kcl","title":"Add AGENTS.md example template","description":"Example AGENTS.md that teams can add to their repos with BeadHub coordination instructions for agents.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-02T22:19:57.232421+01:00","updated_at":"2025-12-03T20:08:12.066192+01:00","closed_at":"2025-12-03T20:08:12.066192+01:00"}
{"id":"beadhub-kdpe","title":"UX: Workspaces tabs should show counts (Online (3) | Offline (12))","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-13T21:26:17.15149+01:00","updated_at":"2025-12-13T23:33:15.302866+01:00","closed_at":"2025-12-13T23:33:15.302866+01:00"}
{"id":"beadhub-keb9","title":"messages.py: 3 queries missing deleted_at filter","description":"Lines 116, 133, 144: _get_workspace_project_id and send_message sender/recipient lookups query workspaces without deleted_at IS NULL filter. Deleted workspaces can still send/receive mail.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-21T20:46:59.155583+01:00","updated_at":"2025-12-21T21:42:27.870356+01:00","closed_at":"2025-12-21T21:42:27.870356+01:00","close_reason":"Add deleted_at filters to message workspace lookups"}
{"id":"beadhub-kh2u","title":"Add --leave-conversation flag to bdh :chat","description":"Add --leave-conversation as a semantic alias for --reply --no-wait. This flag indicates intent to send a final message and exit without waiting for a response.\n\nCurrent: bdh :chat bob \"msg\" --reply --no-wait\nNew: bdh :chat bob \"msg\" --leave-conversation\n\nThe three explicit intent flags become:\n- --start-conversation: initiating exchange (5 min wait)\n- --reply: responding to conversation (60s wait)  \n- --leave-conversation: signing off (no wait)\n\nImplementation: bdh/internal/commands/chat.go - add flag, set noWait=true when used.","status":"closed","priority":1,"issue_type":"feature","created_at":"2026-01-09T22:54:19.920966+01:00","created_by":"juanre","updated_at":"2026-01-09T23:04:13.186399+01:00","closed_at":"2026-01-09T23:04:13.186399+01:00","close_reason":"Implemented: --leave-conversation flag added, SSE timeout message now shows 'Waited Xs â€” no reply'"}
{"id":"beadhub-kje7","title":"Add bdh :send command for sending mail","description":"Restore bdh :send command from commit 74ef99e^. The command already existed and was deleted when mail was deprecated. Restore send.go and send_test.go.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-15T17:40:08.862342+01:00","updated_at":"2025-12-15T17:49:55.817047+01:00","closed_at":"2025-12-15T17:49:55.817047+01:00"}
{"id":"beadhub-kjjn","title":"Validate target workspace still exists before sending message","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T20:35:31.288615+01:00","updated_at":"2026-01-03T18:38:44.598857Z","closed_at":"2026-01-03T18:38:44.598857Z","close_reason":"Redundant: server already validates workspace existence and returns 422/403; client surfaces errors on send."}
{"id":"beadhub-kku2","title":"bdh: preserve argv structure in /v1/bdh/command requests (avoid strings.Join)","description":"CRITICAL: bdh must be a transparent wrapper for bd. It strips its own arguments (prefixed with :) but MUST pass the remaining args to bd EXACTLY as received - no reconstruction, no strings.Join, no parsing. The current implementation joins args with spaces which destroys quoting/escaping. Fix: pass os.Args slice directly to bd after removing bdh-specific flags. Do not reconstruct the command line string at all for bd execution. The command_line sent to server for approval is separate - that can be a display string, but bd must receive the original argv.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-13T12:52:10.403658+01:00","updated_at":"2025-12-13T13:10:11.439713+01:00","closed_at":"2025-12-13T13:10:11.439713+01:00","dependencies":[{"issue_id":"beadhub-kku2","depends_on_id":"beadhub-t265","type":"discovered-from","created_at":"2025-12-13T12:52:10.405911+01:00","created_by":"juanre"}]}
{"id":"beadhub-klcf","title":"Fix misleading approve/reject language in bdh help and SOT","description":"The bdh --help says 'Pre-flight check via /v1/bdh/command (approve/reject)' and 'Run bd with all provided arguments (if approved)' which makes it sound like the server gates all bd execution.\n\nActual behavior:\n- Server unreachable/errors: bd runs anyway (with warning)\n- Server returns approved:false for claim conflicts: bd doesn't run, but --:jump-in overrides\n\nThe API protocol (approved: true/false) is fine, but user-facing language should emphasize that bd almost always runs.\n\nFix needed in:\n1. bdh/cmd/bdh/main.go (the help text)\n2. beadhub-sot/source-of-truth/beadhub-bdh-design.md (framing around approve/reject)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-10T22:13:15.40654+01:00","created_by":"juanre","updated_at":"2026-01-10T22:40:35.130249+01:00","closed_at":"2026-01-10T22:40:35.130249+01:00","close_reason":"Fixed help text in bdh. SOT fix needed in beadhub-sot repo separately."}
{"id":"beadhub-knu","title":"Update tests for non-namespaced bead IDs","description":"Update all test assertions that expect namespaced bead_ids (like 'default:bd-root') to expect raw IDs ('bd-root'). Update blocked_by assertions for JSONB format.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T08:15:51.11689+01:00","updated_at":"2025-12-07T08:29:06.45045+01:00","closed_at":"2025-12-07T08:29:06.45045+01:00","dependencies":[{"issue_id":"beadhub-knu","depends_on_id":"beadhub-vmx","type":"parent-child","created_at":"2025-12-07T08:15:51.118028+01:00","created_by":"juanre"}]}
{"id":"beadhub-ko8u","title":"UX: Add refresh button and 'Last updated' indicator","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-13T21:26:25.287907+01:00","updated_at":"2025-12-13T21:26:25.287907+01:00"}
{"id":"beadhub-kpn","title":"CRITICAL: MCP tools accept client-provided project_id - tenant isolation bypass","description":"**Vulnerability**: MCP tools get_ready_issues and get_issue in mcp.py:411-445 accept project_id as client argument. No server-side validation.\n\n**Attack scenario**:\nA malicious MCP client calls get_ready_issues with any project_id and sees other tenants' data.\n\n**Root cause**: Server trusts client-provided project_id instead of deriving it from authenticated context.\n\n**Fix for Cloud**: Derive project_id from API key authentication (X-API-Key â†’ project mapping in auth_bridge).\n**Fix for OSS**: Accept project_id from client (single-tenant, no isolation needed) OR require X-Project-ID header like HTTP endpoints.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-07T22:42:24.321168+01:00","updated_at":"2025-12-08T00:31:24.007446+01:00","closed_at":"2025-12-08T00:31:24.007446+01:00"}
{"id":"beadhub-kpog","title":"Fix test_cli_project_id.py failures from project_id/project_key refactoring","description":"Tests in test_cli_project_id.py need updating after data model changes:\n- project_key â†’ project_slug\n- agent_name â†’ alias\n- Added repo_origin field to .beadhub file\n- workspace_config.py behavior may need review\n\nTests expect get_project_id() to return value from .beadhub file, but behavior may have changed. Needs investigation to determine correct behavior per new data model.\n\nUpdated 2025-12-12: terminology updated per data model changes.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-10T10:31:15.140152+01:00","updated_at":"2026-01-09T21:01:34.23303+01:00","closed_at":"2026-01-09T21:01:34.23303+01:00","close_reason":"Tests verified passing. The test_cli_project_id.py tests correctly use project_id (UUID) field. The project_key/agent_name terminology in MCP routes is intentional - it's the Agent Mail protocol interface, not internal data model.","dependencies":[{"issue_id":"beadhub-kpog","depends_on_id":"beadhub-r0xm","type":"discovered-from","created_at":"2025-12-10T10:31:15.140924+01:00","created_by":"juanre"}]}
{"id":"beadhub-kpr","title":"Missing bead ID format validation in beads_sync.py - could allow malformed IDs","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-03T15:38:53.134321+01:00","updated_at":"2025-12-03T18:04:26.851314+01:00","closed_at":"2025-12-03T18:04:26.851314+01:00"}
{"id":"beadhub-kue1","title":"Migrate test_claims.py to db_infra fixture","description":"Convert from app_with_test_db to async tests using db_infra fixture. Also has 7 async tests with manual try/finally.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-10T10:55:16.776481+01:00","created_by":"juanre","updated_at":"2026-01-10T12:02:54.153093+01:00","closed_at":"2026-01-10T12:02:54.153093+01:00","close_reason":"Converted 13 tests (8 sync + 6 async) to use db_infra fixture - all pass","dependencies":[{"issue_id":"beadhub-kue1","depends_on_id":"beadhub-7wpr","type":"parent-child","created_at":"2026-01-10T10:55:50.14972+01:00","created_by":"juanre"}]}
{"id":"beadhub-kx5r","title":"Handle bdh init when directory name fails validation","description":"If directory name starts with a number (e.g., '123-my-project'), bdh init will fail with cryptic error since project_slug validation requires starting with a letter or number: ^[a-z0-9][a-z0-9-]{0,62}$\n\nShould either:\n1. Sanitize directory name automatically\n2. Provide clear error message with suggestion\n3. Prompt for input when validation fails\n\nUpdated 2025-12-12: terminology changed from project_key to project_slug per data model.","status":"closed","priority":1,"issue_type":"bug","assignee":"eve-agent","created_at":"2025-12-10T10:43:04.462971+01:00","updated_at":"2026-01-03T18:30:04.722095Z","closed_at":"2026-01-03T18:30:04.722095Z","close_reason":"Sanitized invalid directory names into valid project_slug during bdh init; added tests.","dependencies":[{"issue_id":"beadhub-kx5r","depends_on_id":"beadhub-f5il","type":"discovered-from","created_at":"2025-12-10T10:43:04.463832+01:00","created_by":"juanre"}]}
{"id":"beadhub-kxg1","title":"Implement bdh :chat command","description":"Add :chat command to bdh script:\n- bdh :chat \u003cagent\u003e \"message\" - Start/continue chat\n- bdh :chat \u003cagent\u003e --end \"bye\" - End session\n- bdh :chat --pending - Show pending requests\n\nCommand flow:\n1. Check for existing session or create new one\n2. Send message if provided\n3. Open SSE connection (curl --no-buffer)\n4. Block until response or timeout\n5. Display response and exit\n\nPart of epic beadhub-dtcl","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T20:30:12.385844+01:00","updated_at":"2025-12-10T20:35:03.961185+01:00","closed_at":"2025-12-10T20:35:03.961185+01:00","dependencies":[{"issue_id":"beadhub-kxg1","depends_on_id":"beadhub-2w64","type":"blocks","created_at":"2025-12-10T20:30:43.705636+01:00","created_by":"juanre"},{"issue_id":"beadhub-kxg1","depends_on_id":"beadhub-8kfc","type":"blocks","created_at":"2025-12-10T20:30:43.757983+01:00","created_by":"juanre"}]}
{"id":"beadhub-kxnx","title":"Policy editor: Add Role/Invariant UX is confusing","description":"When adding a role/invariant, user fills form fields but may not realize they need to click 'Add Role' button before 'Create Version'. The two-step process (fill â†’ add â†’ save) is confusing. Options: 1) Auto-add when fields filled, 2) Inline editing with immediate visual feedback, 3) Validation warning if form has unsaved content.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-04T10:47:59.868882Z","created_by":"juanre","updated_at":"2026-01-04T11:10:20.492183Z","closed_at":"2026-01-04T11:10:20.492183Z","close_reason":"Fixed in PoliciesPage.tsx"}
{"id":"beadhub-l2if","title":"Fix outdated test_bdh.py tests that test old bdh script behavior","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-11T08:52:52.55059+01:00","updated_at":"2026-01-03T18:38:40.25238Z","closed_at":"2026-01-03T18:38:40.25238Z","close_reason":"Obsolete: legacy test_bdh.py suite no longer exists; current bdh wrapper is covered by tests/test_bdh_command.py and bdh/internal/commands tests.","dependencies":[{"issue_id":"beadhub-l2if","depends_on_id":"beadhub-0ari","type":"discovered-from","created_at":"2025-12-11T08:52:52.551639+01:00","created_by":"juanre"}]}
{"id":"beadhub-lbj","title":"Cache Lua script with script_load/evalsha instead of eval each time","description":"Reduce Redis CPU by caching Lua scripts (SCRIPT LOAD + EVALSHA) instead of sending full script bodies on every call.\n\nCurrent state:\n- Reservations/MCP endpoints define Lua scripts in Python and call eval with the full script each time.\n\nChange:\n- On startup (or first use), SCRIPT LOAD each Lua script and store sha.\n- Use EVALSHA for subsequent calls; fall back to SCRIPT LOAD if NOSCRIPT.\n\nAcceptance:\n- Functional behavior unchanged\n- Handles NOSCRIPT gracefully\n- Add a small unit/integration test that exercises the fallback path (if feasible)","acceptance_criteria":"- Lua scripts are executed via EVALSHA after initial load\n- NOSCRIPT fallback works\n- Behavior unchanged and covered by tests where feasible","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-03T15:39:17.538333+01:00","updated_at":"2026-01-03T16:42:33.040422Z"}
{"id":"beadhub-lcrf","title":"Frontend - Add Claims to API Client","description":"Add Claim interface and listClaims() function. Remove Lock interface and listReservations().","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T17:56:45.734921+01:00","updated_at":"2025-12-12T18:31:11.834554+01:00","closed_at":"2025-12-12T18:31:11.834554+01:00","dependencies":[{"issue_id":"beadhub-lcrf","depends_on_id":"beadhub-wrab","type":"blocks","created_at":"2025-12-12T17:57:22.16941+01:00","created_by":"juanre"}]}
{"id":"beadhub-ld8z","title":"Chat: sender of '.' termination hangs waiting for reply","description":"When an agent sends '.' to end a chat, they still wait for an SSE response that never comes if the other party isn't listening. The sender should exit immediately after sending '.' without waiting for a reply.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T13:53:18.490871+01:00","updated_at":"2025-12-13T13:56:18.384978+01:00","closed_at":"2025-12-13T13:56:18.384978+01:00"}
{"id":"beadhub-lefg","title":"Migrate test_projects.py to db_infra fixture","description":"Convert from app_with_test_db to async tests using db_infra fixture.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-10T10:55:07.11032+01:00","created_by":"juanre","updated_at":"2026-01-10T12:06:46.05458+01:00","closed_at":"2026-01-10T12:06:46.05458+01:00","close_reason":"Migrated test_projects.py to async pattern. All 28 tests pass.","dependencies":[{"issue_id":"beadhub-lefg","depends_on_id":"beadhub-7wpr","type":"parent-child","created_at":"2026-01-10T10:55:49.511157+01:00","created_by":"juanre"}]}
{"id":"beadhub-lh20","title":"Consolidate duplicate DashboardIdentity interface (useStore vs api)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T20:35:05.662742+01:00","updated_at":"2025-12-13T23:45:59.803648+01:00","closed_at":"2025-12-13T23:45:59.803648+01:00"}
{"id":"beadhub-lhx4","title":"Update Go bdh config.go: AgentName to Alias, add RepoOrigin","description":"Update bdh/internal/config/config.go for new data model.\n\nConfig struct changes:\n- AgentName string -\u003e Alias string  \n- Add RepoOrigin string field\n- YAML tag: agent_name â†’ alias, add repo_origin\n\nValidation changes:\n- Update pattern check for alias field\n- Add pattern check for repo_origin (URL format)\n\nLoad() changes:\n- Read alias field from .beadhub file (no backwards compatibility)\n\nSave() changes:\n- Write alias instead of agent_name\n- Write repo_origin field\n\nThis is the foundation for all other Go CLI changes.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T12:51:38.7507+01:00","updated_at":"2025-12-12T18:22:49.59966+01:00","closed_at":"2025-12-12T18:22:49.59966+01:00"}
{"id":"beadhub-ljw6","title":"SSE connection resource leak - stale handlers and zombie connections","description":"Location: frontend/src/hooks/useSSE.ts:87 and src/beadhub/events.py:157-225. Frontend dependency array excludes eventTypes/onEvent/onError - stale handlers accumulate. Backend doesn't handle disconnects before CancelledError. Causes memory leaks, zombie connections, and server resource exhaustion. Fix: include all deps or use refs for handlers; add request.is_disconnected() checks.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-08T18:24:13.487936+01:00","updated_at":"2025-12-21T12:27:20.478985+01:00","closed_at":"2025-12-21T12:27:20.478985+01:00","close_reason":"Fixed SSE resource leaks with disconnect detection. Backend: Added check_disconnected callback to stream_events_multi and stream_chat_events, passed request.is_disconnected from routes. Frontend: Used refs for callbacks to prevent stale handlers, added reconnectTimeoutRef for proper cleanup, fixed dependency arrays. Added 3 tests. All 93 SSE/chat tests passing.","dependencies":[{"issue_id":"beadhub-ljw6","depends_on_id":"beadhub-tyf3","type":"blocks","created_at":"2025-12-21T09:49:28.517549+01:00","created_by":"juanre"}]}
{"id":"beadhub-lmhz","title":"Fix array index key in ActiveChatPanel messages","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T14:55:37.259486+01:00","updated_at":"2025-12-13T17:22:10.367465+01:00","closed_at":"2025-12-13T17:22:10.367465+01:00"}
{"id":"beadhub-lmr5","title":"Update messages/inbox view to use pagination","description":"Update frontend inbox/messages views:\n\n- Use new pagination component\n- Fetch first page on mount\n- Load more pages on user request\n- Handle cursor state in component\n- Show loading state during fetches","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T10:31:09.451476+01:00","updated_at":"2025-12-22T13:15:38.651335+01:00","closed_at":"2025-12-22T13:15:38.651335+01:00","close_reason":"Implemented per-workspace pagination for MessagesPage","dependencies":[{"issue_id":"beadhub-lmr5","depends_on_id":"beadhub-v9wr","type":"blocks","created_at":"2025-12-22T10:32:22.473231+01:00","created_by":"juanre"},{"issue_id":"beadhub-lmr5","depends_on_id":"beadhub-4exs","type":"blocks","created_at":"2025-12-22T10:38:07.808835+01:00","created_by":"juanre"},{"issue_id":"beadhub-lmr5","depends_on_id":"beadhub-c6zq","type":"blocks","created_at":"2025-12-22T10:38:07.975291+01:00","created_by":"juanre"}]}
{"id":"beadhub-lmtj","title":"Workspace lifecycle: detect and mark deleted workspaces","description":"When a worktree or directory with .beadhub is deleted, the workspace should be marked as gone. Includes: soft-delete DB column, DELETE endpoint, auto-deregister on every bdh command (checks git worktree list), dashboard delete button, filtering deleted from API responses.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-16T20:41:11.523013+01:00","updated_at":"2025-12-17T07:36:32.82263+01:00","closed_at":"2025-12-17T07:36:32.82263+01:00"}
{"id":"beadhub-lohq","title":"Migrate test_sse_streaming.py to db_infra fixture","description":"Convert from app_with_test_db to async tests using db_infra fixture.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-10T10:54:58.002802+01:00","created_by":"juanre","updated_at":"2026-01-10T12:41:26.022631+01:00","closed_at":"2026-01-10T12:41:26.022631+01:00","close_reason":"Migrated test_sse_streaming.py to async fixtures. 33 tests pass. Validation tests now use db_infra + redis_client_async with LifespanManager + AsyncClient pattern.","dependencies":[{"issue_id":"beadhub-lohq","depends_on_id":"beadhub-7wpr","type":"parent-child","created_at":"2026-01-10T10:55:49.053236+01:00","created_by":"juanre"}]}
{"id":"beadhub-loy0","title":"Add GET /sessions endpoint for workspace session list","description":"List sessions for a workspace","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T14:22:19.199954+01:00","updated_at":"2025-12-13T14:45:14.680399+01:00","closed_at":"2025-12-13T14:45:14.680399+01:00","dependencies":[{"issue_id":"beadhub-loy0","depends_on_id":"beadhub-n80a","type":"blocks","created_at":"2025-12-13T14:22:19.20105+01:00","created_by":"juanre"}]}
{"id":"beadhub-lrn","title":"Add input validation for repo_name (max length, allowed characters)","description":"BeadsUploadRequest.repo field only validates min_length=1. Missing:\n- Maximum length (DoS via extremely long names)\n- Character pattern validation (potential injection)\n\n**Fix**: Add Field(..., min_length=1, max_length=255, pattern='^[a-zA-Z0-9_.-]+$') similar to BRANCH_NAME_PATTERN in beads_sync.py.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T22:42:24.662868+01:00","updated_at":"2025-12-08T09:02:53.316911+01:00","closed_at":"2025-12-08T09:02:53.316911+01:00"}
{"id":"beadhub-ltta","title":"Validate workspace ownership for escalation event publishing","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T12:31:53.509939+01:00","updated_at":"2025-12-08T14:59:02.209349+01:00","closed_at":"2025-12-08T14:59:02.209349+01:00","dependencies":[{"issue_id":"beadhub-ltta","depends_on_id":"beadhub-w4p","type":"discovered-from","created_at":"2025-12-08T12:31:53.510825+01:00","created_by":"juanre"}]}
{"id":"beadhub-lviu","title":"Demote chat notifications: WAITING only after commands","description":"Currently every bdh command shows both WAITING and MESSAGES notifications. Change to:\n\n- WAITING notifications: Show after commands (someone is blocked waiting)\n- MESSAGES (non-waiting chat): Don't show after every command\n- Mail inbox count: Show only at checkpoints (bdh ready, bdh :inbox)\n\nThis reduces interruption. Agents see mail at natural transition points, not constantly.\n\nChanges needed:\n- passthrough.go: Only show WAITING in formatPassthroughOutput\n- context.go: Modify ShowServerContext to accept filter options\n- ready.go (new or existing): Show full context including mail","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-15T18:23:22.750981+01:00","updated_at":"2025-12-15T18:39:49.482231+01:00","closed_at":"2025-12-15T18:39:49.482231+01:00","dependencies":[{"issue_id":"beadhub-lviu","depends_on_id":"beadhub-fei6","type":"blocks","created_at":"2025-12-15T18:23:29.039242+01:00","created_by":"juanre"}]}
{"id":"beadhub-lykw","title":"Project and Repo Management","description":"# Overview\n\nBeadHub currently lacks proper project and repo management capabilities. Projects and repos can only be created implicitly via `bdh init`, and there's no way to:\n- List projects\n- Delete projects\n- List repos in a project\n- Remove a repo from a project\n- See the project/repo/workspace hierarchy\n\nThis causes problems like the beadhub-cloud incident: running `bdh init` without `--project` created a new project instead of adding the repo to the existing beadhub project.\n\n# Design Decisions\n\n## 1. Soft-delete for repos and workspaces\n\nWhen a repo is deleted:\n- Set `deleted_at` timestamp on repo (new column needed)\n- Cascade soft-delete all workspaces in that repo\n- Release all bead claims for those workspaces\n- Clear Redis presence for those workspaces\n\nRationale: Preserves history, allows recovery, maintains audit trail.\n\n## 2. No moving repos between projects\n\nThe immutability principle from data-model.md applies:\n- workspace â†’ project: Immutable\n- workspace â†’ repo: Immutable  \n- repo â†’ project: Also immutable\n\nTo \"move\" a repo: delete from wrong project, re-register via `bdh init --project \u003ccorrect\u003e`.\n\n## 3. Better bdh init UX\n\nWhen repo not found, show existing projects before prompting for new:\n```\n$ bdh init\nLooking up repo github.com/org/repo...\nRepo not found.\n\nExisting projects:\n  [1] beadhub\n  [2] other-project\n  [n] Create new project\n\nSelect [1]: \n```\n\nPrevents accidental new project creation.\n\n## 4. Project deletion cascades\n\nDELETE project â†’ CASCADE delete repos â†’ soft-delete workspaces â†’ release claims\n\n# API Changes\n\n## OSS Endpoints (new)\n\n### Projects\n- `GET /v1/projects` - List all projects\n- `GET /v1/projects/{id}` - Get project details with repo count\n- `DELETE /v1/projects/{id}` - Delete project (cascades)\n\n### Repos  \n- `GET /v1/repos?project_id=...` - List repos in project\n- `GET /v1/repos/{id}` - Get repo details with workspace count\n- `DELETE /v1/repos/{id}` - Soft-delete repo (cascades to workspaces)\n\n## Cloud Endpoints (new)\n\n### Project Repos\n- `GET /api/v1/projects/{id}/repos` - List repos in project\n- `DELETE /api/v1/projects/{id}/repos/{repo_id}` - Remove repo\n\n# Database Changes\n\n## OSS Migrations\n\n### repos table\nAdd soft-delete support:\n```sql\nALTER TABLE repos ADD COLUMN deleted_at TIMESTAMPTZ;\nCREATE INDEX idx_repos_deleted ON repos(deleted_at) WHERE deleted_at IS NULL;\n```\n\n### workspaces table  \nAlready has deleted_at from previous work.\n\n### Cascade logic\n- repos FK to projects: ON DELETE CASCADE (hard delete repos when project deleted)\n- workspaces FK to repos: Need trigger or app logic for soft-delete cascade\n\n## Query changes\nAll repo queries need `WHERE deleted_at IS NULL` filter.\n\n# CLI Changes\n\n## bdh init improvements\n1. When repo not found, list existing projects\n2. Allow selection by number or slug\n3. Only create new project if explicitly chosen\n\n## New commands (optional, lower priority)\n- `bdh :projects` - List projects\n- `bdh :repos` - List repos in current project\n\n# Dashboard Changes\n\n## Minimal (Phase 1)\n- Add project/repo info to WorkspacesPage header\n- Show project slug and repo count\n\n## Full (Phase 2 - needs more design)\n- ProjectsPage with project list\n- Drill-down to see repos per project\n- Drill-down to see workspaces per repo\n- Delete actions with confirmation\n\n# What happens to users on deletion\n\n## When repo is deleted\n1. Workspace soft-deleted, Redis presence cleared\n2. Next `bdh` command gets error: \"Workspace deleted. Re-run `bdh init`\"\n3. User runs `bdh init --project \u003cproject\u003e` to re-register\n\n## When project is deleted\n1. All repos hard-deleted (CASCADE)\n2. All workspaces soft-deleted\n3. All .beadhub files become invalid\n4. Users must re-register with new project\n\n# Testing the solution\n\nUse the beadhub-cloud mistake as test case:\n1. Implement delete endpoints\n2. Delete the beadhub-cloud project\n3. Re-run `bdh init --project beadhub` in beadhub-cloud repo\n4. Verify repo now in correct project\n\n# Open questions\n\n1. Dashboard UX - how to present project/repo hierarchy?\n2. Should bdh init --project also allow project creation? (Currently requires prompt)\n3. Permissions - who can delete repos/projects in Cloud? (Owner only? Admins?)","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-21T15:24:22.393612+01:00","updated_at":"2025-12-21T17:57:41.651279+01:00","closed_at":"2025-12-21T17:57:41.651279+01:00","close_reason":"Duplicate of beadhub-1thq"}
{"id":"beadhub-lzq","title":"Add complexity limits to JSONL upload endpoint","description":"beads/upload-jsonl accepts 10MB but no limits on JSON nesting depth or issue count. Add MAX_ISSUES_COUNT and depth-limited JSON decoder.","acceptance_criteria":"- Reject JSONL uploads with too many issues (MAX_ISSUES_COUNT)\n- Reject/limit excessive JSON nesting depth (depth-limited decoder)\n- Return clear 4xx error messages\n- Add tests for too-many-issues and too-deep JSON\n- Limits documented in docs/api-reference.md","notes":"Assigned for implementation. Please add MAX_ISSUES_COUNT + depth-limited JSON parse, tests, and docs. Follow beadhub-sot security-patterns.md; keep errors clear 4xx.","status":"closed","priority":3,"issue_type":"task","assignee":"dave-agent","created_at":"2025-12-07T22:17:23.939244+01:00","updated_at":"2026-01-03T19:28:52.654002Z","closed_at":"2026-01-03T19:28:52.654002Z","close_reason":"Added JSONL upload complexity limits (MAX_ISSUES_COUNT, MAX_JSON_DEPTH) with clear 4xx errors, tests, and docs."}
{"id":"beadhub-m03","title":"Add library mode: create_app() with external DB/Redis params","description":"Enable beadhub to be mounted as a sub-app in beadhub-cloud by supporting create_app(db_manager, redis_client, schema, settings) parameters. This allows the SaaS layer to provide shared database pool and Redis connections.\n\nWHEN COMPLETE: Create issue in beadhub-cloud to mount the OSS routes.","status":"closed","priority":0,"issue_type":"feature","created_at":"2025-12-03T08:46:00.26767+01:00","updated_at":"2025-12-03T09:38:47.208145+01:00","closed_at":"2025-12-03T09:38:47.208145+01:00","close_reason":"Implemented library mode: create_app(db_infra, redis) for external connections"}
{"id":"beadhub-m32y","title":"Migrate test_escalation_validation.py to db_infra fixture","description":"Convert from app_with_test_db to async tests using db_infra fixture.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-10T10:55:09.097805+01:00","created_by":"juanre","updated_at":"2026-01-10T12:45:03.721193+01:00","closed_at":"2026-01-10T12:45:03.721193+01:00","close_reason":"Migrated test_escalation_validation.py to async fixtures. 14 tests pass.","dependencies":[{"issue_id":"beadhub-m32y","depends_on_id":"beadhub-7wpr","type":"parent-child","created_at":"2026-01-10T10:55:50.058305+01:00","created_by":"juanre"}]}
{"id":"beadhub-m44h","title":"Rename bdh version command to :version for consistency","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-11T18:34:03.98482+01:00","updated_at":"2025-12-11T18:34:03.98482+01:00"}
{"id":"beadhub-m4kb","title":"bdh repo mismatch check can be bypassed","description":"SECURITY: validateRepoOriginMatchesCurrent() in bdh/internal/commands/heartbeat.go:16-41 silently returns nil on ANY error, bypassing the safety check entirely.\n\nPer data-model.md: workspaceâ†’repo is IMMUTABLE. The check prevents operating in wrong repo context which could lead to cross-tenant data leaks.\n\nCurrent behavior:\n```go\nif err != nil {\n    // Best-effort: don't block commands in environments without git\n    return nil  // BYPASSED\n}\n```\n\nAn attacker could manipulate environment to trigger this path (corrupt git, remove git binary), bypassing the check.\n\nFix:\n1. Only ignore specific errors: 'git not found', 'not a git repo'\n2. Log warning and fail closed for unexpected errors\n3. Add BEADHUB_SKIP_REPO_CHECK env var for legitimate non-git testing","notes":"Track under beadhub-oy60 epic","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-06T09:20:22.180396Z","created_by":"juanre","updated_at":"2026-01-06T10:04:13.610858Z","closed_at":"2026-01-06T10:04:13.610858Z","close_reason":"Fixed - now fails closed on unexpected errors, only skips for git-not-found/not-a-repo, added BEADHUB_SKIP_REPO_CHECK env var","dependencies":[{"issue_id":"beadhub-m4kb","depends_on_id":"beadhub-oy60","type":"parent-child","created_at":"2026-01-06T10:02:34.557667Z","created_by":"juanre"}]}
{"id":"beadhub-m7kb","title":"Dashboard returns 404 Not Found at root URL","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-08T15:42:56.962936+01:00","updated_at":"2025-12-08T15:46:06.579489+01:00","closed_at":"2025-12-08T15:46:06.579489+01:00"}
{"id":"beadhub-md6p","title":"Include deletion timestamp in 'already deleted' error messages","description":"When workspace is already deleted, error says 'Workspace X is already deleted'. More helpful: 'Workspace X was deleted at 2025-12-17T10:30:00Z'. Minor UX improvement.","status":"open","priority":4,"issue_type":"chore","created_at":"2025-12-17T08:02:07.198271+01:00","updated_at":"2025-12-17T08:02:07.198271+01:00","dependencies":[{"issue_id":"beadhub-md6p","depends_on_id":"beadhub-lmtj","type":"discovered-from","created_at":"2025-12-17T08:02:07.199213+01:00","created_by":"juanre"}]}
{"id":"beadhub-meur","title":"Review escalation authorization model and add workspace isolation","description":"## Decision (aligned with security patterns)\n\nTrust boundary is the **project** (`X-Project-ID`) when auth is enabled.\n\nWe support two access modes:\n\n### 1) Agent mode (no API key)\nUsed by agents to poll *only their own* escalations.\n\n- `GET /v1/escalations`:\n  - Requires `X-Project-ID` when auth enabled.\n  - Requires `workspace_id` filter when auth enabled.\n  - Rejects `project_slug` when auth enabled.\n- `GET /v1/escalations/{escalation_id}`:\n  - Requires `X-Project-ID` when auth enabled.\n  - Requires `workspace_id` query param when auth enabled.\n  - Returns 404 if the escalation is not for that workspace/project.\n\n### 2) Human oversight mode (API key)\nUsed by a human/coordinator to view and respond.\n\n- `GET /v1/escalations`:\n  - With valid `X-API-Key` (when auth enabled), can list escalations scoped to the project (optionally filtered by repo/workspace/status/alias).\n- `GET /v1/escalations/{escalation_id}`:\n  - With valid `X-API-Key` (when auth enabled), can view escalation details in the project without needing `workspace_id`.\n- `POST /v1/escalations/{escalation_id}/respond`:\n  - Requires valid `X-API-Key` when auth enabled.\n  - Requires `X-Project-ID` (tenant scoping) when auth enabled.\n\n## Notes\n- This does **not** attempt cryptographic â€œworkspace authâ€ (we donâ€™t currently have a per-workspace credential/header). The enforced security boundary is project isolation + API-key-gated human actions.\n- If we later want true per-workspace authorization, we should introduce a cloud-middleware-provided identity header (e.g., `X-Workspace-ID`) or a signed workspace token.\n","acceptance_criteria":"- Auth enabled: `GET /v1/escalations` without `X-API-Key` requires `workspace_id`\n- Auth enabled: `GET /v1/escalations/{id}` without `X-API-Key` requires `workspace_id` and returns 404 on mismatch\n- Auth enabled: `POST /v1/escalations/{id}/respond` requires `X-API-Key` (401 if missing/invalid)\n- Cross-project access remains blocked (tenant isolation via `X-Project-ID`)\n- Tests updated/added to cover the above","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T14:57:58.712077+01:00","updated_at":"2026-01-03T19:45:03.674855Z","closed_at":"2026-01-03T19:45:03.674855Z","close_reason":"Defined escalation access model: workspace-scoped reads without API key, admin-only respond in auth mode; updated code + tests.","dependencies":[{"issue_id":"beadhub-meur","depends_on_id":"beadhub-ltta","type":"discovered-from","created_at":"2025-12-08T14:57:58.713385+01:00","created_by":"juanre"}]}
{"id":"beadhub-mg5j","title":"Deprecate --no-wait flag in bdh :chat","description":"With --leave-conversation added as semantic intent flag, --no-wait becomes redundant. Options:\n\n1. Remove entirely (breaking change)\n2. Keep as hidden alias (no help text, still works)\n3. Show deprecation warning when used\n\nRecommend option 2: keep working silently but remove from --help. Agents using old syntax won't break, but new usage learns the semantic flags.\n\nDepends on: --leave-conversation implementation","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T22:54:20.732076+01:00","created_by":"juanre","updated_at":"2026-01-09T23:04:17.67455+01:00","closed_at":"2026-01-09T23:04:17.67455+01:00","close_reason":"Implemented: --no-wait hidden from help (still works as alias for backward compat)","dependencies":[{"issue_id":"beadhub-mg5j","depends_on_id":"beadhub-kh2u","type":"blocks","created_at":"2026-01-09T22:54:25.831506+01:00","created_by":"juanre"}]}
{"id":"beadhub-mg89","title":"Implement :mail command with mode flags","description":"Create a new mail.go command that unifies mail operations under one namespace with mode flags, mirroring the :chat command design.\n\n**Mode flags (mutually exclusive):**\n- `--send` - Send a message to a target\n- `--inbox` - List messages (unread by default)\n- `--open` - Read messages from a specific sender and auto-acknowledge\n- `--ack` - Explicitly acknowledge a message by ID\n- `--history` - Show all messages from a specific sender\n\n**Modifier flags:**\n- `--all` - Include read messages (used with --inbox)\n- `--subject \"...\"` - Set subject (used with --send)\n- `--json` - Output as JSON\n\n**Usage examples:**\n```bash\nbdh :mail --send bob \"Need help with the API\"\nbdh :mail --send bob \"Status update\" --subject \"Daily standup\"\nbdh :mail --inbox\nbdh :mail --inbox --all\nbdh :mail --open bob          # reads and auto-acks\nbdh :mail --ack msg_abc123\nbdh :mail --history bob\nbdh :mail --inbox --json\n```\n\n**Implementation notes:**\n- Follow chat.go's pattern for mode validation (exactly one mode required)\n- Reuse existing client methods (Send, Inbox, Ack)\n- --open is new functionality: filter inbox by sender + auto-ack all from that sender\n- --history is new functionality: show all messages (read + unread) from a sender\n- Support fuzzy alias matching like :send does today\n- Include comprehensive tests in mail_test.go","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T14:01:33.54702+01:00","created_by":"juanre","updated_at":"2026-01-10T14:15:13.812837+01:00","closed_at":"2026-01-10T14:15:13.812837+01:00","close_reason":"Implemented :mail command with mode flags matching chat.go pattern. All tests pass.","dependencies":[{"issue_id":"beadhub-mg89","depends_on_id":"beadhub-waak","type":"parent-child","created_at":"2026-01-10T14:04:38.342712+01:00","created_by":"juanre"}]}
{"id":"beadhub-mgv","title":"Add locks list CLI command","description":"beadhub locks list to show all active file reservations. Supports --project-key filter.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-02T22:19:56.401237+01:00","updated_at":"2025-12-02T22:24:30.705045+01:00","closed_at":"2025-12-02T22:24:30.705045+01:00","close_reason":"Added beadhub locks list command with --agent filter"}
{"id":"beadhub-mifg","title":"TECH DEBT: Remove deprecated API fields (changed_count, deleted_count)","description":"## Problem\n\nDeprecated API fields are still being serialized in responses, creating maintenance burden and confusion.\n\n### Current Behavior\n\n**Go client - bdh/internal/client/client.go:140-143:**\n```go\n// Deprecated: use Stats.Inserted + Stats.Updated\nChangedCount int `json:\"changed_count,omitempty\"`\n// Deprecated: use Stats.Deleted\nDeletedCount int `json:\"deleted_count,omitempty\"`\n```\n\n**Python backend - src/beadhub/routes/bdh.py:575-577, 1587:**\n```python\n# Deprecated: use stats.inserted + stats.updated\n\"changed_count\": ...\n# Deprecated: use stats.deleted\n\"deleted_count\": ...\n```\n\n### Impact\n\n- API response bloat\n- Confusion for new developers\n- Both old and new fields must be maintained\n- No clear deprecation timeline\n\n### Solution\n\n1. **Audit usage**: Check if any clients depend on these fields\n2. **Set deprecation timeline**: Announce removal date\n3. **Remove from code**:\n   - Remove from Go client struct\n   - Remove from Python response building\n4. **Update API documentation**\n\n### Migration for Clients\n\nClients should migrate from:\n```json\n{\n  \"changed_count\": 5,\n  \"deleted_count\": 2\n}\n```\n\nTo:\n```json\n{\n  \"stats\": {\n    \"inserted\": 3,\n    \"updated\": 2,\n    \"deleted\": 2,\n    \"unchanged\": 10\n  }\n}\n```\n\n### Files to Update\n\n- `bdh/internal/client/client.go`\n- `src/beadhub/routes/bdh.py`\n- API documentation\n\n### Acceptance Criteria\n\n- [ ] Deprecated fields removed from responses\n- [ ] Go client struct updated\n- [ ] No tests depend on deprecated fields\n- [ ] API docs updated to remove deprecated fields","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-08T12:43:00.123858+01:00","created_by":"juanre","updated_at":"2026-01-08T12:43:00.123858+01:00"}
{"id":"beadhub-mmox","title":"notifications: Migrate passthrough to use main.go notifications","description":"## Goal\n\nRemove all notification handling from passthrough.go. Let main.go handle it uniformly.\n\n## Changes\n\n1. **Remove from PassthroughResult:**\n   - MessagesWaiting field\n   - PendingConversations field  \n   - InboxMessages field\n   - RecipientAlias field (used for notification formatting)\n\n2. **Remove from runPassthrough:**\n   - GetPendingChats call (lines ~299-307)\n   - Inbox fetch for ready command (lines ~323-331)\n   - MessagesWaiting extraction from Command API response\n\n3. **Remove formatPassthroughNotifications function entirely**\n\n4. **Remove from formatPassthroughOutput:**\n   - Call to formatPassthroughNotifications\n\n5. **Update tests** that check for notifications in passthrough output\n\n## Result\n\n- Passthrough commands output their content only\n- main.go prints notifications uniformly at the end\n- Clearer separation of concerns","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T10:02:39.74261+01:00","created_by":"juanre","updated_at":"2026-01-10T10:40:44.789244+01:00","closed_at":"2026-01-10T10:40:44.789244+01:00","close_reason":"Removed notification handling from passthrough. Now main.go's PrintNotifications handles all notifications.","dependencies":[{"issue_id":"beadhub-mmox","depends_on_id":"beadhub-bt5h","type":"blocks","created_at":"2026-01-10T10:02:51.500509+01:00","created_by":"juanre"},{"issue_id":"beadhub-mmox","depends_on_id":"beadhub-1wqx","type":"parent-child","created_at":"2026-01-10T10:07:44.093958+01:00","created_by":"juanre"}]}
{"id":"beadhub-mo0q","title":"Add rate limiting across cleanup runs","description":"Cleanup has maxDeletionsPerRun=5 but no rate limiting across runs. Multiple concurrent bdh processes could each delete 5 workspaces. Consider: (1) Per-workspace cleanup state in Redis with TTL, (2) Distributed locking, (3) Backoff on failures.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T08:01:50.737086+01:00","updated_at":"2025-12-17T18:57:57.241513+01:00","closed_at":"2025-12-17T18:57:57.241513+01:00","close_reason":"Won't fix: auto-cleanup feature removed - worktree-based detection doesn't work across machines","dependencies":[{"issue_id":"beadhub-mo0q","depends_on_id":"beadhub-lmtj","type":"discovered-from","created_at":"2025-12-17T08:01:50.737968+01:00","created_by":"juanre"}]}
{"id":"beadhub-moho","title":"Fix React duplicate key warning in StatusPage agent list","description":"StatusPage.tsx uses agent.name as the React key in AgentRow, but agent names aren't unique (e.g., multiple 'backend-bot' entries from different workspaces/runs). This causes 'Encountered two children with the same key' console errors. Fix by using a unique identifier like workspace_id + agent_name or array index.","status":"closed","priority":3,"issue_type":"bug","created_at":"2025-12-08T18:15:19.64221+01:00","updated_at":"2025-12-13T15:28:27.707634+01:00","closed_at":"2025-12-13T14:15:30.283309+01:00"}
{"id":"beadhub-mp5o","title":"Migrate test_auth_helpers.py to db_infra fixture","description":"Convert from app_with_test_db to async tests using db_infra fixture.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-10T10:54:47.693597+01:00","created_by":"juanre","updated_at":"2026-01-10T11:14:22.836166+01:00","closed_at":"2026-01-10T11:14:22.836166+01:00","close_reason":"Migrated 6 tests to use db_infra fixture. Removed all app_with_test_db usage.","dependencies":[{"issue_id":"beadhub-mp5o","depends_on_id":"beadhub-7wpr","type":"parent-child","created_at":"2026-01-10T10:55:48.372863+01:00","created_by":"juanre"}]}
{"id":"beadhub-mtab","title":"bdh init should validate alias uniqueness and register workspace","description":"When multiple workspaces are initialized with bdh init in the same project, they all get the same default alias (claude-code). This breaks agent coordination since aliases must be unique per project. The fix: bdh init should call a new /v1/workspaces/register endpoint that validates alias uniqueness before writing .beadhub file.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-13T09:53:51.126688+01:00","updated_at":"2025-12-13T10:25:05.444499+01:00","closed_at":"2025-12-13T10:25:05.444499+01:00"}
{"id":"beadhub-mwui","title":"Dashboard Alignment with Bead Claiming Model","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-12T17:56:26.39519+01:00","updated_at":"2025-12-12T18:32:07.094021+01:00","closed_at":"2025-12-12T18:32:07.094021+01:00"}
{"id":"beadhub-mzbv","title":"Refactor overly long functions in workspaces.py","description":"## Problem\n\nSeveral functions in `workspaces.py` exceed 100-300 lines with complex nested logic, making them hard to understand, test, and maintain.\n\n### Current State\n\n- `list_workspaces()` (lines 817-1091) - **274 lines**\n- `list_team_workspaces()` (lines 1094-1438) - **344 lines**\n- `suggest_name_prefix()` (lines 139-256) - **117 lines**\n\nThese functions do too much: query building, data fetching, presence enrichment, claim enrichment, sorting, formatting.\n\n### Impact\n\n- Hard to understand full logic flow\n- Difficult to unit test individual parts\n- Changes have high risk of unintended side effects\n- Code review is challenging\n\n### Solution\n\nBreak into smaller, focused functions:\n\n```python\n# Instead of one massive list_workspaces (274 lines):\n\nasync def _build_workspace_query(\n    filters: WorkspaceFilters,\n    cursor_data: Optional[CursorData],\n) -\u003e tuple[str, list]:\n    \"\"\"Build SQL query for workspace listing.\"\"\"\n    ...\n\nasync def _fetch_workspaces(\n    db: DatabaseManager,\n    query: str,\n    params: list,\n) -\u003e list[dict]:\n    \"\"\"Execute workspace query.\"\"\"\n    ...\n\nasync def _enrich_with_presence(\n    workspaces: list[dict],\n    redis: Redis,\n) -\u003e list[dict]:\n    \"\"\"Add presence data to workspace records.\"\"\"\n    ...\n\nasync def _enrich_with_claims(\n    workspaces: list[dict],\n    db: DatabaseManager,\n) -\u003e list[dict]:\n    \"\"\"Add active claim data to workspace records.\"\"\"\n    ...\n\nasync def _apply_pagination(\n    workspaces: list[dict],\n    limit: int,\n    cursor_data: Optional[CursorData],\n) -\u003e PaginatedResponse:\n    \"\"\"Apply cursor-based pagination.\"\"\"\n    ...\n\nasync def list_workspaces(...) -\u003e PaginatedResponse:\n    \"\"\"List workspaces with optional filtering.\n    \n    Orchestrates query building, fetching, enrichment, and pagination.\n    \"\"\"\n    query, params = await _build_workspace_query(filters, cursor_data)\n    workspaces = await _fetch_workspaces(db, query, params)\n    workspaces = await _enrich_with_presence(workspaces, redis)\n    workspaces = await _enrich_with_claims(workspaces, db)\n    return _apply_pagination(workspaces, limit, cursor_data)\n```\n\n### Files to Update\n\n- `src/beadhub/routes/workspaces.py`\n\n### Acceptance Criteria\n\n- [ ] No function exceeds ~50-75 lines\n- [ ] Each helper function has single responsibility\n- [ ] Helper functions are unit-testable\n- [ ] Main functions are thin orchestrators\n- [ ] All existing tests pass\n- [ ] Consider adding unit tests for new helpers","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-08T12:40:18.137557+01:00","created_by":"juanre","updated_at":"2026-01-08T12:40:18.137557+01:00"}
{"id":"beadhub-mzy","title":"SOT spec vs implementation mismatch: blocked_by format","description":"SOT spec (beadhub-specifications.md line 551-560) shows blocked_by as simple array: {\"blocked_by\": [\"bd-001\"]}. Implementation (beads_sync.py line 177) expects structured dependencies: {\"dependencies\": [{\"type\": \"blocks\", \"depends_on_id\": \"bd-001\"}]}. Need to decide: update spec to match implementation (richer format supports cross-repo refs), or update implementation to accept both formats.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-07T09:56:03.075164+01:00","updated_at":"2025-12-07T10:03:32.932435+01:00","closed_at":"2025-12-07T10:03:32.932435+01:00"}
{"id":"beadhub-n0ut","title":"Client: Add --start-conversation flag with 5 min wait","description":"Add --start-conversation flag to bdh :chat command.\n\nBehavior:\n- Wait up to 5 minutes (300s) for reply\n- Ignore targets_left (wait even if all targets have left)\n- Display: \"Starting conversation, waiting for reply... (5 min)\"\n\nUse case: Agent initiating a new exchange, willing to wait for target to notice notification.\n\nParent: beadhub-bwpi\nDepends on: beadhub-62gm (server must return targets_left first)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-16T21:32:22.742391+01:00","updated_at":"2025-12-17T18:57:15.557675+01:00","closed_at":"2025-12-17T18:57:15.557675+01:00","close_reason":"Already implemented - tests exist in chat_test.go","dependencies":[{"issue_id":"beadhub-n0ut","depends_on_id":"beadhub-62gm","type":"blocks","created_at":"2025-12-16T21:32:55.819396+01:00","created_by":"juanre"}]}
{"id":"beadhub-n2n","title":"Multi-repo coordination: central BeadHub serving multiple repos","description":"Enable BeadHub to coordinate agents across multiple repositories in an organization.\n\nCore capabilities:\n- Repos register with central BeadHub\n- Unified bead namespace: repo:bead-id\n- Cross-repo dependencies: blocked_by: [\"other-repo:bead-id\"]\n- Cross-repo messaging: send to repo:agent or repo:*\n- Subscriptions: notify me when bead X closes\n\nThis unlocks true multi-agent coordination for organizations with multiple codebases.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-03T09:14:50.74176+01:00","updated_at":"2025-12-03T19:08:39.461533+01:00","closed_at":"2025-12-03T19:08:39.461533+01:00"}
{"id":"beadhub-n5s1","title":"bdh: fail fast on coordination project/workspace mismatch","description":"Observed locally: bdh preflight /v1/bdh/command returned 400 'workspace does not belong to project' after server restart; .beadhub had project_id/repo_id that no longer matched server DB (likely due to dev DB reset or pointing at a different server). This bead was created to consider improving bdh UX (clear recovery path like re-init/update) but may be unnecessary for real deployments.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T17:53:40.041791Z","created_by":"juanre","updated_at":"2026-01-02T17:55:36.710295Z","closed_at":"2026-01-02T17:55:36.710295Z","close_reason":"Not needed for real deployments; local dev DB reset / env mismatch. Dropping.","dependencies":[{"issue_id":"beadhub-n5s1","depends_on_id":"beadhub-1tqa","type":"discovered-from","created_at":"2026-01-02T17:53:40.043845Z","created_by":"juanre"}]}
{"id":"beadhub-n5z","title":"Add index on parent_id in beads_issues table","description":"**Problem**: parent_id column in beads_issues lacks an index. Parent-child relationship queries will be slow as the table grows.\n\n**File**: migrations/beads/001_initial.sql\n\n**Fix**: Add migration to create index:\n```sql\nCREATE INDEX IF NOT EXISTS idx_beads_issues_parent \nON {{tables.beads_issues}}(parent_id);\n```","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-02T19:47:30.523854+01:00","updated_at":"2025-12-02T22:01:13.282238+01:00","closed_at":"2025-12-02T22:01:13.282238+01:00","close_reason":"Added partial index on parent_id (WHERE parent_id IS NOT NULL). No FK constraint since JSONL sync order isn't guaranteed."}
{"id":"beadhub-n80a","title":"Persist chat messages to Postgres for audit trail","description":"Currently chat messages are Redis-only with 5-minute TTL. Add Postgres persistence for:\n\n- Audit trail of agent conversations\n- Message history retrieval after session expires\n- Durability across Redis restarts\n\nImplementation:\n- Add chat_messages table (or extend existing messages table)\n- Write to both Redis (real-time) and Postgres (durability)\n- Consider whether to link messages to beads for context\n\nRelated: beadhub-dtcl (chat epic), beadhub-fh23 (messages API)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-10T22:28:48.922605+01:00","updated_at":"2025-12-13T14:52:17.351453+01:00","closed_at":"2025-12-13T14:45:21.809552+01:00"}
{"id":"beadhub-nb68","title":"File reservation system with MCP Agent Mail drop-in compatibility","description":"Implement file reservations in BeadHub as a drop-in replacement for mcp_agent_mail's file reservation system. This enables coordination when multiple agents work on the same codebase.\n\n## DEPENDENCY: Identity Resolution (beadhub-ki7v in beadhub-be)\n\nThis epic depends on claude-be's identity resolution work (beadhub-ki7v). The identity resolution provides:\n- resolve_project(project_key, tenant_id) â†’ project_id\n- resolve_agent(project_id, agent_name) â†’ (workspace_id, alias)\n\n## Goals\n\n1. **Drop-in compatibility**: Users of mcp_agent_mail can point at BeadHub without code changes\n2. **bdh CLI integration**: Add :lock, :unlock, :locks commands for agent workflows\n3. **Conflict detection**: Prevent agents from stepping on each other's work\n\n## Background\n\n### Previous Implementation (removed Dec 12, 2025)\n\nBeadHub had file reservations before, removed in commit 1abe435 with message:\n\u003e \"bead claims now provide task-level coordination\"\n\n**Deleted files:**\n- src/beadhub/routes/reservations.py (697 lines, Redis-based with Lua scripts)\n- tests/test_reservations.py, test_reservation_race.py, test_revoke.py\n\n**Old API endpoints:**\n- POST /v1/reservations - acquire locks\n- POST /v1/reservations/release - release locks\n- POST /v1/reservations/renew - extend TTL\n- GET /v1/reservations - list active locks\n- POST /v1/reservations/revoke - admin revoke (API key required)\n\n**Recovery**: git show 1abe435^:src/beadhub/routes/reservations.py\n\n### MCP Agent Mail Reference\n\nSee: other/mcp_agent_mail/src/mcp_agent_mail/app.py (lines 5704-5964)\n\n**Tools to match:**\n- file_reservation_paths - reserve paths with globs, TTL, exclusive flag\n- release_file_reservations - release by path or all\n- renew_file_reservations - extend TTL\n\n**Key semantics:**\n- Glob pattern matching for paths\n- Exclusive vs shared reservations\n- TTL-based expiration with renewal\n- Conflict detection across agents\n\n### Compatibility Spec\n\nSee: beadhub-sot/source-of-truth/mcp-agent-mail-compatibility.md (section \"File Reservation Compatibility\")\n\n## Identity Mapping (Drop-in) - CORRECTED\n\nmcp_agent_mail uses project_key + agent_name. BeadHub uses project_id + workspace_id.\n\n**Mapping strategy (from sync with claude-be):**\n- project_key â†’ project_id (UUID) via mapping table, NOT project_slug\n- agent_name â†’ alias (via mapping table that returns workspace_id)\n- Client NEVER sends project_id - server always derives it\n\n**Key rules:**\n- project_slug is display-only, not used for identity\n- Agent Mail clients get REAL workspaces (workspace_type='agent_mail', repo_id=NULL)\n- Identity resolution (beadhub-ki7v) handles the mapping\n\n## Architecture (agreed with claude-be)\n\n```\nMCP /mcp endpoint\n    â”‚\n    â”œâ”€â–º Polymorphic dispatch (detect arg shape)\n    â”‚\n    â”œâ”€â–º Agent Mail shape (project_key + agent_name)\n    â”‚       â””â”€â–º Identity resolution (beadhub-ki7v)\n    â”‚               â”œâ”€â–º Messaging (beadhub-f7i0)\n    â”‚               â””â”€â–º File reservations (this epic)\n    â”‚\n    â””â”€â–º BeadHub native shape (workspace_id)\n            â””â”€â–º Existing handlers\n```\n\n## Architecture Decisions\n\n1. **Storage**: Redis (as before) - TTL-native, fast, matches old implementation\n2. **MCP tools**: Add to existing /mcp endpoint with polymorphic dispatch\n3. **bdh integration**: New :lock/:unlock/:locks commands in bdh CLI\n4. **SSE events**: Restore lock acquired/released/renewed events for dashboard\n5. **Key schema**: lock:{project_id}:{path_hash} (scoped by project_id for tenant isolation)\n\n## Subtasks\n\nSee blocked issues for implementation breakdown.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-15T21:38:53.798086+01:00","updated_at":"2025-12-17T19:27:54.973699+01:00","closed_at":"2025-12-17T19:27:54.973699+01:00","close_reason":"File reservation system complete: storage model, reservations router, MCP tools, bdh CLI commands, tests, SSE events, and documentation all implemented","dependencies":[{"issue_id":"beadhub-nb68","depends_on_id":"beadhub-1tty","type":"blocks","created_at":"2025-12-15T21:42:03.674889+01:00","created_by":"juanre"},{"issue_id":"beadhub-nb68","depends_on_id":"beadhub-sgup","type":"blocks","created_at":"2025-12-15T21:42:03.742128+01:00","created_by":"juanre"},{"issue_id":"beadhub-nb68","depends_on_id":"beadhub-tslb","type":"blocks","created_at":"2025-12-15T21:42:03.809598+01:00","created_by":"juanre"},{"issue_id":"beadhub-nb68","depends_on_id":"beadhub-xy2n","type":"blocks","created_at":"2025-12-15T21:42:03.873469+01:00","created_by":"juanre"},{"issue_id":"beadhub-nb68","depends_on_id":"beadhub-71he","type":"blocks","created_at":"2025-12-15T21:42:03.937872+01:00","created_by":"juanre"},{"issue_id":"beadhub-nb68","depends_on_id":"beadhub-7bgc","type":"blocks","created_at":"2025-12-15T21:42:04.001594+01:00","created_by":"juanre"},{"issue_id":"beadhub-nb68","depends_on_id":"beadhub-pp67","type":"blocks","created_at":"2025-12-15T21:42:04.067887+01:00","created_by":"juanre"}]}
{"id":"beadhub-nch6","title":"Improve error type handling in SendMessageDialog onError","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T20:35:06.888856+01:00","updated_at":"2025-12-13T23:47:24.96361+01:00","closed_at":"2025-12-13T23:47:24.96361+01:00"}
{"id":"beadhub-nct2","title":"Handle sendChatMessage delivered:false response","description":"sendChatMessage returns { message_id, delivered } but we ignore delivered. If delivered:false, user should be notified their message didn't reach all recipients.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-14T21:49:21.269433+01:00","updated_at":"2026-01-04T17:21:52.254733Z","closed_at":"2026-01-04T17:21:52.254733Z","close_reason":"Added delivery feedback when sendChatMessage returns delivered:false - shows warning in both SessionViewer and ActiveChatPanel"}
{"id":"beadhub-nem8","title":"Improve default policy bootstrap + bdh :policy output","description":"- Strengthen DEFAULT_POLICY_BUNDLE (esp coordinator playbook: overall project ownership, docs, goal alignment).\n- Ensure new installs/projects get a good seeded policy.\n- Fix Policy: v3 (updated 11 hours ago)\nRole: coordinator\n\nGlobal invariants:\n  - Mail-first communication\n    Use mail (`bdh :send`) by default for status updates and FYIs. Use chat only when you need an answer NOW to proceed. Respond IMMEDIATELY to WAITING notificat...\n  - No workspace impersonation\n    ONLY run bdh from YOUR workspace directory. The `.beadhub` file determines your identity. Running bdh from another directory impersonates that workspace's ag...\n  - Use bdh for tracking\n    All task and issue tracking MUST use bdh (beadhub). Do NOT create markdown TODO lists or use external trackers. This ensures visibility and coordination acro...\n\nRole playbook (coordinator):\n  Coordinator\n  ## Coordinator Role\n  \n  You orchestrate work across multiple agents. Your responsibilities:\n  \n  - Break down epics into implementable tasks\n  - Assign work to appropriate agents based on their focus\n  - Monitor progress and unblock agents\n  - Review completed work before closing epics\n  - Escalate to humans when agents are stuck or conflicting\n  \n  Use `bdh ready` to see available work and `bdh :who` to see team status. output truncation so sentences arenâ€™t cut.","notes":"Implemented default policy seeding on new OSS projects, improved DEFAULT_POLICY_BUNDLE text (coordinator outcome/docs emphasis), and removed invariant summary truncation in Policy: v3 (updated 11 hours ago)\nRole: coordinator\n\nGlobal invariants:\n  - Mail-first communication\n    Use mail (`bdh :send`) by default for status updates and FYIs. Use chat only when you need an answer NOW to proceed. Respond IMMEDIATELY to WAITING notificat...\n  - No workspace impersonation\n    ONLY run bdh from YOUR workspace directory. The `.beadhub` file determines your identity. Running bdh from another directory impersonates that workspace's ag...\n  - Use bdh for tracking\n    All task and issue tracking MUST use bdh (beadhub). Do NOT create markdown TODO lists or use external trackers. This ensures visibility and coordination acro...\n\nRole playbook (coordinator):\n  Coordinator\n  ## Coordinator Role\n  \n  You orchestrate work across multiple agents. Your responsibilities:\n  \n  - Break down epics into implementable tasks\n  - Assign work to appropriate agents based on their focus\n  - Monitor progress and unblock agents\n  - Review completed work before closing epics\n  - Escalate to humans when agents are stuck or conflicting\n  \n  Use `bdh ready` to see available work and `bdh :who` to see team status.. Updated policy history tests.","status":"closed","priority":3,"issue_type":"task","assignee":"juanre","created_at":"2026-01-03T11:07:00.005355Z","created_by":"juanre","updated_at":"2026-01-03T11:10:08.881527Z","closed_at":"2026-01-03T11:10:08.881527Z","close_reason":"done"}
{"id":"beadhub-nflg","title":"Add mark-as-read endpoint","description":"Add POST /v1/chat/sessions/{session_id}/read endpoint:\n\nRequest: { workspace_id, up_to_message_id }\n\nUpserts into chat_read_receipts table. Used by client after displaying messages.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T20:25:32.412199+01:00","updated_at":"2025-12-14T00:50:49.464384+01:00","closed_at":"2025-12-14T00:50:49.464384+01:00","dependencies":[{"issue_id":"beadhub-nflg","depends_on_id":"beadhub-6t7d","type":"blocks","created_at":"2025-12-13T20:26:14.79076+01:00","created_by":"juanre"}]}
{"id":"beadhub-nfpu","title":"Messages to existing sessions not persisted to Postgres","description":"CRITICAL: In create_session() (chat.py:315-357), when an existing active session is found and a message is sent to it, the message is only stored in Redis (5 min TTL) but NOT persisted to Postgres. This causes data loss - messages disappear when Redis expires and won't appear in GET /v1/chat/sessions/{id}/messages. Fix: Add Postgres INSERT after publish_chat_event() around line 348, similar to lines 684-699.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-13T14:58:40.355661+01:00","updated_at":"2025-12-13T15:10:52.020307+01:00","closed_at":"2025-12-13T15:10:52.020307+01:00"}
{"id":"beadhub-nfz8","title":"Display apex context in bdh ready output","description":"Add 'You are working on: [apex title]' at the top of bdh ready output, before inbox/team status. If multiple apexes, show each on its own line. Fetch apex titles from issues.jsonl. Format: 'You are working on: beadhub-xyz \"Auth system epic\"'. If apex bead is closed or not found, show warning and clear from .role.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T21:59:18.229933+01:00","updated_at":"2025-12-20T10:37:07.94056+01:00","closed_at":"2025-12-20T10:37:07.94056+01:00","close_reason":"Implemented apex display in bdh ready output: added ApexInfo struct and ApexContext to PassthroughResult, loadApexContext() for loading/validating apex from .role, and display logic showing 'WORKING ON:' section at top of ready output. Closed/missing apexes are warned about and automatically cleared from .role. All tests pass.","dependencies":[{"issue_id":"beadhub-nfz8","depends_on_id":"beadhub-npuh","type":"parent-child","created_at":"2025-12-17T21:59:32.923382+01:00","created_by":"juanre"},{"issue_id":"beadhub-nfz8","depends_on_id":"beadhub-vvon","type":"blocks","created_at":"2025-12-17T21:59:40.866922+01:00","created_by":"juanre"}]}
{"id":"beadhub-ngvd","title":"Migrate test_reservations.py to db_infra fixture","description":"Convert from app_with_test_db to async tests using db_infra fixture.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-10T10:54:57.608787+01:00","created_by":"juanre","updated_at":"2026-01-10T11:37:22.656244+01:00","closed_at":"2026-01-10T11:37:22.656244+01:00","close_reason":"Migrated test_reservations.py to async pattern with db_infra and redis_client_async fixtures. All 50 tests pass.","dependencies":[{"issue_id":"beadhub-ngvd","depends_on_id":"beadhub-7wpr","type":"parent-child","created_at":"2026-01-10T10:55:48.963172+01:00","created_by":"juanre"}]}
{"id":"beadhub-nimv","title":"Pin pnpm/uv versions in Dockerfile","description":"# Docker Reproducibility (Pin Toolchain Inputs)\n\nThe current `Dockerfile` uses floating versions:\n\n- `pnpm@latest` via `corepack prepare` (frontend build stage).\n- `ghcr.io/astral-sh/uv:latest` to provide `uv` (backend build stage).\n\n## Why This Matters\n\nEven with a lockfile (`pnpm-lock.yaml`, `uv.lock`), unpinned *toolchain* inputs can cause rebuilds of the same git commit to break:\n\n- A new pnpm release can change lockfile interpretation or CLI behavior.\n- A new `uv` release can change resolution/install behavior, default flags, or wheel handling.\n- If a user rebuilds an older tag for incident response, they can end up debugging â€œrandomâ€ breakage unrelated to their changes.\n\nThis affects both OSS users building images and Cloud build pipelines (less often, but still a source of surprise).\n\n## Proposed Approach\n\n- Pin pnpm to a specific version, e.g.:\n  - `corepack prepare pnpm@9.15.0 --activate`\n  - or set `ENV COREPACK_ENABLE_DOWNLOAD_PROMPT=0` and use a pinned `packageManager` field in `frontend/package.json`.\n- Pin uv by digest (preferred) or at least by tag:\n  - `COPY --from=ghcr.io/astral-sh/uv:0.5.22@sha256:\u003cdigest\u003e /uv /usr/local/bin/uv`\n  - or install `uv==\u003cversion\u003e` from PyPI (slower; less deterministic than digest pinning).\n\n## Operational Guidance\n\n- Document the update process:\n  - When bumping `uv.lock` / `pnpm-lock.yaml`, consider bumping the pinned tool versions at the same time.\n- Prefer digest pinning for container images to eliminate registry tag drift.\n\n## Acceptance Criteria\n\n- Rebuilding the same commit weeks later should not â€œrandomlyâ€ fail due to pnpm/uv changes.\n- Docker builds remain cache-friendly (pins should not reduce caching).\n\n","acceptance_criteria":"- Dockerfile pins pnpm and uv versions (prefer digest pinning)\n- Same git commit rebuilds reliably over time\n- Document the update process","status":"closed","priority":2,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-17T18:22:02.710952+01:00","created_by":"Juan Reyero","updated_at":"2026-01-18T13:56:52.185615+01:00","closed_at":"2026-01-18T13:56:52.185615+01:00","close_reason":"Pinned Docker toolchain inputs: pnpm pinned via Corepack (PNPM_VERSION=9.15.0 matches frontend/package.json packageManager), uv pinned via ghcr.io/astral-sh/uv:0.9.22 (no :latest). Docs in docs/specs/docker-reproducibility.md."}
{"id":"beadhub-nkjm","title":"bdh has no worktree awareness - uses hardcoded .beads/ paths","description":"bdh uses hardcoded paths to .beads/ directory (init.go:160, passthrough.go:484, passthrough.go:691) instead of using worktree-aware discovery like bd does.\n\n**Problem:**\n- bd (beads) has native worktree support via GetMainRepoRoot() in internal/git/gitdir.go\n- bd automatically finds main repo's .beads/ when running in a worktree\n- bdh ignores this and always looks at current directory's .beads/\n- This breaks bdh's BeadHub sync in worktrees (reads non-existent .beads/issues.jsonl)\n\n**Fix needed:**\n1. Add getMainRepoRoot() function to bdh (same logic as bd: compare git-dir vs git-common-dir)\n2. Use it to find the correct .beads/ directory\n3. Update all hardcoded .beads/ paths to use the resolved path\n\n**Also:**\n- Remove redirect file creation from scripts/create-worktree.sh (unnecessary since bd handles worktrees natively)\n- The redirect mechanism is for external beads repos, not worktree sharing","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-02T11:56:18.453177Z","created_by":"juanre","updated_at":"2026-01-02T12:14:22.231937Z","closed_at":"2026-01-02T12:14:22.231937Z","close_reason":"Completed: Added worktree-aware beads discovery to bdh via internal/beads package. Updated all consumers. Removed unnecessary redirect from create-worktree.sh."}
{"id":"beadhub-nm5k","title":"Extract SQL placeholder generation to helper function","description":"The pattern \", \".join(f\"$\\{i\\}\" for i in range(1, count + 1)) is used in 3 places (status.py, mcp.py). Extract to a helper function for clarity and to make the SQL injection safety explicit. Discovered during beadhub-oqdq review.","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-20T11:42:14.78827+01:00","updated_at":"2025-12-22T00:44:39.977051+01:00","closed_at":"2025-12-22T00:44:39.977051+01:00","close_reason":"Won't fix - simple idiomatic one-liner doesn't benefit from extraction"}
{"id":"beadhub-nmug","title":"Claims not released when beads are closed","description":"Bead claims remain in the bead_claims table after the bead is closed. This causes the claims dashboard to show stale claims. When a bead is closed (via bdh close or the API), the corresponding claim should be deleted from bead_claims. Observed: beadhub-pg3t and beadhub-g3ii are closed but still show claims.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T15:32:37.761417+01:00","updated_at":"2025-12-13T15:35:42.725221+01:00","closed_at":"2025-12-13T15:35:42.725221+01:00"}
{"id":"beadhub-nonh","title":"Wrap session+participant inserts in transaction","description":"In create_session, if session INSERT succeeds but participant INSERTs fail, we have a session with no participants in the database. Should wrap both operations in a transaction for atomicity.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-13T22:59:19.736787+01:00","updated_at":"2025-12-13T22:59:19.736787+01:00","dependencies":[{"issue_id":"beadhub-nonh","depends_on_id":"beadhub-ixss","type":"discovered-from","created_at":"2025-12-13T22:59:19.737675+01:00","created_by":"juanre"}]}
{"id":"beadhub-npuh","title":"Epic: Apex bead tracking for context awareness","description":"Add apex bead tracking to improve agent context awareness. When an agent claims a bead, automatically detect its apex (parent epic or top-level bead) and store it in .role. Display apex context in bdh ready and :who outputs. Prompt for epic closure when all child beads are complete.","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-17T21:58:43.170681+01:00","updated_at":"2025-12-20T11:13:14.779139+01:00","closed_at":"2025-12-20T11:13:14.779139+01:00","close_reason":"Epic complete: all 9 subtasks implemented - apex detection, storage, display in ready/:who, and epic closure prompts"}
{"id":"beadhub-nr96","title":"Implicit schema creation outside migrations","description":"Location: src/beadhub/db.py:54-64. Schema creation happens outside transaction control before migrations run. If migration fails, schema exists but is incomplete, making rollback difficult and leaving DB in inconsistent state. Fix: move schema creation into first migration file or handle failures with proper cleanup.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-08T18:25:32.133985+01:00","updated_at":"2025-12-08T18:25:32.133985+01:00"}
{"id":"beadhub-ntf","title":"Document cloud beads sync setup for customers","description":"Update docs/agents-template.md and README with: 1) How to configure BeadHub Cloud beads sync, 2) bd-wrapper installation, 3) CI/CD integration example (GitHub Actions), 4) Environment variable reference. Include troubleshooting section.\n\nMoved from beadhub-2k6 (cloud-specific documentation).","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T08:35:08.231783+01:00","updated_at":"2025-12-08T08:35:13.837874+01:00","closed_at":"2025-12-08T08:35:13.837874+01:00"}
{"id":"beadhub-ntpa","title":"Update frontend dashboard: agent_name â†’ alias","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T18:06:36.244985+01:00","updated_at":"2025-12-12T18:09:02.394634+01:00","closed_at":"2025-12-12T18:09:02.394634+01:00","dependencies":[{"issue_id":"beadhub-ntpa","depends_on_id":"beadhub-rl9y","type":"discovered-from","created_at":"2025-12-12T18:06:36.245789+01:00","created_by":"juanre"}]}
{"id":"beadhub-ntpu","title":"Make unread MAIL notification explicit about recipient workspace (\"for \u003calias\u003e (you)\")","description":"Problem\nAgents sometimes ignore BeadHub inbox notifications because the CLI copy is ambiguous: it says â€œMAIL: â€¦ unreadâ€ but doesnâ€™t specify that the unread messages are addressed to the *current agent workspace* (the one running this command). Agents may incorrectly interpret this as â€œmail for the human/adminâ€ and skip checking the inbox, causing missed coordination and delays.\n\nContext: what â€œMAILâ€ is in BeadHub\n- â€œMAILâ€ refers to BeadHub inbox messages stored in Postgres (`server.messages`) and retrieved via `bdh :inbox`.\n- These messages can be sent by:\n  - another agent via `bdh :send \u003calias\u003e ...`\n  - the dashboard (human) messaging a workspace\n  - system/automation (e.g., notifications/outbox) if enabled\n- This is separate from â€œCHATâ€ (persistent chat sessions) which shows up as WAITING/CHATS and is accessed via `bdh :chat ...`.\n\nWhere the confusing notification appears (bdh CLI)\nThere are multiple code paths that emit the unread mail hint; all must be updated for consistency:\n\n1) Lightweight NOTIFICATIONS block (end-of-command)\n- File: `bdh/internal/commands/context.go`\n- Function: `FormatServerNotifications(...)`\n- Current output example:\n  - `NOTIFICATIONS:`\n  - `  MAIL: 1 unread â€” Run \"bdh :inbox\"`\n  - `  MAILS: N unread â€” Run \"bdh :inbox\"`\n\n2) Start-of-command context (colon commands)\n- File: `bdh/internal/commands/context.go`\n- Function: `ShowServerContextWithOptions(...)` prints:\n  - `FormatServerContextPrefix(...)` (WAITING only)\n  - `FormatServerContextSuffix(...)` (CHATS backlog + MAIL count)\n- Current suffix output example:\n  - `MAIL: 1 unread â€” Run \"bdh :inbox\"`\n\n3) â€œReady commandâ€ checkpoint summary after `bdh ready` (bd passthrough)\n- File: `bdh/internal/commands/passthrough.go`\n- Function: `formatPassthroughOutput(...)`\n- Current output example:\n  - `MAIL: 1 unread (run 'bdh :inbox')`\n  - `MAILS: N unread (run 'bdh :inbox')`\n\nWhy this is confusing / root cause\n- The notification text does not identify the recipient.\n- In mixed human+agent workflows (dashboard messaging, admin, etc.), agents can think â€œmail is for the humanâ€ and ignore it.\n- For LLM-based agents, explicit recipient targeting greatly improves compliance (â€œthis is for youâ€).\n\nProposed UX copy change\nMake the unread-mail notification explicitly addressed to the current workspace alias, and include â€œ(you)â€.\n\nTarget strings (examples)\n- `MAIL: 1 unread for bob-coordinator (you) â€” Run \"bdh :inbox\"`\n- `MAILS: 3 unread for bob-coordinator (you) â€” Run \"bdh :inbox\"`\n\nNotes\n- The alias should be the *current workspace alias* from local `.beadhub` config (recipient), NOT the sender.\n- If alias is empty/unavailable, fall back gracefully (omit the â€œfor â€¦ (you)â€ clause rather than printing a blank).\n\nImplementation approach (recommended)\nUse the local config alias everywhere we render the line:\n\nA) Context notifications (`bdh/internal/commands/context.go`)\n- `FetchServerContext(cfg)` / `FetchServerNotifications(cfg)` already have access to `cfg`.\n- Add the current alias into the formatting path (e.g., extend `ServerContext` with `CurrentAlias string` populated from `cfg.Alias`, or pass alias explicitly into the formatters).\n- Update all three emit sites in this file:\n  - `FormatServerNotifications(...)`\n  - `FormatServerContextSuffix(...)`\n  - any other mail line builder (search for `MAIL:` / `MAILS:`)\n\nB) Ready checkpoint in passthrough (`bdh/internal/commands/passthrough.go`)\n- `formatPassthroughOutput(...)` currently only has `PassthroughResult`, no alias.\n- `runPassthrough(...)` loads `.beadhub` config; add a field like `RecipientAlias` (or reuse `cfg.Alias`) into `PassthroughResult` so `formatPassthroughOutput` can render the same â€œfor \u003calias\u003e (you)â€ clause.\n\nC) Tests\n- Update existing tests that assert the old strings:\n  - `bdh/internal/commands/context_test.go` currently checks for `MAIL: 1 unread` / `MAILS: 3 unread` / `MAILS: 2 unread`.\n  - `bdh/internal/commands/passthrough_test.go` likely asserts ready output fragments containing the old mail strings.\n- Add at least one explicit test for the new behavior:\n  - alias present =\u003e includes `for \u003calias\u003e (you)`\n  - alias absent =\u003e does not include a dangling â€œforâ€.\n\nNon-goals\n- No server API changes required (we do not need the server to tell us our alias; we already know it locally).\n- Do not change JSON output shapes; this is display text only.\n\nAcceptance criteria\n- Every unread-mail hint emitted by `bdh` includes the recipient alias and â€œ(you)â€ when alias is available.\n- Output is consistent across:\n  - `NOTIFICATIONS:` block\n  - colon-command context suffix\n  - ready-command checkpoint summary\n- If alias is missing, output remains sensible and still points to `bdh :inbox`.\n\nManual verification recipe\n1) Create two workspaces (A and B) with distinct aliases.\n2) From A: `bdh :send \u003calias-of-B\u003e \"test\" --subject \"ping\"`.\n3) From B: run `bdh :status` and `bdh ready`.\n4) Confirm the MAIL line includes: `for \u003calias-of-B\u003e (you)`.\n5) Run `bdh :inbox` and confirm messages are present.\n","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-07T07:02:20.405063Z","created_by":"juanre","updated_at":"2026-01-09T18:52:35.920978+01:00","closed_at":"2026-01-09T18:52:35.920978+01:00","close_reason":"Implementation complete: Added CurrentAlias/RecipientAlias fields and updated all MAIL notification paths to include 'for \u003calias\u003e (you)' format","labels":["area:ux","component:bdh","component:messaging"]}
{"id":"beadhub-nts3","title":"Centralize magic numbers and limits into config module","description":"## Problem\n\nHardcoded limits are scattered throughout the codebase without central constants, making configuration changes difficult.\n\n### Current Behavior\n\n**beads.py (lines 138-140):**\n```python\nMAX_JSONL_SIZE = 10 * 1024 * 1024  # 10MB\nMAX_ISSUES_COUNT = 10000\nMAX_JSON_DEPTH = 10\n```\n\n**status.py (lines 50-51):**\n```python\nDEFAULT_WORKSPACE_LIMIT = 200\nMAX_WORKSPACE_LIMIT = 1000\n```\n\n**workspaces.py (lines 36-40):**\n```python\nTEAM_STATUS_DEFAULT_LIMIT = 15\nTEAM_STATUS_MAX_LIMIT = 200\nTEAM_STATUS_CANDIDATE_MULTIPLIER = 5\nTEAM_STATUS_CANDIDATE_MAX = 500\nREGISTRY_MAX_LIMIT = 1000\n```\n\n**passthrough.go:**\n```go\nconst (\n    defaultReadyTeamLimit = 10\n    defaultWhoLimit = 50\n    defaultReadyLocksLimit = 10\n)\n```\n\n### Impact\n\n- Changing global API limits requires editing multiple files\n- No single source of truth for limits\n- Inconsistency risk (e.g., different max limits in different places)\n- Hard to expose limits via API for clients to respect\n\n### Solution\n\nCreate centralized configuration:\n\n```python\n# src/beadhub/limits.py\n\nimport os\n\n# Pagination limits\nDEFAULT_PAGE_LIMIT = int(os.getenv(\"BEADHUB_DEFAULT_PAGE_LIMIT\", \"50\"))\nMAX_PAGE_LIMIT = int(os.getenv(\"BEADHUB_MAX_PAGE_LIMIT\", \"200\"))\n\n# Workspace limits\nDEFAULT_WORKSPACE_LIMIT = int(os.getenv(\"BEADHUB_DEFAULT_WORKSPACE_LIMIT\", \"200\"))\nMAX_WORKSPACE_LIMIT = int(os.getenv(\"BEADHUB_MAX_WORKSPACE_LIMIT\", \"1000\"))\nTEAM_STATUS_DEFAULT_LIMIT = 15\nTEAM_STATUS_MAX_LIMIT = 200\n\n# Upload limits\nMAX_UPLOAD_SIZE_BYTES = int(os.getenv(\"BEADHUB_MAX_UPLOAD_SIZE_MB\", \"10\")) * 1024 * 1024\nMAX_ISSUES_PER_UPLOAD = int(os.getenv(\"BEADHUB_MAX_ISSUES_PER_UPLOAD\", \"10000\"))\nMAX_JSON_DEPTH = 10\n\n# Registry limits\nREGISTRY_MAX_LIMIT = 1000\n```\n\n### Files to Update\n\n- Create `src/beadhub/limits.py`\n- Update `src/beadhub/routes/beads.py`\n- Update `src/beadhub/routes/status.py`\n- Update `src/beadhub/routes/workspaces.py`\n- Consider exposing via `/v1/limits` endpoint for clients\n\n### Acceptance Criteria\n\n- [ ] All limits centralized in one module\n- [ ] Environment variable overrides where appropriate\n- [ ] All routes import limits from central module\n- [ ] Document limits in .env.example","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-08T12:40:59.79789+01:00","created_by":"juanre","updated_at":"2026-01-08T12:40:59.79789+01:00"}
{"id":"beadhub-nyhp","title":"Update documentation: agent_name â†’ alias, project_key â†’ project_slug","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T18:06:36.533253+01:00","updated_at":"2025-12-12T18:41:34.744674+01:00","closed_at":"2025-12-12T18:41:34.744674+01:00","dependencies":[{"issue_id":"beadhub-nyhp","depends_on_id":"beadhub-rl9y","type":"discovered-from","created_at":"2025-12-12T18:06:36.534323+01:00","created_by":"juanre"}]}
{"id":"beadhub-nyjx","title":"API: accept hostname and path in workspace registration","description":"Update POST /v1/workspaces/register and upsert_workspace to accept and store hostname and workspace_path fields.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T19:07:00.663723+01:00","updated_at":"2025-12-21T20:40:05.680515+01:00","closed_at":"2025-12-21T20:40:05.680515+01:00","close_reason":"Implemented API changes: added hostname/workspace_path fields to RegisterWorkspaceRequest, CommandRequest, SyncRequest models; updated upsert_workspace to store fields with COALESCE immutability; updated all workspace list queries and response models; added 6 comprehensive tests","dependencies":[{"issue_id":"beadhub-nyjx","depends_on_id":"beadhub-5wir","type":"parent-child","created_at":"2025-12-17T19:07:00.665576+01:00","created_by":"juanre"},{"issue_id":"beadhub-nyjx","depends_on_id":"beadhub-go2o","type":"blocks","created_at":"2025-12-17T19:07:06.943525+01:00","created_by":"juanre"}]}
{"id":"beadhub-nzwp","title":"Add ARIA labels to icon-only buttons and status indicators for accessibility","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-08T15:32:34.960016+01:00","updated_at":"2025-12-08T15:32:34.960016+01:00","dependencies":[{"issue_id":"beadhub-nzwp","depends_on_id":"beadhub-7r4","type":"discovered-from","created_at":"2025-12-08T15:32:34.960839+01:00","created_by":"juanre"}]}
{"id":"beadhub-o0w2","title":"Create workspaces table migration","description":"Add migration 007_workspaces.sql with:\n- workspace_id UUID PRIMARY KEY\n- project_id UUID (nullable? references projects?)\n- agent_name TEXT NOT NULL UNIQUE\n- human_name TEXT\n- created_at, updated_at timestamps","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T21:01:55.715241+01:00","updated_at":"2025-12-11T21:04:06.053604+01:00","closed_at":"2025-12-11T21:04:06.053604+01:00"}
{"id":"beadhub-o14","title":"No retry logic for failed beads sync operations","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-03T15:38:51.346117+01:00","updated_at":"2025-12-03T19:39:57.322927+01:00","closed_at":"2025-12-03T19:39:57.322927+01:00"}
{"id":"beadhub-o3c2","title":"Add maxLength to subject input in SendMessageDialog","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T20:35:06.27999+01:00","updated_at":"2025-12-13T20:40:25.021849+01:00","closed_at":"2025-12-13T20:40:25.021849+01:00"}
{"id":"beadhub-o3x","title":"Cross-repo messaging","description":"Allow messages addressed to repo:agent or repo:* (broadcast to repo).\nRoute messages based on repo context.\nUpdate MCP send_message tool.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-03T09:15:08.978343+01:00","updated_at":"2025-12-03T18:52:45.775198+01:00","closed_at":"2025-12-03T18:52:45.775198+01:00","dependencies":[{"issue_id":"beadhub-o3x","depends_on_id":"beadhub-bt0","type":"blocks","created_at":"2025-12-03T09:15:17.184144+01:00","created_by":"juanre"}]}
{"id":"beadhub-o4x3","title":"Invalidate message queries after successful send","description":"After a successful send from `SendMessageDialog`, the dashboard should refresh any cached inbox/message views.\n\nCurrent state:\n- `MessagesPage` uses React Query key prefix `['all-inboxes', ...]` and stores the flattened messages list in local state.\n- `SendMessageDialog` closes after success, but does not invalidate message queries.\n\nFix:\n- On successful send, invalidate the relevant query keys so Messages page updates without waiting for the 30s refetch interval.\n\nRelevant files:\n- `frontend/src/components/SendMessageDialog.tsx`\n- `frontend/src/pages/MessagesPage.tsx`\n","acceptance_criteria":"- Successful send invalidates ['all-inboxes'] queries\n- MessagesPage shows new message without manual refresh","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T20:35:18.751646+01:00","updated_at":"2026-01-03T18:40:09.581057Z"}
{"id":"beadhub-o5a8","title":"Chat SSE event types must match spec (no joined/ended/timeout)","description":"beadhub-chat-spec.md v2.1 specifies SSE event types like message (and optionally typing) and explicitly says no joined/ended/timeout lifecycle events. Current code defines and publishes joined/ended (and has timeout event type) which pushes clients toward a session lifecycle model.\n\nFix: remove/stop emitting joined/ended/timeout chat events (or keep internally but do not expose via SSE), and add typing if needed.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T23:12:03.085892+01:00","updated_at":"2025-12-13T23:39:46.11961+01:00","closed_at":"2025-12-13T23:39:46.11961+01:00","dependencies":[{"issue_id":"beadhub-o5a8","depends_on_id":"beadhub-ixss","type":"discovered-from","created_at":"2025-12-13T23:12:03.087201+01:00","created_by":"juanre"}]}
{"id":"beadhub-o6hu","title":"bdh CLI: collect and send hostname/cwd in command requests","description":"Add hostname and cwd fields to CommandRequest in bdh Go client.\n\nFiles to modify:\n- bdh/internal/client/client.go: Add Hostname and Cwd fields to CommandRequest struct\n- bdh/internal/commands/passthrough.go (or wherever command is built): Collect os.Hostname() and os.Getwd()\n\nImplementation:\n```go\ntype CommandRequest struct {\n    // ... existing fields ...\n    Hostname string `json:\"hostname,omitempty\"`\n    Cwd      string `json:\"cwd,omitempty\"`\n}\n```\n\nCollect values:\n```go\nhostname, _ := os.Hostname()\ncwd, _ := os.Getwd()\n```\n\nNote: Errors are ignored - empty string is fine if collection fails.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-13T21:09:32.157869+01:00","updated_at":"2025-12-13T21:09:32.157869+01:00"}
{"id":"beadhub-o71h","title":"Auto-deregister stale workspaces on every bdh command","description":"On every bdh command, before processing: 1) Update last_seen_at for current workspace. 2) Check git worktree list. 3) For each registered workspace in this repo, if its path no longer exists and it's not the current workspace, call DELETE endpoint to mark as deleted. This runs automatically - no explicit :deregister command needed.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-16T20:40:56.360967+01:00","updated_at":"2025-12-16T23:07:46.819243+01:00","closed_at":"2025-12-16T23:07:46.819243+01:00","dependencies":[{"issue_id":"beadhub-o71h","depends_on_id":"beadhub-psfv","type":"blocks","created_at":"2025-12-16T20:41:05.243129+01:00","created_by":"juanre"},{"issue_id":"beadhub-o71h","depends_on_id":"beadhub-lmtj","type":"blocks","created_at":"2025-12-16T20:41:17.883557+01:00","created_by":"juanre"}]}
{"id":"beadhub-o7gt","title":"Migrate test_reservation_events.py to db_infra fixture","description":"Convert from app_with_test_db to async tests using db_infra fixture.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-10T10:55:07.901063+01:00","created_by":"juanre","updated_at":"2026-01-10T12:44:20.979124+01:00","closed_at":"2026-01-10T12:44:20.979124+01:00","close_reason":"Migration complete: all 10 tests pass, code-reviewer approved","dependencies":[{"issue_id":"beadhub-o7gt","depends_on_id":"beadhub-7wpr","type":"parent-child","created_at":"2026-01-10T10:55:49.775305+01:00","created_by":"juanre"}]}
{"id":"beadhub-o9h7","title":"Fix coord performance regression (role + apex)","description":"We saw a major latency regression in the coord branch after 2022c086fe4f2dbcc42b7f211b1a16e0b31e61be. bdh commands (esp. `ready`/`:who`) and server endpoints appear to have become slow.\n\nHypothesis from code review:\n- Removing client-sent `role` caused an extra Redis HGET on every presence update to â€œpreserve existing roleâ€. This adds hot-path latency to every command.\n- `/v1/workspaces` computes per-claim apex via a recursive CTE over `beads.beads_issues` for every workspace/claim. This is a read-path cost and can grow superlinearly as workspaces/claims increase.\n\nGoal:\n- Restore `role` as a short classification (1â€“2 words) stored in `.beadhub` and propagated reliably.\n- Make apex display fast at scale (many workspaces + many claims) without expensive per-request recursion.\n\nThis epic tracks the work to (1) restore role correctly and cheaply, (2) redesign apex computation/storage so workspaces listing is O(#claims) with good indexes, and (3) add perf/behavior tests to prevent regressions.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-20T13:53:17.387384+01:00","updated_at":"2025-12-21T18:01:43.042446+01:00","closed_at":"2025-12-21T18:01:43.042446+01:00","close_reason":"All work complete: role restored, apex persisted on write path, perf fixtures added"}
{"id":"beadhub-ocku","title":"Release BeadHub as OSS (v1)","description":"Prepare this repo for public open-source release. Scope: UI polish (GitHub-blue accent, logo parity), codebase hygiene (remove LLM detritus), Python tooling (black/ruff/isort/mypy + pre-push), Docker correctness, release docs (CHANGELOG/CONTRIBUTING/etc), bdh installer parity, repo hygiene (remote branches).","acceptance_criteria":"- OSS release checklist completed\n- CI/hooks prevent obvious regressions\n- Docker build+run works from clean machine\n- Docs/branding consistent","notes":"OSS release checklist complete (beadhub-ocku.1-9 closed). origin remote branches pruned to main + beads-sync; CI/hooks in place; docs+branding updated; docker verified.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-06T09:22:57.804893Z","created_by":"juanre","updated_at":"2026-01-06T14:51:08.482314Z","closed_at":"2026-01-06T14:51:08.482315Z"}
{"id":"beadhub-ocku.1","title":"Dashboard theme: switch accent from red to GitHub blue","description":"Update OSS dashboard + component library theme so the primary accent matches GitHub blue, and ensure contrast/accessibility stays OK in light/dark.","acceptance_criteria":"- Accent color updated consistently across UI\n- No hardcoded old accent remains\n- Contrast remains readable","notes":"Ready for eve-frontend to claim + close (I released claims)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T09:23:07.989329Z","created_by":"juanre","updated_at":"2026-01-06T09:41:37.963607Z","closed_at":"2026-01-06T09:41:37.963607Z","close_reason":"Closed","dependencies":[{"issue_id":"beadhub-ocku.1","depends_on_id":"beadhub-ocku","type":"parent-child","created_at":"2026-01-06T09:23:07.990112Z","created_by":"juanre"}]}
{"id":"beadhub-ocku.2","title":"Dashboard branding: use circle logo (match Cloud)","description":"Replace current top-left BD logo in OSS dashboard with the same circle logo used in Cloud.","acceptance_criteria":"- OSS top-left logo matches Cloud asset\n- No broken layout on small screens","notes":"Ready for eve-frontend to claim + close (I released claims)","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T09:23:09.993937Z","created_by":"juanre","updated_at":"2026-01-06T09:41:37.964957Z","closed_at":"2026-01-06T09:41:37.964957Z","close_reason":"Closed","dependencies":[{"issue_id":"beadhub-ocku.2","depends_on_id":"beadhub-ocku","type":"parent-child","created_at":"2026-01-06T09:23:09.994746Z","created_by":"juanre"}]}
{"id":"beadhub-ocku.3","title":"Code hygiene: remove spurious LLM comments","description":"Scan repo for stale/incorrect LLM-generated comments (e.g. 'we no longer need X') and remove or rewrite to only keep comments that explain current code.","acceptance_criteria":"- No stale 'we do not need' / TODO-after-delete comments remain\n- Remaining comments clarify existing behavior","notes":"Scanned repo for stale LLM-style comments (e.g. 'we don't need X anymore') and removed the remaining instance in tests/test_tenant_isolation.py.","status":"closed","priority":3,"issue_type":"chore","created_at":"2026-01-06T09:23:13.836026Z","created_by":"juanre","updated_at":"2026-01-06T14:47:21.438306Z","closed_at":"2026-01-06T14:47:21.438307Z","dependencies":[{"issue_id":"beadhub-ocku.3","depends_on_id":"beadhub-ocku","type":"parent-child","created_at":"2026-01-06T09:23:13.836752Z","created_by":"juanre"}]}
{"id":"beadhub-ocku.4","title":"Python tooling: add black/ruff/isort/mypy + pre-push","description":"Adopt formatting/linting/typecheck (black, ruff, isort, mypy) using the same settings as ~/prj/pgdbm. Ensure they run automatically before push (git hook or bd hooks) and/or in CI.","acceptance_criteria":"- Tools configured in pyproject/ruff.toml etc\n- One command runs all checks\n- Checks run automatically before push","notes":"Implemented Python tooling + pre-push checks: added black/isort/mypy config in pyproject, Makefile targets (check-python/fmt-python/hooks-install), hook templates in scripts/git-hooks, Python CI workflow, updated uv.lock. Reformatted codebase with black/isort/ruff; ran pytest (783 passed).","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T09:23:16.5449Z","created_by":"juanre","updated_at":"2026-01-06T12:45:01.801755Z","closed_at":"2026-01-06T12:45:01.801756Z","dependencies":[{"issue_id":"beadhub-ocku.4","depends_on_id":"beadhub-ocku","type":"parent-child","created_at":"2026-01-06T09:23:16.545615Z","created_by":"juanre"}]}
{"id":"beadhub-ocku.5","title":"Docker: verify docker-compose + Dockerfile for OSS","description":"Validate Dockerfile + docker-compose.yml from clean environment: build, start, migrations, Redis/Postgres wiring, health, basic smoke flow.","acceptance_criteria":"- docker compose up works from clean checkout\n- Docs include minimal run instructions\n- No missing env vars or broken ports","notes":"Validated docker canonical flow: \nDocker services running (.env.docker):\n  Redis:      redis://localhost:6380\n  PostgreSQL: postgresql://localhost:5433/beadhub\n  API:        http://localhost:9000/v1\n  Dashboard:  http://localhost:9000\n\nChecking health...\n  Status: ok\n    redis: ok\n    database: ok brings up postgres/redis/api on ports 5433/6380/9000; /health OK; /v1/status OK; /v1/status/stream returns 200 text/event-stream. Verified containers healthy via NAME                        IMAGE                COMMAND                  SERVICE    CREATED              STATUS                        PORTS\nbeadhub-docker-api-1        beadhub-docker-api   \"uvicorn beadhub.apiâ€¦\"   api        About a minute ago   Up About a minute (healthy)   0.0.0.0:9000-\u003e8000/tcp, [::]:9000-\u003e8000/tcp\nbeadhub-docker-postgres-1   postgres:16-alpine   \"docker-entrypoint.sâ€¦\"   postgres   About a minute ago   Up About a minute (healthy)   0.0.0.0:5433-\u003e5432/tcp, [::]:5433-\u003e5432/tcp\nbeadhub-docker-redis-1      redis:7-alpine       \"docker-entrypoint.sâ€¦\"   redis      About a minute ago   Up About a minute (healthy)   0.0.0.0:6380-\u003e6379/tcp, [::]:6380-\u003e6379/tcp.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T09:23:18.709162Z","created_by":"juanre","updated_at":"2026-01-06T14:30:06.808174Z","closed_at":"2026-01-06T14:30:06.808175Z","dependencies":[{"issue_id":"beadhub-ocku.5","depends_on_id":"beadhub-ocku","type":"parent-child","created_at":"2026-01-06T09:23:18.709933Z","created_by":"juanre"}]}
{"id":"beadhub-ocku.6","title":"Release docs: CHANGELOG + OSS repo docs","description":"Add/curate OSS release docs: CHANGELOG, CONTRIBUTING, SECURITY, CODE_OF_CONDUCT (if desired), release checklist, versioning notes.","acceptance_criteria":"- Repo has standard OSS docs\n- CHANGELOG covers first OSS release","notes":"Added OSS repo docs: CHANGELOG.md, CONTRIBUTING.md, SECURITY.md, CODE_OF_CONDUCT.md; linked from README. Verified python checks + pytest still pass.","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-06T09:23:20.538315Z","created_by":"juanre","updated_at":"2026-01-06T14:34:11.232171Z","closed_at":"2026-01-06T14:34:11.232173Z","dependencies":[{"issue_id":"beadhub-ocku.6","depends_on_id":"beadhub-ocku","type":"parent-child","created_at":"2026-01-06T09:23:20.53904Z","created_by":"juanre"}]}
{"id":"beadhub-ocku.7","title":"Fix bdh installer (match bd installer behavior)","description":"Fix/update bdh installer so it works like beads' installer at ~/prj/beadhub-all/other/beads. Ensure it installs correct binary for platform, sets permissions, verifies version, and prints next steps.","acceptance_criteria":"- Fresh machine install works\n- Matches bd installer UX/behavior\n- Clear verification step","notes":"Fixed in commit 65122ba (branch: henry). Commit message: bdh installer: match bd installer behavior","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-06T09:23:22.676385Z","created_by":"juanre","updated_at":"2026-01-06T09:38:28.468121Z","closed_at":"2026-01-06T09:37:20.343642Z","close_reason":"Implemented - installer now matches bd behavior with colors, PATH warnings, multiple binary detection, verification, macOS re-signing, and fallback install methods","dependencies":[{"issue_id":"beadhub-ocku.7","depends_on_id":"beadhub-ocku","type":"parent-child","created_at":"2026-01-06T09:23:22.677134Z","created_by":"juanre"}]}
{"id":"beadhub-ocku.8","title":"Repo hygiene: delete remote branches except main","description":"Audit remote branches and delete stale origin branches, keeping main (and any protected branches).","acceptance_criteria":"- Remote branches pruned\n- No needed branches lost","notes":"Cherry-picked origin/eve commit a697c85 into main (df63d16), then deleted remote branch eve. origin now has only main + beads-sync.","status":"closed","priority":4,"issue_type":"chore","created_at":"2026-01-06T09:23:25.051996Z","created_by":"juanre","updated_at":"2026-01-06T14:45:30.95868Z","closed_at":"2026-01-06T14:45:30.958682Z","dependencies":[{"issue_id":"beadhub-ocku.8","depends_on_id":"beadhub-ocku","type":"parent-child","created_at":"2026-01-06T09:23:25.052653Z","created_by":"juanre"}]}
{"id":"beadhub-ocku.9","title":"Pre-push/CI gate: run formatting/lint/tests before pushing","description":"Decide and implement a consistent gate: either bd hooks or git hooks + CI. Ensure Python + frontend checks run (fast subset locally, full in CI).","acceptance_criteria":"- Clear  or equivalent\n- Pre-push hook (or bd hooks) installed via single command\n- CI enforces on PR","notes":"Added unified gate: Makefile uv run ruff check .\nAll checks passed!\nuv run black --check .\nuv run isort --check-only .\nSkipped 7 files\nuv run mypy\nSuccess: no issues found in 1 source file\ncd frontend \u0026\u0026 pnpm lint \u0026\u0026 pnpm build\n\n\u003e frontend@0.0.0 lint /Users/juanre/prj/beadhub-all/beadhub/frontend\n\u003e eslint .\n\n\n/Users/juanre/prj/beadhub-all/beadhub/frontend/packages/dashboard/src/pages/ChatPage.tsx\n  601:6  warning  React Hook useCallback has a missing dependency: 'api'. Either include it or remove the dependency array  react-hooks/exhaustive-deps\n\n/Users/juanre/prj/beadhub-all/beadhub/frontend/packages/dashboard/src/pages/ClaimsPage.tsx\n  172:6  warning  React Hook useCallback has a missing dependency: 'api'. Either include it or remove the dependency array  react-hooks/exhaustive-deps\n\n/Users/juanre/prj/beadhub-all/beadhub/frontend/packages/dashboard/src/pages/EscalationsPage.tsx\n  305:6  warning  React Hook useCallback has a missing dependency: 'api'. Either include it or remove the dependency array  react-hooks/exhaustive-deps\n\n/Users/juanre/prj/beadhub-all/beadhub/frontend/packages/dashboard/src/pages/MessagesPage.tsx\n  365:6  warning  React Hook useCallback has a missing dependency: 'api'. Either include it or remove the dependency array  react-hooks/exhaustive-deps\n\n/Users/juanre/prj/beadhub-all/beadhub/frontend/packages/dashboard/src/pages/WorkspacesPage.tsx\n  327:6  warning  React Hook useCallback has a missing dependency: 'api'. Either include it or remove the dependency array  react-hooks/exhaustive-deps\n\nâœ– 5 problems (0 errors, 5 warnings)\n\n\n\u003e frontend@0.0.0 build /Users/juanre/prj/beadhub-all/beadhub/frontend\n\u003e tsc -b \u0026\u0026 vite build\n\nvite v7.2.7 building client environment for production...\ntransforming...\nâœ“ 2102 modules transformed.\nrendering chunks...\ncomputing gzip size...\ndist/index.html                   0.73 kB â”‚ gzip:   0.47 kB\ndist/assets/index-DPBcU8jF.css   68.26 kB â”‚ gzip:  10.89 kB\ndist/assets/index-D-nMpZ5Z.js   679.33 kB â”‚ gzip: 202.60 kB\nâœ“ built in 1.32s\ncd bdh \u0026\u0026 go test ./...\n?   \tgithub.com/beadhub/bdh/cmd/bdh\t[no test files]\nok  \tgithub.com/beadhub/bdh/internal/bd\t(cached)\nok  \tgithub.com/beadhub/bdh/internal/beads\t(cached)\nok  \tgithub.com/beadhub/bdh/internal/client\t(cached)\nok  \tgithub.com/beadhub/bdh/internal/commands\t(cached)\nok  \tgithub.com/beadhub/bdh/internal/config\t(cached)\nok  \tgithub.com/beadhub/bdh/internal/sync\t(cached) runs python+frontend+bdh; added frontend CI workflow; repo pre-push hook now runs python checks and (if frontend/node_modules exists) frontend lint/build. Fixed eslint noise: ignore **/dist/**, disable overly strict fast-refresh and set-state-in-effect rules; fixed dashboard PageProps type; hardened useSSE reconnect timer.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T09:23:30.709823Z","created_by":"juanre","updated_at":"2026-01-06T14:39:12.261008Z","closed_at":"2026-01-06T14:38:52.017314Z","dependencies":[{"issue_id":"beadhub-ocku.9","depends_on_id":"beadhub-ocku","type":"parent-child","created_at":"2026-01-06T09:23:30.710479Z","created_by":"juanre"},{"issue_id":"beadhub-ocku.9","depends_on_id":"beadhub-ocku.4","type":"blocks","created_at":"2026-01-06T09:23:51.707396Z","created_by":"juanre"},{"issue_id":"beadhub-ocku.9","depends_on_id":"beadhub-ocku.5","type":"blocks","created_at":"2026-01-06T09:23:51.841036Z","created_by":"juanre"},{"issue_id":"beadhub-ocku.9","depends_on_id":"beadhub-ocku.6","type":"blocks","created_at":"2026-01-06T09:23:51.979623Z","created_by":"juanre"},{"issue_id":"beadhub-ocku.9","depends_on_id":"beadhub-ocku.7","type":"blocks","created_at":"2026-01-06T09:23:52.115097Z","created_by":"juanre"}]}
{"id":"beadhub-oidr","title":"Security: require X-Project-ID for /v1/workspaces when auth enabled","description":"Harden `/v1/workspaces` registry endpoint to prevent cross-project leakage when auth is enabled (Cloud and OSS-with-API-key).\n\nProblem\n- In OSS auth-disabled mode, `/v1/workspaces` can return a full registry, including `project_id` values for multiple projects.\n- In Cloud, tenant isolation relies on `X-Project-ID` injected by middleware. If OSS is ever reachable directly (misconfig) or if auth is enabled without strict scoping, `/v1/workspaces` can become a cross-project data leak.\n\nGoal\n- Align implementation with `security-patterns.md`:\n  - When auth is enabled (Cloud or OSS with API key), require `X-Project-ID` for tenant scoping and do not allow unscoped registry listing.\n\nProposed changes\n- In `src/beadhub/routes/workspaces.py` (`GET /v1/workspaces`):\n  - If auth is enabled and `X-Project-ID` is missing: return 400/403 with a clear error.\n  - If auth is enabled and `project_slug` (or any project selector query param) is provided: reject (403) rather than using it.\n  - Ensure response never includes workspaces from other projects when auth is enabled.\n\nTests\n- Add integration tests:\n  - Auth enabled + missing X-Project-ID =\u003e rejected\n  - Auth enabled + X-Project-ID =\u003e scoped results only\n  - Auth enabled + project_slug param =\u003e rejected\n\nNotes\n- Cloud relies on middleware to overwrite/strip client headers; this bead is defense-in-depth in OSS.\n- Consider similar hardening for `/v1/workspaces/team` if it currently accepts `project_slug` in auth-enabled mode.\n\nReferences\n- ../beadhub-sot/source-of-truth/security-patterns.md\n- ../beadhub-sot/source-of-truth/beadhub-specifications.md (tenant isolation notes)\n","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-02T16:04:52.959474Z","created_by":"juanre","updated_at":"2026-01-02T17:50:44.843086Z","closed_at":"2026-01-02T17:50:44.843086Z","close_reason":"Implemented auth checks requiring X-Project-ID header for /v1/workspaces endpoints when auth enabled. Go CLI updated to send header. All tests passing. Merged to main.","dependencies":[{"issue_id":"beadhub-oidr","depends_on_id":"beadhub-1tqa","type":"discovered-from","created_at":"2026-01-02T16:04:52.962334Z","created_by":"juanre"}]}
{"id":"beadhub-ojhx","title":"Add workspace-project ownership validation in bdh_command","description":"In src/beadhub/routes/bdh.py bdh_command(), there's no check that workspace_id belongs to the claimed project_id. A workspace registered in project A could send commands claiming project_id=B. Add verify_workspace_ownership() similar to get_or_verify_repo_id() security check.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T10:50:07.060861+01:00","updated_at":"2025-12-13T16:37:20.284372+01:00","closed_at":"2025-12-13T16:37:20.284372+01:00"}
{"id":"beadhub-on08","title":"Policy history items not expandable/previewable","description":"Problem\n- In `frontend/src/pages/PoliciesPage.tsx`, the History tab lists versions but users cannot preview what changes are in an older version before activating it.\n\nGoal\n- Allow previewing any historical policy version (bundle content) without activating it.\n\nProposed approach\n1) Backend: add a read endpoint for a specific policy version:\n   - `GET /v1/policies/{policy_id}`\n   - Requires `X-Project-ID` (tenant isolation)\n   - Must validate the policy belongs to the project (reject cross-project)\n   - Response should include the same bundle shape as active (policy_id, project_id, version, updated_at, invariants, roles, adapters).\n   - Optional: support `?role=` and `?only_selected=true` like `/active`.\n   - Add integration tests for: happy path, missing X-Project-ID, cross-project rejection.\n\n2) Frontend: make History items expandable and show a preview panel:\n   - Clicking a version expands it and fetches its bundle via the new endpoint\n   - Show invariants + roles (use the markdown renderer from beadhub-zjyv)\n   - Keep \"Activate\" available for non-active versions (but see beadhub-9gca for confirmation)\n\nFiles\n- Backend: `src/beadhub/routes/policies.py`, `tests/test_policies.py`\n- Frontend: `frontend/src/pages/PoliciesPage.tsx`, `frontend/src/lib/api.ts`\n\nNotes\n- Keep all requests project-scoped (no project_slug selectors).\n- Avoid fetching all bundles in the history list response (load-on-expand for performance).","acceptance_criteria":"- A user can click a history version and preview its invariants + roles without activating it.\n- Preview loads on demand and shows a clear loading/error state.\n- Cross-project policy IDs cannot be fetched (server rejects).\n- Tests cover the new backend read endpoint.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T18:45:19.212694Z","created_by":"juanre","updated_at":"2026-01-02T21:45:28.514778Z","closed_at":"2026-01-02T21:45:28.514778Z","close_reason":"Completed: backend GET /v1/policies/{policy_id} + dashboard expandable history preview + markdown rendering","dependencies":[{"issue_id":"beadhub-on08","depends_on_id":"beadhub-1tqa","type":"discovered-from","created_at":"2026-01-02T18:45:19.214751Z","created_by":"juanre"}]}
{"id":"beadhub-on08.1","title":"Frontend: expandable policy history preview","description":"Add an expandable preview for policy history items in the dashboard so users can inspect older versions before activation.\n\nUI\n- In History tab (frontend/src/pages/PoliciesPage.tsx), clicking a version row expands it to show invariants + roles content for that version.\n- Fetch bundle on-demand via backend endpoint from beadhub-v5e9 (GET /v1/policies/{policy_id}).\n- Use markdown renderer from beadhub-zjyv for body_md/playbook_md.\n- Provide loading/error states per expanded item.\n\nNotes\n- Keep Activate button available, but it should use confirmation from beadhub-9gca.","acceptance_criteria":"- Clicking a history item expands it and shows a preview of that policy version without activating it.\n- Preview fetch is lazy and shows a visible loading indicator.\n- Preview shows rendered markdown (not raw).\n- Works for multiple versions and collapse/expand toggles cleanly.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T21:12:46.925452Z","created_by":"juanre","updated_at":"2026-01-02T21:22:56.268897Z","closed_at":"2026-01-02T21:22:56.268897Z","close_reason":"Implemented expandable history preview: HistoryItem now expands on click, lazy-fetches policy via GET /v1/policies/{policy_id}, shows invariants/roles with rendered markdown, includes loading/error states. Build and tests pass.","dependencies":[{"issue_id":"beadhub-on08.1","depends_on_id":"beadhub-on08","type":"parent-child","created_at":"2026-01-02T21:12:46.926405Z","created_by":"juanre"},{"issue_id":"beadhub-on08.1","depends_on_id":"beadhub-on08","type":"discovered-from","created_at":"2026-01-02T21:12:46.927818Z","created_by":"juanre"}]}
{"id":"beadhub-opqt","title":"Security follow-ups from SECURITY_REVIEW_2026-01","description":"## Context\nA non-SOT security review (now stored at `../beadhub-sot/history/SECURITY_REVIEW_2026-01.md`) calls out several remaining security hardening items across:\n- `beadhub` (OSS core)\n- `beadhub-cloud` (Cloud wrapper)\n- `aweb` (protocol implementation)\n\nWe already completed the Cloud mount security epic (`beadhub-ab1g`) and shipped policy changes:\n- Cloud blocks `/api/v1/init`\n- Cloud governs `Authorization: Bearer aw_sk_*` by requiring the project exist in SaaS tables\n- Human principals cannot do bead ops via `/api`\n- Prefer `BEADHUB_INTERNAL_AUTH_SECRET` for internal signatures\n\nThis epic captures the remaining findings that are still relevant.\n\n## Acceptance\n- Any remaining P0 findings are either fixed with tests or explicitly dismissed with rationale in SOT.\n- Changes preserve the Cloudâ†”OSS trust boundary and tenant isolation model.\n","status":"closed","priority":0,"issue_type":"epic","owner":"juan@juanreyero.com","created_at":"2026-01-25T17:30:06.123006+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T18:01:56.935726+01:00","closed_at":"2026-01-25T18:01:56.935726+01:00","close_reason":"Implemented P0/P1 security follow-ups; left P2 timing oracle decision","dependencies":[{"issue_id":"beadhub-opqt","depends_on_id":"beadhub-ab1g","type":"discovered-from","created_at":"2026-01-25T17:30:06.124538+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-opqt.1","title":"beadhub: remove or guard cross-project workspace query fallback","description":"## Finding\n`src/beadhub/routes/status.py` exposes helper queries that accept `project_id: Optional[str]` and, when `None`, query workspaces across *all* projects:\n- `get_all_workspace_ids_from_db(..., project_id=None)`\n- `get_workspace_ids_by_repo_from_db(..., project_id=None)`\n- `get_workspace_ids_by_repo_id_from_db(..., project_id=None)`\n- `get_workspace_ids_by_human_name_from_db(..., project_id=None)`\n\nToday, the public routes always pass an authenticated `project_id`, but these helpers are an easy future footgun.\n\n## Change\nPick one:\n- Require `project_id` for these helpers and delete the global-scan branch, or\n- Move global-scan behavior to a separate internal-only function with explicit auth checks.\n\nAdd/adjust tests to ensure all public status endpoints are project-scoped.\n","status":"closed","priority":0,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-25T17:30:25.315057+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T17:39:50.252103+01:00","closed_at":"2026-01-25T17:39:50.252103+01:00","close_reason":"Require project_id for status workspace queries (no global fallback)","dependencies":[{"issue_id":"beadhub-opqt.1","depends_on_id":"beadhub-opqt","type":"parent-child","created_at":"2026-01-25T17:30:25.316173+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-opqt.2","title":"aweb: /v1/auth/introspect must scope agent lookup to project","description":"## Finding\nIn `../aweb/src/aweb/routes/auth.py`, the `/v1/auth/introspect` endpoint enriches with agent fields by `agent_id` only. It should ensure the agent belongs to the authenticated project.\n\n## Change\n- Add `AND project_id = $2` to the agent lookup.\n- Add a regression test in aweb to ensure cross-project agent metadata is never returned.\n","status":"closed","priority":0,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-25T17:30:35.757264+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T17:57:04.708301+01:00","closed_at":"2026-01-25T17:57:04.708301+01:00","close_reason":"Introspect agent enrichment now project-scoped; added regression test","dependencies":[{"issue_id":"beadhub-opqt.2","depends_on_id":"beadhub-opqt","type":"parent-child","created_at":"2026-01-25T17:30:35.758271+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-opqt.3","title":"beadhub-cloud: avoid reading candidate_project_id from stripped headers","description":"## Finding\n`../beadhub-cloud/backend/src/beadhub_cloud/middleware/auth_bridge.py` reads `candidate_project_id` from `request.headers.get('X-Project-ID')` before stripping untrusted headers. Even if currently safe, this is confusing and risks future TOCTOU mistakes.\n\n## Change\n- Strip internal headers first.\n- Source `candidate_project_id` only from safe inputs (query param `project_id`, or Cloud-owned routes/path params), not from `X-Project-ID`.\n- Add/adjust tests asserting that a client-supplied `X-Project-ID` is ignored.\n","status":"closed","priority":0,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-25T17:30:46.200408+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T17:42:41.866735+01:00","closed_at":"2026-01-25T17:42:41.866735+01:00","close_reason":"Auth bridge only uses project_id query param (not X-Project-ID header)","dependencies":[{"issue_id":"beadhub-opqt.3","depends_on_id":"beadhub-opqt","type":"parent-child","created_at":"2026-01-25T17:30:46.201535+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-opqt.4","title":"aweb: include project_id in agent/session lookups (reduce timing leaks)","description":"## Finding\nSeveral aweb endpoints fetch by id then check `project_id` in Python, which can leak existence via timing differences:\n- `../aweb/src/aweb/routes/chat.py` (`_get_agent_by_id`, and session queries)\n- `../aweb/src/aweb/routes/reservations.py` agent lookups\n\n## Change\n- Push project scoping into SQL WHERE clauses (`... WHERE agent_id = $1 AND project_id = $2`).\n- Ensure error responses remain identical for \"not found\" vs \"wrong project\".\n- Add/adjust cross-project isolation tests.\n","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-25T17:30:56.632497+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T17:58:58.554309+01:00","closed_at":"2026-01-25T17:58:58.554309+01:00","close_reason":"aweb: push project_id into agent/session lookups (reduce timing leaks)","dependencies":[{"issue_id":"beadhub-opqt.4","depends_on_id":"beadhub-opqt","type":"parent-child","created_at":"2026-01-25T17:30:56.633557+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-opqt.5","title":"beadhub: warn when X-BH-Auth present but internal auth secret missing","description":"## Finding\n`src/beadhub/internal_auth.py` ignores proxy headers when `BEADHUB_INTERNAL_AUTH_SECRET` is unset (OSS mode). In a misconfigured Cloud deployment, this could silently change the effective auth mode.\n\n## Change\n- When `X-BH-Auth` is present but no internal auth secret is configured, log a clear warning (and optionally include request path).\n- Keep behavior safe-by-default for OSS (do not start trusting headers).\n\n## Acceptance\n- Adds observability without changing auth semantics in OSS.\n","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-25T17:31:07.078922+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T18:00:43.187231+01:00","closed_at":"2026-01-25T18:00:43.187231+01:00","close_reason":"Warn when X-BH-Auth present but internal auth secret unset (misconfig visibility)","dependencies":[{"issue_id":"beadhub-opqt.5","depends_on_id":"beadhub-opqt","type":"parent-child","created_at":"2026-01-25T17:31:07.079903+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-opqt.6","title":"aweb: consider mitigating API key prefix timing oracle","description":"## Finding\n`../aweb/src/aweb/auth.py` rejects missing key_prefix quickly (no bcrypt) but rejects existing prefixes slowly (bcrypt), which can leak valid prefixes via timing.\n\n## Discussion\nMitigations (trade-offs):\n- Dummy bcrypt on missing prefixes (reduces oracle, increases CPU DoS surface)\n- Replace bcrypt with a fast hash + server-side pepper/HMAC (bigger change)\n- Accept risk + rely on rate limiting (prefix space may be large enough in practice)\n\n## Acceptance\n- Decide on stance (mitigate vs accept) and document in SOT.\n- If mitigating, add tests/benchmarks to ensure we don't create an easy DoS vector.\n","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-25T17:31:26.28637+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T18:53:42.762129+01:00","closed_at":"2026-01-25T18:53:42.762129+01:00","close_reason":"Decision: remove prefix lookup; verify aweb keys via full-key SHA-256 lookup","dependencies":[{"issue_id":"beadhub-opqt.6","depends_on_id":"beadhub-qnp0","type":"parent-child","created_at":"2026-01-25T18:03:02.658362+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-oqag","title":"Pre-existing test failure: TestAgentPresenceIndexing::test_agent_with_repo_id_appears_in_status_query","status":"closed","priority":2,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-01-16T09:53:04.900279+01:00","created_by":"Juan Reyero","updated_at":"2026-01-16T10:52:17.857635+01:00","closed_at":"2026-01-16T10:52:17.857635+01:00","close_reason":"Fixed. Status endpoint now uses Redis indexes for repo_id lookup in OSS mode.","dependencies":[{"issue_id":"beadhub-oqag","depends_on_id":"beadhub-v2kg.3","type":"discovered-from","created_at":"2026-01-16T09:53:04.901162+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-oqdq","title":"Remove current_bead references from status.py and mcp.py","description":"status.py:85 and mcp.py:267,310 still read 'current_bead' from Redis presence, but that field was removed in beadhub-21z4. These now return None/empty. The code should either be removed or replaced with proper claims fetching from the database.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-20T10:44:01.153919+01:00","updated_at":"2025-12-20T11:31:46.301075+01:00","closed_at":"2025-12-20T11:31:46.301075+01:00","close_reason":"Removed current_bead from presence (now fetched from bead_claims table in Postgres). Updated status.py, mcp.py, presence.py, and source-of-truth docs."}
{"id":"beadhub-orae","title":"Rename chat context 'MESSAGES' to mail-first cues (MAILS + WAITING only)","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-04T18:34:10.593103Z","created_by":"juanre","updated_at":"2026-01-04T18:35:51.57696Z","closed_at":"2026-01-04T18:35:51.57696Z","close_reason":"Remove confusing chat 'MESSAGES:' context; show only WAITING and MAILS when unread"}
{"id":"beadhub-orq","title":"Inconsistent error handling - catches all exceptions, masks bugs, leaks info","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-03T15:38:50.035508+01:00","updated_at":"2025-12-03T18:00:18.509966+01:00","closed_at":"2025-12-03T18:00:18.509966+01:00"}
{"id":"beadhub-ous3","title":"Reorder sidebar navigation by usage frequency","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T22:46:45.165753+01:00","created_by":"juanre","updated_at":"2026-01-09T22:54:15.843955+01:00","closed_at":"2026-01-09T22:54:15.843955+01:00","close_reason":"Implemented sidebar reorder and separators"}
{"id":"beadhub-owol","title":"SOT - Update Specifications","description":"Remove /reservations endpoints from beadhub-specifications.md. Update Redis section in beadhub-architecture.md.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-12T17:56:52.82803+01:00","updated_at":"2025-12-12T17:56:52.82803+01:00"}
{"id":"beadhub-ox8","title":"Cross-repo dependency resolution","description":"Parse blocked_by references like other-repo:bead-id.\nResolve cross-repo blockers when computing ready issues.\nUpdate bd ready to show cross-repo blocking info.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-03T09:15:08.189458+01:00","updated_at":"2025-12-03T18:39:25.650717+01:00","closed_at":"2025-12-03T18:39:25.650717+01:00","dependencies":[{"issue_id":"beadhub-ox8","depends_on_id":"beadhub-5gz","type":"blocks","created_at":"2025-12-03T09:15:17.085304+01:00","created_by":"juanre"}]}
{"id":"beadhub-ox8v","title":"Add metrics/logging for auto-cleanup","description":"Auto-cleanup has no observability. Add structured logging: 'Scanned N workspaces, deleted M stale ones'. Consider Prometheus metrics for tracking cleanup rate, success/failure counts, repos with high churn.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-17T08:02:06.59435+01:00","updated_at":"2025-12-17T18:57:57.242056+01:00","closed_at":"2025-12-17T18:57:57.242056+01:00","close_reason":"Won't fix: auto-cleanup feature removed - worktree-based detection doesn't work across machines","dependencies":[{"issue_id":"beadhub-ox8v","depends_on_id":"beadhub-lmtj","type":"discovered-from","created_at":"2025-12-17T08:02:06.595948+01:00","created_by":"juanre"}]}
{"id":"beadhub-oy60","title":"bdh Go security hardening from code review","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-06T09:23:44.961298Z","created_by":"juanre","updated_at":"2026-01-06T10:14:32.377237Z","closed_at":"2026-01-06T10:14:32.377237Z","close_reason":"All 5 security issues complete: P0 (confirmation flag), P1s (fail-closed, config requirements), P2s (path validation, test coverage)."}
{"id":"beadhub-p02w","title":"Add issue detail drawer for bead_id click","description":"Make bead_id clickable in Issues and Claims pages. Opens slide-out drawer showing full issue: title, description, status, priority, type, blockers, labels. Fetches from /v1/beads/issues/{bead_id} endpoint.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-13T12:14:58.04844+01:00","updated_at":"2025-12-13T13:39:03.88474+01:00","closed_at":"2025-12-13T13:39:03.88474+01:00","dependencies":[{"issue_id":"beadhub-p02w","depends_on_id":"beadhub-ewtl","type":"blocks","created_at":"2025-12-13T13:08:44.567014+01:00","created_by":"juanre"}]}
{"id":"beadhub-p17c","title":"Restore mail functionality for async-first agent communication","description":"Mail was hidden in favor of chat, but they serve different purposes. Chat is synchronous (real-time Q\u0026A), mail is async-first with structured content (subject, body, priority, threads, read/ack). Both should coexist. This epic restores mail to bdh CLI and documentation.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-15T17:39:53.364041+01:00","updated_at":"2025-12-15T17:53:10.767579+01:00","closed_at":"2025-12-15T17:53:10.767579+01:00"}
{"id":"beadhub-p1eg","title":"Implement --:jump-in flag for coordinated multi-agent work","description":"New bdh flag that: 1) Strips itself before passing to bd 2) Runs command despite existing claim 3) REQUIRES a message argument explaining why joining 4) Sends notification to other agent(s) 5) Creates additional claim in database. Syntax: bdh update bd-42 --status in_progress --:jump-in \"I'll handle the tests\"","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-13T11:27:33.820552+01:00","updated_at":"2025-12-13T12:00:24.158078+01:00","closed_at":"2025-12-13T12:00:24.158078+01:00","dependencies":[{"issue_id":"beadhub-p1eg","depends_on_id":"beadhub-3r30","type":"parent-child","created_at":"2025-12-13T11:28:13.131436+01:00","created_by":"juanre"},{"issue_id":"beadhub-p1eg","depends_on_id":"beadhub-wj6x","type":"blocks","created_at":"2025-12-13T11:28:17.259711+01:00","created_by":"juanre"}]}
{"id":"beadhub-p2ha","title":"Unify auth model: Bearer project keys everywhere; remove OSS admin key + project_id plumbing","description":"# Epic: Unify Auth Model (OSS + Cloud-Embedded)\n\nCanonical spec: `docs/specs/auth-model.md`\n\n## Decisions (Confirmed)\n\n- **Delete** `GET /v1/beads/issues/all` (no cross-project aggregation endpoint).\n- **One project per key**: clients never provide or choose `project_id`; project scope is derived server-side from the API key (or Cloud internal context).\n\n## Why Weâ€™re Doing This\n\nWe currently have multiple â€œmodesâ€ that are easy to misconfigure:\n\n- `BEADHUB_API_KEY` is overloaded (sometimes â€œserver admin keyâ€, sometimes â€œproject API keyâ€).\n- Clients can send `X-Project-ID` and/or store `project_id` in `.beadhub`, which is a footgun and complicates security reasoning.\n- Browser SSE (`EventSource`) canâ€™t send custom headers, so â€œadmin key via X-API-Keyâ€ breaks the dashboard stream unless auth is disabled.\n\nEven for private/protected deployments, shipping confusing/partial security makes it too easy to end up accidentally insecure or broken.\n\n## Target End State (High Level)\n\n- **Public clients (bdh, dashboard, scripts)**:\n  - Authenticate with `Authorization: Bearer \u003cbh_sk_...\u003e` on every request.\n  - Store the key in `.env` as `BEADHUB_API_KEY` (client-side meaning only).\n  - Never send `X-Project-ID`; never persist `project_id` in `.beadhub`.\n- **OSS server**:\n  - Requires a project context for all project-scoped endpoints.\n  - Derives `project_id` from the Bearer token by looking up `api_keys` in the DB.\n  - Does not support â€œserver admin keyâ€ (`BEADHUB_API_KEY` + `X-API-Key`) as a separate auth scheme.\n- **Cloud embedding (`../beadhub-cloud`)**:\n  - Cloud terminates public auth and injects a signed internal context.\n  - OSS validates internal context using `BEADHUB_INTERNAL_AUTH_SECRET` or `SESSION_SECRET_KEY`.\n\n## Work Breakdown (Child Issues)\n\n- Server auth + scoping changes (`beadhub-wzyo`)\n- Delete `/v1/beads/issues/all` (`beadhub-wzyo.1`)\n- CLI config/request cleanup (`beadhub-q3rs`)\n- Dashboard auth + SSE + remove project selection (`beadhub-8d0q`, `beadhub-p2ha.1`)\n- Docs updates (deployment/dev + client config) (`beadhub-vfoc`)\n- Test suite migration away from `X-Project-ID` assumptions (`beadhub-p2ha.2`)\n\n","acceptance_criteria":"- Spec: docs/specs/auth-model.md is source of truth\n- No public X-Project-ID or X-API-Key auth paths\n- One project per key; /v1/beads/issues/all removed","status":"closed","priority":0,"issue_type":"epic","owner":"juan@juanreyero.com","created_at":"2026-01-17T19:14:35.374582+01:00","created_by":"Juan Reyero","updated_at":"2026-01-18T14:06:22.777921+01:00","closed_at":"2026-01-18T14:06:22.777921+01:00","close_reason":"All child tasks completed: single auth model (Bearer project keys), no public X-Project-ID/X-API-Key paths, /v1/beads/issues/all removed, CLI+dashboard+docs+tests updated accordingly."}
{"id":"beadhub-p2ha.1","title":"Dashboard: remove project_id scoping; rely on auth-derived project","description":"Dashboard: remove project_id scoping and project selection; assume one project per key.","design":"Spec: docs/specs/auth-model.md\\n\\nImplementation notes:\\n- Delete any client-side 'projectId' state, URL params, or localStorage entries used to scope API calls.\\n- Replace /v1/beads/issues/all usage with /v1/beads/issues.\\n- Remove X-Project-ID header wiring.","acceptance_criteria":"- No project_id is required or stored client-side\\n- Dashboard uses only the API key to scope data\\n- All calls succeed without X-Project-ID","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-17T20:44:55.611006+01:00","created_by":"Juan Reyero","updated_at":"2026-01-18T14:06:06.58228+01:00","closed_at":"2026-01-18T14:06:06.58228+01:00","close_reason":"Dashboard no longer stores/selects project_id; assumes one project per key and relies on auth-derived project scoping.","dependencies":[{"issue_id":"beadhub-p2ha.1","depends_on_id":"beadhub-p2ha","type":"parent-child","created_at":"2026-01-17T20:44:55.611623+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-p2ha.2","title":"Tests: migrate Python suite from X-Project-ID/is_auth_enabled to auth-derived project context","description":"Tests: migrate Python suite from X-Project-ID/is_auth_enabled assumptions to auth-derived project context (Bearer or internal).","design":"Spec: docs/specs/auth-model.md\\n\\nMigration approach:\\n- Replace any test that sets X-Project-ID with a helper that calls POST /v1/init to obtain {api_key, project_id, workspace_id}.\\n- Use Authorization: Bearer \u003capi_key\u003e on subsequent requests.\\n- Remove assertions around 'auth enabled/disabled' toggles and 'missing X-Project-ID'.\\n- Replace /v1/beads/issues/all usages with /v1/beads/issues.\\n- Keep a small set of targeted tests for Cloud internal auth header validation (X-BH-Auth) if needed.","acceptance_criteria":"- uv run pytest passes\\n- No tests reference X-Project-ID as public input\\n- No tests reference /v1/beads/issues/all","status":"closed","priority":0,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-17T20:52:03.980278+01:00","created_by":"Juan Reyero","updated_at":"2026-01-18T14:06:04.264163+01:00","closed_at":"2026-01-18T14:06:04.264163+01:00","close_reason":"Test suite migrated to auth-derived project context: no public X-Project-ID / is_auth_enabled assumptions; pytest passes.","dependencies":[{"issue_id":"beadhub-p2ha.2","depends_on_id":"beadhub-p2ha","type":"parent-child","created_at":"2026-01-17T20:52:03.980863+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-p2pe","title":"Fix Chat page badge showing inbox count instead of pending chats","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T23:12:06.027793+01:00","updated_at":"2025-12-13T23:12:11.588503+01:00","closed_at":"2025-12-13T23:12:11.588503+01:00"}
{"id":"beadhub-p34h","title":"Remove inbox server code (after mcp-agent-mail compatibility decision)","description":"Remove inbox routes and database tables from the server. Blocked on decision about mcp-agent-mail compatibility. May keep the API if we want to support external mail protocols.","status":"open","priority":4,"issue_type":"chore","created_at":"2025-12-14T17:29:09.284851+01:00","updated_at":"2025-12-14T17:29:09.284851+01:00"}
{"id":"beadhub-p4i","title":"Update pyproject.toml for beadhub-cloud","description":"Update package name to beadhub-cloud, add beadhub as dependency, update description and metadata. Remove llmring-server dependency, add beadhub dependency instead.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-03T08:21:01.122682+01:00","updated_at":"2025-12-03T08:31:15.619453+01:00","closed_at":"2025-12-03T08:31:15.619453+01:00","close_reason":"Updated pyproject.toml: name=beadhub-cloud, added beadhub dependency, updated scripts","dependencies":[{"issue_id":"beadhub-p4i","depends_on_id":"beadhub-dl7","type":"blocks","created_at":"2025-12-03T08:21:07.984373+01:00","created_by":"juanre"}]}
{"id":"beadhub-p894","title":"Server: simplify /v1/workspaces to avoid recursive apex CTE (use stored apex refs)","description":"`GET /v1/workspaces` currently computes apex for every claim via a recursive CTE over `beads.beads_issues`. This is expensive on the read path and likely the main scalability issue.\n\nChange `/v1/workspaces` to:\n- Fetch workspaces from DB (as today).\n- Fetch claims for those workspaces in one query, using stored apex reference fields from `server.bead_claims`.\n- Attach apex title/type via a cheap lateral join to `beads.beads_issues` (using existing indexes), or return NULL if missing.\n- Remove the recursive `WITH RECURSIVE apex_chain` entirely.\n\nImplementation outline:\n1) Replace the recursive CTE in `src/beadhub/routes/workspaces.py` with:\n   - a simple claims query: claim bead id/title + claimed_at + apex_bead_id.\n   - a lateral join to get `apex_title/apex_type` from `beads_issues` for the apex bead.\n2) Ensure behavior matches current API shape (Claim.apex_id/apex_title/apex_type).\n3) Add tests that validate:\n   - output unchanged for cases where apex was previously computed\n   - performance sanity: query count / explain plan doesnâ€™t include recursion.\n\nStretch:\n- Add `include_claims=false` or pagination if needed for very large workspaces lists (coordinate with existing pagination bead beadhub-6bl).","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-20T13:55:47.971428+01:00","updated_at":"2025-12-20T15:29:19.935565+01:00","closed_at":"2025-12-20T15:29:19.935565+01:00","close_reason":"Removed recursive apex CTE from /v1/workspaces; use stored apex refs with lateral joins","dependencies":[{"issue_id":"beadhub-p894","depends_on_id":"beadhub-o9h7","type":"parent-child","created_at":"2025-12-20T13:55:47.973404+01:00","created_by":"juanre"},{"issue_id":"beadhub-p894","depends_on_id":"beadhub-7re8","type":"blocks","created_at":"2025-12-20T13:55:47.974152+01:00","created_by":"juanre"},{"issue_id":"beadhub-p894","depends_on_id":"beadhub-3uyz","type":"blocks","created_at":"2025-12-20T13:55:47.974753+01:00","created_by":"juanre"}]}
{"id":"beadhub-p8vv","title":"Update AGENTS-template.md with mail-first guidance","description":"Update docs/AGENTS-template.md (which becomes project CLAUDE.md) with:\n\n1. Mail-first philosophy: async communication is default\n2. Chat is for urgent/blocking situations only\n3. Checkpoint discipline: check mail at bdh ready and bdh close\n4. When to use mail vs chat (decision matrix)\n5. How to notify related agents when finishing work\n\nKey messages:\n- Mail lets you focus; chat interrupts\n- Check inbox when starting and finishing beads\n- Use chat only when you need an answer NOW to proceed","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T18:23:23.073265+01:00","updated_at":"2025-12-15T18:39:49.482555+01:00","closed_at":"2025-12-15T18:39:49.482555+01:00","dependencies":[{"issue_id":"beadhub-p8vv","depends_on_id":"beadhub-fei6","type":"blocks","created_at":"2025-12-15T18:23:29.115186+01:00","created_by":"juanre"}]}
{"id":"beadhub-p9h","title":"Add rate limiting to authentication endpoints","description":"beadhub auth.py lacks rate limiting, allowing unlimited brute force attempts against API keys. Add Redis-backed throttling per IP.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T22:17:23.239362+01:00","updated_at":"2025-12-08T08:34:25.658724+01:00","closed_at":"2025-12-08T08:34:25.658724+01:00"}
{"id":"beadhub-pfcd","title":"bdh cleanup: remove unused context helpers and de-duplicate passthrough/server context formatting","description":"bdh/internal/commands/context.go has FetchServerContextWithMessages which is unused, and passthrough output duplicates chat/message notifications already implemented there. Either wire passthrough to reuse the shared helpers or remove dead code to keep the surface area small.","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-12-13T12:52:31.138599+01:00","updated_at":"2025-12-20T09:24:25.342577+01:00","closed_at":"2025-12-20T09:24:25.342577+01:00","close_reason":"Removed unused FetchServerContextWithMessages, extracted FormatWaitingNotification helper to deduplicate WAITING notification formatting between context.go and passthrough.go","dependencies":[{"issue_id":"beadhub-pfcd","depends_on_id":"beadhub-t265","type":"discovered-from","created_at":"2025-12-13T12:52:31.139777+01:00","created_by":"juanre"}]}
{"id":"beadhub-pg3t","title":"Add frontend testing infrastructure (vitest)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T11:01:02.014104+01:00","updated_at":"2025-12-13T15:28:27.705753+01:00","closed_at":"2025-12-13T14:28:07.645022+01:00"}
{"id":"beadhub-ph9l","title":"Fix race condition in concurrent chat session creation","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T14:50:12.889328+01:00","updated_at":"2025-12-13T14:53:18.97982+01:00","closed_at":"2025-12-13T14:53:18.97982+01:00"}
{"id":"beadhub-phyh","title":"Subscriptions: bead watchers + notifications (v1)","description":"Make BeadHub subscriptions (â€˜watch a beadâ€™) a real end-to-end feature.\n\nCurrent state:\n- Subscriptions table/REST endpoints exist, but schema/code semantics are inconsistent (tracked in beadhub-3sl6.2).\n- Notification outbox exists and is wired only to /v1/beads/upload*, not the main bdh-driven sync path.\n- Notifications currently appear as self-sent inbox messages (from_workspace == to_workspace), which is confusing.\n- No user-facing UX: no bdh command to manage subscriptions and no dashboard UI.\n\nTarget UX:\n- Agent/human can subscribe/unsubscribe to a beadâ€™s status changes.\n- When Beads state changes via normal bdh usage, subscribers receive a notification.\n- Notifications have a clear system sender identity.\n- bdh CLI + dashboard provide a simple interface to manage subscriptions.","acceptance_criteria":"- A workspace can subscribe/unsubscribe and list its subscriptions via bdh.\n- When a beadâ€™s status changes via bdh update/close (sync), subscribers receive a notification.\n- Notification sender identity is not confusing (no â€˜from myselfâ€™ workaround).\n- Minimal dashboard UI exists to view/toggle subscriptions.\n- Tests cover the subscription + delivery path.","status":"open","priority":3,"issue_type":"epic","created_at":"2026-01-07T06:52:09.526551Z","created_by":"juanre","updated_at":"2026-01-13T22:42:14.885757+01:00","labels":["component:notifications","phase:oss"],"dependencies":[{"issue_id":"beadhub-phyh","depends_on_id":"beadhub-3sl6.2","type":"blocks","created_at":"2026-01-07T06:52:09.528802Z","created_by":"juanre"}]}
{"id":"beadhub-phyh.1","title":"Subscriptions API: align identity fields (post beadhub-3sl6.2)","description":"Fix server-side semantics so subscriptions store/return the real recipient workspace identity (workspace_id) and are tenant-scoped by project_id; remove the current project_slug/workspace_id confusion in code.","acceptance_criteria":"- POST/GET/DELETE /v1/subscriptions work with correct workspace_id semantics\n- get_subscribers_for_bead returns correct recipient workspace_id values\n- No reliance on misnamed columns in application logic","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-07T06:52:49.632874Z","created_by":"juanre","updated_at":"2026-01-10T12:54:56.9983+01:00","labels":["component:db","component:notifications"],"dependencies":[{"issue_id":"beadhub-phyh.1","depends_on_id":"beadhub-phyh","type":"parent-child","created_at":"2026-01-07T06:52:49.63369Z","created_by":"juanre"},{"issue_id":"beadhub-phyh.1","depends_on_id":"beadhub-3sl6.2","type":"blocks","created_at":"2026-01-07T06:52:49.635417Z","created_by":"juanre"}]}
{"id":"beadhub-phyh.2","title":"Notifications: emit subscription notifications from bdh sync","description":"Wire notification intent recording + processing into the main bdh-driven sync path (POST /v1/bdh/sync) using BeadsSyncResult.status_changes.","acceptance_criteria":"- A status change ingested via /v1/bdh/sync creates outbox entries for subscribers\n- Outbox processing delivers notifications for those entries\n- No notifications are sent for brand-new beads (no old_status)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-07T06:52:49.821212Z","created_by":"juanre","updated_at":"2026-01-07T06:52:49.821212Z","labels":["component:notifications"],"dependencies":[{"issue_id":"beadhub-phyh.2","depends_on_id":"beadhub-phyh","type":"parent-child","created_at":"2026-01-07T06:52:49.82192Z","created_by":"juanre"},{"issue_id":"beadhub-phyh.2","depends_on_id":"beadhub-phyh.1","type":"blocks","created_at":"2026-01-07T06:52:49.823664Z","created_by":"juanre"}]}
{"id":"beadhub-phyh.3","title":"Notifications: system sender identity (no self-sent inbox messages)","description":"Replace the current self-sent-message workaround in notifications outbox delivery with a clear system sender identity that is project-scoped and doesnâ€™t impersonate a user workspace.","acceptance_criteria":"- Notifications arrive as messages with a stable, recognizable sender identity\n- No message rows are created with from_workspace_id == to_workspace_id for notifications\n- Tenant isolation is preserved (no cross-project sender)","status":"open","priority":1,"issue_type":"task","created_at":"2026-01-07T06:52:50.004817Z","created_by":"juanre","updated_at":"2026-01-07T06:52:50.004817Z","labels":["component:db","component:notifications"],"dependencies":[{"issue_id":"beadhub-phyh.3","depends_on_id":"beadhub-phyh","type":"parent-child","created_at":"2026-01-07T06:52:50.005612Z","created_by":"juanre"},{"issue_id":"beadhub-phyh.3","depends_on_id":"beadhub-phyh.2","type":"blocks","created_at":"2026-01-07T06:52:50.007754Z","created_by":"juanre"}]}
{"id":"beadhub-phyh.4","title":"bdh CLI: add :subscribe/:subscriptions/:unsubscribe commands","description":"Add user-facing bdh commands to manage subscriptions from a workspace using .beadhub identity (project_id/workspace_id/alias).","acceptance_criteria":"- bdh :subscribe \u003cbead_id\u003e [--repo] [--events] creates/upserts a subscription\n- bdh :subscriptions lists subscriptions for current workspace\n- bdh :unsubscribe \u003csubscription_id\u003e removes it","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-07T06:52:50.195473Z","created_by":"juanre","updated_at":"2026-01-07T06:52:50.195473Z","labels":["component:bdh","component:notifications"],"dependencies":[{"issue_id":"beadhub-phyh.4","depends_on_id":"beadhub-phyh","type":"parent-child","created_at":"2026-01-07T06:52:50.196195Z","created_by":"juanre"},{"issue_id":"beadhub-phyh.4","depends_on_id":"beadhub-phyh.1","type":"blocks","created_at":"2026-01-07T06:52:50.198124Z","created_by":"juanre"}]}
{"id":"beadhub-phyh.5","title":"Dashboard UI: view and toggle subscriptions","description":"Expose subscriptions in the OSS dashboard (at minimum: list current workspace subscriptions; optionally: toggle watch/unwatch from a bead view).","acceptance_criteria":"- Dashboard shows a subscriptions list for the selected workspace\n- User can create/delete a subscription from the UI (or clearly links to bdh commands)","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-07T06:52:50.377445Z","created_by":"juanre","updated_at":"2026-01-07T06:52:50.377445Z","labels":["component:dashboard","component:notifications"],"dependencies":[{"issue_id":"beadhub-phyh.5","depends_on_id":"beadhub-phyh","type":"parent-child","created_at":"2026-01-07T06:52:50.378089Z","created_by":"juanre"},{"issue_id":"beadhub-phyh.5","depends_on_id":"beadhub-phyh.1","type":"blocks","created_at":"2026-01-07T06:52:50.379972Z","created_by":"juanre"}]}
{"id":"beadhub-phyh.6","title":"MCP: subscriptions tools parity + discovery integration","description":"Ensure MCP tools/call wrappers for subscriptions match the chosen schema and appear in tools/list once discovery endpoints land.","acceptance_criteria":"- tools/call subscribe_to_bead/list_subscriptions/unsubscribe behave correctly\n- After beadhub-doq5.1, these tools appear in tools/list and are discoverable by clients","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-07T06:52:50.570279Z","created_by":"juanre","updated_at":"2026-01-07T06:52:50.570279Z","labels":["component:mcp","component:notifications"],"dependencies":[{"issue_id":"beadhub-phyh.6","depends_on_id":"beadhub-phyh","type":"parent-child","created_at":"2026-01-07T06:52:50.570956Z","created_by":"juanre"},{"issue_id":"beadhub-phyh.6","depends_on_id":"beadhub-phyh.1","type":"blocks","created_at":"2026-01-07T06:52:50.573185Z","created_by":"juanre"},{"issue_id":"beadhub-phyh.6","depends_on_id":"beadhub-doq5.1","type":"blocks","created_at":"2026-01-07T06:53:37.30415Z","created_by":"juanre"}]}
{"id":"beadhub-phyh.7","title":"Tests: subscriptions CRUD + notification delivery","description":"Add tests covering subscription CRUD and end-to-end delivery triggered by a beads sync path.","acceptance_criteria":"- Test: create subscription then ingest status change -\u003e recipient inbox contains notification\n- Test: unsubscribe -\u003e no further notifications","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-07T06:52:50.75747Z","created_by":"juanre","updated_at":"2026-01-07T06:52:50.75747Z","labels":["area:tests","component:notifications"],"dependencies":[{"issue_id":"beadhub-phyh.7","depends_on_id":"beadhub-phyh","type":"parent-child","created_at":"2026-01-07T06:52:50.758395Z","created_by":"juanre"},{"issue_id":"beadhub-phyh.7","depends_on_id":"beadhub-phyh.2","type":"blocks","created_at":"2026-01-07T06:52:50.760488Z","created_by":"juanre"}]}
{"id":"beadhub-phyh.8","title":"Docs: how to use subscriptions (watch beads)","description":"Document the user-facing workflow for watching beads (bdh commands + API/MCP notes).","acceptance_criteria":"- docs/api-reference.md reflects the stable API semantics\n- README/docs include examples for bdh watch workflow","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-07T06:52:50.952792Z","created_by":"juanre","updated_at":"2026-01-07T06:52:50.952792Z","labels":["area:docs","component:notifications"],"dependencies":[{"issue_id":"beadhub-phyh.8","depends_on_id":"beadhub-phyh","type":"parent-child","created_at":"2026-01-07T06:52:50.953518Z","created_by":"juanre"},{"issue_id":"beadhub-phyh.8","depends_on_id":"beadhub-phyh.4","type":"blocks","created_at":"2026-01-07T06:52:50.955829Z","created_by":"juanre"}]}
{"id":"beadhub-pioa","title":"Replace hardcoded 'admin' fallback with better default","description":"The dashboard currently falls back to `humanName = \"admin\"` when `GET /v1/dashboard/config` returns no `human_name`.\n\nThis creates accidental impersonation/ambiguity and hides configuration errors.\n\nFix:\n- Remove the hardcoded \"admin\" fallback.\n- If `human_name` is missing, show a clear error in the UI explaining how to set it (env var / dashboard config), and disable messaging/chat actions that require an identity.\n\nRelevant file:\n- `frontend/src/components/Layout.tsx`\n","acceptance_criteria":"- No hardcoded 'admin' fallback\n- Missing config shows clear UI error and messaging is disabled","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T20:35:19.060268+01:00","updated_at":"2026-01-03T18:40:48.739526Z"}
{"id":"beadhub-pldf","title":"Chat: add --no-wait flag to send message without blocking","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-11T19:39:17.398255+01:00","updated_at":"2025-12-13T17:31:48.570559+01:00","closed_at":"2025-12-13T17:31:48.570559+01:00"}
{"id":"beadhub-pp67","title":"Docs: File reservation system documentation","description":"Document the file reservation system for both beadhub users and mcp_agent_mail migrants.\n\n## Documentation Needed\n\n### For beadhub users (AGENTS-template.md)\n- Add section on file locks/reservations\n- Explain bdh :lock, :unlock, :locks commands\n- Best practices for when to use locks\n\n### For mcp_agent_mail migrants\n- Migration guide from mcp_agent_mail to beadhub\n- Identity mapping explanation:\n  - project_key â†’ project_id (UUID) via mapping table\n  - agent_name â†’ workspace_id via mapping table\n  - Client NEVER sends project_id - server derives it\n- API compatibility notes\n- What stays the same, what changes\n\n### API Documentation\n- REST endpoints for reservations\n- MCP tool schemas\n- SSE event formats\n\n### bdh-design.md updates\n- Add file reservation architecture to design doc\n- Document Redis storage model\n- Explain TTL and expiration behavior\n\n## Key Identity Mapping Rules (from sync with claude-be)\n\nDocument clearly:\n1. project_key â†’ project_id (UUID), NOT project_slug\n2. project_slug is display-only\n3. Agent Mail clients get real workspaces (workspace_type='agent_mail')\n4. Identity resolution (beadhub-ki7v) handles all mapping\n\n## Reference\n- See ../beadhub-sot/source-of-truth/mcp-agent-mail-compatibility.md for compatibility spec\n- See ../other/mcp_agent_mail/ for original tool documentation\n- See beadhub-ki7v for identity resolution implementation\n\n## Acceptance Criteria\n- AGENTS-template.md has lock commands section\n- Migration guide exists for mcp_agent_mail users\n- API endpoints documented with examples\n- Identity mapping clearly explained with correct project_key â†’ project_id mapping","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-15T21:41:49.35896+01:00","updated_at":"2025-12-17T19:27:48.565161+01:00","closed_at":"2025-12-17T19:27:48.565161+01:00","close_reason":"Added file locks section to AGENTS-template.md, updated api-reference.md with correct endpoint docs and SSE events section, fixed SSE event type validation"}
{"id":"beadhub-pph8","title":"Missing composite index on (project_id, status) for ready query","description":"Location: migrations/beads/001_initial.sql. The ready query filters by project_id = X AND status = 'open' (lines 621-623 in beads.py). There's idx_beads_issues_project_id and idx_beads_issues_status but no composite index. With millions of issues, Postgres will scan one index then filter, instead of using a tighter range scan. Fix: Add CREATE INDEX idx_beads_issues_project_status ON beads_issues(project_id, status);","status":"closed","priority":1,"issue_type":"task","assignee":"eve-agent","created_at":"2025-12-09T19:55:12.303655+01:00","updated_at":"2026-01-03T18:34:53.270691Z","closed_at":"2026-01-03T18:34:53.270691Z","close_reason":"Added migration 002_composite_index.sql with CREATE INDEX idx_beads_issues_project_status ON beads_issues(project_id, status)"}
{"id":"beadhub-ppqh","title":"Fix WorkspacesPage UX: remove duplicate filter, hide workspace filter, show human_name","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T18:40:03.439123+01:00","updated_at":"2025-12-13T18:46:01.879702+01:00","closed_at":"2025-12-13T18:46:01.879702+01:00"}
{"id":"beadhub-pq62","title":"Redis keys lack project_id namespace - no tenant isolation in hot state","description":"Location: presence.py, messages.py, reservations.py. Architecture doc (beadhub-architecture.md line 675) says 'Redis keys can be namespaced by project' for tenant isolation, but this is NOT implemented. Current key patterns: presence:{workspace_id}, inbox:{workspace_id}, reservation:{workspace_id}:{path_hash}. Problem: In Cloud multi-tenant mode, there's no isolation between projects at the Redis layer. A workspace_id collision (UUIDs are unique but if Cloud reuses workspace_ids across tenants...) or a bug could leak data between tenants. Fix: Add project_id to Redis key patterns OR document that workspace_id uniqueness provides tenant isolation and Cloud MUST enforce unique workspace_ids per tenant.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-09T19:54:24.436003+01:00","updated_at":"2025-12-12T12:41:31.983563+01:00","closed_at":"2025-12-12T12:41:31.983563+01:00"}
{"id":"beadhub-psfv","title":"Add DELETE /v1/workspaces/{id} endpoint to mark workspace as deleted","description":"Server endpoint to soft-delete a workspace by setting deleted_at = NOW(). Should return the deleted workspace info. Consider: who can delete? Only the workspace itself, or any workspace in the same project, or admin?","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-16T20:40:56.16819+01:00","updated_at":"2025-12-16T22:56:27.746149+01:00","closed_at":"2025-12-16T22:56:27.746149+01:00","dependencies":[{"issue_id":"beadhub-psfv","depends_on_id":"beadhub-9aq9","type":"blocks","created_at":"2025-12-16T20:41:05.171512+01:00","created_by":"juanre"},{"issue_id":"beadhub-psfv","depends_on_id":"beadhub-lmtj","type":"blocks","created_at":"2025-12-16T20:41:17.81692+01:00","created_by":"juanre"}]}
{"id":"beadhub-psg7","title":"bdh: Handle deleted workspace gracefully","description":"When .beadhub points to a soft-deleted workspace, detect and show helpful error: Workspace was deleted. Re-run bdh init to re-register.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T15:25:36.965305+01:00","updated_at":"2025-12-21T17:46:39.176119+01:00","closed_at":"2025-12-21T17:46:39.176119+01:00","close_reason":"Implemented 410 response for deleted workspaces with helpful error message","dependencies":[{"issue_id":"beadhub-psg7","depends_on_id":"beadhub-1thq","type":"blocks","created_at":"2025-12-21T15:26:55.510811+01:00","created_by":"juanre"},{"issue_id":"beadhub-psg7","depends_on_id":"beadhub-j86m","type":"blocks","created_at":"2025-12-21T15:27:04.799545+01:00","created_by":"juanre"}]}
{"id":"beadhub-ptan","title":"bdh :init returns 500 when alias already bound to different repo","description":"## Summary\nRunning `bdh :init` with an alias that already exists in the project but is bound to a different repo currently triggers a Postgres trigger (`repo_id is immutable`) and bubbles up as a **500 Internal Server Error**.\n\nThis is expected to happen in normal workflows (many worktrees/agents, same project) and must instead return an actionable, user-facing error (e.g. 409 Conflict) explaining how to proceed.\n\n## Reproduction\n1. Have an existing workspace/agent registered in project `beadhub` under alias `bob-implementer` (workspace_id == agent_id), already associated with repo A.\n2. In a different repo/worktree (repo B), run:\n   - `bdh :init --project beadhub --alias bob-implementer`\n3. Server responds `500`.\n\nObserved traceback ends in:\n- `src/beadhub/routes/init.py` updating `workspaces.repo_id` for the existing workspace row\n- DB trigger in `src/beadhub/migrations/server/001_initial.sql` raises:\n  - `repo_id is immutable (cannot change to different repo)`\n\n## Why This Is Bad\n- This is a predictable user error / conflict, not an internal server error.\n- It breaks onboarding and automation (e.g. scripts that provision many worktrees).\n- It creates the impression of a broken server, when itâ€™s actually a valid constraint.\n\n## Root Cause\n`/v1/init` uses `workspace_id = identity.agent_id` as the primary key for upserting into `server.workspaces`.\n\nWhen a workspace already exists for that agent_id/project_id, the handler runs an UPDATE that sets `repo_id` based on the current directoryâ€™s repo.\n\nThe DB trigger correctly enforces that `repo_id` cannot change to a different non-NULL repo. However the route does not pre-check or translate the DB exception into a user-level conflict response.\n\n## Proposed Solution\nKeep the DB trigger (it is correct), but ensure the API returns a stable, explicit conflict response and the CLI prints a helpful message.\n\n### Server-side behavior (preferred)\nIn `POST /v1/init`:\n1. If an existing workspace row is found for `(workspace_id, project_id)`:\n2. Load its existing `repo_id` and canonical origin (join `repos`), and compare with the repo derived from the request.\n3. If the repo differs and the new repo_id is non-null:\n   - Return `409 Conflict` with structured details:\n     - `detail`: human-readable explanation\n     - include: existing alias/workspace_id, existing canonical_origin, attempted canonical_origin\n     - remediation: â€œchoose a different aliasâ€, â€œinit in the original repo worktreeâ€, or â€œcreate a new agent/worktreeâ€.\n4. If repo is same, proceed with update (including `--update` path/hostname changes).\n\n### Server-side fallback\nAdditionally (defensive): catch the specific asyncpg RaiseError text from the trigger and translate it to the same 409 response, to avoid any remaining 500s.\n\n### CLI behavior\nUpdate `bdh :init`:\n- When server returns 409, print a clear explanation and suggested next commands.\n- If TTY: optionally prompt to pick a new alias (server-suggested list), then retry init.\n\n## API Contract\n- `POST /v1/init`\n  - Returns `409` when alias/workspace exists but repo differs.\n  - Response body should be stable for CLI parsing (at minimum `detail` string).\n\n## Tests\nAdd tests verifying:\n- The repo mismatch returns `409` (not 500).\n- The response includes enough context to remediate (both canonical origins).\n- The DB trigger remains in place (still enforces immutability even if route check is bypassed).\n\n## Notes / Context\n- Identity selection is driven by `.aw/context` (non-secret pointer), but the core issue here is *server-side alias/workspace binding to a repo*.\n- This is not a security boundary (local users can impersonate by copying config), but it is a correctness/UX issue.\n","notes":"Implemented server-side 409 Conflict for repo/alias mismatch in /v1/init (avoid 500 from repo_id immutability trigger) and added regression test (tests/test_beadhub_init.py). Pending commit.\nCommitted fix: fdeac91 (init returns 409 on repo mismatch + regression test).","status":"closed","priority":1,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-03T13:51:53.564441Z","created_by":"Juan Reyero","updated_at":"2026-02-03T14:05:14.253841Z","closed_at":"2026-02-03T14:05:14.253848Z","labels":["aweb","coordination","init","onboarding"]}
{"id":"beadhub-pvb0","title":"Dashboard: Display role in workspace details","description":"Show full role in workspace detail/expanded view","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-14T09:06:38.543197+01:00","updated_at":"2025-12-15T15:35:00.600642+01:00","closed_at":"2025-12-15T15:18:22.477443+01:00","dependencies":[{"issue_id":"beadhub-pvb0","depends_on_id":"beadhub-ci41","type":"blocks","created_at":"2025-12-14T09:06:56.520988+01:00","created_by":"juanre"},{"issue_id":"beadhub-pvb0","depends_on_id":"beadhub-161u","type":"parent-child","created_at":"2025-12-14T09:24:11.617201+01:00","created_by":"juanre"}]}
{"id":"beadhub-pwbx","title":"TECH DEBT: Rename conflicting get_project_id functions","description":"## Problem\n\nTwo different functions named `get_project_id` exist with completely different purposes, causing confusion.\n\n### Current Behavior\n\n**Location 1: src/beadhub/workspace_config.py:167**\n- Reads project_id from .beadhub file\n- Used by CLI for local config\n- Returns Optional[str]\n\n**Location 2: src/beadhub/auth.py:100**\n- FastAPI dependency that extracts from HTTP header\n- Used for API request validation\n- Raises HTTPException if missing/invalid\n\n### Impact\n\n- Developers must check import path to know behavior\n- IDE autocomplete shows both\n- Easy to use wrong one accidentally\n- Code review confusion\n\n### Solution\n\nRename the auth.py version to clarify its purpose:\n\n```python\n# auth.py\n\ndef require_project_id_header(request: Request) -\u003e str:\n    \"\"\"Extract and validate X-Project-ID header.\n    \n    Raises HTTPException 401 if header is missing or invalid.\n    Use as FastAPI dependency.\n    \"\"\"\n    ...\n\ndef get_optional_project_id_header(request: Request) -\u003e Optional[str]:\n    \"\"\"Extract X-Project-ID header if present.\n    \n    Returns None if missing, raises HTTPException if invalid format.\n    \"\"\"\n    ...\n```\n\nKeep workspace_config.py as-is since it's the \"config file\" context.\n\n### Alternative\n\nRename workspace_config.py version instead:\n- `get_config_project_id()` \n- `load_project_id_from_config()`\n\n### Files to Update\n\n- `src/beadhub/auth.py` - Rename functions\n- All route files importing from auth - Update imports\n- Tests - Update to use new names\n\n### Acceptance Criteria\n\n- [ ] No two functions with same name doing different things\n- [ ] Names clearly indicate source (header vs config)\n- [ ] All imports updated\n- [ ] All tests pass","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T08:31:40.845493+01:00","created_by":"juanre","updated_at":"2026-01-10T12:55:05.717369+01:00","closed_at":"2026-01-10T12:55:05.717369+01:00","close_reason":"Renamed get_project_id to require_project_id_header across 7 files - all 854 tests pass"}
{"id":"beadhub-pzex","title":"Security: reservations/revoke allows cross-tenant revocation","description":"POST /v1/reservations/revoke takes project_id from request body without validating against X-Project-ID header. In Cloud, a user with access to project P could revoke reservations in project Q.\n\nFix: reservations/revoke should only be callable by admins/owners, OR validate project_id matches X-Project-ID from auth.\n\nDiscovered by charlie-agent while assessing beadhub-cbv.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-22T10:02:44.692086+01:00","updated_at":"2025-12-22T11:28:42.398295+01:00","closed_at":"2025-12-22T11:28:42.398295+01:00","close_reason":"Merged to main"}
{"id":"beadhub-q1xh","title":"Add tenant_id to projects table in 001_initial.sql","description":"Edit server/001_initial.sql to add tenant_id column to projects table.\n\nChanges:\n- Add tenant_id UUID column (nullable, no FK) for multi-tenant partition key\n- Update unique constraint on slug to be per-tenant:\n  - idx_projects_slug_no_tenant: slug unique where tenant_id IS NULL (OSS mode)\n  - idx_projects_slug_with_tenant: (tenant_id, slug) unique where tenant_id IS NOT NULL (SaaS)\n\nPer data-model.md section 1a: \"Tenant-Scoped Project Slugs\"\n\nNo backwards compatibility needed - we edit migrations directly.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T12:49:26.109174+01:00","updated_at":"2025-12-12T15:14:41.553224+01:00","closed_at":"2025-12-12T15:14:41.553224+01:00"}
{"id":"beadhub-q3rs","title":"CLI: load .env always; remove project_id/X-Project-ID from bdh","description":"CLI (bdh): load .env automatically; remove project_id/X-Project-ID from config and requests; always send Authorization: Bearer.","design":"Spec: docs/specs/auth-model.md\\n\\nImplementation:\\n- Auto-load .env from workspace root for all commands that contact the server.\\n- Stop persisting project_id in .beadhub or config; treat it as legacy-only.\\n- Remove X-Project-ID header from all requests.\\n- Use BEADHUB_API_KEY as the Bearer token.","acceptance_criteria":"- bdh works with only .beadhub + .env BEADHUB_API_KEY\\n- No requests include X-Project-ID\\n- go test ./... passes","status":"closed","priority":0,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-17T19:14:50.127917+01:00","created_by":"Juan Reyero","updated_at":"2026-01-18T14:06:00.753714+01:00","closed_at":"2026-01-18T14:06:00.753714+01:00","close_reason":"Implemented: bdh loads .env + .env.local; removed project_id/X-Project-ID from config/requests; all client auth uses Authorization: Bearer (BEADHUB_API_KEY).","dependencies":[{"issue_id":"beadhub-q3rs","depends_on_id":"beadhub-p2ha","type":"parent-child","created_at":"2026-01-17T19:15:00.131839+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-q3rs.1","title":"CLI: .env symlink/tracked-file footgun for API key persistence","description":"bdh init currently persists BEADHUB_API_KEY into .env. In this repo, .env is a symlink to tracked .env.dev (explicitly says do not add secrets). This makes it easy to accidentally write/commit secrets and also changes file mode to 0600.","design":"Goal: keep the 'bdh loads .env' simplicity while preventing secret leakage in common setups (tracked .env.dev + symlinked .env).\\n\\nOptions:\\nA) Repo-level: stop symlinking .env -\u003e .env.dev; use .env.example/.env.dev as a template and keep real .env untracked for everything (preferred if we can change dev workflow).\\nB) CLI-level: if .env is a symlink OR is tracked by git OR is group/world-readable, write the API key to .env.local (0600) and load it after .env (override).\\n\\nRecommended: implement B for robustness + optionally do A in this repo.\\n\\nImplementation details (B):\\n- Add env loading order: .env then .env.local (same directory as .beadhub).\\n- saveAPIKeyToEnv(): choose target file (.env.local if .env is unsafe), and ensure file perms 0600.\\n- Warn clearly about where the key was written.\\n- Update docs to recommend .env.local for secrets when .env is tracked.","acceptance_criteria":"- bdh loads .env and .env.local (local overrides)\n- bdh init never writes a secret into a tracked/symlinked .env without warning\n- API key persistence works in this repo without touching .env.dev\n- go test ./... covers symlink/tracked cases","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-17T21:29:18.366278+01:00","created_by":"Juan Reyero","updated_at":"2026-01-18T14:06:01.933632+01:00","closed_at":"2026-01-18T14:06:01.933632+01:00","close_reason":"Implemented safety for API key persistence: init writes to .env.local when .env is symlinked/tracked/unsafe; CLI loads .env then .env.local so secrets donâ€™t leak via tracked .env.dev.","dependencies":[{"issue_id":"beadhub-q3rs.1","depends_on_id":"beadhub-q3rs","type":"parent-child","created_at":"2026-01-17T21:29:18.366856+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-q3rs.1","depends_on_id":"beadhub-p2ha","type":"discovered-from","created_at":"2026-01-17T21:29:18.368655+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-q3y5","title":"Update subscriptions table: consolidate migrations, rename fields","description":"Consolidate server/004_subscriptions.sql and 005_subscriptions_project_id.sql.\n\nCurrent schema:\n- project_key TEXT - RENAME to project_slug (human-readable project identifier)\n- project_id UUID - tenant isolation (keep as-is)\n- agent_name TEXT - RENAME to alias\n- bead_id TEXT\n- repo TEXT - repo name\n- event_types TEXT[]\n- created_at TIMESTAMPTZ\n\nChanges:\n1. project_key â†’ project_slug (was incorrectly named, match .beadhub file)\n2. agent_name â†’ alias\n3. Consolidate both migrations into 004_subscriptions.sql\n4. Keep repo as TEXT for now (simpler than repo_id FK)\n5. Update index names: \n   - idx_subscriptions_agent â†’ idx_subscriptions_alias\n   - All references to project_key â†’ project_slug\n\nFinal schema:\n- id (UUID, PK)\n- project_id (UUID, FK to projects)\n- project_slug (TEXT, NOT NULL) - renamed from project_key\n- alias (TEXT, NOT NULL) - renamed from agent_name\n- bead_id (TEXT, NOT NULL)\n- repo (TEXT, nullable)\n- event_types (TEXT[], NOT NULL, DEFAULT '{status_change}')\n- created_at (TIMESTAMPTZ)\n\nIndexes:\n- idx_subscriptions_unique on (project_id, project_slug, alias, bead_id, COALESCE(repo, ''))\n- idx_subscriptions_bead on (project_id, bead_id, repo)\n- idx_subscriptions_alias on (project_slug, alias)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T12:50:00.225525+01:00","updated_at":"2025-12-12T15:18:12.816334+01:00","closed_at":"2025-12-12T15:18:12.816334+01:00"}
{"id":"beadhub-q4hm","title":"Remove file reservations (locking) system","description":"Remove the file-level locking system. We are moving to bead-level coordination instead.\n\nFiles to modify/remove:\n- src/beadhub/routes/reservations.py - Remove or gut entirely\n- Redis key patterns reservation:* - No longer used\n- Related tests\n\nNOTE: No production data. Can safely remove without migration concerns.\n\nKeep the reservations.py file but deprecate the endpoints, or remove entirely - discuss with Juan.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T09:35:14.935742+01:00","updated_at":"2025-12-20T09:31:38.495107+01:00","closed_at":"2025-12-20T09:31:38.495107+01:00","close_reason":"Obsolete: file reservations are required for agent mail compatibility","dependencies":[{"issue_id":"beadhub-q4hm","depends_on_id":"beadhub-4trs","type":"parent-child","created_at":"2025-12-10T09:36:05.779309+01:00","created_by":"juanre"}]}
{"id":"beadhub-q71a","title":"Role 'Select' button purpose is unclear","description":"Problem\n- In `frontend/src/pages/PoliciesPage.tsx`, each role playbook card has a \"Select\" button that only toggles a ring highlight (`selectedRole` state) and does not change any other UI. Users donâ€™t know what selecting does.\n\nChange\n- Either:\n  A) Remove the \"Select\" button entirely (if selection is not needed), OR\n  B) Make selection meaningful: when a role is selected, show a prominent \"Selected role playbook\" panel (rendered markdown) and rename the button to something clearer (e.g., \"View playbook\" / \"Focus\").\n- Add small helper text near the roles section explaining what selection does.\n\nNotes\n- Keep the interaction consistent with collapsible cards and keyboard accessibility.","acceptance_criteria":"- The UI makes it obvious what selecting a role does (or the select action is removed).\n- If selection remains: selecting a role changes the visible content in a clear way and provides feedback (e.g., a dedicated panel or header).\n- No confusing \"Selected\" state with no effect.","status":"closed","priority":3,"issue_type":"bug","created_at":"2026-01-02T18:45:19.489397Z","created_by":"juanre","updated_at":"2026-01-02T21:27:24.653391Z","closed_at":"2026-01-02T21:27:24.653391Z","close_reason":"Make role selection meaningful (Focus button + focused playbook panel)","dependencies":[{"issue_id":"beadhub-q71a","depends_on_id":"beadhub-1tqa","type":"discovered-from","created_at":"2026-01-02T18:45:19.49049Z","created_by":"juanre"}]}
{"id":"beadhub-q7c5","title":"bdh :chat CLI command - start, respond, end chat","description":"Implement bdh :chat CLI command:\n\nSyntax: bdh :chat \u003cagent-name\u003e [\"message\"]\n\nOptions:\n- --wait=\u003cseconds\u003e: Response timeout (default: 60)\n- --end: End session after sending message\n- --pending: Show pending chat requests\n\nBehavior:\n1. Send message (if provided)\n2. Open SSE connection to session stream\n3. Block until response arrives OR timeout\n4. Return with the response\n\nSee spec: beadhub-sot/source-of-truth/beadhub-chat-spec.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T20:33:22.868609+01:00","updated_at":"2025-12-11T08:38:03.581549+01:00","closed_at":"2025-12-11T08:38:03.581549+01:00","dependencies":[{"issue_id":"beadhub-q7c5","depends_on_id":"beadhub-w143","type":"blocks","created_at":"2025-12-10T20:37:28.764191+01:00","created_by":"juanre"},{"issue_id":"beadhub-q7c5","depends_on_id":"beadhub-fh23","type":"blocks","created_at":"2025-12-10T20:37:28.816626+01:00","created_by":"juanre"},{"issue_id":"beadhub-q7c5","depends_on_id":"beadhub-b37m","type":"blocks","created_at":"2025-12-10T20:37:28.873012+01:00","created_by":"juanre"}]}
{"id":"beadhub-q7i0","title":"Fix: add apex_id/apex_title to WorkspaceInfo response","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-20T13:04:40.833959+01:00","updated_at":"2025-12-20T13:04:50.035356+01:00","closed_at":"2025-12-20T13:04:50.035356+01:00","close_reason":"Added apex_id/apex_title fields to WorkspaceInfo model and populated from first claim"}
{"id":"beadhub-q8k4","title":"Sync: clean up claims for already-closed beads","description":"When syncing, claims are only released when a status CHANGE to 'closed' is detected. If a bead was already closed (e.g., by another agent, or before bdh was used), the claim persists forever.\n\nFix: During sync, after processing status changes, query all claims for this workspace and release any where the bead is already closed in the synced issues.\n\nSymptom: 'bdh :who' shows workspace working on a closed bead.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-17T19:09:11.303725+01:00","updated_at":"2025-12-17T19:22:52.822769+01:00","closed_at":"2025-12-17T19:22:52.822769+01:00","close_reason":"Duplicate of beadhub-r9kp - fixing root cause (claims in /command) will fix this symptom"}
{"id":"beadhub-qakm","title":"Chat send_message must verify alias matches workspace (prevent in-session spoofing)","description":"POST /v1/chat/sessions/{session_id}/messages authorizes by workspace_id via chat_session_participants, but still trusts payload.alias when writing chat_messages.from_agent and publishing ChatMessageEvent. A participant can send a message claiming to be another alias. Fix: ignore payload.alias and derive the canonical alias from server.workspaces (workspace_id) or from chat_session_participants for that session/workspace; reject if mismatch. Also consider applying same rule to other endpoints using SendMessageRequest.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T23:30:18.510036+01:00","updated_at":"2025-12-14T09:13:02.921325+01:00","closed_at":"2025-12-14T09:13:02.921325+01:00","dependencies":[{"issue_id":"beadhub-qakm","depends_on_id":"beadhub-sl8p","type":"discovered-from","created_at":"2025-12-13T23:30:18.511246+01:00","created_by":"juanre"}]}
{"id":"beadhub-qdrk","title":"Multi-bead commands only create/release claim for first bead","description":"When operating on multiple beads, both parse_close_attempt() and parse_status_change() only process the FIRST bead ID.\n\n**Affected operations:**\n1. `bdh close id1 id2 id3` - only releases claim for id1\n2. `bdh update id1 id2 id3 --status in_progress` - only creates claim for id1\n3. `bdh update id1 id2 id3 --claim` - only creates claim for id1\n\n**Root cause:** Both regex patterns only capture one ID:\n- parse_close_attempt: `r'^close\\s+([^-\\s]\\S*)'`\n- parse_status_change: `r'^update\\s+(\\S+).*(?:--status|-s)(?:=|\\s+)(\\S+)'`\n\n**Fix:** Parse all bead IDs before the first flag and process claims for each.","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-05T17:06:59.641999Z","created_by":"juanre","updated_at":"2026-01-05T17:59:14.451623Z","closed_at":"2026-01-05T17:59:14.451623Z","close_reason":"Multi-bead claim and close fixes verified working by Eve"}
{"id":"beadhub-qe7e","title":"Missing type hints in beads_sync.py","description":"Location: src/beadhub/beads_sync.py:90-97, 135-168. Functions _parse_timestamp, _parse_dependency_ref, _parse_structured_ref have incomplete or missing return type hints. Fix: add complete type hints for better IDE support and type checking.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-08T18:26:00.352542+01:00","updated_at":"2025-12-08T18:26:00.352542+01:00"}
{"id":"beadhub-qfxg","title":"Chat admin monitoring view - see all sessions","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-15T21:43:42.565255+01:00","updated_at":"2025-12-15T21:59:30.313368+01:00","closed_at":"2025-12-15T21:59:30.313368+01:00"}
{"id":"beadhub-qhor","title":"Bug: bdh :chat shows your own message labeled as 'Pending message from \u003cother-agent\u003e'","description":"## Bug Description\n\nWhen waiting for a chat response with `bdh :chat agent-x --wait=300`, if agent-x hasn't replied yet, the output incorrectly shows YOUR message labeled as 'Pending message from agent-x'.\n\n## Reproduction\n\n1. Send a message: `bdh :chat claude-be \"Hello\"`\n2. claude-be doesn't respond\n3. Run: `bdh :chat claude-be --wait=300`\n4. Output shows:\n   ```\n   [chat] Pending message from claude-be:\n   Hello   \u003c-- This is YOUR message, not theirs!\n   ```\n\n## Root Cause\n\nIn `bdh/internal/commands/chat.go`, function `showPendingMessage()` (lines 274-320):\n\n1. Gets `pendingConvo.LastMessage` - the last message in conversation (could be from anyone)\n2. Sets `result.TargetAgent = fromAgent` (who you're chatting with)\n3. `formatChatOutput()` at line 580 prints: `\"[chat] Pending message from %s\", result.TargetAgent`\n\nThe bug: It labels the message as 'from TargetAgent' regardless of who actually sent it (`pendingConvo.LastFrom`).\n\n## Fix\n\nOption A: Only show pending if last message is FROM the target agent:\n```go\nif pendingConvo.LastFrom != fromAgent {\n    return nil, fmt.Errorf(\"no pending message from %s (you sent the last message)\", fromAgent)\n}\n```\n\nOption B: Show the message with correct attribution:\n```go\nif pendingConvo.LastFrom == cfg.Alias {\n    sb.WriteString(fmt.Sprintf(\"[chat] Your last message to %s (awaiting reply):\\n\", result.TargetAgent))\n} else {\n    sb.WriteString(fmt.Sprintf(\"[chat] Pending message from %s:\\n\", pendingConvo.LastFrom))\n}\n```\n\n## Impact\n\n- Agents see their own message labeled as coming from someone else\n- Causes confusion about who said what\n- Can lead to infinite wait loops (agent thinks they're waiting for a response that already came)\n\n## Files\n\n- bdh/internal/commands/chat.go:274-320 (showPendingMessage)\n- bdh/internal/commands/chat.go:579-583 (formatChatOutput 'pending' case)","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-16T08:56:31.347668+01:00","updated_at":"2025-12-16T09:03:04.426383+01:00","closed_at":"2025-12-16T09:03:04.426383+01:00"}
{"id":"beadhub-qj4h","title":"Add session_id index on chat_read_receipts table","description":"Migration 009 only indexes workspace_id but queries like 'get all read statuses for session Y' will do full table scans. Add: CREATE INDEX idx_chat_read_receipts_session ON chat_read_receipts(session_id)","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-13T20:42:38.723469+01:00","updated_at":"2025-12-13T20:42:38.723469+01:00"}
{"id":"beadhub-qm84","title":"Add rate limiting to chat admin endpoints","description":"Chat admin endpoints have no rate limiting. Frontend polls every 3 seconds when viewing a session. Multiple tabs could hammer the database. Consider adding rate limiting middleware and/or increasing poll interval to 5-10 seconds.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-15T22:04:00.881876+01:00","updated_at":"2025-12-15T22:04:00.881876+01:00"}
{"id":"beadhub-qmmc","title":"Add concurrency tests for workspace soft-delete","description":"Test coverage missing: (1) Concurrent deletion attempts (race condition), (2) Deletion while workspace has active claims, (3) Deletion while workspace has pending messages, (4) Sync attempt by deleted workspace. Add tests using asyncio.gather() or threading.","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T08:02:05.980186+01:00","updated_at":"2025-12-17T08:02:05.980186+01:00","dependencies":[{"issue_id":"beadhub-qmmc","depends_on_id":"beadhub-lmtj","type":"discovered-from","created_at":"2025-12-17T08:02:05.981527+01:00","created_by":"juanre"}]}
{"id":"beadhub-qmp0","title":"SSE: project_slug filter uses Redis presence instead of database","description":"## Problem\n\nThe SSE endpoint `/v1/status/stream` with `project_slug` filter still uses Redis presence to get workspace IDs:\n\n```python\nelif project_slug:\n    workspace_ids = await get_workspace_ids_by_project_slug(redis, project_slug)\n```\n\nThis has the same staleness bug that was just fixed for the no-filter case - if a workspace's Redis presence expires or has stale data, SSE won't subscribe to that workspace's channel even though messages are still routed to it via the database.\n\n## Location\n\n`src/beadhub/routes/status.py:257-258`\n\n## Fix Required\n\n1. Add `get_workspace_ids_by_project_slug_from_db(db_infra, project_slug)` function that queries:\n   ```sql\n   SELECT w.workspace_id \n   FROM workspaces w\n   JOIN projects p ON w.project_id = p.id\n   WHERE p.slug = $1 AND w.deleted_at IS NULL\n   ```\n\n2. Update SSE endpoint to use database query instead of Redis\n\n## Related\n\n- Fixed in 5599a6f for no-filter case\n- Same issue exists for repo_id filter (separate bead)","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-20T15:59:03.939901+01:00","updated_at":"2025-12-21T10:15:45.115167+01:00","closed_at":"2025-12-21T10:15:45.115167+01:00","close_reason":"SSE project_slug filter now uses database query instead of Redis presence","dependencies":[{"issue_id":"beadhub-qmp0","depends_on_id":"beadhub-tyf3","type":"blocks","created_at":"2025-12-21T09:49:27.855478+01:00","created_by":"juanre"}]}
{"id":"beadhub-qmus","title":"Pin Docker build toolchain inputs (pnpm/uv)","acceptance_criteria":"Docker rebuilds of the same git commit use pinned pnpm and uv versions; Dockerfile does not use pnpm@latest or uv:latest; pinned versions are documented and easy to bump intentionally.","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-18T11:42:45.298222+01:00","created_by":"Juan Reyero","updated_at":"2026-01-18T11:43:12.334901+01:00","closed_at":"2026-01-18T11:43:12.334901+01:00","close_reason":"Implemented and validated (tests passing).","labels":["docker","oss","reproducibility"]}
{"id":"beadhub-qnp0","title":"aweb API key prefix timing oracle (decision + potential mitigation)","description":"## Context\nFrom `../beadhub-sot/history/SECURITY_REVIEW_2026-01.md`.\n\n`aweb` verifies API keys by looking up `key_prefix` and then bcrypt-checking the full token. Missing prefixes reject quickly, existing prefixes reject slowly (bcrypt), creating a timing oracle.\n\n## Goal\nDecide whether to mitigate the prefix timing oracle and, if yes, implement a mitigation that does not create an easy CPU DoS vector.\n\n## Acceptance\n- Decision recorded in SOT (risk accepted OR mitigation chosen).\n- If mitigated: tests demonstrate behavior and rate limiting considerations are documented.\n","status":"closed","priority":2,"issue_type":"epic","owner":"juan@juanreyero.com","created_at":"2026-01-25T18:02:48.252221+01:00","created_by":"Juan Reyero","updated_at":"2026-01-25T18:53:57.643359+01:00","closed_at":"2026-01-25T18:53:57.643359+01:00","close_reason":"Decision recorded + implemented (SHA-256 key lookup); docs updated"}
{"id":"beadhub-qp4p","title":"Go bdh init: handle 409 from repos/lookup (ambiguous repo)","description":"Discovered in beadhub-jdzs review: The Go client's LookupRepo() method doesn't handle 409 responses from /v1/repos/lookup. When a repo exists in multiple projects, bdh init will show a generic error instead of the helpful message with candidate projects. Fix: update bdh/internal/client/client.go LookupRepo() to detect 409 and display the detail.message, then update bdh/internal/commands/init.go to show the candidate projects and suggest --project flag.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-13T16:01:49.190288+01:00","updated_at":"2025-12-13T16:01:49.190288+01:00","dependencies":[{"issue_id":"beadhub-qp4p","depends_on_id":"beadhub-jdzs","type":"discovered-from","created_at":"2025-12-13T16:01:49.191131+01:00","created_by":"juanre"}]}
{"id":"beadhub-qr7i","title":"Add UUID validation to escalation_id path parameter","description":"In get_escalation and respond_escalation endpoints, escalation_id path parameter only has min_length=1 but no UUID format validation. Should validate UUID format for consistency with other validation.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-15T18:49:19.835964+01:00","updated_at":"2025-12-15T18:49:19.835964+01:00"}
{"id":"beadhub-qrnr","title":"Server: add efficient team-status view for workspaces (limit + prioritize)","description":"Context\n- We now have a multi-tenant-aware filtering model in branch `be`: `/v1/workspaces` and `/v1/status/stream` support consistent filters (`project_slug`, `human_name`, `repo` canonical origin) and Cloud tenant isolation via `X-Project-ID` (authoritative, set by middleware).\n- `bdh ready`, `bdh :who`, and `bdh :send` still fundamentally need a *bounded* view of the team. Fetching all workspaces+claims will not scale and also returns counterproductive amounts of data.\n\nGoal\n- Define and implement the *right* Workspaces API for coordination at scale (thousands of workspaces, many claims) with tenant isolation baked in and with responses intentionally bounded for CLI usage.\n\nDesign: Workspaces API vNext (proposed)\n1) Separate concerns: \n   - \"Directory registry\" (all registered workspaces) is DB-backed and can be large.\n   - \"Team coordination view\" is bounded and optimized for bdh and dashboards.\n\n2) Endpoints\nA) `GET /v1/workspaces` (Registry + optional enrichment)\n   - Primary use: dashboard/workspace admin pages, debugging.\n   - Parameters: `project_slug`, `human_name`, `repo`, `include_deleted` (existing).\n   - Add: `include_claims` (bool, default false), `include_presence` (bool, default true), `limit` (optional; if unset, returns full registry for that filter).\n   - Tenant isolation: if `X-Project-ID` present, it *scopes* results regardless of `project_slug` (Cloud); in OSS, `project_slug` can be used normally.\n   - Performance: presence merge must be O(result_size) (pipeline HGETALL per returned workspace_id), never global presence scans.\n\nB) `GET /v1/workspaces/team` (New: bounded team-status view)\n   - Primary use: `bdh ready`, `bdh :who` default, and dashboards \"team status\" widgets.\n   - Always bounded: `limit` default 15 (max 200).\n   - Parameters mirror filters from `be` (`project_slug`, `human_name`, `repo`) plus:\n       - `only_with_claims` (bool, default true for bdh-ready usage)\n       - `include_claims` (bool, default true)\n       - `include_presence` (bool, default true)\n       - `always_include_workspace_id` (optional) to ensure caller is included even if filtered out by `only_with_claims`.\n   - Ordering (stable):\n       1) has_claims desc\n       2) is_online desc\n       3) last_seen desc\n       4) last_claimed_at desc\n       5) alias asc\n   - Tenant isolation: respect `X-Project-ID` when present.\n\n3) Apex strategy (non-negotiable for scale)\n- `/v1/workspaces` and `/v1/workspaces/team` must *not* compute apex by recursive CTE at read time.\n- Store apex on each claim at write time (claim creation / sync backfill) so the team view is O(#claims_returned).\n\n4) Role strategy\n- Role remains a short classification in `.beadhub` and should be durable in Postgres (`workspaces.role`). Presence may cache it, but offline workspaces must still have role.\n\nImplementation notes\n- Candidate selection happens in Postgres and applies LIMIT *before* joining/expanding claims.\n- Claims join should be keyed by `workspace_id IN (...)` and use indexes; join bead titles via a lateral `beads_issues` lookup (latest synced).\n- Presence merge uses Redis pipelining for exactly the candidate IDs returned (not `list_agent_presences(redis)` for all).\n\nValidation\n- Tests: limit + ordering + tenant isolation (X-Project-ID scoping) + presence merge boundedness + claims include/exclude.\n- Benchmark: 5k workspaces / 25k claims must show bounded endpoint (`/v1/workspaces/team?limit=15`) stays fast and response size stays small.\n\nDone when\n- `bdh ready` and `bdh :who` can be implemented without fetching the full registry.\n- Workspaces team-status view is bounded, stable-ordered, and scalable, and aligns with the `be` filter/tenant model.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-21T08:51:08.276534+01:00","updated_at":"2025-12-21T16:24:45.346401+01:00","closed_at":"2025-12-21T16:24:45.346401+01:00","close_reason":"Add tests for team-status tenant scoping and presence ordering","dependencies":[{"issue_id":"beadhub-qrnr","depends_on_id":"beadhub-o9h7","type":"discovered-from","created_at":"2025-12-21T08:51:08.278147+01:00","created_by":"juanre"}]}
{"id":"beadhub-qs7b","title":"Chat join_session should block expired/ended sessions","description":"Discovered in beadhub-1rlh review: join_session() doesn't check if session is expired/ended before allowing target to join. This could resurrect a dead session by changing status from expired to active. Fix: add status check in join_session() similar to stream_session().","status":"closed","priority":2,"issue_type":"bug","assignee":"frank-agent","created_at":"2025-12-13T16:15:02.18781+01:00","updated_at":"2026-01-03T17:16:05.471168Z","closed_at":"2026-01-03T17:16:05.471168Z","close_reason":"Added status guard to join_session() - returns 410 for ended sessions. Added regression test.","dependencies":[{"issue_id":"beadhub-qs7b","depends_on_id":"beadhub-1rlh","type":"discovered-from","created_at":"2025-12-13T16:15:02.18879+01:00","created_by":"juanre"}]}
{"id":"beadhub-qt06","title":"Add soft delete support for projects","description":"Port soft delete from beadhub-cloud to OSS projects table.\n\nChanges needed:\n1. Migration: Add deleted_at TIMESTAMPTZ to projects table\n   File: src/beadhub/migrations/server/0XX_soft_delete_projects.sql\n\n2. DELETE endpoint: Change from hard delete to soft delete\n   File: src/beadhub/routes/projects.py (around line 373)\n   Change: DELETE FROM â†’ UPDATE SET deleted_at = NOW()\n\n3. Query filters: Update list_projects(), get_project() to filter deleted_at IS NULL\n   File: src/beadhub/routes/projects.py\n\n4. CASCADE consideration: With soft delete, need to handle:\n   - repos: Should soft-delete cascade to repos?\n   - workspaces: Should soft-delete cascade to workspaces?\n   (Note: repos and workspaces already have deleted_at columns)\n\nRelated: beadhub-cloud-2vy.7","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-14T16:06:52.819267+01:00","created_by":"Juan Reyero","updated_at":"2026-01-15T22:15:31.32151+01:00","closed_at":"2026-01-15T22:15:31.32151+01:00","close_reason":"Soft delete implementation complete - race condition fixes committed"}
{"id":"beadhub-quz5","title":"Add test for invalid repo_id format in status/escalations endpoints","description":"test_status.py only tests happy path for repo_id filter. Add test that passes invalid UUID format (e.g. 36-char non-UUID string) and verifies 422 response. Same for escalations endpoint.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-13T14:16:03.847749+01:00","updated_at":"2025-12-13T14:16:14.897794+01:00"}
{"id":"beadhub-qx14","title":"Backend: include hostname/cwd in WorkspaceInfo response","description":"Add hostname and cwd fields to WorkspaceInfo model and populate from presence data.\n\nFile: src/beadhub/routes/workspaces.py\n\n1. Add to WorkspaceInfo model:\n```python\nclass WorkspaceInfo(BaseModel):\n    # ... existing fields ...\n    hostname: Optional[str] = None\n    cwd: Optional[str] = None\n```\n\n2. In list_workspaces(), populate from presence:\n```python\nif presence:\n    workspaces.append(\n        WorkspaceInfo(\n            # ... existing fields ...\n            hostname=presence.get(\"hostname\") or None,\n            cwd=presence.get(\"cwd\") or None,\n        )\n    )\nelse:\n    # Offline - no hostname/cwd (ephemeral data)\n    workspaces.append(\n        WorkspaceInfo(\n            # ... existing fields ...\n            hostname=None,\n            cwd=None,\n        )\n    )\n```\n\nNote: hostname/cwd only available for online workspaces (presence data is ephemeral).","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-13T21:09:53.937841+01:00","updated_at":"2025-12-13T21:09:53.937841+01:00","dependencies":[{"issue_id":"beadhub-qx14","depends_on_id":"beadhub-dadn","type":"blocks","created_at":"2025-12-13T21:10:02.887754+01:00","created_by":"juanre","metadata":"{}"}]}
{"id":"beadhub-r0d0","title":"Add chat session API endpoints (create, join, end)","description":"Implement /v1/chat/sessions endpoints:\n- POST /v1/chat/sessions - Create session with initial message\n- POST /v1/chat/sessions/{id}/join - Join existing session\n- POST /v1/chat/sessions/{id}/end - End session\n\nData model in Redis:\n- chat:session:{id} hash with metadata\n- chat:pending:{workspace} set of pending session IDs\n\nPart of epic beadhub-dtcl","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T20:29:50.753029+01:00","updated_at":"2025-12-10T20:35:03.959864+01:00","closed_at":"2025-12-10T20:35:03.959864+01:00"}
{"id":"beadhub-r0vn","title":"Policies page lacks read-only mode detection","description":"Problem\n- In auth-enabled mode (`BEADHUB_API_KEY` set), policy admin endpoints require `X-API-Key`. The dashboard may run without injected headers, so admin actions (New Version / Activate) should not be shown as available if they will always fail.\n\nChange\n- Add a read-only mode to the Policies page when admin actions are not permitted.\n- Minimal approach (no new backend endpoints): if `createPolicy` or `activatePolicy` fails with a missing/invalid API key error, switch the page into read-only mode for the session:\n  - Hide or disable \"New Version\" and \"Activate\" controls\n  - Show a callout explaining how to enable admin actions (Cloud embedding injects headers; otherwise use CLI / restart with proper config).\n- Optional improvement: enhance `ApiClient` to throw a structured error including HTTP status code so the UI can reliably detect 401/403.\n\nFiles\n- `frontend/src/pages/PoliciesPage.tsx`\n- `frontend/src/lib/api.ts` (optional error type)","acceptance_criteria":"- When admin write endpoints are not permitted (e.g., 401 missing API key), the Policies page clearly indicates read-only mode and does not keep offering failing buttons.\n- Read-only mode still allows viewing active policy and history.\n- When admin actions are permitted (auth disabled or headers injected), create/activate flows work normally.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T18:45:20.025065Z","created_by":"juanre","updated_at":"2026-01-02T21:27:19.298374Z","closed_at":"2026-01-02T21:27:19.298374Z","close_reason":"Detect admin-write forbidden and switch Policies page to read-only mode; add ApiError with status","dependencies":[{"issue_id":"beadhub-r0vn","depends_on_id":"beadhub-1tqa","type":"discovered-from","created_at":"2026-01-02T18:45:20.026151Z","created_by":"juanre"}]}
{"id":"beadhub-r0xm","title":"Update bdh init to include all .beadhub fields","description":"Update bdh init command to prompt for and write all required fields:\n\n- workspace_id (auto-generated UUID)\n- beadhub_url (from BEADHUB_URL env or prompt)\n- agent_name (from BEADHUB_AGENT env or default 'claude-code')\n- human_name (from BEADHUB_HUMAN env or prompt - REQUIRED)\n- project_key (from BEADHUB_PROJECT env or prompt - REQUIRED)\n\nThe current implementation is missing human_name and project_key.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T09:35:32.43936+01:00","updated_at":"2025-12-10T10:17:53.230327+01:00","closed_at":"2025-12-10T10:17:53.230327+01:00","dependencies":[{"issue_id":"beadhub-r0xm","depends_on_id":"beadhub-4trs","type":"parent-child","created_at":"2025-12-10T09:36:05.592242+01:00","created_by":"juanre"}]}
{"id":"beadhub-r178","title":"Add workspace registration on bdh init/command","description":"When bdh command runs, upsert into workspaces table:\n- INSERT ON CONFLICT UPDATE for agent_name, human_name, project_id\n- Called from /v1/bdh/command endpoint","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T21:01:55.893151+01:00","updated_at":"2025-12-11T21:05:31.001128+01:00","closed_at":"2025-12-11T21:05:31.001128+01:00","dependencies":[{"issue_id":"beadhub-r178","depends_on_id":"beadhub-o0w2","type":"blocks","created_at":"2025-12-11T21:02:02.990891+01:00","created_by":"juanre"}]}
{"id":"beadhub-r1h","title":"Update CLI to read and pass X-Project-ID header","description":"Read project_id from .beadhub config, add X-Project-ID header to HTTP requests, add --project-id flag override","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T22:29:09.222438+01:00","updated_at":"2025-12-08T08:20:04.475381+01:00","closed_at":"2025-12-08T08:20:04.475381+01:00","dependencies":[{"issue_id":"beadhub-r1h","depends_on_id":"beadhub-4mj","type":"discovered-from","created_at":"2025-12-07T22:29:09.223455+01:00","created_by":"juanre"}]}
{"id":"beadhub-r2dv","title":"Update chat tests for persistent model","description":"Update tests in tests/test_chat.py and bdh/internal/commands/chat_test.go:\n\n1. Remove lifecycle tests (waiting-\u003eactive-\u003eended)\n2. Remove cleanup tests\n3. Add find-or-create tests (same pair returns same session)\n4. Add read receipt tests\n5. Add unread count tests\n6. Test message persistence across disconnects","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T20:25:33.649268+01:00","updated_at":"2025-12-14T08:46:37.49409+01:00","closed_at":"2025-12-14T08:46:37.49409+01:00","dependencies":[{"issue_id":"beadhub-r2dv","depends_on_id":"beadhub-yvd1","type":"blocks","created_at":"2025-12-13T20:26:15.251091+01:00","created_by":"juanre"}]}
{"id":"beadhub-r3hu","title":"Migrate test_chat.py to db_infra fixture","description":"Convert from app_with_test_db to async tests using db_infra fixture.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-10T10:54:38.336094+01:00","created_by":"juanre","updated_at":"2026-01-10T12:04:33.654539+01:00","closed_at":"2026-01-10T12:04:33.654539+01:00","close_reason":"Migration complete - all 81 tests pass using db_infra fixture pattern","dependencies":[{"issue_id":"beadhub-r3hu","depends_on_id":"beadhub-7wpr","type":"parent-child","created_at":"2026-01-10T10:55:48.105908+01:00","created_by":"juanre"}]}
{"id":"beadhub-r58","title":"Add iteration limits to Redis SCAN operations to prevent DoS at scale","description":"Harden remaining Redis SCAN loops to avoid unbounded iteration.\n\nContext:\n- Reservations already enforce MAX_RESERVATIONS_TO_SCAN.\n- src/beadhub/routes/bdh.py check_alias_collision currently SCANs all presence keys to detect alias collisions.\n\nPreferred change:\n- Avoid SCAN: maintain a Redis secondary index for (project_id, alias) -\u003e workspace_id as part of presence updates (with TTL), and use that for collision checks.\n- If any SCAN remains, add a strict max-iterations/keys cap + warning.","acceptance_criteria":"- No unbounded Redis SCAN loops in request paths\n- Alias collision check does not require scanning all presence keys\n- Project-scoped behavior preserved (uses project_id)\n- Tests added for collision lookup (or minimal unit test for helper)","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-06T21:34:30.391785+01:00","updated_at":"2026-01-03T16:33:43.338176Z","closed_at":"2026-01-03T16:33:43.338176Z","close_reason":"merged"}
{"id":"beadhub-r64t","title":"Add role column to workspaces table","description":"Migration to add TEXT role column (nullable, max 200 chars) to server.workspaces table","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-14T09:06:34.837401+01:00","updated_at":"2025-12-14T09:30:22.631005+01:00","closed_at":"2025-12-14T09:30:22.631005+01:00","dependencies":[{"issue_id":"beadhub-r64t","depends_on_id":"beadhub-161u","type":"parent-child","created_at":"2025-12-14T09:24:10.924098+01:00","created_by":"juanre"}]}
{"id":"beadhub-r84","title":"Add project_id column to beads_issues table (migration)","description":"Create migration 002_add_project_id.sql to add project_id UUID column, update unique constraint to (project_id, repo_name, branch, bead_id)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T22:29:08.322057+01:00","updated_at":"2025-12-08T01:04:08.267624+01:00","closed_at":"2025-12-08T01:04:08.267624+01:00","dependencies":[{"issue_id":"beadhub-r84","depends_on_id":"beadhub-4mj","type":"discovered-from","created_at":"2025-12-07T22:29:08.323017+01:00","created_by":"juanre"}]}
{"id":"beadhub-r93o","title":"Chat pending returns expires_in_seconds=0 (expires_at never set)","description":"GET /v1/chat/pending computes expires_in_seconds from session_data.expires_at, but create_session never sets expires_at for v2.1 sessions. Result: pending chats show expires_in_seconds=0 for all sessions.\n\nThis should go away once beadhub-6qlj removes Redis+expires semantics, but until then either:\n- Stop returning expires_in_seconds (or always omit/NULL), or\n- Set expires_at consistently when creating Redis session hashes.","status":"closed","priority":3,"issue_type":"bug","created_at":"2025-12-13T23:12:08.942259+01:00","updated_at":"2025-12-13T23:41:14.915367+01:00","closed_at":"2025-12-13T23:41:14.915367+01:00","dependencies":[{"issue_id":"beadhub-r93o","depends_on_id":"beadhub-ixss","type":"discovered-from","created_at":"2025-12-13T23:12:08.943456+01:00","created_by":"juanre"}]}
{"id":"beadhub-r9kp","title":"Fix claim creation: create/release claims in /command, not sync","description":"## Problem\n\nClaims are created during sync by comparing issues.jsonl with the beads_issues table to detect status changes. This is brittle because:\n1. Depends on DB state being in sync\n2. Race-prone - another workspace syncing first can steal the claim\n3. The /command endpoint ALREADY parses and knows the bead_id being claimed/closed\n\n## Current Flow (broken)\n\n```\nbdh update bead-1 --status in_progress\n  â†’ /command: detects claim attempt, checks existing_claim, approves... but doesn't create claim\n  â†’ bd update: updates local issues.jsonl\n  â†’ /sync: compares issues.jsonl with DB, detects status change, creates claim\n```\n\nIf sync fails or DB is out of sync, claim is never created.\n\n## Fix\n\nCreate/release claims directly in /command endpoint:\n\n### For claim (update --status in_progress):\nLocation: src/beadhub/routes/bdh.py, around line 709\n\n```python\nbead_id = parse_claim_attempt(payload.command_line)\nif bead_id:\n    existing_claim = await get_bead_claim(db, payload.project_id, bead_id)\n    if existing_claim is None:\n        # CREATE CLAIM NOW - don't wait for sync\n        await upsert_bead_claim(db, payload.project_id, payload.workspace_id, \n                                payload.alias, payload.human_name, bead_id)\n        return CommandApprovedResponse(approved=True, context=context)\n    elif existing_claim['workspace_id'] == payload.workspace_id:\n        # Same workspace re-claiming - OK\n        return CommandApprovedResponse(approved=True, context=context)\n    else:\n        # Different workspace - reject (unless jump_in)\n        ...\n```\n\n### For release (close command):\nLocation: src/beadhub/routes/bdh.py, add after claim detection\n\n```python\nbead_id = parse_close_attempt(payload.command_line)  # NEW: parse 'close \u003cbead_id\u003e'\nif bead_id:\n    # RELEASE CLAIM NOW - don't wait for sync\n    await release_all_claims_for_bead(db, payload.project_id, bead_id)\n```\n\n## Also needed\n\n1. Add parse_close_attempt() function to extract bead_id from 'close \u003cbead_id\u003e' commands\n2. Keep sync claim logic as backup/cleanup, but primary creation is in /command\n3. Add tests for direct claim creation in /command\n\n## Files to modify\n\n- src/beadhub/routes/bdh.py (main fix)\n- tests/test_bdh_command.py (add tests)","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-17T19:22:30.251151+01:00","updated_at":"2025-12-17T19:31:52.021046+01:00","closed_at":"2025-12-17T19:31:52.021046+01:00","close_reason":"Claims now created/released in /command endpoint. Added parse_close_attempt(), claim creation for unclaimed beads, and claim release for close commands. Tests: test_command_creates_claim_directly_on_approval, test_command_releases_claim_on_close, test_close_help_does_not_release_claims"}
{"id":"beadhub-rcpk","title":"Duplicate: Remove vestigial priority field from messaging","description":"Duplicate of beadhub-w0kj.\n\nClosing in favor of the original issue.\n\n(If you were looking for the actual work item, use beadhub-w0kj.)","status":"closed","priority":3,"issue_type":"chore","created_at":"2026-01-07T06:37:49.438862Z","created_by":"juanre","updated_at":"2026-01-08T15:49:51.099852+01:00","closed_at":"2026-01-08T15:49:51.099857+01:00"}
{"id":"beadhub-rh2","title":"Add workspace_id param to message endpoints","description":"Update /v1/messages, /v1/messages/inbox, /v1/messages/inbox/count to use workspace_id. Change to_agent to to_workspace for routing. Keep agent_name as metadata in from_agent_name field.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T19:10:00.332196+01:00","updated_at":"2025-12-07T20:56:05.56667+01:00","closed_at":"2025-12-07T20:56:05.56667+01:00","dependencies":[{"issue_id":"beadhub-rh2","depends_on_id":"beadhub-6am","type":"blocks","created_at":"2025-12-07T19:10:00.333375+01:00","created_by":"juanre"}]}
{"id":"beadhub-rkud","title":"Frontend dashboard shows parent-child issues as flat list","description":"## Problem\n\nThe frontend dashboard did not immediately display parent-child relationships between issues. Issues that are children of an epic appeared as a flat list instead of being nested under their parent.\n\n## Steps to Reproduce\n\n1. Created an epic:\n```bash\nbdh create --title=\"Migrate all tests to use db_infra fixture\" --type=epic --priority=0 --body=\"...\"\n```\nThis created: `beadhub-7wpr`\n\n2. Created child tasks:\n```bash\nbdh create --title=\"Delete app_with_test_db from helpers_app.py\" --type=task --priority=0 --body=\"...\"\n```\nThis created: `beadhub-7zjk` (and 28 other tasks)\n\n3. Added parent-child dependencies:\n```bash\nbdh dep add beadhub-7zjk beadhub-7wpr --type=parent-child\n```\n\nOutput was:\n```\nâœ“ Added dependency: beadhub-7zjk depends on beadhub-7wpr (parent-child)\n```\n\n4. Frontend dashboard showed all issues as flat list (no hierarchy visible)\n\n5. Created another unrelated issue:\n```bash\nbdh create --title=\"Frontend dashboard shows parent-child issues as flat list\" --type=bug --priority=1 --body=\"...\"\n```\n\nOutput was:\n```\nâœ“ Created issue: beadhub-rkud\nSYNC: +1 inserted, ~30 updated\n```\n\n6. After this sync, the frontend correctly displayed the parent-child hierarchy\n\n## Observations\n\n- The `bdh dep add` commands did NOT trigger a sync that updated the existing issues\n- Previous `bdh create` commands showed only `+1 inserted` in sync output\n- The final `bdh create` showed `~30 updated` which propagated the parent-child relationships\n- CLI showed correct relationships throughout (`bdh show` worked correctly)\n\n## Root Cause Hypothesis\n\nThe `bdh dep add` command stores the relationship locally but does not trigger a full sync to the frontend/server. The relationships only propagate when a subsequent operation triggers a sync that includes the updated issues.\n\n## Relevant Issue IDs\n\n- Epic: `beadhub-7wpr`\n- Example child: `beadhub-7zjk`\n- All children visible via: `bdh show beadhub-7wpr`","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-10T11:02:07.719745+01:00","created_by":"juanre","updated_at":"2026-01-10T11:14:02.981536+01:00","closed_at":"2026-01-10T11:14:02.981536+01:00","close_reason":"Fixed: added 'dep' to IsMutationCommand so dep add/remove/relate/unrelate trigger sync to server"}
{"id":"beadhub-rkxj","title":"Update routes/bdh.py: Pydantic models and handlers for alias/repo_id","description":"Update src/beadhub/routes/bdh.py for new data model.\n\nPydantic model changes:\n- CommandRequest: agent_name â†’ alias, add repo_origin field\n- BeadInProgress: agent_name â†’ alias\n- SyncRequest: agent_name â†’ alias\n\nFunction updates:\n- upsert_workspace(): agent_name param â†’ alias, add repo_id param\n  - Call repos/ensure internally to get repo_id from repo_origin\n  - Or expect repo_id to be passed from caller\n- get_bead_claim(): return alias instead of agent_name\n- get_beads_in_progress(): return alias instead of agent_name  \n- check_agent_name_collision() â†’ check_alias_collision()\n  - Update uniqueness check: per-project instead of global\n- upsert_bead_claim(): agent_name param â†’ alias\n\nHandler updates:\n- bdh_command(): \n  - Parse repo_origin to get/create repo, get repo_id\n  - Register presence with alias and repo_id\n  - Upsert workspace with repo_id\n- bdh_sync(): sync alias to claims (not agent_name)\n\nValidation updates per beadhub-utg3 (use same patterns):\n- alias: ^[a-zA-Z0-9][a-zA-Z0-9_-]{0,63}$\n- human_name: ^[a-zA-Z][a-zA-Z '-]{0,63}$\n- project_slug: ^[a-z0-9][a-z0-9-]{0,62}$\n\nNOTE: This task subsumes beadhub-utg3 (field validators) - close that bead when this is done.\n\nDepends on: DB migrations, presence.py, repos/ensure endpoint","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T12:50:39.1464+01:00","updated_at":"2025-12-12T23:10:51.688513+01:00","closed_at":"2025-12-12T23:10:51.688513+01:00","dependencies":[{"issue_id":"beadhub-rkxj","depends_on_id":"beadhub-47mi","type":"blocks","created_at":"2025-12-12T12:50:47.652272+01:00","created_by":"juanre"},{"issue_id":"beadhub-rkxj","depends_on_id":"beadhub-f9rh","type":"blocks","created_at":"2025-12-12T12:50:47.714031+01:00","created_by":"juanre"},{"issue_id":"beadhub-rkxj","depends_on_id":"beadhub-wvj6","type":"blocks","created_at":"2025-12-12T12:50:47.774358+01:00","created_by":"juanre"},{"issue_id":"beadhub-rkxj","depends_on_id":"beadhub-w4sg","type":"blocks","created_at":"2025-12-12T14:52:39.062327+01:00","created_by":"juanre"}]}
{"id":"beadhub-rkzo","title":"MCP and agents routes missing project_id/repo_id in update_agent_presence","description":"Discovered in beadhub-xrne review: /v1/agents/register and MCP routes only pass project_slug to update_agent_presence(), not project_id or repo_id.\n\nImpact after beadhub-f1na fix:\n- These agents WILL appear in list_agent_presences() (via idx:all_workspaces)\n- These agents WILL appear in get_workspace_ids_by_project_slug() (via idx:project_slug_workspaces)\n- These agents will NOT appear in /v1/status?repo_id=... queries (no idx:repo_workspaces entry)\n- These agents will NOT appear in get_workspace_ids_by_project_id() (no idx:project_workspaces entry)\n\nFix: update agents.py and mcp.py to pass project_id and repo_id (may need to add these to request payloads or resolve from project_slug).","status":"closed","priority":2,"issue_type":"bug","assignee":"dave-agent","created_at":"2025-12-13T15:58:02.87682+01:00","updated_at":"2026-01-03T17:15:38.511202Z","closed_at":"2026-01-03T17:15:38.511202Z","close_reason":"Added project_id/repo_id optional fields to /v1/agents/register and MCP register_agent. Both now pass these to update_agent_presence for proper secondary index creation. Agents with repo_id now appear in /v1/status?repo_id=... queries.","dependencies":[{"issue_id":"beadhub-rkzo","depends_on_id":"beadhub-xrne","type":"discovered-from","created_at":"2025-12-13T15:58:02.877739+01:00","created_by":"juanre"}]}
{"id":"beadhub-rl0m","title":"Chat create_session still writes Redis pending/session hashes after Postgres pending refactor","description":"After beadhub-6qlj, GET /v1/chat/pending reads from Postgres (participants/messages/read_receipts). However create_session still writes Redis chat:session:{id} hashes and adds session_id to chat:pending:{workspace_id} sets. This is now redundant and violates the v2.1 goal of Redis pub/sub only.\n\nFix: remove Redis pending/session-hash writes, or gate behind an explicit legacy flag until all clients stop depending on it.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-14T08:50:59.328805+01:00","updated_at":"2025-12-14T09:20:28.235799+01:00","closed_at":"2025-12-14T09:20:28.235799+01:00"}
{"id":"beadhub-rl9y","title":"Epic: Implement new data model with repos table and alias rename","description":"Comprehensive refactoring of BeadHub to implement the new data model from data-model.md.\n\nKey changes:\n1. Add repos table with canonical_origin for repo identification\n2. Add tenant_id to projects table for multi-tenant isolation\n3. Rename agent_name â†’ alias everywhere (DB, Redis, Python, Go)\n4. Add repo_id FK to workspaces table\n5. Add Redis secondary indexes for efficient queries\n6. Update all API routes, tests, and CLI\n\nThis is zero-tech-debt work - all migrations will be edited in place, no backwards compatibility needed.\n\nRelated documents:\n- beadhub-sot/source-of-truth/data-model.md\n- beadhub-sot/source-of-truth/beadhub-specifications.md v2.2.0\n- beadhub-sot/source-of-truth/beadhub-bdh-design.md v1.2.0","status":"closed","priority":0,"issue_type":"epic","created_at":"2025-12-12T12:47:58.666587+01:00","updated_at":"2025-12-12T18:24:50.036018+01:00","closed_at":"2025-12-12T18:24:50.036018+01:00","dependencies":[{"issue_id":"beadhub-rl9y","depends_on_id":"beadhub-f9rh","type":"blocks","created_at":"2025-12-12T15:06:32.864974+01:00","created_by":"juanre"},{"issue_id":"beadhub-rl9y","depends_on_id":"beadhub-q1xh","type":"blocks","created_at":"2025-12-12T15:06:32.936994+01:00","created_by":"juanre"},{"issue_id":"beadhub-rl9y","depends_on_id":"beadhub-wvj6","type":"blocks","created_at":"2025-12-12T15:06:33.006201+01:00","created_by":"juanre"},{"issue_id":"beadhub-rl9y","depends_on_id":"beadhub-yf1p","type":"blocks","created_at":"2025-12-12T15:06:33.078629+01:00","created_by":"juanre"},{"issue_id":"beadhub-rl9y","depends_on_id":"beadhub-q3y5","type":"blocks","created_at":"2025-12-12T15:06:33.15069+01:00","created_by":"juanre"},{"issue_id":"beadhub-rl9y","depends_on_id":"beadhub-6d4m","type":"blocks","created_at":"2025-12-12T15:06:33.22462+01:00","created_by":"juanre"},{"issue_id":"beadhub-rl9y","depends_on_id":"beadhub-txuf","type":"blocks","created_at":"2025-12-12T15:06:33.29533+01:00","created_by":"juanre"},{"issue_id":"beadhub-rl9y","depends_on_id":"beadhub-3840","type":"blocks","created_at":"2025-12-12T15:06:33.367622+01:00","created_by":"juanre"},{"issue_id":"beadhub-rl9y","depends_on_id":"beadhub-3efj","type":"blocks","created_at":"2025-12-12T15:06:33.437891+01:00","created_by":"juanre"},{"issue_id":"beadhub-rl9y","depends_on_id":"beadhub-47mi","type":"blocks","created_at":"2025-12-12T15:06:33.507779+01:00","created_by":"juanre"},{"issue_id":"beadhub-rl9y","depends_on_id":"beadhub-79uv","type":"blocks","created_at":"2025-12-12T15:06:33.57534+01:00","created_by":"juanre"},{"issue_id":"beadhub-rl9y","depends_on_id":"beadhub-i8qj","type":"blocks","created_at":"2025-12-12T15:06:33.646919+01:00","created_by":"juanre"},{"issue_id":"beadhub-rl9y","depends_on_id":"beadhub-lhx4","type":"blocks","created_at":"2025-12-12T15:06:33.720802+01:00","created_by":"juanre"}]}
{"id":"beadhub-rp8b","title":"P0 sync gap repro","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-07T16:49:25.447359+01:00","created_by":"juanre","updated_at":"2026-01-07T17:01:42.269732+01:00","closed_at":"2026-01-07T17:01:42.269732+01:00","close_reason":"Repro for bdh sync P0 (daemon export timing)"}
{"id":"beadhub-rrmq","title":"Update bdh notifications to show waiting vs messages","description":"Update context.go and passthrough.go to show:\n- WAITING: X is waiting for you (sender_waiting=true)\n- MESSAGES: N from X (sender_waiting=false)\nUpdate PendingConversation struct in client.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-14T17:07:18.756374+01:00","updated_at":"2025-12-14T17:13:30.762557+01:00","closed_at":"2025-12-14T17:13:30.762557+01:00","dependencies":[{"issue_id":"beadhub-rrmq","depends_on_id":"beadhub-2s14","type":"blocks","created_at":"2025-12-14T17:07:26.855482+01:00","created_by":"juanre"},{"issue_id":"beadhub-rrmq","depends_on_id":"beadhub-jb5q","type":"blocks","created_at":"2025-12-14T17:07:27.258956+01:00","created_by":"juanre"}]}
{"id":"beadhub-rsh5","title":"bdh.py: get_beads_in_progress JOIN missing deleted_at filter","description":"Line 493: JOIN workspaces in get_beads_in_progress doesn't filter deleted workspaces. Could show claims from deleted workspaces in coordination context.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-21T20:46:57.895223+01:00","updated_at":"2025-12-21T21:50:45.751528+01:00","closed_at":"2025-12-21T21:50:45.751528+01:00","close_reason":"Filtered get_beads_in_progress to exclude soft-deleted workspaces per SOT; added regression test."}
{"id":"beadhub-rt3t","title":"Add bead_id validation after parsing in /v1/bdh/command","description":"The parse_claim_attempt() regex extracts any non-whitespace as bead_id. Malicious input like 'update $(rm -rf /) --status in_progress' would extract '$(rm -rf /)'. Must validate bead_id matches ^[a-zA-Z0-9_-]+$ pattern before using it.","status":"closed","priority":0,"issue_type":"bug","assignee":"eve-agent","created_at":"2025-12-10T10:43:03.712076+01:00","updated_at":"2026-01-03T17:25:34.091619Z","closed_at":"2026-01-03T17:25:34.091619Z","close_reason":"Added bead_id validation after parse_status_change() and parse_close_attempt() using is_valid_bead_id. Returns 422 for invalid bead_ids containing shell metacharacters. Test added for injection patterns.","dependencies":[{"issue_id":"beadhub-rt3t","depends_on_id":"beadhub-f5il","type":"discovered-from","created_at":"2025-12-10T10:43:03.712994+01:00","created_by":"juanre"}]}
{"id":"beadhub-rthm","title":"Cascading dropdown filters for dashboard","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-08T17:50:31.611358+01:00","updated_at":"2025-12-08T18:10:46.373005+01:00","closed_at":"2025-12-08T18:10:46.373005+01:00"}
{"id":"beadhub-rtwz","title":"Validate role length in Go config.LoadRole()","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-15T15:32:03.278422+01:00","updated_at":"2025-12-15T15:33:10.087235+01:00","closed_at":"2025-12-15T15:33:10.087235+01:00"}
{"id":"beadhub-ryz","title":"Fix workspace enumeration timing attack in ensure_workspace","description":"routes/mcp.py _tool_ensure_workspace reveals workspace existence via timing differences between SELECT and INSERT. Use UPSERT for constant-time response.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-07T22:17:23.589206+01:00","updated_at":"2025-12-08T09:25:32.074852+01:00","closed_at":"2025-12-08T09:25:32.074852+01:00"}
{"id":"beadhub-rzko","title":"Add cross-project message rejection test","description":"Add tests that cross-project message sends are rejected (403) to cover tenant isolation in messages routing.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T11:20:37.039544+01:00","updated_at":"2025-12-20T11:24:36.596191+01:00","closed_at":"2025-12-20T11:24:36.596191+01:00","close_reason":"Completed","dependencies":[{"issue_id":"beadhub-rzko","depends_on_id":"beadhub-f0kk","type":"discovered-from","created_at":"2025-12-20T11:20:37.040847+01:00","created_by":"juanre"}]}
{"id":"beadhub-s0qa","title":"Workspaces API vNext: formalize and implement registry vs team-status split","description":"Goal\n- Implement the new Workspaces API described in beadhub-qrnr as the canonical server contract (we have not shipped; prioritize correctness, clarity, and scalability over compatibility).\n\nScope\n1) `GET /v1/workspaces` (registry)\n- Keep as registry listing with filters (`project_slug`, `human_name`, `repo`, `include_deleted`).\n- Add explicit enrichment toggles so callers do not accidentally trigger expensive joins:\n  - `include_claims` (default false)\n  - `include_presence` (default true)\n  - optional `limit` (unset = full for that filter; set = bounded registry).\n- Tenant model: if `X-Project-ID` is present, it scopes results (Cloud); `project_slug` is then only for display/filter within that tenant.\n\n2) `GET /v1/workspaces/team` (team-status)\n- New endpoint for bounded, prioritized coordination views.\n- Default `limit=15`, max 200; stable ordering and tie-break rules.\n- Must support same filters (`project_slug`, `human_name`, `repo`) + team-specific params (`only_with_claims`, `always_include_workspace_id`, include toggles).\n\n3) Response shape\n- Reuse existing `WorkspaceInfo`/`Claim` shapes where possible, but ensure:\n  - `role` is populated from DB for offline workspaces (presence is a cache).\n  - `status/last_seen` come from presence if present, else offline.\n  - `claims` list only present when include_claims=true.\n\n4) Performance invariants\n- Presence merge is O(number of returned workspaces) via pipelining; never global presence scans.\n- No recursive apex computation in either endpoint; apex is stored on claims at write time.\n\nImplementation Tasks\n- Update server code (`src/beadhub/routes/workspaces.py`, `src/beadhub/presence.py`, potentially DB migrations/indexes).\n- Update/expand tests: ordering, limit, tenant scoping, include toggles.\n\nValidation\n- `uv run pytest` passes.\n- Benchmark confirms `/v1/workspaces/team` remains fast and payload-bounded with 5k workspaces / 25k claims seeded.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-21T13:34:13.237716+01:00","updated_at":"2025-12-21T16:43:13.142404+01:00","closed_at":"2025-12-21T16:43:13.142404+01:00","close_reason":"Add registry option tests (claims, presence, limit)","dependencies":[{"issue_id":"beadhub-s0qa","depends_on_id":"beadhub-qrnr","type":"discovered-from","created_at":"2025-12-21T13:34:13.238942+01:00","created_by":"juanre"}]}
{"id":"beadhub-s1xf","title":"Update Go bdh tests: config_test.go, client_test.go","description":"Update Go test files for new data model.\n\nFiles to update:\n1. bdh/internal/config/config_test.go:\n   - Test config field assignments: AgentName â†’ Alias\n   - Test YAML parsing for both alias and agent_name (migration)\n   - Test RepoOrigin field\n\n2. bdh/internal/client/client_test.go:\n   - Test request structs with Alias instead of AgentName\n   - Test RepoOrigin in requests\n\nThis updates tests to match the new struct fields.\n\nDepends on: config.go, client.go changes","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T12:52:14.076568+01:00","updated_at":"2025-12-13T17:36:51.334913+01:00","closed_at":"2025-12-13T17:36:51.334913+01:00","dependencies":[{"issue_id":"beadhub-s1xf","depends_on_id":"beadhub-je0h","type":"blocks","created_at":"2025-12-12T12:52:24.928487+01:00","created_by":"juanre"},{"issue_id":"beadhub-s1xf","depends_on_id":"beadhub-lhx4","type":"blocks","created_at":"2025-12-12T12:52:24.988003+01:00","created_by":"juanre"}]}
{"id":"beadhub-s35l","title":"Persist workspace focus apex (remember last epic context)","description":"Problem: bdh derives apex context (WORKING ON / Working on epic) only from *active claims* (bead_claims.apex_*). In the common workflow, agents claim subtasks under an epic and then close/release claims as they finish. When the last claim is closed, all apex context disappears. If the user opens a new agent/session in the same workspace, bdh ready/:who provide no clue what epic they were working under.\n\nGoal: Persist a workspace-level 'focus apex' that survives claim release, so agents regain context in new sessions even with zero active claims.\n\nKey behavior: focus_apex is updated whenever a new claim is created (or whenever a claim with a different apex is created). When claims are released, focus_apex remains as the last known apex until replaced by a later claim.\n\nApproach (no backwards-compat required, not deployed):\n- DB: add focus_apex fields to workspaces (focus_apex_bead_id + focus_apex_repo_name + focus_apex_branch + focus_updated_at). Optionally join beads_issues at read time to show title/type.\n- Write path: when a claim is created in /v1/bdh/command, set workspaces.focus_apex_* from the claim's computed apex_* in the same transaction.\n- Read path:\n  - /v1/workspaces/team should return focus apex fields even when the workspace has no active claims.\n  - bdh ready should show a 'RECENT CONTEXT' (or similar) section when there are no active claims, sourced from focus apex.\n  - bdh :who should show either current apex (from active claims) or recent focus (clearly labeled) for workspaces without claims.\n\nAcceptance: After closing the last claim, reopening bdh ready in the same workspace shows the last focus apex, and other agents can see 'recent focus' in :who/team view.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-21T19:38:18.302751+01:00","updated_at":"2025-12-21T20:04:02.118212+01:00","closed_at":"2025-12-21T20:04:02.118212+01:00","close_reason":"Persist focus apex across claims"}
{"id":"beadhub-s3va","title":"Display apex context in :who output","description":"Enhance :who output to show apex context for each agent. Change from: 'claude-be â€” working on bd-42 \"JWT validation\"' to: 'claude-be â€” bd-42 \"JWT validation\" (epic: beadhub-xyz \"Auth system\")'. Requires server to include apex in workspace response, or client to look it up from issues.jsonl.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T21:59:18.60314+01:00","updated_at":"2025-12-20T11:13:07.225358+01:00","closed_at":"2025-12-20T11:13:07.225358+01:00","close_reason":"Implemented apex display in :who output with Role: and Apex: formatting","dependencies":[{"issue_id":"beadhub-s3va","depends_on_id":"beadhub-npuh","type":"parent-child","created_at":"2025-12-17T21:59:33.03928+01:00","created_by":"juanre"},{"issue_id":"beadhub-s3va","depends_on_id":"beadhub-k571","type":"blocks","created_at":"2025-12-17T21:59:40.984832+01:00","created_by":"juanre"}]}
{"id":"beadhub-s49k","title":"Align SOT docs for /v1/status/stream and Cloud auth bridge","description":"SOT currently disagrees about /v1/status/stream (architecture/specs list it as planned while OSS status + code implement it and treat it as API-key-protected when BEADHUB_API_KEY is set). Also clarify Cloud auth-bridge behavior for SSE: browser uses session+project_id query param to let the bridge set X-Project-ID; OSS layer must never allow cross-project selection in Cloud. Update source-of-truth docs to match implemented behavior and avoid confusion between BEADHUB_API_KEY (OSS) and Cloud project API keys.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-22T13:09:55.312255+01:00","updated_at":"2025-12-22T13:18:54.120698+01:00","closed_at":"2025-12-22T13:18:54.120698+01:00","close_reason":"Aligned SOT docs for /v1/status/stream + clarified OSS/Cloud API key headers and admin authorization; pushed beadhub-sot commit b9df9b9"}
{"id":"beadhub-s4rj","title":"Dashboard: filtering by repo/owner/project","description":"Add optional filtering to the dashboard (after show-all-by-default is done).\n\nFilter options:\n- By repo (e.g., show only 'beadhub' repo)\n- By owner/human_name (e.g., show only Juan's workspaces)\n- By project (if multiple projects exist)\n- By workspace ID (for power users/debugging)\n\nImplementation:\n- Filter chips in header or sidebar\n- URL query params for shareable filtered views\n- Persist last-used filters in localStorage\n\nDepends on: beadhub-ich1 (show-all redesign)","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T16:22:08.362701+01:00","updated_at":"2025-12-08T17:12:25.168576+01:00","closed_at":"2025-12-08T17:12:25.168576+01:00","dependencies":[{"issue_id":"beadhub-s4rj","depends_on_id":"beadhub-ich1","type":"blocks","created_at":"2025-12-08T16:22:08.364+01:00","created_by":"juanre"}]}
{"id":"beadhub-sac","title":"Remove filesystem-based beads sync","description":"Edit existing migrations to remove filesystem sync: 1) server/002_repos.sql - remove path_or_url column or make optional, 2) Remove BEADS_JSONL_PATH config, 3) Remove _read_issues_from_jsonl() and filesystem-based sync endpoints, 4) Keep only upload-based sync. No new migration needed since DB hasn't been deployed.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T22:58:31.793778+01:00","updated_at":"2025-12-07T09:22:35.476829+01:00","closed_at":"2025-12-07T09:22:35.476829+01:00","dependencies":[{"issue_id":"beadhub-sac","depends_on_id":"beadhub-ya3","type":"blocks","created_at":"2025-12-06T22:59:04.842487+01:00","created_by":"juanre"},{"issue_id":"beadhub-sac","depends_on_id":"beadhub-vo4","type":"parent-child","created_at":"2025-12-06T22:59:04.895757+01:00","created_by":"juanre"}]}
{"id":"beadhub-sac9","title":"Integrate aweb agent heartbeat into workspace heartbeat","description":"When aweb adds POST /v1/agents/heartbeat (epic aweb-gkv), beadhub's workspace heartbeat should also call it as a side-effect so beadhub agents appear online in aweb's presence system. Depends on aweb work landing first.","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-02-04T09:42:48.331797Z","created_by":"Juan Reyero","updated_at":"2026-02-04T10:18:23.950398Z","closed_at":"2026-02-04T10:18:23.950398Z","close_reason":"Closed"}
{"id":"beadhub-sbl","title":"Add test coverage for panic and revoke","description":"Test /v1/reservations/revoke endpoint and CLI panic command","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-03T06:38:49.921679+01:00","updated_at":"2025-12-03T06:46:08.40735+01:00","closed_at":"2025-12-03T06:46:08.40735+01:00","close_reason":"Test coverage added in tests/test_revoke.py: 7 tests covering revoke all, revoke by agent, empty project, auth requirements, glob injection prevention, valid paths."}
{"id":"beadhub-sczz","title":"Frontend: add dashboardIdentity to store and fetch on load","description":"Add dashboardIdentity state to useStore (workspace_id, alias, human_name, project_id). Fetch from /v1/dashboard/identity on dashboard load. Store for session duration.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T19:27:04.478208+01:00","updated_at":"2025-12-13T20:13:50.338043+01:00","closed_at":"2025-12-13T20:13:50.338043+01:00","dependencies":[{"issue_id":"beadhub-sczz","depends_on_id":"beadhub-k3jq","type":"blocks","created_at":"2025-12-13T19:27:37.137161+01:00","created_by":"juanre"},{"issue_id":"beadhub-sczz","depends_on_id":"beadhub-g9l6","type":"parent-child","created_at":"2025-12-13T19:27:52.567258+01:00","created_by":"juanre"}]}
{"id":"beadhub-sgjk","title":"SSE: repo_id filter uses Redis presence instead of database","description":"## Problem\n\nThe SSE endpoint `/v1/status/stream` with `repo_id` filter still uses Redis presence to get workspace IDs:\n\n```python\nelif repo_id:\n    workspace_ids = await get_workspace_ids_by_repo_id(redis, repo_id)\n```\n\nThis has the same staleness bug that was just fixed for the no-filter case - if a workspace's Redis presence expires or has stale data, SSE won't subscribe to that workspace's channel even though messages are still routed to it via the database.\n\n## Location\n\n`src/beadhub/routes/status.py:254-255`\n\n## Fix Required\n\n1. Add `get_workspace_ids_by_repo_id_from_db(db_infra, repo_id)` function that queries:\n   ```sql\n   SELECT workspace_id \n   FROM workspaces\n   WHERE repo_id = $1 AND deleted_at IS NULL\n   ```\n\n2. Update SSE endpoint to use database query instead of Redis\n\n## Related\n\n- Fixed in 5599a6f for no-filter case\n- Same issue exists for project_slug filter (beadhub-qmp0)","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-20T15:59:25.605222+01:00","updated_at":"2025-12-21T10:15:45.444282+01:00","closed_at":"2025-12-21T10:15:45.444282+01:00","close_reason":"SSE repo_id filter now uses database query instead of Redis presence","dependencies":[{"issue_id":"beadhub-sgjk","depends_on_id":"beadhub-qmp0","type":"related","created_at":"2025-12-20T16:00:07.367141+01:00","created_by":"juanre"},{"issue_id":"beadhub-sgjk","depends_on_id":"beadhub-tyf3","type":"blocks","created_at":"2025-12-21T09:49:27.992232+01:00","created_by":"juanre"}]}
{"id":"beadhub-sgup","title":"Backend: Restore reservations router with updated API","description":"Restore the reservations router, adapting it to current BeadHub architecture.\n\n## Recovery Source\n\ngit show 1abe435^:src/beadhub/routes/reservations.py\n\n## Endpoints to Restore\n\n1. POST /v1/reservations - acquire locks\n   - Request: workspace_id, alias, paths[], ttl_seconds, exclusive, reason, bead_id\n   - Response: granted[], conflicts[]\n\n2. POST /v1/reservations/release - release locks\n   - Request: workspace_id, alias, paths[] (or all=true)\n   - Response: released[], not_found[], not_owner[]\n\n3. POST /v1/reservations/renew - extend TTL\n   - Request: workspace_id, alias, paths[], ttl_seconds\n   - Response: renewed[], not_found[], not_owner[]\n\n4. GET /v1/reservations - list active locks\n   - Query params: project_slug, workspace_id, path_prefix\n   - Response: reservations[]\n\n5. POST /v1/reservations/revoke - admin force-release (API key auth)\n   - Request: project_slug, paths[] or workspace_id\n   - Response: revoked_count\n\n## Changes from Old Implementation\n\n1. Add project_slug parameter (old version used workspace_id only)\n2. Support project_key alias for mcp_agent_mail compatibility\n3. Update to current auth patterns (require_api_key, validate_workspace_id)\n\n## Files to Create/Modify\n\n- src/beadhub/routes/reservations.py (new, based on old)\n- src/beadhub/api.py (add router)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-15T21:39:26.062235+01:00","updated_at":"2025-12-16T21:04:20.210364+01:00","closed_at":"2025-12-16T21:04:20.210364+01:00","dependencies":[{"issue_id":"beadhub-sgup","depends_on_id":"beadhub-1tty","type":"blocks","created_at":"2025-12-15T21:42:52.551898+01:00","created_by":"juanre"}]}
{"id":"beadhub-sj9x","title":"Modify bdh sync to only send changed issues","description":"Update passthrough.go sync logic:\n\nCurrent: Reads full issues.jsonl, sends entire content\nNew:\n1. Load sync state (last-synced hashes)\n2. Compute current hashes for all issues\n3. Compare: find added, modified, deleted issues\n4. Send only changed issues + deleted IDs\n5. Update sync state on success\n\nRequest format change:\n{\n  \"sync_mode\": \"incremental\",\n  \"changed_issues\": [...],\n  \"deleted_ids\": [...]\n}\n\nFallback to full sync if:\n- No sync state file\n- Server requests full sync\n- --full flag passed\n\nFiles: bdh/internal/commands/passthrough.go","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T10:31:30.611514+01:00","updated_at":"2025-12-22T11:25:26.428668+01:00","closed_at":"2025-12-22T11:25:26.428668+01:00","close_reason":"Modified passthrough sync to use incremental mode - computes hashes, finds changes, only sends modified/deleted issues","dependencies":[{"issue_id":"beadhub-sj9x","depends_on_id":"beadhub-9v3g","type":"blocks","created_at":"2025-12-22T10:34:51.898594+01:00","created_by":"juanre"},{"issue_id":"beadhub-sj9x","depends_on_id":"beadhub-2ia2","type":"blocks","created_at":"2025-12-22T10:38:12.203447+01:00","created_by":"juanre"}]}
{"id":"beadhub-sjvt","title":"Fix test_beads_upload_syncs_issues and test_mcp_beads_ready_and_issue FK violation","description":"Tests fail with ForeignKeyViolationError: audit_log requires project_id to exist in projects table but tests don't create the project first. Error: Key (project_id)=(...) is not present in table projects.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-10T23:20:16.2187+01:00","created_by":"juanre","updated_at":"2026-01-10T23:40:55.067488+01:00","closed_at":"2026-01-10T23:40:55.067488+01:00","close_reason":"Fixed by creating projects before beads upload operations that trigger audit_log FK constraints"}
{"id":"beadhub-skjc","title":"Restore heartbeat endpoint lost in refactor","description":"POST /v1/workspaces/heartbeat was dropped when beadhub-main was refactored into beadhub. The presence.py module survived but the ~249 lines in workspaces.py defining the heartbeat route are missing. Original implementation in beadhub-main/src/beadhub/routes/workspaces.py lines 518-766. Scope: restore beadhub-specific workspace heartbeat only.","status":"closed","priority":2,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-02-04T09:28:28.107105Z","created_by":"Juan Reyero","updated_at":"2026-02-04T09:42:52.996039Z","closed_at":"2026-02-04T09:42:52.996039Z","close_reason":"Closed"}
{"id":"beadhub-skqk","title":"Persist sender_leaving to chat_messages table","description":"The sender_leaving field is transmitted via SSE but not stored in the database. This means historical message queries won't show which messages had sender leaving. Fix: add column to chat_messages, update INSERTs, update MessageHistoryItem model.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-14T11:56:38.72752+01:00","updated_at":"2025-12-14T12:00:39.989757+01:00","closed_at":"2025-12-14T12:00:39.989757+01:00"}
{"id":"beadhub-sl8p","title":"Chat endpoints must use participants table for auth (N-party)","description":"Several endpoints still authorize via chat_sessions.initiator_workspace/target_workspace (1-1) instead of chat_session_participants. This breaks group chat and deviates from beadhub-chat-spec.md v2.1 (participants table is authoritative).\n\nAffected:\n- GET /v1/chat/sessions/{id}/stream\n- POST /v1/chat/sessions/{id}/messages\n- GET /v1/chat/sessions/{id}/messages\n- GET /v1/chat/sessions\n\nFix: replace initiator/target checks with an EXISTS query on chat_session_participants(session_id, workspace_id), and (where needed) return participants from that table.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T23:11:46.537113+01:00","updated_at":"2025-12-13T23:24:08.802618+01:00","closed_at":"2025-12-13T23:24:08.802618+01:00","dependencies":[{"issue_id":"beadhub-sl8p","depends_on_id":"beadhub-ixss","type":"discovered-from","created_at":"2025-12-13T23:11:46.538289+01:00","created_by":"juanre"}]}
{"id":"beadhub-slcs","title":"Issues page: Show all issues by default without requiring workspace/project ID","description":"IssuesPage currently requires manual entry of workspace_id and project_id before showing any data. Other pages (Status, Locks, Escalations) now show all data by default.\n\nChallenge: The beads API requires X-Project-ID header for tenant isolation. Options:\n1. Add a new endpoint that lists all issues across projects (admin view)\n2. Use the global filter bar's projectKeyFilter to determine project context\n3. Auto-detect project from workspace selection\n\nNeed to also add issues count to Status page stats grid.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-08T17:17:35.935046+01:00","updated_at":"2025-12-08T17:39:10.65473+01:00","closed_at":"2025-12-08T17:39:10.65473+01:00"}
{"id":"beadhub-sm5","title":"Fix race condition in message acknowledgment","description":"**Problem**: The acknowledge endpoint in `routes/messages.py:167-198` reads all messages, finds the target, modifies it, and writes back using `lset`. This is not atomic and can lose updates if messages are added/removed concurrently.\n\n**File**: `routes/messages.py:175-192`\n\n**Current code**:\n```python\nraw_items = await run_in_threadpool(redis.lrange, key, 0, -1)\nupdated = False\n\nfor index, raw in enumerate(raw_items):\n    # ... find and update ...\n    await run_in_threadpool(redis.lset, key, index, serialized)\n```\n\n**Problem scenarios**:\n1. Agent A reads inbox (3 messages at index 0,1,2)\n2. New message arrives (now 4 messages, indexes shift)\n3. Agent A writes to index 1 - wrong message gets modified!\n\n**Fix options**:\n1. Use Redis Lua script for atomic read-modify-write\n2. Use Redis WATCH/MULTI/EXEC transaction\n3. Change data structure from list to hash (keyed by message_id)\n\n**Recommended**: Option 3 (hash by message_id) is cleanest and avoids index problems entirely.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-02T19:45:18.271054+01:00","updated_at":"2025-12-02T21:45:14.123727+01:00","closed_at":"2025-12-02T21:45:14.123727+01:00","close_reason":"Changed message inbox from Redis list to hash (keyed by message_id). Eliminates index-shift race condition. hset/hget/hgetall operations are atomic per message.","dependencies":[{"issue_id":"beadhub-sm5","depends_on_id":"beadhub-9i0","type":"blocks","created_at":"2025-12-02T19:45:18.27169+01:00","created_by":"juanre"}]}
{"id":"beadhub-smxc","title":"bdh cleanup: remove committed ./bdh/bdh binary and keep it gitignored","description":"A built Mach-O binary is currently tracked at ./bdh/bdh. This is build output and should not be committed. Remove it from git history completely (use git filter-branch or BFG Repo-Cleaner) and ensure .gitignore keeps ignoring it. Adjust release/build scripts as needed.","status":"closed","priority":2,"issue_type":"chore","created_at":"2025-12-13T12:52:09.924108+01:00","updated_at":"2025-12-13T17:50:24.550465+01:00","closed_at":"2025-12-13T17:50:24.550465+01:00","dependencies":[{"issue_id":"beadhub-smxc","depends_on_id":"beadhub-t265","type":"discovered-from","created_at":"2025-12-13T12:52:09.925332+01:00","created_by":"juanre"}]}
{"id":"beadhub-sp89","title":"Store bead claims in Redis for fast lookup","description":"In addition to the bead_claims table, maintain a Redis structure for fast claim lookups:\n\nKey pattern: claim:{project_key}:{bead_id}\nValue: JSON { workspace_id, agent_name, human_name, claimed_at }\nTTL: Configurable stale timeout (default 4 hours)\n\nAlso maintain a set for listing all claims in a project:\nKey: claims:{project_key}\nType: Set of bead_ids\n\nThis enables O(1) claim checks and fast listing without database queries.\n\nPostgres remains the source of truth; Redis is a cache that gets rebuilt on startup if needed.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T09:35:49.928612+01:00","updated_at":"2025-12-20T09:48:44.521857+01:00","closed_at":"2025-12-20T09:48:44.521857+01:00","close_reason":"Obsolete: claim caching in Redis is not in canonical SOT; claims are stored in Postgres and staleness is derived, not TTL-expired","dependencies":[{"issue_id":"beadhub-sp89","depends_on_id":"beadhub-4trs","type":"parent-child","created_at":"2025-12-10T09:36:05.414361+01:00","created_by":"juanre"},{"issue_id":"beadhub-sp89","depends_on_id":"beadhub-6gfo","type":"blocks","created_at":"2025-12-10T09:36:15.038487+01:00","created_by":"juanre"}]}
{"id":"beadhub-sppz","title":"Handle multiple apex beads with warning","description":"When claiming a bead whose apex differs from current apex: 1) Warn the user that they're now working across multiple epics, 2) Store both apex IDs comma-separated in .role line 2. Display should show both apexes in ready/who output. This prevents losing context when an agent pivots to help with a different epic.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T21:59:17.86302+01:00","updated_at":"2025-12-20T10:29:05.977558+01:00","closed_at":"2025-12-20T10:29:05.977558+01:00","close_reason":"Implemented multiple apex accumulation: when claiming a bead from a different epic, the new apex is appended to existing apexes (no duplicates). A warning is displayed showing all epics being worked on. Optimized to load issues.jsonl once for title lookups. All tests pass.","dependencies":[{"issue_id":"beadhub-sppz","depends_on_id":"beadhub-npuh","type":"parent-child","created_at":"2025-12-17T21:59:32.808685+01:00","created_by":"juanre"},{"issue_id":"beadhub-sppz","depends_on_id":"beadhub-9jya","type":"blocks","created_at":"2025-12-17T21:59:40.750981+01:00","created_by":"juanre"}]}
{"id":"beadhub-stjt","title":"Cloud: block /mcp for human principals","description":"Enforce Cloud policy that human principals (JWT/cookie) cannot access the mounted OSS core MCP endpoint. Add /mcp to OssAuthMiddleware human_denylist and add/adjust tests.","acceptance_criteria":"Cloud wrapper returns 403 for human principals calling /api/mcp; API-key callers unaffected; tests cover behavior.","status":"closed","priority":1,"issue_type":"task","assignee":"Juan Reyero","owner":"juan@juanreyero.com","created_at":"2026-01-26T10:46:26.898549+01:00","created_by":"Juan Reyero","updated_at":"2026-01-26T10:50:31.243228+01:00","closed_at":"2026-01-26T10:50:31.243228+01:00","close_reason":"Block /mcp for human principals in Cloud mode; add regression test","labels":["area:security","component:cloud","component:mcp"]}
{"id":"beadhub-svbb","title":"Role length must not generate invalid aliases","description":"We currently allow role up to 200 chars, but aliases are capped at 64. Both /v1/workspaces/suggest-alias and bdh :init can derive a suggested alias from role (e.g., alice-ROLE, ROLE-01). This can produce aliases \u003e64 chars, causing later 422s on registration and a bad UX loop.\n\nFix: enforce a role length limit that guarantees any derived alias stays \u003c=64, and apply it consistently across: server request validation, bdh CLI validation, and the workspaces.role DB constraint (we have not deployed so migrations can be edited).\n\nImportant: simply setting role\u003c=64 is insufficient because the alias prefix adds extra characters. Choose a safe role max (e.g., 50-53) so classic-prefix-role and role-01 always fit within 64.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-21T19:04:16.85014+01:00","updated_at":"2025-12-21T19:10:42.485586+01:00","closed_at":"2025-12-21T19:10:42.485586+01:00","close_reason":"Reduce role max length to 50 and align DB/CLI/API so derived aliases are always \u003c=64.","dependencies":[{"issue_id":"beadhub-svbb","depends_on_id":"beadhub-zp2t","type":"discovered-from","created_at":"2025-12-21T19:04:16.851979+01:00","created_by":"juanre"}]}
{"id":"beadhub-swnj","title":"notifications: Migrate colon commands to use main.go notifications","description":"## Goal\n\nRemove DeferServerNotifications pattern from all colon commands. Let main.go handle notifications uniformly.\n\n## Commands to update\n\n- :status - remove DeferServerNotifications, RefreshPresenceOnly calls\n- :policy - remove DeferServerNotifications, RefreshPresenceOnly calls\n- :send - remove DeferServerNotifications, RefreshPresenceOnly calls\n- :inbox - remove DeferServerNotifications, RefreshPresenceOnly calls\n- :ack - remove DeferServerNotifications, RefreshPresenceOnly calls\n- :who - remove DeferServerNotifications, RefreshPresenceOnly calls\n- :lock/:reservations - remove DeferServerNotifications, RefreshPresenceOnly calls\n- :escalate - remove DeferServerNotifications, RefreshPresenceOnly calls\n- :reset-policy - remove DeferServerNotifications, RefreshPresenceOnly calls\n- :chat - remove DeferServerNotifications calls, use SetExcludeChatAlias instead\n\n## Special handling\n\n- :chat command needs to call SetExcludeChatAlias(targetAgent) before returning so notifications exclude the current chat partner\n\n## Result\n\n- No colon command handles notifications itself\n- main.go prints notifications uniformly\n- RefreshPresenceOnly calls removed (FetchNotifications does this)","status":"closed","priority":1,"issue_type":"task","created_at":"2026-01-10T10:02:51.641574+01:00","created_by":"juanre","updated_at":"2026-01-10T10:49:12.701241+01:00","closed_at":"2026-01-10T10:49:12.701241+01:00","close_reason":"Migrated all colon commands to use main.go PrintNotifications","dependencies":[{"issue_id":"beadhub-swnj","depends_on_id":"beadhub-bt5h","type":"blocks","created_at":"2026-01-10T10:03:04.168659+01:00","created_by":"juanre"},{"issue_id":"beadhub-swnj","depends_on_id":"beadhub-1wqx","type":"parent-child","created_at":"2026-01-10T10:07:44.418396+01:00","created_by":"juanre"}]}
{"id":"beadhub-sync-cache","title":"bdh: move incremental sync state out of .beads","description":"## Problem\n`bdh` currently stores *its own* incremental sync state at `.beads/sync-state.json` (see `bdh/internal/sync/state.go`).\n\n`.beads/` is the Beads toolâ€™s storage area; BeadHub should not create or depend on it. This pollutes repos, confuses ownership, and risks collisions with other tooling that legitimately uses `.beads/`.\n\n## Goal\nMove BeadHub-owned client sync state out of `.beads/` into a BeadHub-owned cache directory, without breaking existing installations.\n\n## Proposed approach\n- New default location (per worktree): `.beadhub-cache/sync-state.json`.\n  - `.beadhub-cache/` sits next to `.beadhub` and is clearly BeadHub-owned.\n  - Create the directory if missing.\n- Backwards compatible migration:\n  - On load, if `.beadhub-cache/sync-state.json` does not exist but `.beads/sync-state.json` does, read the old state and immediately write it to the new location.\n  - Do **not** require `.beads/` to exist.\n  - Leave the old file in place (safer), but stop writing to it.\n\n## Implementation notes\n- Update the default path constant(s):\n  - `bdh/internal/sync/state.go` (`DefaultStateFile`)\n  - `bdh/internal/beads/beads.go` (`SyncStatePath`)\n- Ensure state file writes remain atomic (temp + rename) as today.\n- Update unit tests that currently assert `.beads/sync-state.json` (e.g. `bdh/internal/beads/beads_test.go`).\n\n## Follow-ups (optional)\n- Add `.beadhub-cache/` to repo `.gitignore` so it never shows up as untracked noise.","acceptance_criteria":"- `bdh` no longer writes anything under `.beads/`.\n- `bdh` sync state is stored at `.beadhub-cache/sync-state.json` (created on demand).\n- Existing worktrees with `.beads/sync-state.json` migrate automatically to the new location on first run.\n- Fresh clones work without a `.beads/` directory.\n- Unit tests cover new path + migration.","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-07T14:57:36.889607+01:00","created_by":"juanre","updated_at":"2026-01-08T19:59:50.241457+01:00","closed_at":"2026-01-08T19:59:50.241457+01:00","close_reason":"Implementation complete: sync state now at .beadhub-cache/sync-state.json with automatic migration from legacy .beads/ location","labels":["area:ux","component:bdh","component:sync"]}
{"id":"beadhub-sypo","title":"bdh init: prompt for workspace role if .role missing, show existing role","description":"Improve bdh init to handle .role file: (1) If .role exists, show its content to remind user, (2) If .role missing, prompt user for 1-2 sentence description and create the file. Add --:role flag for non-interactive use.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-14T18:51:07.694069+01:00","updated_at":"2025-12-14T18:52:44.409419+01:00","closed_at":"2025-12-14T18:52:44.409419+01:00"}
{"id":"beadhub-t265","title":"Rewrite bdh in Go","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-11T15:12:36.625058+01:00","updated_at":"2025-12-20T09:56:29.38209+01:00","closed_at":"2025-12-20T09:56:29.38209+01:00","close_reason":"Go rewrite complete. Deployment tasks moved to beadhub-8tkr"}
{"id":"beadhub-t265.1","title":"Initialize Go module and project structure for bdh","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T15:12:52.077123+01:00","updated_at":"2025-12-11T15:26:10.467635+01:00","closed_at":"2025-12-11T15:26:10.467635+01:00","dependencies":[{"issue_id":"beadhub-t265.1","depends_on_id":"beadhub-t265","type":"parent-child","created_at":"2025-12-11T15:12:52.077549+01:00","created_by":"juanre"}]}
{"id":"beadhub-t265.10","title":"Implement bdh :send command with workspace resolution in Go","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T15:13:03.513129+01:00","updated_at":"2025-12-11T18:07:40.172835+01:00","closed_at":"2025-12-11T18:07:40.172835+01:00","dependencies":[{"issue_id":"beadhub-t265.10","depends_on_id":"beadhub-t265.3","type":"blocks","created_at":"2025-12-11T15:14:32.34395+01:00","created_by":"juanre"},{"issue_id":"beadhub-t265.10","depends_on_id":"beadhub-t265.4","type":"blocks","created_at":"2025-12-11T15:14:32.399127+01:00","created_by":"juanre"}]}
{"id":"beadhub-t265.11","title":"Implement bdh :who command in Go","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T15:13:03.698508+01:00","updated_at":"2025-12-11T18:17:30.669951+01:00","closed_at":"2025-12-11T18:17:30.669951+01:00","dependencies":[{"issue_id":"beadhub-t265.11","depends_on_id":"beadhub-t265.3","type":"blocks","created_at":"2025-12-11T15:14:32.45503+01:00","created_by":"juanre"},{"issue_id":"beadhub-t265.11","depends_on_id":"beadhub-t265.4","type":"blocks","created_at":"2025-12-11T15:14:32.50991+01:00","created_by":"juanre"}]}
{"id":"beadhub-t265.12","title":"Implement bdh :ack command in Go","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T15:13:03.885545+01:00","updated_at":"2025-12-11T17:54:10.613761+01:00","closed_at":"2025-12-11T17:54:10.613761+01:00","dependencies":[{"issue_id":"beadhub-t265.12","depends_on_id":"beadhub-t265","type":"parent-child","created_at":"2025-12-11T15:13:03.886017+01:00","created_by":"juanre"},{"issue_id":"beadhub-t265.12","depends_on_id":"beadhub-t265.3","type":"blocks","created_at":"2025-12-11T15:14:32.568054+01:00","created_by":"juanre"},{"issue_id":"beadhub-t265.12","depends_on_id":"beadhub-t265.4","type":"blocks","created_at":"2025-12-11T15:14:32.622693+01:00","created_by":"juanre"}]}
{"id":"beadhub-t265.13","title":"Implement bdh :status command in Go","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T15:13:13.110555+01:00","updated_at":"2025-12-11T18:19:53.809987+01:00","closed_at":"2025-12-11T18:19:53.809987+01:00","dependencies":[{"issue_id":"beadhub-t265.13","depends_on_id":"beadhub-t265.3","type":"blocks","created_at":"2025-12-11T15:14:32.677043+01:00","created_by":"juanre"},{"issue_id":"beadhub-t265.13","depends_on_id":"beadhub-t265.4","type":"blocks","created_at":"2025-12-11T15:14:32.733022+01:00","created_by":"juanre"}]}
{"id":"beadhub-t265.14","title":"Implement bdh :escalate command in Go","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T15:13:13.302561+01:00","updated_at":"2025-12-11T18:21:38.78828+01:00","closed_at":"2025-12-11T18:21:38.78828+01:00","dependencies":[{"issue_id":"beadhub-t265.14","depends_on_id":"beadhub-t265.3","type":"blocks","created_at":"2025-12-11T15:14:32.785002+01:00","created_by":"juanre"},{"issue_id":"beadhub-t265.14","depends_on_id":"beadhub-t265.4","type":"blocks","created_at":"2025-12-11T15:14:32.8422+01:00","created_by":"juanre"}]}
{"id":"beadhub-t265.15","title":"Implement SSE client for real-time streaming in Go","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T15:13:13.500772+01:00","updated_at":"2025-12-11T18:34:09.989298+01:00","closed_at":"2025-12-11T18:34:09.989298+01:00","dependencies":[{"issue_id":"beadhub-t265.15","depends_on_id":"beadhub-t265.4","type":"blocks","created_at":"2025-12-11T15:14:33.010592+01:00","created_by":"juanre"}]}
{"id":"beadhub-t265.16","title":"Implement bdh :chat command with session management in Go","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T15:13:13.691135+01:00","updated_at":"2025-12-11T18:43:03.486662+01:00","closed_at":"2025-12-11T18:43:03.486662+01:00","dependencies":[{"issue_id":"beadhub-t265.16","depends_on_id":"beadhub-t265.15","type":"blocks","created_at":"2025-12-11T15:14:33.172618+01:00","created_by":"juanre"},{"issue_id":"beadhub-t265.16","depends_on_id":"beadhub-t265.3","type":"blocks","created_at":"2025-12-11T15:14:33.228156+01:00","created_by":"juanre"}]}
{"id":"beadhub-t265.17","title":"Implement pending chat request notifications in bdh output","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T15:13:13.875734+01:00","updated_at":"2025-12-11T19:00:20.373889+01:00","closed_at":"2025-12-11T19:00:20.373889+01:00","dependencies":[{"issue_id":"beadhub-t265.17","depends_on_id":"beadhub-t265.3","type":"blocks","created_at":"2025-12-11T15:14:33.392451+01:00","created_by":"juanre"},{"issue_id":"beadhub-t265.17","depends_on_id":"beadhub-t265.4","type":"blocks","created_at":"2025-12-11T15:14:33.447723+01:00","created_by":"juanre"}]}
{"id":"beadhub-t265.18","title":"Add goreleaser config for bdh multi-platform releases","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T15:13:14.064999+01:00","updated_at":"2025-12-22T00:05:51.055269+01:00","closed_at":"2025-12-22T00:05:51.055269+01:00","close_reason":"Created bdh/.goreleaser.yaml with multi-platform builds (linux/darwin/windows, amd64/arm64)","dependencies":[{"issue_id":"beadhub-t265.18","depends_on_id":"beadhub-t265.1","type":"blocks","created_at":"2025-12-11T15:14:33.614768+01:00","created_by":"juanre"},{"issue_id":"beadhub-t265.18","depends_on_id":"beadhub-8tkr","type":"parent-child","created_at":"2025-12-20T09:56:14.064959+01:00","created_by":"juanre"}]}
{"id":"beadhub-t265.19","title":"Create install.sh script for bdh (curl one-liner support)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T15:13:23.10208+01:00","updated_at":"2025-12-22T00:05:51.31522+01:00","closed_at":"2025-12-22T00:05:51.31522+01:00","close_reason":"Created bdh/install.sh with checksum verification and platform detection","dependencies":[{"issue_id":"beadhub-t265.19","depends_on_id":"beadhub-t265.18","type":"blocks","created_at":"2025-12-11T15:14:33.669606+01:00","created_by":"juanre"},{"issue_id":"beadhub-t265.19","depends_on_id":"beadhub-8tkr","type":"parent-child","created_at":"2025-12-20T09:56:14.331288+01:00","created_by":"juanre"}]}
{"id":"beadhub-t265.2","title":"Set up GitHub Actions CI for bdh Go (lint, test, build)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T15:12:52.268801+01:00","updated_at":"2025-12-22T00:05:40.4436+01:00","closed_at":"2025-12-22T00:05:40.4436+01:00","close_reason":"Created .github/workflows/bdh.yml with lint, test, and build jobs","dependencies":[{"issue_id":"beadhub-t265.2","depends_on_id":"beadhub-t265.1","type":"blocks","created_at":"2025-12-11T15:13:37.282469+01:00","created_by":"juanre"},{"issue_id":"beadhub-t265.2","depends_on_id":"beadhub-8tkr","type":"parent-child","created_at":"2025-12-20T09:56:13.802796+01:00","created_by":"juanre"}]}
{"id":"beadhub-t265.20","title":"Write unit tests for bdh Go config parsing and validation","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T15:13:23.287904+01:00","updated_at":"2025-12-22T00:05:51.548178+01:00","closed_at":"2025-12-22T00:05:51.548178+01:00","close_reason":"Unit tests already exist in config_test.go (72% coverage with comprehensive validation tests)","dependencies":[{"issue_id":"beadhub-t265.20","depends_on_id":"beadhub-t265.3","type":"blocks","created_at":"2025-12-11T15:14:40.120329+01:00","created_by":"juanre"},{"issue_id":"beadhub-t265.20","depends_on_id":"beadhub-8tkr","type":"parent-child","created_at":"2025-12-20T09:56:14.589435+01:00","created_by":"juanre"}]}
{"id":"beadhub-t265.21","title":"Write unit tests for bdh Go HTTP client","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T15:13:23.474706+01:00","updated_at":"2025-12-22T00:05:51.782687+01:00","closed_at":"2025-12-22T00:05:51.782687+01:00","close_reason":"Unit tests already exist in client_test.go (56% coverage, tests all API methods)","dependencies":[{"issue_id":"beadhub-t265.21","depends_on_id":"beadhub-t265.4","type":"blocks","created_at":"2025-12-11T15:14:40.176762+01:00","created_by":"juanre"},{"issue_id":"beadhub-t265.21","depends_on_id":"beadhub-8tkr","type":"parent-child","created_at":"2025-12-20T09:56:14.865671+01:00","created_by":"juanre"}]}
{"id":"beadhub-t265.22","title":"Write integration tests for bdh Go (end-to-end with mock server)","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T15:13:23.66519+01:00","updated_at":"2025-12-22T00:05:52.013551+01:00","closed_at":"2025-12-22T00:05:52.013551+01:00","close_reason":"Created tests/test_bdh_go_integration.py - runs bdh Go binary against real BeadHub server (not mock)","dependencies":[{"issue_id":"beadhub-t265.22","depends_on_id":"beadhub-t265.7","type":"blocks","created_at":"2025-12-11T15:14:40.386732+01:00","created_by":"juanre"},{"issue_id":"beadhub-t265.22","depends_on_id":"beadhub-t265.8","type":"blocks","created_at":"2025-12-11T15:14:40.443299+01:00","created_by":"juanre"},{"issue_id":"beadhub-t265.22","depends_on_id":"beadhub-t265.6","type":"blocks","created_at":"2025-12-11T15:14:40.497905+01:00","created_by":"juanre"},{"issue_id":"beadhub-t265.22","depends_on_id":"beadhub-8tkr","type":"parent-child","created_at":"2025-12-20T09:56:15.121901+01:00","created_by":"juanre"}]}
{"id":"beadhub-t265.23","title":"Update bdh documentation for Go version installation","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-11T15:13:23.858287+01:00","updated_at":"2025-12-22T00:05:52.481252+01:00","closed_at":"2025-12-22T00:05:52.481252+01:00","close_reason":"Added installation section to README.md with curl one-liner and from-source build instructions","dependencies":[{"issue_id":"beadhub-t265.23","depends_on_id":"beadhub-t265.19","type":"blocks","created_at":"2025-12-11T15:14:40.652337+01:00","created_by":"juanre"},{"issue_id":"beadhub-t265.23","depends_on_id":"beadhub-8tkr","type":"parent-child","created_at":"2025-12-20T09:56:15.385548+01:00","created_by":"juanre"}]}
{"id":"beadhub-t265.24","title":"Add input validation matching BeadHub API specs in bdh Go","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T15:13:24.052115+01:00","updated_at":"2025-12-22T00:05:52.243374+01:00","closed_at":"2025-12-22T00:05:52.243374+01:00","close_reason":"Input validation already exists in config.go Validate() with UUID, URL, alias, role, etc patterns","dependencies":[{"issue_id":"beadhub-t265.24","depends_on_id":"beadhub-t265.3","type":"blocks","created_at":"2025-12-11T15:14:40.233317+01:00","created_by":"juanre"},{"issue_id":"beadhub-t265.24","depends_on_id":"beadhub-8tkr","type":"parent-child","created_at":"2025-12-20T09:56:15.652009+01:00","created_by":"juanre"}]}
{"id":"beadhub-t265.3","title":"Implement .beadhub config file parsing in Go","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T15:12:52.453663+01:00","updated_at":"2025-12-11T16:09:04.18474+01:00","closed_at":"2025-12-11T16:09:04.18474+01:00","dependencies":[{"issue_id":"beadhub-t265.3","depends_on_id":"beadhub-t265","type":"parent-child","created_at":"2025-12-11T15:12:52.454243+01:00","created_by":"juanre"},{"issue_id":"beadhub-t265.3","depends_on_id":"beadhub-t265.1","type":"blocks","created_at":"2025-12-11T15:13:36.3645+01:00","created_by":"juanre"}]}
{"id":"beadhub-t265.4","title":"Implement BeadHub HTTP client in Go (base client with timeouts, errors)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T15:12:52.638423+01:00","updated_at":"2025-12-11T16:45:41.365792+01:00","closed_at":"2025-12-11T16:45:41.365792+01:00","dependencies":[{"issue_id":"beadhub-t265.4","depends_on_id":"beadhub-t265","type":"parent-child","created_at":"2025-12-11T15:12:52.638902+01:00","created_by":"juanre"},{"issue_id":"beadhub-t265.4","depends_on_id":"beadhub-t265.1","type":"blocks","created_at":"2025-12-11T15:13:36.420056+01:00","created_by":"juanre"}]}
{"id":"beadhub-t265.5","title":"Implement bd subprocess execution with faithful argument passthrough","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T15:12:52.838827+01:00","updated_at":"2025-12-11T16:52:14.234257+01:00","closed_at":"2025-12-11T16:52:14.234257+01:00","dependencies":[{"issue_id":"beadhub-t265.5","depends_on_id":"beadhub-t265","type":"parent-child","created_at":"2025-12-11T15:12:52.83934+01:00","created_by":"juanre"},{"issue_id":"beadhub-t265.5","depends_on_id":"beadhub-t265.1","type":"blocks","created_at":"2025-12-11T15:13:36.475266+01:00","created_by":"juanre"}]}
{"id":"beadhub-t265.6","title":"Implement bdh init command in Go","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T15:12:53.039117+01:00","updated_at":"2025-12-11T17:07:04.117283+01:00","closed_at":"2025-12-11T17:07:04.117283+01:00","dependencies":[{"issue_id":"beadhub-t265.6","depends_on_id":"beadhub-t265","type":"parent-child","created_at":"2025-12-11T15:12:53.039602+01:00","created_by":"juanre"},{"issue_id":"beadhub-t265.6","depends_on_id":"beadhub-t265.3","type":"blocks","created_at":"2025-12-11T15:13:36.631885+01:00","created_by":"juanre"},{"issue_id":"beadhub-t265.6","depends_on_id":"beadhub-t265.4","type":"blocks","created_at":"2025-12-11T15:13:36.689601+01:00","created_by":"juanre"}]}
{"id":"beadhub-t265.7","title":"Implement bd passthrough with pre-flight coordination check","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T15:13:02.953709+01:00","updated_at":"2025-12-11T17:17:45.812212+01:00","closed_at":"2025-12-11T17:17:45.812212+01:00","dependencies":[{"issue_id":"beadhub-t265.7","depends_on_id":"beadhub-t265","type":"parent-child","created_at":"2025-12-11T15:13:02.954182+01:00","created_by":"juanre"},{"issue_id":"beadhub-t265.7","depends_on_id":"beadhub-t265.4","type":"blocks","created_at":"2025-12-11T15:13:36.847183+01:00","created_by":"juanre"},{"issue_id":"beadhub-t265.7","depends_on_id":"beadhub-t265.5","type":"blocks","created_at":"2025-12-11T15:13:36.903441+01:00","created_by":"juanre"}]}
{"id":"beadhub-t265.8","title":"Implement post-mutation sync to BeadHub after bd commands","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-11T15:13:03.140328+01:00","updated_at":"2025-12-11T17:20:02.909152+01:00","closed_at":"2025-12-11T17:20:02.909152+01:00","dependencies":[{"issue_id":"beadhub-t265.8","depends_on_id":"beadhub-t265","type":"parent-child","created_at":"2025-12-11T15:13:03.140758+01:00","created_by":"juanre"},{"issue_id":"beadhub-t265.8","depends_on_id":"beadhub-t265.4","type":"blocks","created_at":"2025-12-11T15:13:37.063135+01:00","created_by":"juanre"},{"issue_id":"beadhub-t265.8","depends_on_id":"beadhub-t265.5","type":"blocks","created_at":"2025-12-11T15:13:37.117666+01:00","created_by":"juanre"}]}
{"id":"beadhub-t265.9","title":"Implement bdh :inbox command in Go","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-11T15:13:03.327196+01:00","updated_at":"2025-12-11T17:42:49.604684+01:00","closed_at":"2025-12-11T17:42:49.604684+01:00","dependencies":[{"issue_id":"beadhub-t265.9","depends_on_id":"beadhub-t265","type":"parent-child","created_at":"2025-12-11T15:13:03.328091+01:00","created_by":"juanre"},{"issue_id":"beadhub-t265.9","depends_on_id":"beadhub-t265.3","type":"blocks","created_at":"2025-12-11T15:14:32.232112+01:00","created_by":"juanre"},{"issue_id":"beadhub-t265.9","depends_on_id":"beadhub-t265.4","type":"blocks","created_at":"2025-12-11T15:14:32.289307+01:00","created_by":"juanre"}]}
{"id":"beadhub-t6pf","title":"Improve :inbox output (hide workspace_id prefix by default)","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-04T17:13:54.501633Z","created_by":"juanre","updated_at":"2026-01-04T17:15:59.752713Z","closed_at":"2026-01-04T17:15:59.752713Z","close_reason":"Hide sender workspace_id in :inbox output by default; add --show-workspace-id flag; update tests"}
{"id":"beadhub-t74p","title":"Missing cleanup on database initialization failure","description":"Location: src/beadhub/api.py:48-55. If DB init fails, Redis is closed but app may be partially initialized. Error propagates but leaves app in undefined state. Causes cryptic errors on subsequent requests, resource leaks, difficult debugging. Fix: proper cleanup for ALL initialized resources on failure, fail fast with clear error.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-08T18:25:00.481579+01:00","updated_at":"2026-01-17T15:36:12.352447+01:00","closed_at":"2026-01-17T15:36:12.352447+01:00","close_reason":"Fixed: Initialize all resources before setting app.state, clean up properly on failure"}
{"id":"beadhub-t7p3","title":"Add human_name to workspace identity model","description":"Extend .beadhub file and agent registration to include human_name (the person who owns the workspace, e.g. 'Juan'). This is needed so the dashboard can show 'Juan's frontend-bot' instead of just 'frontend-bot' or a UUID.\n\nChanges:\n- Update .beadhub file spec to include human_name field\n- Update POST /v1/agents/register to accept member_name or human_name\n- Store human_name in Redis presence data\n- Return human_name in GET /v1/workspaces and GET /v1/status responses","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-08T16:21:18.356399+01:00","updated_at":"2025-12-08T16:43:48.574771+01:00","closed_at":"2025-12-08T16:43:48.574771+01:00"}
{"id":"beadhub-t7wg","title":"Add test coverage for repo_id/canonical_origin validation","description":"Add explicit test coverage for repo_id and canonical_origin validation.\n\nTargets:\n- `repo_id` query/path params should reject non-UUID values with 422.\n- `repo` / `canonical_origin` filters should reject invalid patterns (spaces, scheme prefixes, etc.) with 422.\n\nProposed tests:\n- Add unit/integration tests that call endpoints with invalid inputs and assert 422 + error detail:\n  - `GET /v1/status?repo_id=not-a-uuid`\n  - `GET /v1/workspaces?repo=not a repo`\n  - `POST /v1/repos/ensure` / `POST /v1/repos/lookup` with malformed origin_url if applicable\n\nRelevant areas:\n- `src/beadhub/routes/status.py`\n- `src/beadhub/routes/workspaces.py`\n- `src/beadhub/routes/repos.py`\n- `tests/test_status.py`, `tests/test_workspace_registration.py`, `tests/test_repos.py`\n","acceptance_criteria":"- New tests assert 422 on invalid repo_id and invalid canonical_origin/repo filters","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T00:15:08.626297+01:00","updated_at":"2026-01-03T18:40:58.521905Z"}
{"id":"beadhub-tdp2","title":"SECURITY: Add JSONL upload DoS protection","description":"## Problem\n\nJSONL upload endpoint may be vulnerable to DoS via deeply nested JSON.\n\n### Current Behavior\n\nIn `src/beadhub/routes/beads.py:143-161`:\n```python\ndef _check_json_depth(obj: object, max_depth: int, current_depth: int = 0) -\u003e bool:\n    if current_depth \u003e= max_depth:\n        return False\n    if isinstance(obj, dict):\n        for v in obj.values():\n            if not _check_json_depth(v, max_depth, current_depth + 1):  # Recursion\n                return False\n```\n\nWhile `MAX_JSON_DEPTH = 10` limits recursion, the depth check happens AFTER `json.loads()`, which can still cause Python recursion limit issues with deeply nested payloads.\n\n### Attack Vector\n\n1. Attacker crafts JSON with nesting deeper than Python's recursion limit\n2. `json.loads()` is called before depth check\n3. Python raises RecursionError, crashing worker process\n4. Repeated requests cause DoS\n\n### Solution Options\n\n**Option A: Check size before parsing**\n```python\nMAX_JSONL_SIZE = 10 * 1024 * 1024  # 10MB - already exists\n# Add: Reject payloads likely to be malicious\nif len(line) \u003e 100_000:  # Single line \u003e 100KB is suspicious\n    raise HTTPException(422, \"Line too long\")\n```\n\n**Option B: Use ijson for streaming parse with depth limit**\n```python\nimport ijson\n# Stream parse with depth tracking\n```\n\n**Option C: Catch RecursionError gracefully**\n```python\ntry:\n    data = json.loads(line)\nexcept RecursionError:\n    raise HTTPException(422, \"JSON nesting too deep\")\n```\n\n**Option D: Configure Python recursion limit higher + worker restart**\n- Set `sys.setrecursionlimit()` appropriately\n- Ensure worker process isolation (uvicorn workers restart on crash)\n\n### Files to Update\n\n- `src/beadhub/routes/beads.py`\n\n### Acceptance Criteria\n\n- [ ] Deeply nested JSON does not crash workers\n- [ ] Clear error message for rejected payloads\n- [ ] Legitimate large uploads still work\n- [ ] Add test for deeply nested JSON rejection","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-09T08:32:11.523112+01:00","created_by":"juanre","updated_at":"2026-01-09T21:13:19.21595+01:00","closed_at":"2026-01-09T21:13:19.21595+01:00","close_reason":"Already implemented and tested. RecursionError catch in beads.py:205-211, test in test_beads_upload.py:767-793 (test_beads_upload_jsonl_extremely_deep_nesting_no_crash). All acceptance criteria met."}
{"id":"beadhub-te27","title":"Test --claim fix verification","status":"closed","priority":3,"issue_type":"task","assignee":"juanre","created_at":"2026-01-05T16:47:37.657499Z","created_by":"juanre","updated_at":"2026-01-05T16:59:46.573289Z","closed_at":"2026-01-05T16:59:46.573289Z","close_reason":"Test beads for --claim bug fix verification"}
{"id":"beadhub-tel0","title":"UX: Filter dropdowns should have search for large lists","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-13T21:26:24.973052+01:00","updated_at":"2025-12-13T21:26:24.973052+01:00"}
{"id":"beadhub-telj","title":"Extract priority type to shared constant/enum","description":"Message priority is modeled in multiple places with duplicated string unions.\n\nCurrent state:\n- Backend supports `low|normal|high|urgent`.\n- Frontend `SendMessageDialog` hardcodes `\"low\" | \"normal\" | \"high\"`.\n- API client `sendMessage()` hardcodes `\"low\" | \"normal\" | \"high\"`.\n\nFix:\n- Define a single shared `MessagePriority` type/enum in the frontend and reuse it in:\n  - `frontend/src/lib/api.ts`\n  - `frontend/src/components/SendMessageDialog.tsx`\n- Decide whether to expose `urgent` in the SendMessageDialog UI (recommended), and keep Messages UI consistent.\n","acceptance_criteria":"- Frontend uses a single shared MessagePriority type for send + UI\n- Priority values align with backend","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-13T20:35:31.923645+01:00","updated_at":"2026-01-03T18:40:28.784389Z"}
{"id":"beadhub-tiyh","title":"Add localStorage persistence to Zustand store and fix dark mode flicker","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-08T15:32:34.409442+01:00","updated_at":"2026-02-05T12:20:57.122779Z","closed_at":"2026-02-05T12:20:57.122779Z","close_reason":"Merged to main (9acaeb7). Backend task beadhub-h48b needed for dates to actually display.","dependencies":[{"issue_id":"beadhub-tiyh","depends_on_id":"beadhub-7r4","type":"discovered-from","created_at":"2025-12-08T15:32:34.410207+01:00","created_by":"juanre"}]}
{"id":"beadhub-tltw","title":"TECH DEBT: Refactor workspace_config.py to eliminate ~120 lines of duplication","description":"## Problem\n\nSix nearly identical getter functions in workspace_config.py, differing only by field name.\n\n### Current Behavior\n\nIn `src/beadhub/workspace_config.py:107-229`, there are 6 functions with identical structure:\n\n```python\ndef get_workspace_id(override: str | None = None, path: Path | None = None) -\u003e str | None:\n    if override:\n        return override\n    config = load_workspace_config(path)\n    if config:\n        return config.workspace_id\n    return None\n\ndef get_project_slug(override: str | None = None, path: Path | None = None) -\u003e str | None:\n    if override:\n        return override\n    config = load_workspace_config(path)\n    if config:\n        return config.project_slug\n    return None\n\n# ... 4 more identical functions for:\n# - get_project_id\n# - get_alias\n# - get_human\n# - get_role\n```\n\n### Impact\n\n- ~120 lines of duplicate code\n- Adding new config fields requires copy-pasting\n- Bug fixes must be applied 6 times\n- Violates DRY principle\n\n### Solution\n\nExtract to generic helper:\n\n```python\ndef _get_config_field(\n    field_name: str,\n    override: str | None = None,\n    path: Path | None = None,\n) -\u003e str | None:\n    \"\"\"Get a config field value with optional override.\n    \n    Args:\n        field_name: Name of the WorkspaceConfig field\n        override: If provided, return this instead of config value\n        path: Optional path to .beadhub file\n    \n    Returns:\n        The override value, config value, or None\n    \"\"\"\n    if override:\n        return override\n    config = load_workspace_config(path)\n    if config:\n        return getattr(config, field_name, None)\n    return None\n\n# Simple wrappers for type safety and discoverability:\ndef get_workspace_id(override: str | None = None, path: Path | None = None) -\u003e str | None:\n    return _get_config_field(\"workspace_id\", override, path)\n\ndef get_project_slug(override: str | None = None, path: Path | None = None) -\u003e str | None:\n    return _get_config_field(\"project_slug\", override, path)\n\ndef get_project_id(override: str | None = None, path: Path | None = None) -\u003e str | None:\n    return _get_config_field(\"project_id\", override, path)\n\ndef get_alias(override: str | None = None, path: Path | None = None) -\u003e str | None:\n    return _get_config_field(\"alias\", override, path)\n\ndef get_human(override: str | None = None, path: Path | None = None) -\u003e str | None:\n    return _get_config_field(\"human\", override, path)\n\ndef get_role(override: str | None = None, path: Path | None = None) -\u003e str | None:\n    return _get_config_field(\"role\", override, path)\n```\n\nThis reduces ~120 lines to ~40 lines while maintaining the same API.\n\n### Acceptance Criteria\n\n- [ ] Single _get_config_field helper\n- [ ] All getter functions use the helper\n- [ ] Public API unchanged (same function signatures)\n- [ ] All existing tests pass\n- [ ] Adding new config fields is trivial","status":"open","priority":2,"issue_type":"task","created_at":"2026-01-08T12:43:13.176745+01:00","created_by":"juanre","updated_at":"2026-01-08T12:43:13.176745+01:00"}
{"id":"beadhub-tnk","title":"Update CLI to use workspace_id from .beadhub","description":"Update beadhub CLI commands to read workspace_id from .beadhub file instead of --project-key option.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T19:18:05.970518+01:00","updated_at":"2025-12-07T22:04:49.671547+01:00","closed_at":"2025-12-07T22:04:49.671547+01:00","dependencies":[{"issue_id":"beadhub-tnk","depends_on_id":"beadhub-asx","type":"blocks","created_at":"2025-12-07T19:18:12.365693+01:00","created_by":"juanre"}]}
{"id":"beadhub-toyn","title":"Fix misaligned horizontal borders (logo vs filter bar)","description":"The horizontal line under the logo and the horizontal line under the filters are not at the same height - visible in sidebar/topbar layout","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-06T18:58:11.065385Z","created_by":"juanre","updated_at":"2026-01-06T19:08:30.124281Z","closed_at":"2026-01-06T19:08:30.124281Z","close_reason":"Implemented"}
{"id":"beadhub-tpe","title":"Strengthen race condition test with barrier and more agents","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-03T16:45:17.040472+01:00","updated_at":"2025-12-03T16:47:26.432791+01:00","closed_at":"2025-12-03T16:47:26.432791+01:00"}
{"id":"beadhub-tslb","title":"Backend: MCP tools for file reservations (mcp_agent_mail compatible)","description":"Add MCP tools that match mcp_agent_mail's file reservation interface.\n\n## DEPENDENCY: Identity Resolution (beadhub-ki7v)\n\nUse claude-be's identity resolution (beadhub-ki7v) for mapping:\n- resolve_project(project_key, tenant_id) â†’ project_id\n- resolve_agent(project_id, agent_name) â†’ (workspace_id, alias)\n\n## Tools to Implement\n\n### 1. file_reservation_paths\n\nArguments (mcp_agent_mail format):\n- project_key: string â†’ mapped to project_id via resolve_project()\n- agent_name: string â†’ mapped to workspace_id via resolve_agent()\n- paths: string[] (supports globs)\n- ttl_seconds: int (default 300, max 3600)\n- exclusive: bool (default true)\n- reason: string (optional)\n\nResponse:\n- reservations: [{path, lock_id, expires_at, exclusive}]\n- conflicts: [{path, held_by, expires_at}]\n\nReference: other/mcp_agent_mail/src/mcp_agent_mail/app.py:5704-5888\n\n### 2. release_file_reservations\n\nArguments:\n- project_key: string\n- agent_name: string\n- paths: string[] (optional, release specific paths)\n- all: bool (optional, release all for this agent)\n\nResponse:\n- released_count: int\n- released_paths: string[]\n\nReference: other/mcp_agent_mail/src/mcp_agent_mail/app.py:5889-5990\n\n### 3. renew_file_reservations\n\nArguments:\n- project_key: string\n- agent_name: string\n- paths: string[] (optional)\n- ttl_seconds: int\n\nResponse:\n- renewed: [{path, new_expires_at}]\n- not_found: string[]\n\n## Implementation Notes\n\n1. Use polymorphic dispatch: if args have project_key, use compat mode\n2. Call identity resolution FIRST: project_key â†’ project_id, agent_name â†’ workspace_id\n3. Then call the REST API endpoints with workspace_id (don't duplicate logic)\n4. Client NEVER sends project_id - if they try, reject the request\n\n## Key Rule (from sync with claude-be)\n\nproject_key â†’ project_id (UUID), NOT project_slug. The mapping table is:\n- agent_mail_projects: project_key TEXT â†’ project_id UUID\n- agent_mail_agents: (project_id, agent_name) â†’ workspace_id\n\n## Files to Modify\n\n- src/beadhub/routes/mcp.py (add tool handlers)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-15T21:39:40.393174+01:00","updated_at":"2025-12-16T21:25:34.288854+01:00","closed_at":"2025-12-16T21:25:34.288854+01:00","dependencies":[{"issue_id":"beadhub-tslb","depends_on_id":"beadhub-1tty","type":"blocks","created_at":"2025-12-15T21:42:52.614655+01:00","created_by":"juanre"},{"issue_id":"beadhub-tslb","depends_on_id":"beadhub-sgup","type":"blocks","created_at":"2025-12-15T21:42:52.742846+01:00","created_by":"juanre"}]}
{"id":"beadhub-tsz0","title":"Multi-claim test B","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-05T17:42:01.245921Z","created_by":"juanre","updated_at":"2026-01-05T17:58:45.082883Z","closed_at":"2026-01-05T17:58:45.082883Z","close_reason":"Bug fixed and verified - multi-bead claim/close now works"}
{"id":"beadhub-tupk","title":"Chat frontend: implement message windowing for long sessions","description":"ActiveChatPanel appends messages indefinitely to state array. For long-running sessions with thousands of messages, this could cause browser memory issues. Consider keeping only last N messages in state with 'load more' for history.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-15T22:03:55.333822+01:00","updated_at":"2025-12-15T22:03:55.333822+01:00"}
{"id":"beadhub-txuf","title":"Update beads_issues table: add closed_by_workspace_id, repo_id","description":"Edit beads/001_initial.sql to add fields per data-model.md.\n\nChanges:\n1. Add closed_by_workspace_id (UUID, FK to server.workspaces, nullable)\n   - Tracks who closed each bead\n   - Note: This is a cross-schema FK (beads schema â†’ server schema)\n\n2. Keep repo_name as TEXT (do NOT change to repo_id FK)\n   - Reason: beads schema should not have FK to server.repos\n   - Cross-schema FKs create coupling and migration complexity\n   - repo_name TEXT is sufficient for display/filtering\n\nPer data-model.md section 9: \"Bead History via closed_by_workspace_id\"\n- Primary use case: \"who worked on this bead that was done wrong?\"\n- For closed beads, the workspace that closed it is the relevant one\n\nIndex:\n- idx_beads_issues_closed_by on (closed_by_workspace_id) WHERE closed_by_workspace_id IS NOT NULL","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T12:50:15.931189+01:00","updated_at":"2025-12-12T15:19:28.384863+01:00","closed_at":"2025-12-12T15:19:28.384863+01:00","dependencies":[{"issue_id":"beadhub-txuf","depends_on_id":"beadhub-wvj6","type":"blocks","created_at":"2025-12-12T12:50:26.926701+01:00","created_by":"juanre"}]}
{"id":"beadhub-tyf3","title":"Epic: SSE Streaming Correctness and Scalability","description":"## Summary\n\nThe SSE streaming endpoint (`/v1/status/stream`) has several correctness and scalability issues that affect dashboard reliability at scale.\n\n## Problems\n\n1. **Redis-based workspace discovery** - Filters use Redis presence which can be stale; fixed for no-filter case but not for project_slug/repo_id filters\n2. **No limit on workspace subscriptions** - When no filter provided, subscribes to ALL workspaces which doesn't scale\n3. **Dashboard connects without filter** - StatusPage connects to SSE without project filter, causing unbounded subscriptions\n4. **Inconsistent filter parameters** - SSE uses different filter names than /v1/workspaces\n\n## Goals\n\n1. All workspace discovery uses persistent database, not ephemeral Redis presence\n2. Sensible limits on workspace subscriptions (default 200, max 1000)\n3. Dashboard always passes project filter or uses sensible defaults\n4. Unified filter parameters across SSE and REST endpoints\n\n## Related Work\n\n- beadhub-ljw6: SSE resource leak (stale handlers)\n- beadhub-wm8k: Unbounded reconnection loop\n- beadhub-w7hi: Caching for high-volume deployments","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-21T09:49:22.061435+01:00","updated_at":"2025-12-21T13:17:14.557126+01:00","closed_at":"2025-12-21T13:17:14.557126+01:00","close_reason":"All subtasks completed. SSE streaming now uses database for all lookups, has sensible limits (200 default, 1000 max), supports tenant isolation, and has unified filter parameters with /v1/workspaces.","dependencies":[{"issue_id":"beadhub-tyf3","depends_on_id":"beadhub-9hb0","type":"blocks","created_at":"2025-12-21T12:02:12.913449+01:00","created_by":"juanre"}]}
{"id":"beadhub-tzky","title":"Auto-reserve modified files via git status integration","description":"Automatically reserve and release files based on git status, removing need for manual :lock/:unlock.\n\n## Concept\n\nOn every bdh command:\n1. Run `git status --porcelain` to get modified/staged/untracked files\n2. Compare to agent's currently held locks\n3. Reserve any newly modified files not already locked\n4. Release locks on files no longer modified (committed or reverted)\n\n## Flow\n\n```\nAgent runs: bdh ready\n\nbdh internally:\n  1. git status --porcelain\n     â†’ M  src/api.py\n     â†’ M  src/models.py\n     â†’ ?  src/new_file.py\n  \n  2. GET /v1/reservations?workspace_id=X\n     â†’ Currently holding: src/api.py\n  \n  3. Diff:\n     - Need to reserve: src/models.py, src/new_file.py\n     - Already held: src/api.py (keep)\n     - No longer modified: (none)\n  \n  4. POST /v1/reservations (acquire src/models.py, src/new_file.py)\n  \n  5. Continue with normal 'bdh ready' output\n```\n\n## File States to Track\n\n| git status | Action |\n|------------|--------|\n| M (modified) | Reserve |\n| A (staged new) | Reserve |\n| MM (modified+staged) | Reserve |\n| ?? (untracked) | Reserve (configurable?) |\n| D (deleted) | Release if held |\n| (not in status) | Release if held |\n\n## Conflict Handling\n\nIf reservation fails (held by another agent):\n```\nâš  Cannot auto-reserve files held by others:\n  src/api.py â€” claude-be (expires in 3m)\n\nYou have uncommitted changes to these files. Options:\n  - Coordinate: bdh :chat claude-be \"Need src/api.py...\"\n  - Stash your changes: git stash\n  - Wait for their lock to expire\n```\n\n## Configuration\n\nIn .beadhub:\n```yaml\nauto_reserve: true          # Enable/disable (default: true)\nreserve_untracked: false    # Reserve ?? files (default: false)\n```\n\n## Edge Cases\n\n1. **Large repos**: git status might be slow. Cache result for N seconds?\n2. **Partial commits**: If agent commits some files, release those, keep others\n3. **Renamed files**: Old path released, new path reserved\n4. **Submodules**: Skip or handle separately?\n\n## Implementation Location\n\nbdh/internal/commands/common.go or new autoreserve.go\nCalled from passthrough wrapper before executing bd command.\n\n## Dependencies\n\nDepends on file reservation system (beadhub-nb68) being implemented first.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-15T22:26:47.496503+01:00","updated_at":"2025-12-21T20:51:37.973668+01:00","closed_at":"2025-12-21T20:51:37.973668+01:00","close_reason":"Completed auto-reserve integration with TTL renewals + release, correct tenant-scoped lock listing (workspace_id), robust JSON parsing for nullable lock fields, tests, and README config docs.","dependencies":[{"issue_id":"beadhub-tzky","depends_on_id":"beadhub-nb68","type":"blocks","created_at":"2025-12-15T22:26:53.353105+01:00","created_by":"juanre"}]}
{"id":"beadhub-u2nn","title":"Send null instead of empty string for empty subject","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T20:35:31.600828+01:00","updated_at":"2026-01-03T18:38:44.399027Z","closed_at":"2026-01-03T18:38:44.399027Z","close_reason":"Not needed: backend models subject as string (default ''), and UI already displays '(no subject)' for empty subject."}
{"id":"beadhub-u2yh","title":"Cannot acknowledge mail from deleted workspaces","description":"When a workspace is deleted, any unread mail sent by that workspace becomes orphaned. The recipient cannot acknowledge/dismiss the messages because `bdh :mail --open \u003csender\u003e` requires the sender workspace to exist.\n\n**Reproduction:**\n1. Workspace A sends mail to Workspace B\n2. Delete Workspace A\n3. Workspace B tries `bdh :mail --open A` â†’ error: \"no workspace found\"\n4. Mail remains in unread count permanently\n\n**Possible fixes:**\n- Allow --open to work with workspace_id instead of just alias\n- Add a --dismiss flag to clear specific messages by ID\n- Auto-clear mail when sender workspace is deleted\n- Allow acknowledging by sender alias even if workspace deleted (lookup by historical alias)","status":"closed","priority":3,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-01-17T14:24:41.391032+01:00","created_by":"Juan Reyero","updated_at":"2026-01-18T15:25:37.765059+01:00","closed_at":"2026-01-18T15:25:37.765059+01:00","close_reason":"Fixed: Added from_alias query parameter to inbox endpoint. CLI --open and --history now fall back to from_alias filter when workspace is deleted, allowing recipients to acknowledge orphaned mail."}
{"id":"beadhub-u56","title":"Add optimistic locking to beads_sync using updated_at","description":"Prevent lost updates when multiple clients sync bead issues concurrently.\n\nCurrent risk:\n- If two sync operations update the same issue row, a stale write can overwrite a newer write.\n\nProposed approach:\n- Add optimistic locking to beads_sync issue upserts using updated_at (or a version integer).\n- On update, require updated_at match (or be older) and reject/conflict if DB row is newer than payload.\n- Decide conflict behavior: skip + report conflicts, or retry with merge strategy.\n\nDeliverable:\n- A clear contract in the sync endpoint response for conflicts (count + list of bead IDs).\n\nTests:\n- Simulate concurrent updates in tests: write newer row, then attempt stale update and assert conflict handling.","acceptance_criteria":"- Concurrent stale updates do not overwrite newer DB state\n- Sync responses surface conflict counts/details\n- Tests cover at least one stale update scenario\n- No regression to existing sync flows","notes":"Follow-up hardening merged: added \"SELECT ... FOR UPDATE\" to make optimistic-lock timestamp comparison atomic under concurrency. Landed in main at 159d575 (commit 0a238d2).","status":"closed","priority":3,"issue_type":"feature","assignee":"eve-agent","created_at":"2025-12-03T15:39:17.001772+01:00","updated_at":"2026-01-03T19:50:28.497075Z","closed_at":"2026-01-03T19:28:57.676457Z","close_reason":"Implemented optimistic locking for beads_sync (skip stale updated_at), surfaced conflicts in response, and added deterministic stale-update test."}
{"id":"beadhub-u6xh","title":"No rate limiting on any endpoint","description":"Location: all route files. No rate limiting on /v1/reservations (lock acquisition), /v1/messages (can flood inboxes), /v1/escalations, /v1/beads/upload. Malicious actors can DoS service, buggy agents can spam, no protection against abuse or runaway loops. Fix: implement rate limiting using Redis or slowapi middleware, prioritize write endpoints and SSE.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-08T18:25:00.654624+01:00","updated_at":"2026-01-09T22:38:58.095989+01:00","closed_at":"2026-01-09T22:38:58.095989+01:00","close_reason":"By design: Cloud already has rate limiting (middleware/rate_limit.py). OSS operates under 'trusted network assumption' per security-patterns.md. Self-hosters expected to use firewall/nginx/etc. Not a bug."}
{"id":"beadhub-u83e","title":"Restore workspace role end-to-end (bdh + server + API)","description":"Context\\n- SOT docs (beadhub-workspace-roles.md, beadhub-bdh-design.md, specifications) define a short, optional role stored in .beadhub and propagated to server and status outputs.\\n- Role removal created ambiguity and added Redis reads to preserve missing role; we want durable, low-latency role handling with no backward-compat shims.\\n\\nGoals\\n- Role stored in workspaces table (durable) and cached in presence; offline workspaces still show role.\\n- bdh reads role from .beadhub and sends it in /v1/agents/register and /v1/bdh/command (and /v1/bdh/sync if needed).\\n- API responses include role where appropriate (workspaces registry, team-status, status contexts, rejection contexts, message metadata).\\n\\nWork\\n1) DB: ensure workspaces.role column exists (migration) and optional length constraint per SOT.\\n2) Server: accept role on registration/command; update workspaces.role; write role into presence; when role omitted, keep existing DB value (no Redis read).\\n3) API: include role in workspaces endpoints and bdh command context (beads_in_progress + claimed_by); ensure DB role used for offline workspaces.\\n4) bdh: read role from .beadhub and include in relevant requests.\\n5) Tests: role persistence across offline/online, role inclusion in responses; no Redis reads to preserve role.\\n\\nHow to verify\\n- Unit tests cover role field in register/command responses and workspaces list; regression test ensures missing role doesn't trigger Redis read or erase stored role.\\n- Manual: set role in .beadhub and confirm via bdh :who / ready output.\\n","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T15:01:40.365646+01:00","updated_at":"2025-12-21T15:39:03.41651+01:00","closed_at":"2025-12-21T15:39:03.41651+01:00","close_reason":"Completed","dependencies":[{"issue_id":"beadhub-u83e","depends_on_id":"beadhub-o9h7","type":"discovered-from","created_at":"2025-12-21T15:01:40.373106+01:00","created_by":"juanre"}]}
{"id":"beadhub-u8n3","title":"UX: Sidebar should highlight active navigation item","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-13T21:26:17.455648+01:00","updated_at":"2025-12-13T23:29:43.199359+01:00","closed_at":"2025-12-13T23:29:43.199359+01:00"}
{"id":"beadhub-ua5q","title":"Add admin endpoint to reset policy to default seed","description":"We seed a default policy bundle for new projects; add an admin endpoint to reset an existing project back to the current DEFAULT_POLICY_BUNDLE (create new version + activate), project-scoped via X-Project-ID and gated by X-API-Key when BEADHUB_API_KEY is set.","notes":"Implemented admin reset endpoint POST /v1/policies/reset (X-Project-ID scoped, X-API-Key gated when enabled): creates a new version from DEFAULT_POLICY_BUNDLE and activates it, leaving history intact. Added integration test.","status":"closed","priority":3,"issue_type":"feature","assignee":"juanre","created_at":"2026-01-03T12:03:07.760996Z","created_by":"juanre","updated_at":"2026-01-03T12:05:03.293145Z","closed_at":"2026-01-03T12:05:03.293145Z","close_reason":"done"}
{"id":"beadhub-uao8","title":"Add disabled prop to FilterBar for Cloud embedding","description":"Add filterBarProps to DashboardLayout so Cloud can disable filters when 'All Projects' is selected.\n\nChanges:\n1. FilterBar: Add disabled?: boolean prop that grays out controls\n2. DashboardLayoutProps: Add filterBarProps?: { disabled?: boolean }\n3. DashboardLayout: Pass filterBarProps to FilterBar\n\nRequested by eve-implementer for beadhub-cloud sidebar UX work.","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-14T19:01:56.43429+01:00","created_by":"Juan Reyero","updated_at":"2026-01-14T19:04:02.012084+01:00","closed_at":"2026-01-14T19:04:02.012084+01:00","close_reason":"Implemented FilterBarProps.disabled, added filterBarProps to DashboardLayoutProps, all controls respect disabled state"}
{"id":"beadhub-ufw9","title":"Cloud API: GET/DELETE /api/v1/projects/{id}/repos","description":"Add Cloud endpoints to list and delete repos within a project. Bridges to OSS endpoints. Respects Cloud project ownership.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T15:25:37.387855+01:00","updated_at":"2025-12-21T18:08:21.5896+01:00","closed_at":"2025-12-21T18:08:21.5896+01:00","close_reason":"Implemented Cloud repos endpoints with owner/admin authorization","dependencies":[{"issue_id":"beadhub-ufw9","depends_on_id":"beadhub-1thq","type":"blocks","created_at":"2025-12-21T15:26:55.649005+01:00","created_by":"juanre"},{"issue_id":"beadhub-ufw9","depends_on_id":"beadhub-xlmc","type":"blocks","created_at":"2025-12-21T15:27:04.939539+01:00","created_by":"juanre"},{"issue_id":"beadhub-ufw9","depends_on_id":"beadhub-j86m","type":"blocks","created_at":"2025-12-21T15:27:05.086932+01:00","created_by":"juanre"}]}
{"id":"beadhub-uhgw","title":"Perf fixture: validate team-status endpoint stays bounded at scale","description":"Context\\n- We observed performance regressions with large workspace/claim counts. We need a repeatable fixture/benchmark to guard against unbounded queries.\\n\\nWork\\n- Add a repeatable seed script or test fixture that can create e.g. 5k workspaces and 25k claims (no network).\\n- Exercise /v1/workspaces/team?limit=15 and assert response length \u003c= 15 and ordering rules hold.\\n- Measure or at least assert no global presence scan is used (via FakeRedis or instrumentation).\\n\\nHow to verify\\n- Run the fixture (documented in scripts/ or tests) and show bounded output; test fails if endpoint returns \u003e limit or if presence merge scans all workspaces.","notes":"Implemented scale fixture test with 5k workspaces/25k claims, FakeRedis to prevent global scans, and docs entry. Code review: verified ordering uses last_seen desc with claims present, bounded presence fetch \u003c= candidate_limit, and FakeRedis raises on scan/smembers.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T15:01:51.203699+01:00","updated_at":"2025-12-21T18:06:42.539477+01:00","closed_at":"2025-12-21T18:06:42.539477+01:00","close_reason":"releasing claim","dependencies":[{"issue_id":"beadhub-uhgw","depends_on_id":"beadhub-o9h7","type":"discovered-from","created_at":"2025-12-21T15:01:51.204998+01:00","created_by":"juanre"}]}
{"id":"beadhub-uo1s","title":"Add bdh :ack command for acknowledging mail","description":"Restore bdh :ack command from commit 74ef99e^. The command already existed and was deleted when mail was deprecated. Restore ack.go and ack_test.go.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-15T17:40:09.172+01:00","updated_at":"2025-12-15T17:50:00.229119+01:00","closed_at":"2025-12-15T17:50:00.229119+01:00"}
{"id":"beadhub-up58","title":"SSE: Add limit parameter and sensible default for all-workspaces query","description":"## Problem\n\nThe SSE endpoint in the `be` branch now uses database instead of Redis for workspace discovery (5599a6f), but it has no LIMIT:\n\n```python\nrows = await server_db.fetch_all(\n    \"SELECT workspace_id FROM {{tables.workspaces}} WHERE deleted_at IS NULL\"\n)\n```\n\nWith 10,000+ workspaces (per architecture spec), this creates 10,000+ Redis pub/sub subscriptions per SSE connection - a massive resource issue.\n\n## Location\n\n`src/beadhub/routes/status.py` - `get_all_workspace_ids_from_db()` and `status_stream()`\n\n## Fix Required\n\n1. Add `limit` query parameter to SSE endpoint (default 200, max 1000)\n2. Add `LIMIT` clause to database query\n3. Document that 'no filter' mode is intended for small deployments\n4. For Cloud/multi-tenant, require a filter (project_id or project_slug)\n\n## Related\n\n- beadhub-qmp0: SSE project_slug filter\n- beadhub-sgjk: SSE repo_id filter\n- beadhub-w7hi: caching consideration","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-21T09:48:36.038611+01:00","updated_at":"2025-12-21T10:15:44.791394+01:00","closed_at":"2025-12-21T10:15:44.791394+01:00","close_reason":"Added limit parameter (default 200, max 1000) to SSE endpoint and all workspace query functions","dependencies":[{"issue_id":"beadhub-up58","depends_on_id":"beadhub-tyf3","type":"blocks","created_at":"2025-12-21T09:49:28.126517+01:00","created_by":"juanre"}]}
{"id":"beadhub-up92","title":"Add tests for /v1/bdh/command and /v1/bdh/sync endpoints","description":"Add comprehensive tests for the new bdh endpoints:\n\n/v1/bdh/command tests:\n- Auto-registration on first contact\n- Approval for query commands (ready, show, list)\n- Approval for claiming available bead\n- Rejection when claiming already-claimed bead\n- Context includes messages_waiting and beads_in_progress\n- Command line parsing\n\n/v1/bdh/sync tests:\n- JSONL parsing\n- Claim created when status=in_progress\n- Claim released when status=open or closed\n- Idempotency\n\nUse existing test patterns from the codebase.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-10T09:35:49.743927+01:00","updated_at":"2025-12-20T09:53:37.878633+01:00","closed_at":"2025-12-20T09:53:37.878633+01:00","close_reason":"Completed: comprehensive /v1/bdh/command and /v1/bdh/sync tests exist (tests/test_bdh_command.py)","dependencies":[{"issue_id":"beadhub-up92","depends_on_id":"beadhub-4trs","type":"parent-child","created_at":"2025-12-10T09:36:05.838626+01:00","created_by":"juanre"},{"issue_id":"beadhub-up92","depends_on_id":"beadhub-f5il","type":"blocks","created_at":"2025-12-10T09:36:15.515967+01:00","created_by":"juanre"},{"issue_id":"beadhub-up92","depends_on_id":"beadhub-jv2g","type":"blocks","created_at":"2025-12-10T09:36:15.578911+01:00","created_by":"juanre"}]}
{"id":"beadhub-uqt0","title":"Frontend ChatPage expects old pending schema (from_alias/message)","description":"Server GET /v1/chat/pending now returns v2.1 PendingConversation: {session_id, participants[], last_message, last_from, unread_count, last_activity}. Frontend ChatPage still treats items as PendingChatRequest with from_alias/message and tries to call joinChatSession on selection (frontend/src/pages/ChatPage.tsx). This breaks pending rendering and selection even before addressing removed /join endpoint.\n\nFix: update frontend types/UI to the v2.1 pending schema (participants + last_from/last_message) and new flow (no join/end).","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-14T08:50:59.2094+01:00","updated_at":"2025-12-14T09:09:29.616921+01:00","closed_at":"2025-12-14T09:09:29.616921+01:00"}
{"id":"beadhub-us5","title":"Enforce escalation expiry - auto-close expired escalations","description":"Define and enforce escalation expiry semantics.\n\nCurrent state:\n- Escalations have expires_at but nothing updates status when expired.\n\nDesign decision needed:\n- Choose status for expired (e.g., \"expired\") vs treating as closed.\n- Decide mechanism: opportunistic (on list/status endpoints) vs background job.\n\nProposed implementation:\n- Add status \"expired\" and update pending escalations to expired when expires_at \u003c now (server time).\n- Ensure list/status endpoints do not count expired as pending.\n- Record responded_at for expired? (probably leave null; add audit log entry instead).\n\nTests:\n- Create escalation with short expiry, advance time (or set expires_at in DB), verify list/status excludes from pending and/or shows expired.","acceptance_criteria":"- Expired pending escalations are not counted as pending\n- Expired escalations are marked with status=expired (or documented alternative)\n- Endpoint behavior is deterministic and tested\n- No cross-project data leakage (still workspace/project scoped per policy)","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-03T15:39:14.288537+01:00","updated_at":"2026-01-03T16:42:14.079519Z"}
{"id":"beadhub-utg3","title":"Add field validators for human_name, project_slug, and alias in CommandRequest","description":"Add field validators for human_name, project_slug, and alias in CommandRequest.\n\nPer spec (beadhub-specifications.md v2.2.0):\n- human_name: ^[a-zA-Z][a-zA-Z '-]{0,63}$ (1-64 chars, allows apostrophes like O'Brien)\n- project_slug: ^[a-z0-9][a-z0-9-]{0,62}$ (1-63 chars, lowercase slug)\n- alias: ^[a-zA-Z0-9][a-zA-Z0-9_-]{0,63}$ (1-64 chars, workspace identifier)\n\nUpdated 2025-12-12 per data model changes (agent_name renamed to alias).","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-10T10:43:03.909287+01:00","updated_at":"2025-12-12T14:51:22.280048+01:00","closed_at":"2025-12-12T14:51:22.280048+01:00","dependencies":[{"issue_id":"beadhub-utg3","depends_on_id":"beadhub-f5il","type":"discovered-from","created_at":"2025-12-10T10:43:03.910084+01:00","created_by":"juanre"}]}
{"id":"beadhub-utgu","title":"Frontend - Rename agent_name to alias","description":"Update all agent_name references to alias throughout WorkspacesPage, StatusPage, api.ts.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T17:56:46.27742+01:00","updated_at":"2025-12-12T18:31:11.835505+01:00","closed_at":"2025-12-12T18:31:11.835505+01:00"}
{"id":"beadhub-uuar","title":"Add test coverage for messages_waiting in /v1/chat/pending","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T12:49:39.430568+01:00","updated_at":"2025-12-13T12:51:23.163225+01:00","closed_at":"2025-12-13T12:51:23.163225+01:00"}
{"id":"beadhub-uv3y","title":"Test claim verification - eve","status":"closed","priority":3,"issue_type":"task","created_at":"2026-01-05T12:33:27.020664Z","created_by":"juanre","updated_at":"2026-01-05T16:59:46.569611Z","closed_at":"2026-01-05T16:59:46.569611Z","close_reason":"Test beads for --claim bug fix verification"}
{"id":"beadhub-uwzi","title":"Auto-mark messages as read when fetched via bdh :inbox","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-10T18:40:26.916903+01:00","updated_at":"2025-12-10T19:42:20.512022+01:00","closed_at":"2025-12-10T19:42:20.512022+01:00"}
{"id":"beadhub-uz09","title":"Rewrite bdh script to use new /v1/bdh/command flow","description":"Rewrite the bdh bash script to implement the new flow:\n\n1. Read .beadhub config\n2. POST /v1/bdh/command with workspace info and raw command_line\n3. If rejected: print rejection reason and context, exit\n4. If approved: run bd with original args\n5. If mutation command: POST /v1/bdh/sync with issues.jsonl\n6. Print bd output + coordination context\n\nThe script receives the same args as bd and passes command_line as a single string. Backend does the parsing.\n\nSee beadhub-bdh-design.md for full spec.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T09:35:15.125525+01:00","updated_at":"2025-12-10T15:34:12.319194+01:00","closed_at":"2025-12-10T15:34:12.319194+01:00","dependencies":[{"issue_id":"beadhub-uz09","depends_on_id":"beadhub-4trs","type":"parent-child","created_at":"2025-12-10T09:36:05.652845+01:00","created_by":"juanre"},{"issue_id":"beadhub-uz09","depends_on_id":"beadhub-f5il","type":"blocks","created_at":"2025-12-10T09:36:15.338041+01:00","created_by":"juanre"},{"issue_id":"beadhub-uz09","depends_on_id":"beadhub-jv2g","type":"blocks","created_at":"2025-12-10T09:36:15.399128+01:00","created_by":"juanre"}]}
{"id":"beadhub-uzt","title":"Update MCP tools to pass project_id context","description":"Update _tool_get_ready_issues and _tool_get_issue in routes/mcp.py to extract project_id from args and filter queries","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-07T22:29:09.042566+01:00","updated_at":"2025-12-08T01:04:08.890099+01:00","closed_at":"2025-12-08T01:04:08.890099+01:00","dependencies":[{"issue_id":"beadhub-uzt","depends_on_id":"beadhub-4mj","type":"discovered-from","created_at":"2025-12-07T22:29:09.043321+01:00","created_by":"juanre"}]}
{"id":"beadhub-v0d0","title":"SECURITY: Secure Redis presence system against spoofing","description":"## Problem\n\nRedis presence updates have no authentication. Any process with Redis access can spoof workspace presence for other workspaces.\n\n### Current Behavior\n\nIn `src/beadhub/presence.py:102-103`:\n```python\nawait redis.hset(key, mapping=fields)  # No auth check\nawait redis.expire(key, ttl_seconds)\n```\n\nThe presence system allows any caller to:\n1. Set arbitrary `workspace_id`, `alias`, `project_id` in presence data\n2. Manipulate secondary indexes (`idx:alias:*`, `idx:project_workspaces:*`)\n3. Impersonate any workspace in the system\n\n### Attack Vector\n\nIn environments where Redis is network-accessible (not localhost-only):\n- Attackers can impersonate workspaces\n- Poison secondary indexes causing incorrect routing\n- Manipulate team status displays\n- Potentially escalate privileges if presence is used for authorization decisions\n\n### Files Affected\n\n- `src/beadhub/presence.py:52-141` (all presence update functions)\n- `src/beadhub/redis_client.py` (connection setup)\n\n### Solution Options\n\n**Option A: Network isolation (minimum)**\n- Document that Redis MUST be localhost-only or VPN-protected\n- Add startup warning if Redis URL is not localhost\n\n**Option B: Redis AUTH (recommended)**\n- Require `REDIS_PASSWORD` environment variable in production\n- Configure Redis with AUTH enabled\n- Update connection code to use authentication\n\n**Option C: Signed presence data (most secure)**\n- Add HMAC signature to presence payloads\n- Validate signature on read\n- Requires shared secret between API servers\n\n### Acceptance Criteria\n\n- [ ] Redis connection requires authentication in production mode\n- [ ] Documentation updated with Redis security requirements\n- [ ] Startup warning if using insecure Redis configuration\n- [ ] Consider adding presence data signatures for defense in depth","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-08T12:36:57.210467+01:00","created_by":"juanre","updated_at":"2026-01-09T18:50:08.350796+01:00","closed_at":"2026-01-09T18:50:08.350796+01:00","close_reason":"Infrastructure concern, not app bug. Attack requires direct Redis network access + no AUTH - both are deployment misconfigurations. Standard practice: Redis in private VPC with AUTH enabled. Creating P3 doc task for security hardening guidance."}
{"id":"beadhub-v2kg","title":"Unified init flow with API key auth","description":"## Goal\nImplement unified init flow with API key-based authentication for bdh.\n\n## Architecture Summary\n- API keys table lives in OSS (server schema) with project_id\n- Cloud adds user_id to keys and wraps with email validation\n- CLI is identical for OSS and Cloud backends\n- bdh always sends API key with requests\n\n## 1. OSS Schema Changes\n\n**api_keys table - add columns:**\n```sql\nALTER TABLE server.api_keys\n  ADD COLUMN project_id UUID NOT NULL REFERENCES server.projects(id),\n  ADD COLUMN user_id UUID;  -- nullable, set by Cloud\n```\n\n## 2. New Endpoint: POST /v1/init\n\n**Request:**\n```json\n{\n  \"repo_origin\": \"git@github.com:org/repo.git\",  // required\n  \"alias\": \"claude-main\",                        // required\n  \"human_name\": \"Juan\",                          // optional\n  \"role\": \"developer\",                           // optional\n  \"email\": \"user@example.com\",                   // required for Cloud, ignored by OSS\n  \"project_slug\": \"my-project\"                   // optional, for creating new project\n}\n```\n\n**Response (success):**\n```json\n{\n  \"status\": \"ok\",\n  \"api_key\": \"bh_sk_xxxx\",\n  \"project_id\": \"uuid\",\n  \"project_slug\": \"my-project\",\n  \"repo_id\": \"uuid\",\n  \"canonical_origin\": \"github.com/org/repo\",\n  \"workspace_id\": \"uuid\"\n}\n```\n\n**Response (Cloud - needs email validation):**\n```json\n{\n  \"status\": \"pending_validation\",\n  \"message\": \"Check your email to validate your account\"\n}\n```\n\n**Error responses:**\n```json\n{ \"error\": \"invalid_repo_origin\", \"message\": \"Could not parse git remote URL\" }\n{ \"error\": \"alias_exists\", \"message\": \"Alias 'claude-main' already exists in this project\" }\n{ \"error\": \"email_required\", \"message\": \"Email required for Cloud registration\" }\n{ \"error\": \"project_not_found\", \"message\": \"Repo not registered. Provide project_slug to create new project\" }\n```\n\n**Server behavior:**\n1. Compute canonical_origin from repo_origin\n2. Look up project by canonical_origin (from registered repos)\n3. If found â†’ use that project\n4. If not found AND project_slug provided â†’ create new project\n5. If not found AND no project_slug â†’ error 'project_not_found'\n6. Create repo record if needed\n7. Create workspace (or return existing if same alias/repo)\n8. Create API key linked to project\n9. Return api_key in response\n\n## 3. CLI Changes (bdh :init)\n\n**Flow:**\n1. Load .env, check for existing BEADHUB_API_KEY\n2. If key exists â†’ just register workspace (current behavior)\n3. If no key:\n   - Prompt for email (unless BEADHUB_EMAIL set)\n   - Read git remote origin\n   - POST /v1/init { repo_origin, alias, human_name, role, email }\n   - Handle response:\n     - \"ok\" â†’ save api_key to .env, save workspace to .beadhub\n     - \"pending_validation\" â†’ print message, exit (user re-runs after validating)\n     - \"project_not_found\" â†’ prompt for project_slug, retry\n   - Confirm before creating new project: \"Create project 'my-project'? (y/n)\"\n\n**What goes where:**\n- `.env`: BEADHUB_API_KEY (secret, not committed)\n- `.beadhub`: workspace_id, alias, human_name, role, project_slug (identity, not committed)\n\n## 4. API Key Auth\n\nAll bdh requests include API key:\n```\nAuthorization: Bearer bh_sk_xxxx\n```\n\nServer looks up project_id from api_keys table. No X-Project-ID header needed.\n\n## Dependencies\n- Cloud consolidation (beadhub-cloud-twx) depends on this\n- CLI can be developed in parallel once endpoint contract is agreed\n\n## Related\n- beadhub-cloud-twx: Cloud-side consolidation (remove Cloud api_keys/projects tables)\n- beadhub-sot: Source of truth docs to update","status":"closed","priority":2,"issue_type":"epic","owner":"juan@juanreyero.com","created_at":"2026-01-15T18:07:08.863333+01:00","created_by":"Juan Reyero","updated_at":"2026-01-16T17:16:28.466376+01:00","closed_at":"2026-01-16T17:16:28.466376+01:00","close_reason":"Core implementation complete. P0 security fixes done. P1-P3 improvements (v2kg.10-14) remain as backlog."}
{"id":"beadhub-v2kg.1","title":"Schema: Add project_id and user_id to api_keys table","description":"Add columns to server.api_keys table:\n- project_id UUID NOT NULL REFERENCES projects(id)\n- user_id UUID (nullable, set by Cloud)\n\nMigration file in src/beadhub/migrations/\n\nThis is the foundation - endpoint and CLI depend on this schema.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-16T08:53:07.503649+01:00","created_by":"Juan Reyero","updated_at":"2026-01-16T09:23:52.583115+01:00","closed_at":"2026-01-16T09:23:52.583115+01:00","close_reason":"Added project_id (NOT NULL with CASCADE) and user_id (nullable) to api_keys table via migration 002_api_keys_project_user.sql. Test added and passing.","dependencies":[{"issue_id":"beadhub-v2kg.1","depends_on_id":"beadhub-v2kg","type":"parent-child","created_at":"2026-01-16T08:53:07.504297+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-v2kg.10","title":"SECURITY: Clarify member_email vs user_id in init endpoint","description":"Init endpoint sets member_email without setting user_id. Schema comment says user_id should be NULL in OSS and set by Cloud after email validation.\n\nOptions:\n1. Add comment explaining Cloud sets user_id separately\n2. Don't set member_email in OSS mode (set to NULL)\n3. Add validation that email only accepted in Cloud mode\n\nLocation: src/beadhub/routes/init.py:333-342","status":"closed","priority":1,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-01-16T12:43:11.483329+01:00","created_by":"Juan Reyero","updated_at":"2026-01-16T18:28:32.769422+01:00","closed_at":"2026-01-16T18:28:32.769422+01:00","close_reason":"Fixed: OSS no longer stores email in member_email. INSERT now excludes member_email (defaults to NULL). Only Cloud sets it after validation.","dependencies":[{"issue_id":"beadhub-v2kg.10","depends_on_id":"beadhub-v2kg","type":"parent-child","created_at":"2026-01-16T12:43:11.483881+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-v2kg.11","title":"Increase API key entropy from 128 to 256 bits","description":"API keys use 16 bytes (128 bits) via secrets.token_hex(16). Industry standard is 256 bits (GitHub uses this).\n\nChange to secrets.token_hex(32) for 256-bit keys.\n\nUpdate test assertions that expect 38-character keys.\n\nLocation: src/beadhub/routes/init.py:32-45","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-16T12:43:26.601937+01:00","created_by":"Juan Reyero","updated_at":"2026-01-16T18:56:18.930665+01:00","closed_at":"2026-01-16T18:56:18.930665+01:00","close_reason":"Changed to secrets.token_hex(32) for 256-bit entropy. Updated tests.","dependencies":[{"issue_id":"beadhub-v2kg.11","depends_on_id":"beadhub-v2kg","type":"parent-child","created_at":"2026-01-16T12:43:26.602609+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-v2kg.12","title":"Add email format validation to init endpoint","description":"The email field has no format validation - malformed emails can be stored.\n\nUse Pydantic EmailStr:\n```python\nfrom pydantic import EmailStr\nemail: Optional[EmailStr] = Field(default=None)\n```\n\nLocation: src/beadhub/routes/init.py:56","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-16T12:43:27.105541+01:00","created_by":"Juan Reyero","updated_at":"2026-01-16T18:57:47.656276+01:00","closed_at":"2026-01-16T18:57:47.656276+01:00","close_reason":"Added EmailStr validation. Invalid emails return 422. Added email-validator dependency.","dependencies":[{"issue_id":"beadhub-v2kg.12","depends_on_id":"beadhub-v2kg","type":"parent-child","created_at":"2026-01-16T12:43:27.106111+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-v2kg.13","title":"Go client: validate API key format before saving","description":"When saving API key to .env, no validation of returned key format. If server returns malformed data, client stores invalid key.\n\nAdd validation:\n```go\nif !strings.HasPrefix(apiKey, \"bh_sk_\") || len(apiKey) \u003c 38 {\n    return fmt.Errorf(\"server returned malformed API key\")\n}\n```\n\nLocation: bdh/internal/commands/init.go:879","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-16T12:43:27.612404+01:00","created_by":"Juan Reyero","updated_at":"2026-01-16T13:09:17.760718+01:00","closed_at":"2026-01-16T13:09:17.760718+01:00","close_reason":"Implemented. Added validation check before saving API key to .env.","dependencies":[{"issue_id":"beadhub-v2kg.13","depends_on_id":"beadhub-v2kg","type":"parent-child","created_at":"2026-01-16T12:43:27.613092+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-v2kg.14","title":"Remove redundant human_name conflict check in init endpoint","description":"The human_name conflict check is redundant - DB unique constraint on (project_id, alias) already prevents duplicates.\n\nCurrent code checks if human_name differs to detect conflicts, but this is fragile:\n- If human_name is None, check is skipped\n- Two users could register same alias if one doesn't provide human_name\n\nRemove the check and rely on DB constraint.\n\nLocation: src/beadhub/routes/init.py:269-284","status":"closed","priority":3,"issue_type":"chore","owner":"juan@juanreyero.com","created_at":"2026-01-16T12:43:28.120737+01:00","created_by":"Juan Reyero","updated_at":"2026-01-16T18:59:05.113435+01:00","closed_at":"2026-01-16T18:59:05.113435+01:00","close_reason":"Removed fragile human_name conflict check. Same alias returns existing workspace (idempotent). DB constraint handles uniqueness.","dependencies":[{"issue_id":"beadhub-v2kg.14","depends_on_id":"beadhub-v2kg","type":"parent-child","created_at":"2026-01-16T12:43:28.121268+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-v2kg.2","title":"Server: POST /v1/init endpoint","description":"Implement POST /v1/init endpoint that creates project/repo/workspace/key in one call.\n\nRequest:\n- repo_origin (required): raw git URL\n- alias (required): workspace alias\n- human_name (optional)\n- role (optional)\n- email (optional, for Cloud)\n- project_slug (optional, for creating new project)\n\nResponse:\n- status: 'ok' or 'pending_validation'\n- api_key, project_id, project_slug, repo_id, canonical_origin, workspace_id\n\nServer logic:\n1. Compute canonical_origin from repo_origin\n2. Look up project by canonical_origin\n3. If not found + project_slug provided: create project\n4. If not found + no project_slug: error 'project_not_found'\n5. Create repo if needed\n6. Create workspace (or return existing)\n7. Create API key linked to project\n8. Return response\n\nDepends on schema migration (beadhub-v2kg.1).","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-16T08:53:16.328989+01:00","created_by":"Juan Reyero","updated_at":"2026-01-16T10:23:32.931918+01:00","closed_at":"2026-01-16T10:23:32.931918+01:00","close_reason":"Implemented POST /v1/init endpoint with 10 passing tests","dependencies":[{"issue_id":"beadhub-v2kg.2","depends_on_id":"beadhub-v2kg","type":"parent-child","created_at":"2026-01-16T08:53:16.329655+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-v2kg.2","depends_on_id":"beadhub-v2kg.1","type":"blocks","created_at":"2026-01-16T08:54:04.182231+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-v2kg.3","title":"Server: API key auth middleware","description":"Add middleware to validate API key and derive project_id.\n\n- Check Authorization header: Bearer bh_sk_xxx\n- Look up key in api_keys table\n- If valid: set project_id in request context\n- If invalid: 401 Unauthorized\n\nThis replaces X-Project-ID header for authenticated requests.\n\nExisting endpoints should work with either:\n- API key auth (new) - derives project_id from key\n- X-Project-ID header (existing) - for backward compat during migration\n\nDepends on schema migration (beadhub-v2kg.1).","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-16T08:53:23.873256+01:00","created_by":"Juan Reyero","updated_at":"2026-01-16T09:53:17.355306+01:00","closed_at":"2026-01-16T09:53:17.355306+01:00","close_reason":"Implemented API key auth middleware: hash_api_key(), parse_bearer_token(), verify_bearer_token(), get_project_from_auth(). Updated verify_workspace_access() for dual-mode support. All 21 auth tests pass.","dependencies":[{"issue_id":"beadhub-v2kg.3","depends_on_id":"beadhub-v2kg","type":"parent-child","created_at":"2026-01-16T08:53:23.874463+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-v2kg.3","depends_on_id":"beadhub-v2kg.1","type":"blocks","created_at":"2026-01-16T08:54:04.598779+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-v2kg.4","title":"CLI: Load .env for API key","description":"Update bdh to load .env file and check BEADHUB_API_KEY before init.\n\nCurrent: godotenv.Load() is called but API key not used\nNew: If BEADHUB_API_KEY exists, skip the full init flow\n\nThis is prerequisite for the new init flow.","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-16T08:53:30.194799+01:00","created_by":"Juan Reyero","updated_at":"2026-01-16T09:33:09.921618+01:00","closed_at":"2026-01-16T09:33:09.921618+01:00","close_reason":"Implemented API key check in init.go after loading .env. Added tests for API key flow.","dependencies":[{"issue_id":"beadhub-v2kg.4","depends_on_id":"beadhub-v2kg","type":"parent-child","created_at":"2026-01-16T08:53:30.195436+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-v2kg.5","title":"CLI: New init flow with /v1/init endpoint","description":"Update bdh :init to use new /v1/init endpoint.\n\nFlow:\n1. Check BEADHUB_API_KEY in .env - if exists, skip to workspace registration\n2. Prompt for email (unless BEADHUB_EMAIL set)\n3. Read git remote origin\n4. POST /v1/init { repo_origin, alias, human_name, role, email }\n5. Handle response:\n   - 'ok': save api_key to .env, save workspace to .beadhub\n   - 'pending_validation': print message, exit\n   - 'project_not_found': prompt for project_slug, confirm, retry\n6. Confirm before creating new project: 'Create project X? (y/n)'\n\nDepends on:\n- Server /v1/init endpoint (beadhub-v2kg.2)\n- CLI .env loading (beadhub-v2kg.4)","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-16T08:53:38.774231+01:00","created_by":"Juan Reyero","updated_at":"2026-01-16T10:47:18.668661+01:00","closed_at":"2026-01-16T10:47:18.668661+01:00","close_reason":"Implemented new init flow using POST /v1/init endpoint. When no API key exists, uses atomic endpoint to create project/repo/workspace/api_key in one call.","dependencies":[{"issue_id":"beadhub-v2kg.5","depends_on_id":"beadhub-v2kg","type":"parent-child","created_at":"2026-01-16T08:53:38.774847+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-v2kg.5","depends_on_id":"beadhub-v2kg.2","type":"blocks","created_at":"2026-01-16T08:54:10.389111+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-v2kg.5","depends_on_id":"beadhub-v2kg.4","type":"blocks","created_at":"2026-01-16T08:54:10.704871+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-v2kg.6","title":"CLI: Send API key with all requests","description":"Update Go HTTP client to send API key in Authorization header.\n\n- Load BEADHUB_API_KEY from environment\n- Add header: Authorization: Bearer bh_sk_xxx\n- Remove X-Project-ID header (server derives from key)\n\nAll bdh commands should work with API key auth after this.\n\nDepends on:\n- Server auth middleware (beadhub-v2kg.3)\n- CLI .env loading (beadhub-v2kg.4)","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-16T08:53:45.266934+01:00","created_by":"Juan Reyero","updated_at":"2026-01-16T10:16:12.940666+01:00","closed_at":"2026-01-16T10:16:12.940666+01:00","close_reason":"Implemented NewWithAPIKey constructor and updated client methods to send Authorization: Bearer header when API key is set","dependencies":[{"issue_id":"beadhub-v2kg.6","depends_on_id":"beadhub-v2kg","type":"parent-child","created_at":"2026-01-16T08:53:45.267578+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-v2kg.6","depends_on_id":"beadhub-v2kg.3","type":"blocks","created_at":"2026-01-16T08:54:11.140401+01:00","created_by":"Juan Reyero"},{"issue_id":"beadhub-v2kg.6","depends_on_id":"beadhub-v2kg.4","type":"blocks","created_at":"2026-01-16T08:54:11.561674+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-v2kg.7","title":"Schema: Add is_active and metadata columns to api_keys","description":"Add columns to server.api_keys for Cloud consolidation:\n- is_active BOOLEAN DEFAULT TRUE (for soft-revoke)\n- metadata JSONB (for audit info like created_via)\n\nNeeded before Cloud can migrate api_keys to OSS table.\n\nMigration file: 004_api_keys_cloud_columns.sql","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-16T10:01:24.725325+01:00","created_by":"Juan Reyero","updated_at":"2026-01-16T10:03:56.978057+01:00","closed_at":"2026-01-16T10:03:56.978057+01:00","close_reason":"Added migration 004_api_keys_cloud_columns.sql with is_active and metadata columns. Updated verify_bearer_token() to check is_active. Added test for deactivated keys.","dependencies":[{"issue_id":"beadhub-v2kg.7","depends_on_id":"beadhub-v2kg","type":"parent-child","created_at":"2026-01-16T10:01:24.725956+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-v2kg.8","title":"SECURITY: Add rate limiting to POST /v1/init endpoint","description":"Critical security issue: /v1/init is unauthenticated and has no rate limiting. An attacker can:\n- Generate unlimited API keys\n- Exhaust database resources\n- Create millions of keys for same workspace\n\nAdd rate limiting by IP address. Consider CAPTCHA for repeated calls.\n\nLocation: src/beadhub/routes/init.py","status":"closed","priority":0,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-01-16T12:43:10.463575+01:00","created_by":"Juan Reyero","updated_at":"2026-01-16T13:05:18.738621+01:00","closed_at":"2026-01-16T13:05:18.738621+01:00","close_reason":"Implemented Redis-based rate limiting: 10 req/min per IP, 429 with Retry-After header","dependencies":[{"issue_id":"beadhub-v2kg.8","depends_on_id":"beadhub-v2kg","type":"parent-child","created_at":"2026-01-16T12:43:10.46436+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-v2kg.9","title":"SECURITY: Use bcrypt/argon2 instead of SHA-256 for API key hashing","description":"Critical security issue: hash_api_key() uses SHA-256 which is fast and optimized for speed, making brute-force attacks feasible if DB is compromised.\n\nReplace with bcrypt or argon2:\n```python\nimport bcrypt\ndef hash_api_key(key: str) -\u003e str:\n    return bcrypt.hashpw(key.encode(), bcrypt.gensalt()).decode()\n```\n\nNote: Requires migration to rehash existing keys and update lookup logic.\n\nLocation: src/beadhub/auth.py:48-50","status":"closed","priority":0,"issue_type":"bug","owner":"juan@juanreyero.com","created_at":"2026-01-16T12:43:10.981012+01:00","created_by":"Juan Reyero","updated_at":"2026-01-16T13:08:00.503254+01:00","closed_at":"2026-01-16T13:08:00.503254+01:00","close_reason":"Implemented. bcrypt replaces SHA-256 for API key hashing. Lookup by key_prefix, verify with bcrypt.checkpw().","dependencies":[{"issue_id":"beadhub-v2kg.9","depends_on_id":"beadhub-v2kg","type":"parent-child","created_at":"2026-01-16T12:43:10.981532+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-v39q","title":"Chat: sender of '.' termination hangs waiting for reply","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T13:53:13.15049+01:00","updated_at":"2025-12-13T14:18:44.554717+01:00","closed_at":"2025-12-13T14:18:44.554717+01:00"}
{"id":"beadhub-v5e9","title":"Backend: fetch policy by id for history preview","description":"Add a read endpoint to fetch a specific policy version bundle by policy_id so the dashboard can preview older versions without activating.\n\nAPI\n- GET /v1/policies/{policy_id}\n- Requires X-Project-ID\n- Must reject cross-project policy_id\n- Response shape should match GET /v1/policies/active (policy_id, project_id, version, updated_at, invariants, roles, adapters); optional selected_role if role param supported.\n\nFiles\n- src/beadhub/routes/policies.py\n- tests/test_policies.py\n\nDocs (avoid staleness)\n- Update SOT specs to include this endpoint:\n  - ../beadhub-sot/source-of-truth/beadhub-project-policy.md\n  - ../beadhub-sot/source-of-truth/beadhub-specifications.md\n\nSecurity\n- No project_slug selectors; always project-scoped by header.","acceptance_criteria":"- Endpoint returns the requested policy bundle when policy_id belongs to X-Project-ID project.\n- Missing X-Project-ID returns 422.\n- Cross-project policy_id is rejected (400/404).\n- Backend tests cover these cases.","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-02T21:12:25.648979Z","created_by":"juanre","updated_at":"2026-01-02T21:20:58.033637Z","closed_at":"2026-01-02T21:20:58.033637Z","close_reason":"Implemented GET /v1/policies/{policy_id} with X-Project-ID scoping, cross-project rejection, 4 tests. Updated SOT docs (beadhub-project-policy.md, beadhub-specifications.md).","dependencies":[{"issue_id":"beadhub-v5e9","depends_on_id":"beadhub-on08","type":"discovered-from","created_at":"2026-01-02T21:12:25.650896Z","created_by":"juanre"},{"issue_id":"beadhub-v5e9","depends_on_id":"beadhub-on08","type":"parent-child","created_at":"2026-01-02T21:12:30.340619Z","created_by":"juanre"}]}
{"id":"beadhub-v7lo","title":"Server API: expose focus apex in /v1/workspaces/team","description":"Extend the team-status view so bdh can fetch focus apex context even when a workspace has no active claims.\n\nDesign:\n- Add explicit fields to workspace payload (do NOT overload existing apex_id meaning):\n  - focus_apex_id, focus_apex_title, focus_apex_type (optional title/type via join), plus repo_name/branch if needed.\n- Ensure responses remain bounded and fast.\n\nAcceptance:\n- When a workspace has claims: current claim-derived apex fields remain available (as today).\n- When a workspace has no claims but has focus_apex_* set: focus fields are populated.\n- Clear labeling at API layer so CLI can distinguish current vs recent context.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T19:38:38.873552+01:00","updated_at":"2025-12-21T20:03:45.86547+01:00","closed_at":"2025-12-21T20:03:45.86547+01:00","close_reason":"Expose focus apex in workspaces/team","dependencies":[{"issue_id":"beadhub-v7lo","depends_on_id":"beadhub-s35l","type":"parent-child","created_at":"2025-12-21T19:38:38.874926+01:00","created_by":"juanre"}]}
{"id":"beadhub-v7wc","title":"Implement jump_in support in /v1/bdh/command endpoint","description":"When /v1/bdh/command receives jump_in:true, allow the claim even if another workspace already has the bead. Add both workspaces as workers on the bead. This enables collaborative work scenarios where multiple agents legitimately need to work on the same issue.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-13T16:12:35.329506+01:00","updated_at":"2025-12-13T16:14:59.327608+01:00","closed_at":"2025-12-13T16:14:59.327608+01:00"}
{"id":"beadhub-v8px","title":"Dashboard repo filter uses mismatched formats: workspaces have full URL, beads have simple name","description":"ROOT CAUSE: Beads sync stores repo as simple name (e.g., 'beadhub') but should store canonical_origin format (e.g., 'github.com/juanre/beadhub-cloud') to match workspaces.\n\nCurrent state:\n- Workspaces API returns repo: 'github.com/juanre/beadhub-cloud'\n- Beads/issues API returns repo: 'beadhub' (simple name)\n- FilterBar gets repo options from workspaces, sends them to beads API\n\nFix needed:\n1. Update beads sync (bdh/beadhub) to store canonical_origin format\n2. Update REPO_NAME_PATTERN to allow dots (or create a separate canonical origin validation)\n3. Migrate existing beads to use canonical format","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-10T09:04:10.424591+01:00","created_by":"juanre","updated_at":"2026-01-10T09:23:21.545387+01:00","closed_at":"2026-01-10T09:23:21.545387+01:00","close_reason":"Fixed: beads sync now stores canonical_origin format (e.g. github.com/org/repo) instead of simple repo name. Updated CANONICAL_ORIGIN_PATTERN validation in beads_sync.py and all API endpoints."}
{"id":"beadhub-v9wr","title":"Add pagination to all list endpoints and frontend","description":"Currently many list endpoints have no pagination or incomplete pagination:\n\n**Backend Issues:**\n- GET /v1/claims: NO pagination (returns ALL claims)\n- GET /v1/escalations: NO pagination (returns ALL escalations)  \n- GET /v1/chat/admin/sessions: NO pagination (returns ALL sessions)\n- GET /v1/workspaces: Has limit only, no offset/cursor\n- GET /v1/beads: Has limit only, no offset/cursor\n- GET /v1/messages: Has limit + has_more, but no offset/cursor\n\n**Frontend Issues:**\n- No pagination UI components anywhere\n- All list views load all data at once\n\n**Requirements:**\n1. Consistent cursor-based pagination on all list endpoints\n2. Standard response format: {items: [...], has_more: bool, next_cursor: string}\n3. Default page size: 50, max: 200\n4. Frontend pagination component with 'Load more' or cursor navigation\n5. All existing list views updated to paginate\n\nThis is standard practice and blocks production deployment.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-22T10:30:06.420433+01:00","updated_at":"2025-12-22T15:09:28.432018+01:00","closed_at":"2025-12-22T15:09:28.432018+01:00","close_reason":"All 12 subtasks complete, merged to main"}
{"id":"beadhub-vc3j","title":"Client: Enhanced --pending display with sender waiting status","description":"Update bdh :chat --pending to show whether senders are still waiting.\n\nCurrent display:\n  From agent-p1: \"message\"\n  â†’ Reply: bdh :chat agent-p1 \"reply\"\n\nNew display:\n  From agent-p1 (WAITING):\n    \"message\"\n    â†’ Reply: bdh :chat agent-p1 \"reply\"\n\n  From agent-p2 (not waiting):\n    \"message\"\n    â†’ Quick reply: bdh :chat agent-p2 \"reply\" --no-wait\n    â†’ Start exchange: bdh :chat agent-p2 \"reply\" --start-conversation\n\nUses sender_waiting field from GET /v1/chat/pending response.\n\nParent: beadhub-bwpi","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-16T21:32:43.780024+01:00","updated_at":"2025-12-16T21:32:43.780024+01:00"}
{"id":"beadhub-vd28","title":"Add visual separators between sidebar nav groups","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-09T22:46:45.556871+01:00","created_by":"juanre","updated_at":"2026-01-09T22:54:15.846049+01:00","closed_at":"2026-01-09T22:54:15.846049+01:00","close_reason":"Implemented sidebar reorder and separators"}
{"id":"beadhub-vf4x","title":"Frontend: display hostname/cwd in WorkspaceCard","description":"Display hostname and directory in workspace cards with home path shortening.\n\nFile: frontend/src/pages/WorkspacesPage.tsx\n\n1. Add helper function to shorten home paths:\n```typescript\nfunction shortenHomePath(path: string | null): string | null {\n  if (!path) return null\n  // Match /Users/username/ or /home/username/\n  const homePattern = /^(\\/Users\\/[^\\/]+\\/|\\/home\\/[^\\/]+\\/)/\n  return path.replace(homePattern, '~/')\n}\n```\n\n2. Add to WorkspaceCard metadata line (after human_name, before repo):\n```tsx\n{workspace.hostname \u0026\u0026 (\n  \u003c\u003e\n    \u003cspan className=\"flex items-center gap-1\"\u003e\n      \u003cMonitor className=\"h-3 w-3\" /\u003e  {/* or Server icon */}\n      {workspace.hostname}\n    \u003c/span\u003e\n    \u003cspan\u003eÂ·\u003c/span\u003e\n  \u003c/\u003e\n)}\n{workspace.cwd \u0026\u0026 (\n  \u003c\u003e\n    \u003cspan className=\"flex items-center gap-1\"\u003e\n      \u003cFolder className=\"h-3 w-3\" /\u003e\n      {shortenHomePath(workspace.cwd)}\n    \u003c/span\u003e\n    \u003cspan\u003eÂ·\u003c/span\u003e\n  \u003c/\u003e\n)}\n```\n\n3. Import icons from lucide-react: Monitor (or Server), Folder\n\nDesign note: Only shown for online workspaces (offline ones have null values).","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-13T21:09:54.590614+01:00","updated_at":"2025-12-13T21:09:54.590614+01:00","dependencies":[{"issue_id":"beadhub-vf4x","depends_on_id":"beadhub-ilzf","type":"blocks","created_at":"2025-12-13T21:10:03.041149+01:00","created_by":"juanre","metadata":"{}"}]}
{"id":"beadhub-vfoc","title":"Docs: clarify BEADHUB_API_KEY is the project key; remove admin-key/X-API-Key guidance","description":"Docs: clarify BEADHUB_API_KEY is always a project API key (client-side); remove server-admin-key/X-API-Key instructions; document Cloud internal auth secret.","design":"Spec: docs/specs/auth-model.md\\n\\nUpdate targets:\\n- docs/deployment.md: remove 'set BEADHUB_API_KEY to protect admin endpoints' and any X-API-Key examples.\\n- docs/development.md: remove 'optional admin key' guidance; explain how to bootstrap a project key via /v1/init or bdh :init.\\n- README and CLI docs: explain Bearer auth, one project per key, and that .beadhub stores no secrets/project_id.","acceptance_criteria":"- No documentation suggests setting BEADHUB_API_KEY on the server\\n- No docs mention X-API-Key or public X-Project-ID\\n- Docs point to docs/specs/auth-model.md","status":"closed","priority":1,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-17T18:50:23.551406+01:00","created_by":"Juan Reyero","updated_at":"2026-01-18T14:06:08.067058+01:00","closed_at":"2026-01-18T14:06:08.067058+01:00","close_reason":"Docs updated: BEADHUB_API_KEY documented as client-side project key; removed server-admin-key/X-API-Key guidance.","dependencies":[{"issue_id":"beadhub-vfoc","depends_on_id":"beadhub-p2ha","type":"parent-child","created_at":"2026-01-17T20:28:31.174026+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-vj5z","title":"Extract repeated config loading pattern in Go CLI commands","description":"## Problem\n\nNearly every Go CLI command repeats the same config loading and validation boilerplate.\n\n### Current Behavior\n\nEvery command in `bdh/internal/commands/*.go` repeats:\n```go\ncfg, err := config.Load()\nif err != nil {\n    if os.IsNotExist(err) {\n        return fmt.Errorf(\"no .beadhub file found - run 'bdh :init' first\")\n    }\n    return fmt.Errorf(\"loading config: %w\", err)\n}\n\nif err := cfg.Validate(); err != nil {\n    return fmt.Errorf(\"invalid .beadhub config: %w\", err)\n}\nif err := validateRepoOriginMatchesCurrent(cfg); err != nil {\n    return err\n}\n```\n\nThis appears in 30+ command files.\n\n### Impact\n\n- ~600+ lines of repeated code\n- Bug fixes need to be applied everywhere\n- New commands copy-paste boilerplate\n- Easy to forget validation steps in new commands\n\n### Solution\n\nCreate a helper function:\n\n```go\n// commands/config_helpers.go\n\n// RequireValidConfig loads and validates the .beadhub config.\n// Returns error with user-friendly message if config is missing or invalid.\nfunc RequireValidConfig() (*config.Config, error) {\n    cfg, err := config.Load()\n    if err != nil {\n        if os.IsNotExist(err) {\n            return nil, fmt.Errorf(\"no .beadhub file found - run 'bdh :init' first\")\n        }\n        return nil, fmt.Errorf(\"loading config: %w\", err)\n    }\n    \n    if err := cfg.Validate(); err != nil {\n        return nil, fmt.Errorf(\"invalid .beadhub config: %w\", err)\n    }\n    \n    if err := validateRepoOriginMatchesCurrent(cfg); err != nil {\n        return nil, err\n    }\n    \n    return cfg, nil\n}\n\n// Usage in commands:\nfunc runMyCommand(cmd *cobra.Command, args []string) error {\n    cfg, err := RequireValidConfig()\n    if err != nil {\n        return err\n    }\n    // ... rest of command\n}\n```\n\n### Files to Update\n\n- Create `bdh/internal/commands/config_helpers.go`\n- Update all command files to use helper\n- Consider similar helper for presence + notification pattern\n\n### Acceptance Criteria\n\n- [ ] Single RequireValidConfig helper\n- [ ] All commands use the helper\n- [ ] No duplicate config loading code\n- [ ] Error messages remain user-friendly","status":"open","priority":3,"issue_type":"task","created_at":"2026-01-08T12:42:22.523093+01:00","created_by":"juanre","updated_at":"2026-01-08T12:42:22.523093+01:00"}
{"id":"beadhub-vk1","title":"Message read flag race condition in messages.py:183-186","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-03T15:38:51.788615+01:00","updated_at":"2025-12-03T19:21:56.523817+01:00","closed_at":"2025-12-03T19:21:56.523817+01:00"}
{"id":"beadhub-vlav","title":"FIX: beads search indexes not created - migration 002 fails silently","description":"## Problem\n\nThe `002_search_indexes.sql` migration fails silently because `CREATE INDEX CONCURRENTLY` cannot run inside a transaction block. pgdbm wraps all migrations in transactions, causing the entire migration to fail.\n\n**Current state in dev database:**\n- pg_trgm extension: NOT INSTALLED\n- idx_beads_issues_title_trgm: MISSING  \n- idx_beads_issues_bead_id_trgm: MISSING\n\n**Error observed in test logs:**\n```\nERROR pgdbm.migrations:migrations.py:475 Failed to apply migration '002_search_indexes.sql': CREATE INDEX CONCURRENTLY cannot run inside a transaction block\n```\n\n## Impact\n\n- Search endpoint `/v1/beads/issues?q=...` does full table scans on title/bead_id columns\n- Small datasets: negligible performance impact\n- Large datasets (cloud): unacceptable query latency\n- Migration failure is silent - tests pass because they don't verify index existence\n\n## Requirements\n\nMust work for both:\n1. **OSS**: Fresh installs with empty tables (can tolerate brief table locks)\n2. **Cloud**: Production databases with existing data (cannot lock tables during index creation)\n\n## Technical Options\n\n1. **pgdbm autocommit mode**: If pgdbm supports running specific migrations outside transactions, use that for DDL that requires it.\n\n2. **Split migration strategy**:\n   - Migration 002a: `CREATE EXTENSION IF NOT EXISTS pg_trgm` (can run in transaction)\n   - Migration 002b: Marked as autocommit-required, creates indexes CONCURRENTLY\n\n3. **Conditional approach**:\n   - Check if table is empty â†’ use regular CREATE INDEX (faster, locks OK)\n   - Check if table has data â†’ use CONCURRENTLY (no locks, slower)\n\n4. **Application-level index management**:\n   - Skip CONCURRENTLY indexes in migrations\n   - Create them via a separate admin command or startup check\n\n## Acceptance Criteria\n\n- [ ] pg_trgm extension is installed in beads schema\n- [ ] idx_beads_issues_title_trgm index exists and is valid\n- [ ] idx_beads_issues_bead_id_trgm index exists and is valid\n- [ ] Migration works on fresh databases (OSS install)\n- [ ] Migration works on databases with existing data (cloud upgrade)\n- [ ] Test added that verifies indexes exist after migration\n- [ ] No silent migration failures","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-11T00:28:39.643538+01:00","created_by":"juanre","updated_at":"2026-01-11T08:53:54.7022+01:00","closed_at":"2026-01-11T08:53:54.7022+01:00","close_reason":"Fixed: pgdbm now supports no-transaction migrations via magic comment. Indexes verified in dev database."}
{"id":"beadhub-vmx","title":"Evaluate removing colon namespacing from bead IDs","description":"Current design encodes repo_name into bead_id as 'repo:bead_id'. This reserves ':' as a special character, creates redundancy (repo in two places), and the ready query has a bug - it joins on bead_id only, ignoring branch.\n\nDecision: Remove namespacing entirely. Store (repo_name, branch, bead_id) as separate fields.\n\nChanges needed:\n1. bead_id stores raw ID (no prefix)\n2. blocked_by becomes JSONB array of {repo, branch, bead_id} objects\n3. Ready query joins on all three fields\n4. API responses return raw bead_id (repo/branch already separate)\n5. Remove _namespace_id() function from beads_sync.py\n\nSince DB not deployed to prod, edit migrations directly.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T08:11:48.427727+01:00","updated_at":"2025-12-07T08:29:11.092167+01:00","closed_at":"2025-12-07T08:29:11.092167+01:00","dependencies":[{"issue_id":"beadhub-vmx","depends_on_id":"beadhub-ya3","type":"discovered-from","created_at":"2025-12-07T08:11:48.428748+01:00","created_by":"juanre"}]}
{"id":"beadhub-vo4","title":"Design and implement cloud-ready beads sync for multi-tenant BeadHub","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-06T22:25:47.878696+01:00","updated_at":"2025-12-07T09:34:19.553985+01:00","closed_at":"2025-12-07T09:34:19.553985+01:00"}
{"id":"beadhub-voce","title":"Log cleanup errors instead of silently ignoring","description":"In passthrough.go:185, deletion errors are silently ignored: '_, _ = c.DeleteWorkspace(ctx, ws.WorkspaceID)'. Add WARN-level logging for failures. Consider tracking failure counts and pausing cleanup if too many failures.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T08:01:51.041377+01:00","updated_at":"2025-12-17T18:57:57.241798+01:00","closed_at":"2025-12-17T18:57:57.241798+01:00","close_reason":"Won't fix: auto-cleanup feature removed - worktree-based detection doesn't work across machines","dependencies":[{"issue_id":"beadhub-voce","depends_on_id":"beadhub-lmtj","type":"discovered-from","created_at":"2025-12-17T08:01:51.042302+01:00","created_by":"juanre"}]}
{"id":"beadhub-voyd","title":"Chat sessions still expose/use status despite spec (no lifecycle)","description":"beadhub-chat-spec.md v2.1: no waiting/active/ended lifecycle. Current server code still writes and exposes status:\n- create_session inserts chat_sessions.status=\"active\" (src/beadhub/routes/chat.py)\n- list_sessions returns SessionListItem.status and accepts status filter\n- create_session stores status in Redis session hash for pending\n\nFix: stop exposing status in API responses, remove status query param, and consider schema cleanup (drop/ignore status column) or make it an internal constant only during transition.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-14T00:28:15.639239+01:00","updated_at":"2025-12-14T09:42:54.896123+01:00","closed_at":"2025-12-14T09:42:54.896123+01:00","dependencies":[{"issue_id":"beadhub-voyd","depends_on_id":"beadhub-ddsf","type":"discovered-from","created_at":"2025-12-14T00:28:15.640536+01:00","created_by":"juanre"}]}
{"id":"beadhub-vpi","title":"Broadcast messaging","description":"Allow agents to message all workspaces in a repo at once.\n\nAPI:\n- POST /v1/messages with broadcast: true, broadcast_repo: 'backend'\n- Server queries active workspaces by repo\n- Fans out message to all matching inboxes\n\nUse cases:\n- 'API contract question - what format for /api/dashboard?'\n- 'Heads up: I'm refactoring the auth module'\n- Announcements that all agents in a repo should see\n\nImplementation:\n- Query presence keys by repo metadata\n- Create message copy for each workspace inbox\n- Return delivery count in response","status":"open","priority":2,"issue_type":"epic","created_at":"2025-12-08T11:51:41.299548+01:00","updated_at":"2025-12-08T11:51:41.299548+01:00"}
{"id":"beadhub-vs15","title":"Add FK constraint on chat_read_receipts.last_read_message_id","description":"Migration 009 is missing a FK constraint on last_read_message_id. This can allow storing invalid message IDs leading to broken read receipts and orphaned references. Fix: Add REFERENCES {{tables.chat_messages}}(message_id) ON DELETE SET NULL","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-13T20:42:38.443218+01:00","updated_at":"2025-12-13T20:42:38.443218+01:00"}
{"id":"beadhub-vui","title":"Add authorization to SSE endpoint for multi-tenant deployments","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T12:31:46.917329+01:00","updated_at":"2025-12-08T13:32:08.566974+01:00","closed_at":"2025-12-08T13:32:08.566974+01:00","dependencies":[{"issue_id":"beadhub-vui","depends_on_id":"beadhub-w4p","type":"discovered-from","created_at":"2025-12-08T12:31:46.918366+01:00","created_by":"juanre"}]}
{"id":"beadhub-vurd","title":"Integrate beâ†’coord and rebase performance work on new API/tenant model","description":"Context\n- The `be` branch introduced significant changes that affect how we should design and implement coordination scaling: tenant isolation via `X-Project-ID`, SSE filter unification, and changes in workspaces/status behavior and tests.\n- We had ongoing performance work (role/apex, team status bounding) that must be re-aligned to this new baseline to avoid conflicting API designs and duplicated work.\n\nWork\n1) Merge `be` into `coord` (git) and ensure the worktree is clean.\n2) Re-evaluate performance hotspots under the new baseline:\n   - `/v1/workspaces` still does global presence merge and recursive apex computation (needs redesign per beadhub-qrnr + beadhub-hrq5).\n   - `bdh ready` still uses `/v1/workspaces` and must move to bounded team-status API (beadhub-ate4).\n3) Ensure beads reflect the new agreed-upon API/tenant model and do not conflict with `be` changes.\n\nValidation\n- After merge, `uv run pytest` passes (server + CLI tests).\n- No stale/dead code paths remain from pre-merge designs.\n\nDone when\n- `coord` is on top of `be` and the follow-up beads (qrnr/hrq5/ate4) are ready to implement without ambiguity.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T13:33:57.54312+01:00","updated_at":"2025-12-21T13:35:13.842336+01:00","closed_at":"2025-12-21T13:35:13.842336+01:00","close_reason":"Merged be into coord and updated follow-up planning beads","dependencies":[{"issue_id":"beadhub-vurd","depends_on_id":"beadhub-o9h7","type":"discovered-from","created_at":"2025-12-21T13:33:57.544143+01:00","created_by":"juanre"}]}
{"id":"beadhub-vvf","title":"Remove _namespace_id and update beads_sync.py","description":"Remove _namespace_id() function. Update _sync_issues_to_db to:\n1. Store raw bead_id (no prefix)\n2. Build blocked_by as JSONB array of {repo, branch, bead_id} objects\n3. Update parent_id handling similarly","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T08:15:39.927487+01:00","updated_at":"2025-12-07T08:17:38.587591+01:00","closed_at":"2025-12-07T08:17:38.587591+01:00","dependencies":[{"issue_id":"beadhub-vvf","depends_on_id":"beadhub-vmx","type":"parent-child","created_at":"2025-12-07T08:15:39.9286+01:00","created_by":"juanre"}]}
{"id":"beadhub-vvoi","title":"Migrate test_escalation_tenant_isolation.py to db_infra fixture","description":"Convert from app_with_test_db to async tests using db_infra fixture.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-10T10:54:39.138683+01:00","created_by":"juanre","updated_at":"2026-01-10T11:18:00.521419+01:00","closed_at":"2026-01-10T11:18:00.521419+01:00","close_reason":"Migrated 9 tests to use db_infra fixture. Removed all app_with_test_db usage.","dependencies":[{"issue_id":"beadhub-vvoi","depends_on_id":"beadhub-7wpr","type":"parent-child","created_at":"2026-01-10T10:55:48.280975+01:00","created_by":"juanre"}]}
{"id":"beadhub-vvon","title":"Extend .role file format for apex storage","description":"Extend .role file to support a second line containing the apex bead ID(s). Format: line 1 = role description, line 2 = apex bead ID (or comma-separated IDs if working on multiple epics). Update config.go: add LoadApex() returning []string and SaveApex(ids []string). Preserve backward compatibility with single-line .role files.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-17T21:59:17.127694+01:00","updated_at":"2025-12-20T10:11:07.843646+01:00","closed_at":"2025-12-20T10:11:07.843646+01:00","close_reason":"Implemented LoadApex() and SaveApex() for apex storage in .role file with full test coverage and validation","dependencies":[{"issue_id":"beadhub-vvon","depends_on_id":"beadhub-npuh","type":"parent-child","created_at":"2025-12-17T21:59:32.577136+01:00","created_by":"juanre"}]}
{"id":"beadhub-vyz5","title":"Bug: /v1/workspaces/suggest-name-prefix not served (breaks :next-alias-prefix)","description":"Bug: `/v1/workspaces/suggest-name-prefix` is not reachable as an API endpoint (returns 405 / served by dashboard static), breaking worktree creation.\n\nImpact\n- `bdh :next-alias-prefix` fails with:\n  - `BeadHub error (405): {\"detail\":\"Method Not Allowed\"}`\n- `scripts/create-worktree.sh` depends on `bdh :next-alias-prefix` to pick the next agent branch name.\n\nRepro\n- `bdh :next-alias-prefix --json`\n- `curl -i -X POST http://localhost:8000/v1/workspaces/suggest-name-prefix -H 'content-type: application/json' -d '{\"origin_url\":\"git@github.com:juanre/beadhub.git\"}'`\n  - Observed: 405 Method Not Allowed.\n\nExpected\n- `POST /v1/workspaces/suggest-name-prefix` should return JSON per SOT and server implementation in `src/beadhub/routes/workspaces.py`.\n\nLikely cause\n- Dashboard static handler / SPA fallback is intercepting this route (similar to beadhub-dsxj).\n\nFix\n- Ensure the workspaces router includes the suggest-name-prefix route and that API routes are registered before any dashboard fallback.\n- Add regression test verifying POST returns JSON and not HTML.\n\n","status":"closed","priority":0,"issue_type":"bug","created_at":"2026-01-02T15:58:09.273982Z","created_by":"juanre","updated_at":"2026-01-02T16:35:48.824885Z","closed_at":"2026-01-02T16:35:48.824885Z","close_reason":"Same root cause as beadhub-dsxj - stale pycache. POST /v1/workspaces/suggest-name-prefix works correctly.","dependencies":[{"issue_id":"beadhub-vyz5","depends_on_id":"beadhub-dsxj","type":"discovered-from","created_at":"2026-01-02T15:58:09.276276Z","created_by":"juanre"}]}
{"id":"beadhub-w0kj","title":"Remove vestigial priority field from messaging","description":"The priority field in messaging (low/normal/high) is vestigial:\n\n- Only settable via dashboard SendMessageDialog, not available in bdh :send\n- Stored in database but doesn't affect delivery or notification behavior\n- Displayed as colored badge in inbox but doesn't affect sorting\n- Adds UI complexity without providing value\n\nRemoval scope:\n1. Frontend: Remove priority dropdown from SendMessageDialog\n2. Frontend: Remove priority display/colors from MessagesPage\n3. Frontend: Remove priority from Claim type in api.ts (if present)\n4. Backend: Remove priority field from SendMessageRequest model\n5. Backend: Remove priority column from messages table (migration)\n6. Backend: Remove priority from InboxMessage response model\n\nKeep database column for now (nullable) to avoid breaking existing data.","status":"open","priority":3,"issue_type":"chore","created_at":"2026-01-06T21:14:42.294999Z","created_by":"juanre","updated_at":"2026-01-06T21:14:51.950065Z"}
{"id":"beadhub-w143","title":"Chat sessions API - create, join, end endpoints","description":"Implement chat session management endpoints:\n\n- POST /v1/chat/sessions - Create new chat session with initial message\n- POST /v1/chat/sessions/{id}/join - Join existing session\n- POST /v1/chat/sessions/{id}/end - End session with optional final message\n- GET /v1/chat/pending - Get pending chat requests for a workspace\n\nData model in Redis:\n- chat:session:{session_id} - Hash with session metadata\n- chat:pending:{target_workspace} - Set of pending session IDs\n\nSee spec: beadhub-sot/source-of-truth/beadhub-chat-spec.md","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T20:33:21.916986+01:00","updated_at":"2025-12-10T21:08:46.104042+01:00","closed_at":"2025-12-10T21:08:46.104042+01:00"}
{"id":"beadhub-w1wr","title":"Sanitize API error messages before displaying to users","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-08T15:32:33.874189+01:00","updated_at":"2025-12-08T15:32:33.874189+01:00","dependencies":[{"issue_id":"beadhub-w1wr","depends_on_id":"beadhub-7r4","type":"discovered-from","created_at":"2025-12-08T15:32:33.875642+01:00","created_by":"juanre"}]}
{"id":"beadhub-w4p","title":"Real-time event streaming via SSE","description":"SSE endpoint for real-time dashboard updates. Foundation for web dashboard and CLI --watch mode.\n\nSubtasks:\n- Add Redis pub/sub event emission on lock/message/escalation changes\n- Implement GET /v1/status/stream SSE endpoint\n- Subscribe to Redis channels and stream events to connected clients\n- Support filtering by workspace_id or project_id\n\nEvents to stream:\n- lock_acquired, lock_released\n- message_sent, message_read\n- escalation_created, escalation_responded\n- bead_status_changed\n- workspace_connected, workspace_disconnected","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-08T11:51:11.60137+01:00","updated_at":"2025-12-08T12:32:11.495799+01:00","closed_at":"2025-12-08T12:32:11.495799+01:00"}
{"id":"beadhub-w4sg","title":"Add /v1/repos/ensure endpoint for repo registration","description":"Create new endpoint POST /v1/repos/ensure for repo registration.\n\nPurpose: Called during bdh init to register the git repo with BeadHub.\n\nRequest:\n{\n    \"project_id\": \"uuid\",\n    \"origin_url\": \"git@github.com:org/repo.git\"\n}\n\nResponse:\n{\n    \"repo_id\": \"uuid\",\n    \"canonical_origin\": \"github.com/org/repo\",\n    \"name\": \"repo\",\n    \"created\": true|false  // true if newly created\n}\n\nImplementation:\n1. Create canonicalize_git_url() function to normalize URLs:\n   - git@github.com:org/repo.git â†’ github.com/org/repo\n   - https://github.com/org/repo.git â†’ github.com/org/repo\n   - git@gitlab.com:org/repo â†’ gitlab.com/org/repo\n   - https://bitbucket.org/org/repo.git â†’ bitbucket.org/org/repo\n   \n2. Extract name from canonical (last path component)\n\n3. Upsert into repos table:\n   INSERT INTO repos (project_id, origin_url, canonical_origin, name)\n   VALUES ($1, $2, $3, $4)\n   ON CONFLICT (project_id, canonical_origin) \n   DO UPDATE SET origin_url = EXCLUDED.origin_url\n   RETURNING id, (xmax = 0) as created\n\n4. Return repo_id and created flag\n\nFile: src/beadhub/routes/repos.py (new file)\n\nThis endpoint is called by Go bdh init command after project/ensure.\nThe canonical_origin is stored in repos table, NOT in .beadhub file.\n\nDepends on: repos table migration","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T12:52:35.75605+01:00","updated_at":"2025-12-12T18:49:49.925456+01:00","closed_at":"2025-12-12T18:49:49.925456+01:00","dependencies":[{"issue_id":"beadhub-w4sg","depends_on_id":"beadhub-f9rh","type":"blocks","created_at":"2025-12-12T12:52:44.881232+01:00","created_by":"juanre"}]}
{"id":"beadhub-w50x","title":"Add bulk ack for inbox messages (bdh :ack --all)","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-04T17:20:34.699Z","created_by":"juanre","updated_at":"2026-01-04T17:23:44.213268Z","closed_at":"2026-01-04T17:23:44.213268Z","close_reason":"Add bdh :ack --all to acknowledge all unread inbox messages"}
{"id":"beadhub-w5bg","title":"Add status/alias validation to list_issues in beads.py","description":"Same issue as beadhub-g39h: /v1/beads/issues accepts unvalidated status parameter (src/beadhub/routes/beads.py:508). Apply the same validation pattern used in escalations.py.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-15T18:45:50.084667+01:00","updated_at":"2025-12-15T18:45:50.084667+01:00"}
{"id":"beadhub-w6fp","title":"Add project_id to /v1/beads/issues/all response","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T13:26:27.679654+01:00","updated_at":"2025-12-13T13:26:49.734569+01:00","closed_at":"2025-12-13T13:26:49.734569+01:00"}
{"id":"beadhub-w7fe","title":"Add tenant isolation validation to sendMessage","status":"closed","priority":1,"issue_type":"bug","assignee":"juanre","created_at":"2025-12-13T20:35:05.97131+01:00","updated_at":"2026-01-03T17:14:39.838641Z","closed_at":"2026-01-03T17:14:39.838641Z","close_reason":"Enforced X-Project-ID tenant scoping for messages endpoints + MCP tools when auth enabled; added regression tests."}
{"id":"beadhub-w7hi","title":"SSE: consider caching all-workspaces query for high-volume deployments","description":"## Context\n\nThe SSE endpoint now queries all workspace IDs from the database on every connection when no filter is provided:\n\n```python\nworkspace_ids = await get_all_workspace_ids_from_db(db_infra)\n```\n\nThis executes:\n```sql\nSELECT workspace_id FROM workspaces WHERE deleted_at IS NULL\n```\n\n## Performance Consideration\n\nFor small deployments (\u003c 1000 workspaces), this is negligible. For larger deployments with:\n- Many concurrent SSE connections\n- High connection churn (reconnects)\n- Large workspace counts\n\nThis could become a bottleneck since each new SSE connection triggers a full table scan.\n\n## Potential Solutions\n\n1. **In-memory cache with TTL** (5-30 seconds)\n   - Simple, effective for single-instance deployments\n   - Cache invalidation on workspace create/delete\n\n2. **Redis cache layer**\n   - Works for multi-instance deployments\n   - Ironic given we just moved away from Redis for correctness\n\n3. **Accept the cost**\n   - If workspace count remains low\n   - Monitor query performance in production first\n\n## Database Index\n\nAlso consider adding a partial index for this query pattern:\n```sql\nCREATE INDEX idx_workspaces_all_active ON workspaces(workspace_id)\n    WHERE deleted_at IS NULL;\n```\n\n## Priority\n\nLow - only implement if monitoring shows this is a bottleneck","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-20T15:59:51.687076+01:00","updated_at":"2025-12-22T01:21:08.209476+01:00","closed_at":"2025-12-22T01:21:08.209476+01:00","close_reason":"Merged to main"}
{"id":"beadhub-w9h","title":"Phase 2: SaaS Foundation - Multi-tenant auth and project scoping","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-12-03T08:09:02.092212+01:00","updated_at":"2025-12-03T08:41:53.05491+01:00","closed_at":"2025-12-03T08:41:53.05491+01:00","close_reason":"SaaS foundation complete - auth, projects, API keys from template"}
{"id":"beadhub-w9la","title":"Migrate test_agents.py to db_infra fixture","description":"Convert from app_with_test_db to async tests using db_infra fixture.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-10T10:55:18.28098+01:00","created_by":"juanre","updated_at":"2026-01-10T11:31:03.196764+01:00","closed_at":"2026-01-10T11:31:03.196764+01:00","close_reason":"Migrated 13 tests to use db_infra fixture","dependencies":[{"issue_id":"beadhub-w9la","depends_on_id":"beadhub-7wpr","type":"parent-child","created_at":"2026-01-10T10:55:50.514916+01:00","created_by":"juanre"}]}
{"id":"beadhub-waak","title":"Unify mail interface to match chat pattern","description":"The current mail interface is inconsistent with the chat interface:\n\n**Current mail (verb-based commands):**\n- `bdh :send \u003ctarget\u003e \u003cmessage\u003e`\n- `bdh :inbox`\n- `bdh :ack \u003cmessage_id\u003e`\n\n**Current chat (noun with mode flags):**\n- `bdh :chat --reply \u003cagent\u003e \"msg\"`\n- `bdh :chat --open \u003cagent\u003e`\n- `bdh :chat --pending`\n\nChat's design is better - mode flags make intent explicit and all operations live under one namespace. Mail should follow the same pattern.\n\n**Target state:**\n```\nbdh :mail --send \u003ctarget\u003e \"message\"    # send a message\nbdh :mail --inbox                      # list unread messages\nbdh :mail --open \u003csender\u003e              # read from sender, auto-ack\nbdh :mail --ack \u003cmessage_id\u003e           # explicit ack (optional)\nbdh :mail --history \u003csender\u003e           # all messages from sender\nbdh :mail --all                        # include read (with --inbox)\nbdh :mail --subject \"...\"              # with --send\nbdh :mail --json                       # JSON output\n```\n\nThe old commands (:send, :inbox, :ack) will be removed entirely.","status":"closed","priority":1,"issue_type":"epic","created_at":"2026-01-10T14:01:11.245326+01:00","created_by":"juanre","updated_at":"2026-01-10T14:32:39.084827+01:00","closed_at":"2026-01-10T14:32:39.084827+01:00","close_reason":"All child beads completed - mail interface now consistent with chat"}
{"id":"beadhub-wafo","title":"Update Go bdh init.go: read git origin, generate repo_origin","description":"Update bdh/internal/commands/init.go for new data model.\n\nChanges:\n1. Environment variables:\n   - BEADHUB_AGENT â†’ BEADHUB_ALIAS (support both during migration)\n\n2. Config field names:\n   - agentName variable â†’ alias\n   - cfg.AgentName â†’ cfg.Alias\n\n3. Add git origin detection:\n   - Run: git remote get-url origin (or git config --get remote.origin.url)\n   - Store result as RepoOrigin in config\n   - Handle missing origin gracefully (error if not in git repo)\n\n4. Add repo registration to init flow (NEW!):\n   After project ensure:\n   a. Call POST /v1/repos/ensure with { project_id, origin_url: \u003cgit origin\u003e }\n   b. Receive { repo_id, canonical_origin, name }\n   c. Store repo_id for later use in workspace registration\n   d. Display canonical_origin to user\n\n5. Update workspace registration:\n   - Include repo_id from step 4\n   - Use alias instead of agent_name\n\n6. Output changes:\n   - Print repo_origin and canonical_origin\n   - Print alias instead of agent_name\n\nInit flow becomes:\n1. Get/create project via /v1/projects/ensure\n2. Get/create repo via /v1/repos/ensure (NEW!)\n3. Register workspace via /v1/agents/register (with repo_id)\n4. Write .beadhub file (with repo_origin, alias)\n\nDepends on: config.go changes, /v1/repos/ensure endpoint (beadhub-w4sg)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-12T12:51:57.516211+01:00","updated_at":"2025-12-13T00:01:57.854634+01:00","closed_at":"2025-12-13T00:01:57.854634+01:00","dependencies":[{"issue_id":"beadhub-wafo","depends_on_id":"beadhub-lhx4","type":"blocks","created_at":"2025-12-12T12:52:06.618166+01:00","created_by":"juanre"},{"issue_id":"beadhub-wafo","depends_on_id":"beadhub-w4sg","type":"blocks","created_at":"2025-12-12T14:49:19.62873+01:00","created_by":"juanre"}]}
{"id":"beadhub-wb4e","title":"UX: Add keyboard shortcuts for power users (j/k navigation, ? for help)","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-13T21:26:16.848458+01:00","updated_at":"2026-01-03T18:38:57.095662Z","closed_at":"2026-01-03T18:38:57.095662Z","close_reason":"Defer: keyboard shortcuts are nice-to-have; not prioritizing right now."}
{"id":"beadhub-wdum","title":"SECURITY: Sanitize error messages to prevent information disclosure","description":"## Problem\n\nError messages reveal internal implementation details that help attackers.\n\n### Current Behavior\n\nExamples from various routes:\n\n```python\n# workspaces.py:400 - Leaks UUID format and relationship\nraise HTTPException(\n    status_code=404,\n    detail=f\"Repo {payload.repo_id} not found in project {payload.project_id}\",\n)\n\n# beads.py - Leaks field names and internal structure\ndetail=f\"Invalid branch name: {branch_name[:50]}\"\n```\n\n### Attack Vector\n\nInformation disclosed helps attackers:\n- Reveals UUID format expectations (aids forging)\n- Exposes internal ID relationships\n- Shows database field names and structure\n- Assists in reconnaissance for further attacks\n\n### Files Affected\n\n- All route files with `HTTPException` raises\n- Approximately 219 HTTPException raises across 15 route files\n\n### Solution\n\n**Create error helper with production mode:**\n```python\n# errors.py\nimport os\n\n_DEBUG_MODE = os.getenv(\"BEADHUB_DEBUG\", \"false\").lower() == \"true\"\n\ndef validation_error(field: str, value: str, reason: str = \"\") -\u003e HTTPException:\n    if _DEBUG_MODE:\n        truncated = value[:50] if len(value) \u003e 50 else value\n        detail = f\"Invalid {field}: {truncated}\"\n        if reason:\n            detail += f\" ({reason})\"\n    else:\n        detail = \"Invalid request\"\n    return HTTPException(status_code=422, detail=detail)\n\ndef not_found_error(resource: str, identifier: str = \"\") -\u003e HTTPException:\n    if _DEBUG_MODE:\n        detail = f\"{resource} not found: {identifier}\"\n    else:\n        detail = \"Resource not found\"\n    return HTTPException(status_code=404, detail=detail)\n```\n\n### Acceptance Criteria\n\n- [ ] Production mode uses generic error messages\n- [ ] Debug mode (for development) shows detailed errors\n- [ ] Detailed errors logged server-side for debugging\n- [ ] Consistent error format across all routes\n- [ ] No UUIDs, field names, or internal structure in production errors","status":"open","priority":4,"issue_type":"bug","created_at":"2026-01-08T12:39:15.774004+01:00","created_by":"juanre","updated_at":"2026-01-17T15:12:59.352376+01:00"}
{"id":"beadhub-wg7x","title":"Optimize Redis index cleanup with pipeline (N calls â†’ 1)","description":"In presence.py, get_workspace_ids_by_repo_id(), get_workspace_ids_by_project_id(), and get_workspace_ids_by_branch() each make N Redis EXISTS calls to filter stale entries. With 100 workspaces = 100 round trips. Fix: Use Redis pipeline to batch all EXISTS checks into 1 operation. See code review for example implementation.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T14:16:03.570342+01:00","updated_at":"2025-12-13T18:28:37.820455+01:00","closed_at":"2025-12-13T18:28:37.820455+01:00"}
{"id":"beadhub-wj6x","title":"Allow multiple agents to claim same bead (with conflict warning)","description":"Database bead_claims currently has UNIQUE(project_id, bead_id). Change to UNIQUE(project_id, bead_id, workspace_id) to allow multiple agents to claim same bead. Display multi-claim situations prominently as potential conflicts in :status and when showing beads.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-12-13T11:27:33.540054+01:00","updated_at":"2025-12-13T11:49:51.818539+01:00","closed_at":"2025-12-13T11:49:51.818539+01:00","dependencies":[{"issue_id":"beadhub-wj6x","depends_on_id":"beadhub-3r30","type":"parent-child","created_at":"2025-12-13T11:28:13.058944+01:00","created_by":"juanre"}]}
{"id":"beadhub-wm8k","title":"Unbounded SSE reconnection loop without backoff","description":"Location: frontend/src/hooks/useSSE.ts:60-70. Error handler has infinite retry with fixed 5s delay. If server down: browser accumulates failed connections, constant server load, no user feedback, memory leaks from accumulated timeouts. Fix: exponential backoff with max retry limit, provide user feedback for permanent failures.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-08T18:24:59.95647+01:00","updated_at":"2025-12-21T12:30:56.750098+01:00","closed_at":"2025-12-21T12:30:56.750098+01:00","close_reason":"Implemented exponential backoff for SSE reconnection: 1s initial delay, 30s max, 10 retries max. Added connectionFailed state and Retry button in StatusPage UI.","dependencies":[{"issue_id":"beadhub-wm8k","depends_on_id":"beadhub-tyf3","type":"blocks","created_at":"2025-12-21T09:49:28.651601+01:00","created_by":"juanre"}]}
{"id":"beadhub-wna5","title":"UX: Chat history should show participant count for group chats","status":"open","priority":3,"issue_type":"feature","created_at":"2025-12-13T21:26:25.603051+01:00","updated_at":"2025-12-13T21:26:25.603051+01:00"}
{"id":"beadhub-wobz","title":"Remove vestigial priority field from messaging","description":"The priority field in the mail/messaging API is vestigial - it was originally intended for prioritizing messages but is not currently used by any consumer. Clean up: remove from schema, API, and UI.","status":"tombstone","priority":3,"issue_type":"chore","created_at":"2026-01-07T06:45:40.963847Z","created_by":"juanre","updated_at":"2026-01-08T20:14:14.02594+01:00","deleted_at":"2026-01-08T20:14:14.02594+01:00","deleted_by":"daemon","delete_reason":"Duplicate of beadhub-w0kj","original_type":"chore"}
{"id":"beadhub-wq6m","title":"Fix bdh init tests for suggest-alias response","description":"Update bdh init tests to use /v1/workspaces/suggest-alias and validate canonical_origin; ensure init errors on empty canonical_origin from suggest-alias responses.","notes":"Code review: checked init suggest-alias validation and tests; request includes role/origin_url; error handling covers missing project_id/slug/repo_id/canonical_origin; no issues found.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T17:13:08.037665+01:00","updated_at":"2025-12-21T17:32:26.823434+01:00","closed_at":"2025-12-21T17:32:26.823434+01:00","close_reason":"Completed","dependencies":[{"issue_id":"beadhub-wq6m","depends_on_id":"beadhub-o9h7","type":"discovered-from","created_at":"2025-12-21T17:13:08.038946+01:00","created_by":"juanre"}]}
{"id":"beadhub-wqjc","title":"Migrate test_bdh_command.py to db_infra fixture","description":"Convert from app_with_test_db to async tests using db_infra fixture. Large file with many test classes.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-10T10:55:17.883363+01:00","created_by":"juanre","updated_at":"2026-01-10T11:46:28.799771+01:00","closed_at":"2026-01-10T11:46:28.799771+01:00","close_reason":"Migrated 53 tests to use db_infra fixture","dependencies":[{"issue_id":"beadhub-wqjc","depends_on_id":"beadhub-7wpr","type":"parent-child","created_at":"2026-01-10T10:55:50.424465+01:00","created_by":"juanre"}]}
{"id":"beadhub-wrab","title":"Backend - Add Claims API Endpoint","description":"Add GET /v1/claims endpoint requiring project_id for tenant isolation. Reuse get_project_claims() from bdh.py.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T17:56:35.57051+01:00","updated_at":"2025-12-12T18:14:48.051218+01:00","closed_at":"2025-12-12T18:14:48.051218+01:00"}
{"id":"beadhub-wtb1","title":"reservations.py: 3 queries missing deleted_at filter","description":"Lines 187, 205, 242: _get_workspace_project_id, _get_workspace_info, and _batch_verify_workspaces_in_project query workspaces without deleted_at IS NULL filter. Deleted workspaces can still acquire/hold file locks.","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-21T20:46:59.576497+01:00","updated_at":"2025-12-21T21:05:26.423419+01:00","closed_at":"2025-12-21T21:05:26.423419+01:00","close_reason":"Added deleted_at IS NULL filter to all 3 workspace queries in reservations.py"}
{"id":"beadhub-wu3d","title":"Aggregate SSE events across all workspaces in 'All workspaces' mode","description":"Currently the Event Feed only shows events when connected to a specific workspace via SSE. In 'All workspaces' mode, the Event Feed is empty and useless.\n\nFix: Subscribe to events across all workspaces (or all workspaces in the filtered project/repo) and aggregate them in the Event Feed. This requires backend support for project-wide or global SSE subscriptions.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-14T00:11:31.549467+01:00","updated_at":"2025-12-14T18:17:29.032457+01:00","closed_at":"2025-12-14T00:47:17.966485+01:00","dependencies":[{"issue_id":"beadhub-wu3d","depends_on_id":"beadhub-c1tj","type":"blocks","created_at":"2025-12-14T00:12:45.561407+01:00","created_by":"juanre"}]}
{"id":"beadhub-wvj6","title":"Update workspaces table: add repo_id FK, rename agent_name to alias","description":"Edit server/007_workspaces.sql to implement new data model:\n\nChanges:\n1. Rename agent_name column to alias\n2. Add repo_id column (UUID, FK to repos, NOT NULL)\n3. Add current_branch column (TEXT, mutable)\n4. Change project_id from nullable to NOT NULL (immutability - see data-model.md section 2)\n5. Change unique constraint from global to per-project:\n   - Drop: CONSTRAINT unique_agent_name UNIQUE (agent_name)\n   - Add: UNIQUE(project_id, alias)\n6. Update index names:\n   - idx_workspaces_agent_name â†’ idx_workspaces_alias\n7. Keep trigger function as-is (it just updates timestamp)\n\nPer data-model.md:\n- workspace â†’ project immutable (project_id NOT NULL)\n- workspace â†’ repo immutable (repo_id NOT NULL)\n- workspace â†’ alias immutable\n- current_branch is mutable (updated on each bdh command)\n\nDepends on: repos table creation (beadhub-f9rh)","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T12:49:35.87627+01:00","updated_at":"2025-12-12T15:13:44.586823+01:00","closed_at":"2025-12-12T15:13:44.586823+01:00","dependencies":[{"issue_id":"beadhub-wvj6","depends_on_id":"beadhub-f9rh","type":"blocks","created_at":"2025-12-12T12:49:44.774726+01:00","created_by":"juanre"}]}
{"id":"beadhub-ww2","title":"Race condition in reservation acquisition - check-then-act allows multiple agents to acquire same lock","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-03T15:38:30.14965+01:00","updated_at":"2025-12-03T15:53:51.86107+01:00","closed_at":"2025-12-03T15:53:51.86107+01:00"}
{"id":"beadhub-wyqv","title":"OSS API: DELETE /v1/projects/{id} - delete project","description":"Add endpoint to delete a project. CASCADE deletes repos (via FK). Trigger soft-delete of workspaces. Release claims. Clear Redis presence.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T15:25:34.812791+01:00","updated_at":"2025-12-21T16:55:53.205259+01:00","closed_at":"2025-12-21T16:55:53.205259+01:00","close_reason":"Implemented DELETE endpoints with cascade logic","dependencies":[{"issue_id":"beadhub-wyqv","depends_on_id":"beadhub-1thq","type":"blocks","created_at":"2025-12-21T15:26:54.801561+01:00","created_by":"juanre"},{"issue_id":"beadhub-wyqv","depends_on_id":"beadhub-j86m","type":"blocks","created_at":"2025-12-21T15:27:04.513794+01:00","created_by":"juanre"}]}
{"id":"beadhub-wzyo","title":"Server: derive project from Bearer/internal context; remove BEADHUB_API_KEY + X-API-Key auth","description":"Server auth/scoping: derive project from Authorization Bearer token (OSS) or Cloud internal context; remove OSS 'admin key' (BEADHUB_API_KEY + X-API-Key) and remove public X-Project-ID.","design":"Spec: docs/specs/auth-model.md\\n\\nImplementation notes:\\n- Add/standardize a single helper (e.g. get_project_from_auth / verify_workspace_access) used by all project-scoped routes.\\n- Bearer token lookup: api_keys table (prefix lookup + bcrypt verify) =\u003e project_id.\\n- Cloud embedding: accept internal headers only when X-BH-Auth validates using BEADHUB_INTERNAL_AUTH_SECRET (or SESSION_SECRET_KEY).\\n- Never trust client-supplied project_id or X-Project-ID for authorization decisions.\\n- Remove any codepaths that 'enable auth' only when server BEADHUB_API_KEY is set.","acceptance_criteria":"- All project-scoped endpoints 401 without auth\\n- Bearer project keys authorize exactly one project\\n- No endpoint requires X-API-Key or public X-Project-ID\\n- Cloud internal auth works only with valid X-BH-Auth","status":"closed","priority":0,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-17T19:14:46.30872+01:00","created_by":"Juan Reyero","updated_at":"2026-01-18T14:06:13.237532+01:00","closed_at":"2026-01-18T14:06:13.237532+01:00","close_reason":"Implemented unified server auth: project scoped via Authorization Bearer (OSS) or validated internal context (Cloud); no server-side BEADHUB_API_KEY toggle and no public X-Project-ID/X-API-Key requirements.","dependencies":[{"issue_id":"beadhub-wzyo","depends_on_id":"beadhub-p2ha","type":"parent-child","created_at":"2026-01-17T19:14:59.678619+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-wzyo.1","title":"Server: remove or scope GET /v1/issues/all (currently cross-project)","description":"Delete GET /v1/beads/issues/all (cross-project issues listing).","design":"Rationale: 'issues/all' bypasses auth-derived scoping and becomes a cross-project data leak if reused in multi-project setups. With 'one project per key', clients should use GET /v1/beads/issues (server scopes by auth).\\n\\nImplementation:\\n- Remove the endpoint from src/beadhub/routes/beads.py entirely (or return 410 + hide from schema as an intermediate step).\\n- Update dashboard/clients/tests to stop calling it.","acceptance_criteria":"- /v1/beads/issues/all no longer exists (404) or returns 410 and is not in OpenAPI\\n- Dashboard uses /v1/beads/issues\\n- No tests reference /issues/all","status":"closed","priority":0,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-17T20:45:29.689053+01:00","created_by":"Juan Reyero","updated_at":"2026-01-18T14:06:03.103014+01:00","closed_at":"2026-01-18T14:06:03.103014+01:00","close_reason":"Removed cross-project issues endpoint (/v1/beads/issues/all). Clients use /v1/beads/issues (project scoped by auth).","dependencies":[{"issue_id":"beadhub-wzyo.1","depends_on_id":"beadhub-wzyo","type":"parent-child","created_at":"2026-01-17T20:45:29.689686+01:00","created_by":"Juan Reyero"}]}
{"id":"beadhub-x1k2","title":"Add status/alias validation to list_issues in beads.py","description":"Same issue as beadhub-g39h: /v1/beads/issues accepts unvalidated status parameter. Apply same validation pattern used in escalations.py.","status":"tombstone","priority":2,"issue_type":"bug","created_at":"2025-12-15T18:45:55.537155+01:00","updated_at":"2026-01-08T20:07:09.777124+01:00","deleted_at":"2026-01-08T20:07:09.777124+01:00","deleted_by":"daemon","delete_reason":"Duplicate of beadhub-w5bg","original_type":"bug"}
{"id":"beadhub-x2lj","title":"Frontend UI: SendMessageDialog component","description":"Create modal dialog for composing messages. Fields: target workspace (pre-fillable), subject, body textarea, priority selector. Send button with loading state. Success/error feedback via toast or inline message.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T19:27:05.091275+01:00","updated_at":"2025-12-14T08:53:08.270821+01:00","closed_at":"2025-12-13T20:16:16.420991+01:00","dependencies":[{"issue_id":"beadhub-x2lj","depends_on_id":"beadhub-7j9k","type":"blocks","created_at":"2025-12-13T19:27:37.491435+01:00","created_by":"juanre"},{"issue_id":"beadhub-x2lj","depends_on_id":"beadhub-g9l6","type":"parent-child","created_at":"2025-12-13T19:27:52.936464+01:00","created_by":"juanre"}]}
{"id":"beadhub-x3um","title":"CLI: --json outputs pure JSON (including bdh ready passthrough)","description":"Fix bdh JSON output so stdout is always valid JSON when --json is used.\n\nProblems:\n- Several : commands print server context (ShowServerContext) before JSON.\n- Some formatters print 'Warning: ...' text even in JSON mode.\n- bdh passthrough (e.g. 'bdh ready --json') prints coordination text + bd JSON, breaking JSON parsing.\n\nRequirements:\n- For all bdh :commands with --json: suppress all non-JSON prints and encode warnings in JSON.\n- For bdh passthrough with --json: output a JSON envelope that includes the raw bd JSON payload plus bdh coordination context (inbox, focus, team, locks, pending/waiting).\n- Add timeouts for network calls in :who and other affected commands.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-22T00:00:28.764758+01:00","updated_at":"2025-12-22T00:21:49.570642+01:00","closed_at":"2025-12-22T00:21:49.570642+01:00","close_reason":"Merged to main","dependencies":[{"issue_id":"beadhub-x3um","depends_on_id":"beadhub-bj5h","type":"discovered-from","created_at":"2025-12-22T00:00:28.766918+01:00","created_by":"juanre"}]}
{"id":"beadhub-x5r8","title":"Update tests for project_id migration (bead_claims, bdh_command, mcp)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-10T12:48:08.383511+01:00","updated_at":"2025-12-10T12:55:09.241317+01:00","closed_at":"2025-12-10T12:55:09.241317+01:00"}
{"id":"beadhub-x86b","title":"Frontend - Add Messages Page","description":"Create MessagesPage.tsx with inbox view. Add API calls for /v1/messages/inbox. Add Messages nav item.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-12-12T17:56:46.557851+01:00","updated_at":"2025-12-12T18:46:50.407061+01:00","closed_at":"2025-12-12T18:46:50.407061+01:00","dependencies":[{"issue_id":"beadhub-x86b","depends_on_id":"beadhub-84t5","type":"blocks","created_at":"2025-12-12T17:57:22.540864+01:00","created_by":"juanre"}]}
{"id":"beadhub-xaca","title":"Document last_seen_at staleness policy","description":"Inconsistent last_seen_at strategy: Go cleanup only checks if .beadhub file exists, doesn't actually use last_seen_at timestamp. Document the staleness policy. Consider adding grace period (e.g., only delete if last_seen \u003e 24h ago AND worktree gone).","status":"open","priority":2,"issue_type":"task","created_at":"2025-12-17T08:01:50.421807+01:00","updated_at":"2025-12-17T08:01:50.421807+01:00","dependencies":[{"issue_id":"beadhub-xaca","depends_on_id":"beadhub-lmtj","type":"discovered-from","created_at":"2025-12-17T08:01:50.423093+01:00","created_by":"juanre"}]}
{"id":"beadhub-xalf","title":"Automate bdh mail prompt into Codex Terminal tab (macOS)","description":"## Problem\nIn this Codex CLI workflow, I only take action when you send a prompt. BeadHub mail arrives asynchronously, so a blocked agent can sit WAITING until you notice and type e.g. â€œcheck mailâ€.\n\n## Goal\nOn macOS, automatically check `bdh :inbox` every ~60s and, when new unread mail arrives, inject a short prompt into the specific Terminal.app tab running Codex (as if you typed it). Default prompt: â€œcheck mailâ€.\n\n## Constraints / Requirements\n1. Terminal.app may have many windows and tabs; the automation must reliably target the correct tab.\n2. Must avoid workspace impersonation: the mail check must run `bdh` from a fixed worktree path containing the intended `.beadhub`.\n3. Must de-dupe per message_id so it doesnâ€™t spam the terminal repeatedly.\n4. Must be opt-in and reversible (easy enable/disable/uninstall).\n5. Best-effort: we cannot reliably detect whether Codex is mid-input; injection may be disruptive. We should rate-limit and keep injected text minimal.\n\n## Proposed approach\n### A) Identify the correct Terminal tab\nUse Terminal tab â€œcustom titleâ€ as a stable identifier.\n- One-time setup: user sets a unique custom title on the Codex tab (e.g., BeadHub-Codex).\n- AppleScript enumerates all Terminal windows/tabs and selects the tab whose custom title matches.\n\n### B) Poll for mail via launchd\nInstall a LaunchAgent (launchd) that runs every 60 seconds.\n- Script behavior:\n  - cd into configured worktree (absolute path)\n  - run `bdh :inbox --json`\n  - extract message IDs\n  - compare to a local â€œseen IDsâ€ file (store only IDs, not bodies)\n  - if any new IDs exist, run AppleScript injection once and append IDs to seen file\n\n### C) Inject prompt into the Codex Terminal tab\nUse AppleScript `do script ... in \u003ctab\u003e` to write the prompt into that session.\n- Default injected prompt: â€œcheck mailâ€\n- Configurable prompt string.\n- Throttle: at most one injection per poll tick (collapse multiple new messages into one injection).\n\n## Deliverables\n1. `scripts/macos/bdh-mail-watch.sh` (poll + dedupe + call AppleScript)\n2. `scripts/macos/bdh-inject-terminal.applescript` (find tab by custom title + inject)\n3. `scripts/macos/com.beadhub.mailwatch.plist` (LaunchAgent template)\n4. `docs/macos-automation.md` with:\n   - setup (custom title, install LaunchAgent)\n   - permissions (macOS Automation prompts)\n   - how to disable/uninstall\n   - troubleshooting\n\n## Acceptance criteria\n1. With multiple Terminal windows, setting a custom title on the Codex tab is sufficient for the script to find the correct tab.\n2. When a new unread mail arrives, within 60 seconds the script injects the prompt into the Codex tab exactly once per new message_id set.\n3. No repeated injections for the same unread mail (dedupe works across restarts).\n4. The watcher runs `bdh` from the configured worktree path (no accidental impersonation).\n5. User can disable/uninstall cleanly.\n\n## Non-goals\n- Fully autonomous â€œmerge/review/closeâ€ actions.\n- Anything that requires network hooks/webhooks.\n","status":"open","priority":2,"issue_type":"epic","created_at":"2026-01-03T19:24:31.021531Z","created_by":"juanre","updated_at":"2026-01-03T19:25:19.309343Z"}
{"id":"beadhub-xc6","title":"Extend _sync_issues_to_db to accept branch parameter","description":"Modify beads_sync.py _sync_issues_to_db() to accept optional branch parameter. Update the upsert query to use (repo_name, branch, bead_id) key. Update all callers.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T22:52:10.247958+01:00","updated_at":"2025-12-07T07:59:22.106071+01:00","closed_at":"2025-12-07T07:59:22.106071+01:00","dependencies":[{"issue_id":"beadhub-xc6","depends_on_id":"beadhub-eng","type":"blocks","created_at":"2025-12-06T22:54:27.976392+01:00","created_by":"juanre"}]}
{"id":"beadhub-xdc9","title":"Add GET /sessions/{id}/messages endpoint","description":"Retrieve message history for a session","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T14:22:19.031718+01:00","updated_at":"2025-12-13T14:45:14.680126+01:00","closed_at":"2025-12-13T14:45:14.680126+01:00","dependencies":[{"issue_id":"beadhub-xdc9","depends_on_id":"beadhub-n80a","type":"blocks","created_at":"2025-12-13T14:22:19.032733+01:00","created_by":"juanre"}]}
{"id":"beadhub-xf3q","title":"Fix /v1/workspaces to read from PostgreSQL, merge Redis presence","description":"## Problem\n/v1/workspaces reads from Redis presence (TTL 5 min). When workspace presence expires, frontend can't see messages even though they exist in PostgreSQL.\n\n## Root Cause\nMessagesPage fetches workspaces first, then fetches inbox for each. No workspaces = no messages displayed.\n\n## Solution\nRestructure endpoints:\n- `/v1/workspaces` â†’ Read from PostgreSQL, merge presence status from Redis when available\n- `/v1/workspaces/online` â†’ Current behavior (Redis presence only, for 'who is online' views)\n\nWorkspaces without active presence show status='offline'.\n\n## Files\n- src/beadhub/routes/workspaces.py\n- frontend/src/lib/api.ts (may need listOnlineWorkspaces)\n- frontend/src/pages/WorkspacesPage.tsx (may want /online)","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-12T23:56:14.758574+01:00","updated_at":"2025-12-13T00:12:01.33576+01:00","closed_at":"2025-12-13T00:12:01.33576+01:00"}
{"id":"beadhub-xhok","title":"Frontend chat API still calls removed /join and /end endpoints","description":"beadhub-ddsf removed POST /v1/chat/sessions/{id}/join and POST /v1/chat/sessions/{id}/end from the server (src/beadhub/routes/chat.py). Frontend still calls these endpoints via api.joinChatSession and api.endChatSession (frontend/src/lib/api.ts). This will be 404 at runtime.\n\nFix: update frontend chat flows to the v2.1 model (POST /v1/chat/sessions to send/find session; SSE stream is optional; no end/join), and remove UI/state assumptions about session lifecycle.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-14T00:28:08.872207+01:00","updated_at":"2025-12-14T09:01:29.118745+01:00","closed_at":"2025-12-14T09:01:29.118745+01:00","dependencies":[{"issue_id":"beadhub-xhok","depends_on_id":"beadhub-ddsf","type":"discovered-from","created_at":"2025-12-14T00:28:08.873533+01:00","created_by":"juanre"}]}
{"id":"beadhub-xjdp","title":"Make priority default explicit instead of silent fallback","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T20:35:32.853928+01:00","updated_at":"2026-01-03T18:38:44.102063Z","closed_at":"2026-01-03T18:38:44.102063Z","close_reason":"Already explicit: message priority defaults to 'normal' in frontend/api sendMessage signature and SendMessageDialog state."}
{"id":"beadhub-xknl","title":"Fix flaky test: test_workspaces_list_includes_human_name_and_project_slug","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-13T11:48:02.370783+01:00","updated_at":"2025-12-13T14:46:55.31829+01:00","closed_at":"2025-12-13T14:46:55.31829+01:00"}
{"id":"beadhub-xkw0","title":"SECURITY: Add rate limiting on authentication endpoints","description":"## Problem\n\nAPI key validation has no rate limiting, allowing unlimited brute force attempts.\n\n### Current Behavior\n\nIn `src/beadhub/auth.py:72-97`:\n```python\nasync def require_api_key(...) -\u003e None:\n    if not verify_api_key(api_key):  # No rate limit\n        raise HTTPException(status_code=401, ...)\n```\n\nWhile `hmac.compare_digest` prevents timing attacks, unlimited attempts are allowed.\n\n### Attack Vector\n\nAttacker can:\n1. Enumerate API keys via brute force (if key entropy is low)\n2. Cause resource exhaustion via repeated auth attempts\n3. No audit trail of failed attempts\n\n### Files Affected\n\n- `src/beadhub/auth.py`\n- Potentially needs new middleware\n\n### Solution\n\n**Option A: Simple rate limiting**\n```python\nfrom fastapi import Request\nfrom collections import defaultdict\nimport time\n\n_failed_attempts: dict[str, list[float]] = defaultdict(list)\nRATE_LIMIT_WINDOW = 60  # seconds\nMAX_FAILED_ATTEMPTS = 5\n\ndef check_rate_limit(request: Request) -\u003e None:\n    client_ip = request.client.host\n    now = time.time()\n    \n    # Clean old attempts\n    _failed_attempts[client_ip] = [\n        t for t in _failed_attempts[client_ip] \n        if now - t \u003c RATE_LIMIT_WINDOW\n    ]\n    \n    if len(_failed_attempts[client_ip]) \u003e= MAX_FAILED_ATTEMPTS:\n        raise HTTPException(429, \"Too many failed attempts\")\n```\n\n**Option B: Redis-based rate limiting (recommended for multi-process)**\n- Use Redis INCR with TTL for distributed rate limiting\n- Consider using a library like `slowapi`\n\n### Acceptance Criteria\n\n- [ ] Failed auth attempts are rate-limited per IP\n- [ ] Rate limit configuration is environment-based\n- [ ] Failed attempts are logged for monitoring\n- [ ] Consider IP allowlisting for admin endpoints","status":"open","priority":2,"issue_type":"bug","created_at":"2026-01-08T12:38:29.691522+01:00","created_by":"juanre","updated_at":"2026-01-08T12:38:29.691522+01:00"}
{"id":"beadhub-xlmc","title":"OSS API: GET /v1/repos - list repos with filters","description":"Add endpoint to list repos. Support project_id filter. Return id, project_id, canonical_origin, name, workspace_count. Exclude soft-deleted.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T15:25:35.253165+01:00","updated_at":"2025-12-21T16:42:18.949498+01:00","closed_at":"2025-12-21T16:42:18.949498+01:00","close_reason":"Implemented GET /v1/projects, GET /v1/projects/{id}, and GET /v1/repos endpoints with tests","dependencies":[{"issue_id":"beadhub-xlmc","depends_on_id":"beadhub-1thq","type":"blocks","created_at":"2025-12-21T15:26:54.937691+01:00","created_by":"juanre"},{"issue_id":"beadhub-xlmc","depends_on_id":"beadhub-9w1n","type":"blocks","created_at":"2025-12-21T15:27:04.086753+01:00","created_by":"juanre"}]}
{"id":"beadhub-xnto","title":"TEST: Parent issue for hierarchy testing","status":"closed","priority":4,"issue_type":"epic","created_at":"2026-01-09T18:54:50.879407+01:00","created_by":"juanre","updated_at":"2026-01-09T19:08:42.074926+01:00","closed_at":"2026-01-09T19:08:42.074926+01:00","close_reason":"Test issues for parent-child hierarchy validation - complete"}
{"id":"beadhub-xnto.1","title":"TEST: Child issue 1","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-09T18:54:56.837191+01:00","created_by":"juanre","updated_at":"2026-01-09T19:08:42.077235+01:00","closed_at":"2026-01-09T19:08:42.077235+01:00","close_reason":"Test issues for parent-child hierarchy validation - complete","dependencies":[{"issue_id":"beadhub-xnto.1","depends_on_id":"beadhub-xnto","type":"parent-child","created_at":"2026-01-09T18:54:56.837705+01:00","created_by":"juanre"}]}
{"id":"beadhub-xnto.2","title":"TEST: Child issue 2","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-09T18:54:57.219411+01:00","created_by":"juanre","updated_at":"2026-01-09T19:08:42.079404+01:00","closed_at":"2026-01-09T19:08:42.079404+01:00","close_reason":"Test issues for parent-child hierarchy validation - complete","dependencies":[{"issue_id":"beadhub-xnto.2","depends_on_id":"beadhub-xnto","type":"parent-child","created_at":"2026-01-09T18:54:57.219835+01:00","created_by":"juanre"}]}
{"id":"beadhub-xnto.3","title":"TEST: Child issue 3","status":"closed","priority":4,"issue_type":"task","created_at":"2026-01-09T18:54:57.598734+01:00","created_by":"juanre","updated_at":"2026-01-09T19:08:42.081575+01:00","closed_at":"2026-01-09T19:08:42.081575+01:00","close_reason":"Test issues for parent-child hierarchy validation - complete","dependencies":[{"issue_id":"beadhub-xnto.3","depends_on_id":"beadhub-xnto","type":"parent-child","created_at":"2026-01-09T18:54:57.599185+01:00","created_by":"juanre"}]}
{"id":"beadhub-xny2","title":"Fix Go bdh chat: JSON field names mismatch (initiator_alias vs initiator_agent)","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-13T13:41:31.74661+01:00","updated_at":"2025-12-13T13:45:04.756515+01:00","closed_at":"2025-12-13T13:45:04.756515+01:00"}
{"id":"beadhub-xpr0","title":"Chat requests should expire when initiator stops waiting","description":"Currently chat sessions have fixed 5-min TTL. When initiator disconnects from SSE (timeout, closed connection), the pending request should be removed so targets don't see stale requests. Options: (1) SSE disconnect handler cleans up pending, (2) heartbeat-based expiry, (3) shorter TTL. Recommend #1 - clean up when SSE closes.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T15:19:12.815219+01:00","updated_at":"2025-12-13T15:25:58.0588+01:00","closed_at":"2025-12-13T15:25:58.0588+01:00"}
{"id":"beadhub-xrne","title":"bdh_command presence indexing bug: pass project_id/repo_id to update_agent_presence and fix alias collision project check","description":"In src/beadhub/routes/bdh.py bdh_command(), update_agent_presence() is called with project_slug=str(project_id) and without project_id or repo_id. This breaks Redis secondary indexes (idx:project_workspaces, idx:repo_workspaces) and can make /v1/status?repo_id return empty/incorrect results. Also check_alias_collision() compares presence.project_slug to the UUID project_id; it should compare presence.project_id (and stop abusing project_slug). Fix: pass project_id=str(payload.project_id), repo_id=str(repo_id), and project_slug from DB (or leave empty) consistently.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T15:36:33.931202+01:00","updated_at":"2025-12-13T15:58:03.137636+01:00","closed_at":"2025-12-13T15:58:03.137636+01:00","dependencies":[{"issue_id":"beadhub-xrne","depends_on_id":"beadhub-g3ii","type":"discovered-from","created_at":"2025-12-13T15:36:33.932158+01:00","created_by":"juanre"}]}
{"id":"beadhub-xsqo","title":"Frontend query staleTime too aggressive with SSE active","description":"Location: frontend/src/App.tsx:11-18. staleTime=10000 (10s) means dashboard refetches every 10s even when SSE provides real-time updates. Creates unnecessary load and redundant API calls. Fix: increase staleTime to 60000 (60s) or use longer intervals when SSE is connected.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-08T18:25:31.602954+01:00","updated_at":"2025-12-13T15:28:27.707976+01:00","closed_at":"2025-12-13T14:15:47.872714+01:00"}
{"id":"beadhub-xthe","title":"Add unique constraint on chat_sessions (project_id, workspace_a, workspace_b)","description":"Add chat_session_participants table and participant_hash unique constraint:\n\n1. Add participant_hash column to chat_sessions (sorted, colon-joined workspace IDs)\n2. Add UNIQUE constraint on (project_id, participant_hash) to enforce one session per participant set\n3. Add chat_session_participants join table (session_id, workspace_id, alias, joined_at)\n4. Update create_session to compute participant_hash and populate participants table\n\nThis replaces the pair_key Redis logic AND supports N-participant group chat (not just 1-1).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T20:25:31.508536+01:00","updated_at":"2025-12-13T21:06:28.489913+01:00","closed_at":"2025-12-13T21:06:28.489913+01:00"}
{"id":"beadhub-xvbi","title":"Final verification: run all tests, verify data model consistency","description":"Final verification after all data model changes.\n\nChecklist:\n1. Run all Python tests: uv run pytest\n2. Run all Go tests: go test ./bdh/...\n3. Run ruff check: uv run ruff check src tests\n4. Verify migration order is correct\n5. Manual test: bdh init, bdh ready, bdh :status, bdh :chat\n\nVerify consistency:\n- All DB tables use alias instead of agent_name\n- All Redis keys use alias instead of agent_name\n- All API requests/responses use alias\n- All Go structs use Alias\n- All tests pass\n\nClose related beads that are now resolved:\n- beadhub-8qqk (secondary indexes)\n- beadhub-00q0 (lock metadata fields)\n\nDepends on: ALL other tasks in this epic","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-12T12:52:45.065053+01:00","updated_at":"2025-12-13T18:19:00.875651+01:00","closed_at":"2025-12-13T18:19:00.875651+01:00","dependencies":[{"issue_id":"beadhub-xvbi","depends_on_id":"beadhub-aev5","type":"blocks","created_at":"2025-12-12T12:52:51.779485+01:00","created_by":"juanre"},{"issue_id":"beadhub-xvbi","depends_on_id":"beadhub-s1xf","type":"blocks","created_at":"2025-12-12T12:52:51.838825+01:00","created_by":"juanre"},{"issue_id":"beadhub-xvbi","depends_on_id":"beadhub-5bji","type":"blocks","created_at":"2025-12-12T12:52:51.900661+01:00","created_by":"juanre"}]}
{"id":"beadhub-xvh","title":"Fix ready query to join on (repo, branch, bead_id)","description":"Update the NOT EXISTS subquery in /ready endpoint to properly join blocked_by JSONB objects on all three fields (repo_name, branch, bead_id) instead of just bead_id.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-07T08:15:45.375297+01:00","updated_at":"2025-12-07T08:18:06.178609+01:00","closed_at":"2025-12-07T08:18:06.178609+01:00","dependencies":[{"issue_id":"beadhub-xvh","depends_on_id":"beadhub-vmx","type":"parent-child","created_at":"2025-12-07T08:15:45.376142+01:00","created_by":"juanre"}]}
{"id":"beadhub-xw90","title":"Missing input validation on nested JSON fields in beads sync","description":"Location: src/beadhub/beads_sync.py:242-401. Accepts arbitrary JSON without deep validation: labels field accepts any list, dependencies relies on duck-typing, blocked_by silently skips malformed entries. Can cause DB constraint violations, silent data corruption, injection attacks if rendered unsafely. Fix: strict Pydantic models for nested structures, reject invalid uploads with clear errors.","status":"open","priority":2,"issue_type":"bug","created_at":"2025-12-08T18:25:00.130984+01:00","updated_at":"2026-01-09T22:38:58.842321+01:00"}
{"id":"beadhub-xx23","title":"Parse -s shorthand in claim detection regex","description":"Server regex only matches --status, not -s shorthand. Pattern: update bd-42 -s in_progress should also be detected as claim attempt.","status":"closed","priority":2,"issue_type":"bug","created_at":"2025-12-13T11:27:33.259578+01:00","updated_at":"2025-12-13T12:09:16.59397+01:00","closed_at":"2025-12-13T12:09:16.59397+01:00","dependencies":[{"issue_id":"beadhub-xx23","depends_on_id":"beadhub-3r30","type":"parent-child","created_at":"2025-12-13T11:28:12.986817+01:00","created_by":"juanre"}]}
{"id":"beadhub-xy2n","title":"bdh CLI: Add :lock, :unlock, :locks commands","description":"Add file reservation commands to bdh CLI for agent workflows.\n\n## Commands\n\n### bdh :lock \u003cpaths...\u003e\n\nReserve files/directories for exclusive work.\n\nOptions:\n- --ttl \u003cseconds\u003e: Lock duration (default 300, max 3600)\n- --shared: Allow shared access (default exclusive)\n- --reason \u003ctext\u003e: Why you need these files\n- --bead \u003cid\u003e: Associate with a bead\n\nOutput on success:\n  âœ“ Locked 3 paths (expires in 5m)\n    src/api.py\n    src/models.py\n    tests/\n\nOutput on conflict:\n  CONFLICT: Cannot lock - held by other agents:\n    src/api.py â€” claude-be (expires in 3m)\n  \n  Options:\n    - Wait for expiry\n    - Message them: bdh :send claude-be \"Need src/api.py...\"\n    - Force (admin): bdh :lock --force src/api.py\n\n### bdh :unlock [paths...]\n\nRelease file reservations.\n\nOptions:\n- --all: Release all your locks\n\nOutput:\n  âœ“ Released 2 locks\n    src/api.py\n    src/models.py\n\n### bdh :locks\n\nList active reservations in the project.\n\nOptions:\n- --mine: Only show your locks\n- --json: JSON output\n\nOutput:\n  ACTIVE LOCKS:\n    src/api.py â€” claude-be (expires in 3m) \"Working on auth\"\n    src/models.py â€” claude-fe (expires in 8m)\n    tests/ â€” you (expires in 2m)\n\n## Implementation\n\n1. Add commands to bdh/internal/commands/\n2. Call BeadHub REST API: /v1/reservations\n3. Format output for CLI readability\n\n## Server Endpoints Used\n\n- POST /v1/reservations (acquire)\n- POST /v1/reservations/release\n- GET /v1/reservations (list)","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-15T21:39:56.371025+01:00","updated_at":"2025-12-17T18:55:01.544434+01:00","closed_at":"2025-12-17T18:55:01.544434+01:00","close_reason":"Completed by claude-coord","dependencies":[{"issue_id":"beadhub-xy2n","depends_on_id":"beadhub-sgup","type":"blocks","created_at":"2025-12-15T21:42:52.810719+01:00","created_by":"juanre"}]}
{"id":"beadhub-xylc","title":"Add error feedback for chat handleEnd and joinMutation failures","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-13T17:31:12.668834+01:00","updated_at":"2025-12-13T17:31:12.668834+01:00"}
{"id":"beadhub-y28","title":"Fix test_mcp inbox count assertion failure","description":"**Problem**: test_mcp.py:111 expects 1 message but finds 2. State leakage between test phases.\n\n**File**: tests/test_mcp.py:111\n\n**Root cause**: app_with_test_db() creates fresh DB but uses same Redis instance. Test sends messages via MCP before assertion, Redis isn't flushed between operations within the same test.\n\n**Fix options**:\n1. Flush Redis between test phases\n2. Use unique project keys per test phase\n3. Verify test logic - maybe 2 messages IS correct for the test scenario\n\n**Investigation needed**: Review what messages are being sent before the assertion to determine correct expected count.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-02T19:47:39.267554+01:00","updated_at":"2025-12-02T20:15:53.187533+01:00","closed_at":"2025-12-02T20:15:53.187533+01:00","close_reason":"Fixed JSONB serialization for options field (json.dumps on insert, json.loads on read with error handling), and DRYed up Redis fixtures in conftest.py"}
{"id":"beadhub-y4d","title":"Add concurrent access tests for library mode","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-03T09:46:21.12855+01:00","updated_at":"2025-12-03T12:08:39.021729+01:00","closed_at":"2025-12-03T12:08:39.021729+01:00"}
{"id":"beadhub-y6ul","title":"bdh client: Update Workspace struct for claims[]","description":"Update bdh Go client to handle new claims[] array instead of current_bead.\n\nChanges to bdh/internal/client/client.go:\n1. Add Claim struct: {BeadID, Title, ClaimedAt string}\n2. Update Workspace struct: remove CurrentBead/CurrentBeadTitle, add Claims []Claim\n\nThis must be done before updating the display commands.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-20T10:28:46.560485+01:00","updated_at":"2025-12-20T10:51:54.088161+01:00","closed_at":"2025-12-20T10:51:54.088161+01:00","close_reason":"Added Claim struct to client.go, updated Workspace struct, updated passthrough.go and who.go to use Claims array. All Go tests pass.","dependencies":[{"issue_id":"beadhub-y6ul","depends_on_id":"beadhub-94uw","type":"parent-child","created_at":"2025-12-20T10:28:52.554745+01:00","created_by":"juanre"},{"issue_id":"beadhub-y6ul","depends_on_id":"beadhub-7szl","type":"blocks","created_at":"2025-12-20T10:28:52.673056+01:00","created_by":"juanre"}]}
{"id":"beadhub-y9j9","title":"bdh: evaluate restoring local apex computation for UX/offline (and/or send apex hints)","description":"Historically bdh computed apex locally by reading `.beads/issues.jsonl` and used it to:\n- show WORKING ON context without extra server calls\n- warn when working across multiple epics\n- prompt to close epic when children done\n\nRecent changes moved apex computation to the server (`/v1/workspaces` recursive CTE), which may be causing latency. Even if we fix server-side scaling, local computation can still be valuable for:\n- offline mode / server unreachable scenarios\n- additional local UX (warnings, prompts) without server coupling\n\nThis task is to decide which parts of the old local apex logic to restore and how it interacts with the server contract:\n- restore local apex computation only for *the bead being claimed/closed* (cheap, immediate)\n- optionally persist lightweight local state (separate from `.beadhub`) if we want to remember multiple active epics\n- optionally send apex hints to the server (if design chooses option B/C)\n\nAcceptance criteria should include:\n- no new heavy parsing on every command (avoid re-reading issues.jsonl unless needed)\n- deterministic output ordering (avoid map iteration nondeterminism)\n\nFiles:\n- `bdh/internal/commands/passthrough.go`\n- `bdh/internal/commands/who.go`","notes":"Decision: keep apex context sourced from server claim apex fields; no local apex computation on every command (only related-work parsing on close). Documented in beadhub-bdh-design.md. Implemented deterministic WORKING ON output ordering by sorting apex IDs; added test. Tests: go test ./internal/commands.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-20T13:55:58.58512+01:00","updated_at":"2025-12-21T18:06:48.332933+01:00","closed_at":"2025-12-21T18:06:48.332933+01:00","close_reason":"releasing claim","dependencies":[{"issue_id":"beadhub-y9j9","depends_on_id":"beadhub-o9h7","type":"parent-child","created_at":"2025-12-20T13:55:58.586803+01:00","created_by":"juanre"},{"issue_id":"beadhub-y9j9","depends_on_id":"beadhub-bcdk","type":"blocks","created_at":"2025-12-20T13:55:58.587583+01:00","created_by":"juanre"}]}
{"id":"beadhub-ya3","title":"Create beads upload endpoint in BeadHub OSS","description":"Add POST /v1/beads/upload endpoint that accepts JSON payload {repo, branch, issues: [...]} instead of reading from filesystem. Reuse _sync_issues_to_db() for the actual sync. This enables cloud customers to push issues without filesystem access.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T22:52:14.19056+01:00","updated_at":"2025-12-07T08:05:00.134944+01:00","closed_at":"2025-12-07T08:05:00.134944+01:00","dependencies":[{"issue_id":"beadhub-ya3","depends_on_id":"beadhub-xc6","type":"blocks","created_at":"2025-12-06T22:54:28.031443+01:00","created_by":"juanre"}]}
{"id":"beadhub-yc84","title":"Epic: Dashboard Display Improvements","status":"closed","priority":2,"issue_type":"epic","created_at":"2025-12-13T12:14:40.341748+01:00","updated_at":"2026-01-03T18:38:33.223357Z","closed_at":"2026-01-03T18:38:33.223357Z","close_reason":"All epic dependency beads are closed; dashboard display improvements delivered.","dependencies":[{"issue_id":"beadhub-yc84","depends_on_id":"beadhub-3dvj","type":"blocks","created_at":"2025-12-13T12:15:41.505372+01:00","created_by":"juanre"},{"issue_id":"beadhub-yc84","depends_on_id":"beadhub-233p","type":"blocks","created_at":"2025-12-13T12:15:41.574161+01:00","created_by":"juanre"},{"issue_id":"beadhub-yc84","depends_on_id":"beadhub-fuom","type":"blocks","created_at":"2025-12-13T12:15:41.641397+01:00","created_by":"juanre"},{"issue_id":"beadhub-yc84","depends_on_id":"beadhub-p02w","type":"blocks","created_at":"2025-12-13T12:15:41.710294+01:00","created_by":"juanre"},{"issue_id":"beadhub-yc84","depends_on_id":"beadhub-h4db","type":"blocks","created_at":"2025-12-13T12:15:41.780345+01:00","created_by":"juanre"},{"issue_id":"beadhub-yc84","depends_on_id":"beadhub-a7tg","type":"blocks","created_at":"2025-12-13T12:15:41.847202+01:00","created_by":"juanre"},{"issue_id":"beadhub-yc84","depends_on_id":"beadhub-1lih","type":"blocks","created_at":"2025-12-13T12:16:07.419783+01:00","created_by":"juanre"},{"issue_id":"beadhub-yc84","depends_on_id":"beadhub-acij","type":"blocks","created_at":"2025-12-13T12:16:07.490374+01:00","created_by":"juanre"},{"issue_id":"beadhub-yc84","depends_on_id":"beadhub-a7f2","type":"blocks","created_at":"2025-12-13T12:51:35.54872+01:00","created_by":"juanre"},{"issue_id":"beadhub-yc84","depends_on_id":"beadhub-ewtl","type":"blocks","created_at":"2025-12-13T13:08:44.498349+01:00","created_by":"juanre"}]}
{"id":"beadhub-ydr","title":"Add project_id to audit_log entries for forensic capability","description":"beads.py:143-162 audit log records 'beads_uploaded' event but doesn't include project_id in the details JSON. This makes it impossible to attribute uploads to specific tenants during incident investigation.\n\n**Fix**: Add 'project_id': project_id to the json.dumps() call in both upload endpoints.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-07T22:42:24.493448+01:00","updated_at":"2025-12-08T09:35:56.233111+01:00","closed_at":"2025-12-08T09:35:56.233111+01:00"}
{"id":"beadhub-yf1p","title":"Update bead_claims table: rename agent_name to alias","description":"Edit server/006_bead_claims.sql to implement new data model:\n\nChanges:\n1. Rename agent_name column to alias\n2. Add workspace_id FK to workspaces table (currently no FK)\n\nUpdated schema:\n- id (UUID, PK)\n- project_id (UUID, FK to projects, NOT NULL)\n- workspace_id (UUID, FK to workspaces, NOT NULL)  \u003c-- ADD FK\n- alias (TEXT, NOT NULL)  \u003c-- renamed from agent_name\n- human_name (TEXT, NOT NULL)\n- bead_id (TEXT, NOT NULL)\n- claimed_at (TIMESTAMPTZ, NOT NULL, DEFAULT NOW())\n\nKeep existing constraint: UNIQUE(project_id, bead_id) - one workspace per bead per project\n\nPer data-model.md section 7: \"Denormalized project_id in Claims\"\n- project_id is denormalized (could derive from workspace_id) but needed for unique constraint","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-12T12:49:45.022905+01:00","updated_at":"2025-12-12T15:16:34.7969+01:00","closed_at":"2025-12-12T15:16:34.7969+01:00"}
{"id":"beadhub-ylus","title":"Fix 20 test failures from workspace/agent registration refactoring","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T14:35:07.014164+01:00","updated_at":"2025-12-13T14:46:32.554378+01:00","closed_at":"2025-12-13T14:46:32.554378+01:00"}
{"id":"beadhub-ymsk","title":"Fix beadhub_server fixture in conftest.py","description":"Fix the session-scoped beadhub_server fixture which uses separate event loops and has fragile cleanup.","status":"closed","priority":0,"issue_type":"task","created_at":"2026-01-10T10:54:37.537121+01:00","created_by":"juanre","updated_at":"2026-01-10T13:23:23.637645+01:00","closed_at":"2026-01-10T13:23:23.637645+01:00","close_reason":"Fixed beadhub_server fixture: use asyncio.run() instead of manual event loop management, ensure database cleanup on Redis skip","dependencies":[{"issue_id":"beadhub-ymsk","depends_on_id":"beadhub-7wpr","type":"parent-child","created_at":"2026-01-10T10:55:47.916437+01:00","created_by":"juanre"}]}
{"id":"beadhub-ypl6","title":"UX: Send Message action unclear on workspace cards - needs label or tooltip","status":"closed","priority":0,"issue_type":"bug","created_at":"2025-12-13T21:26:07.545692+01:00","updated_at":"2025-12-13T21:29:56.035838+01:00","closed_at":"2025-12-13T21:29:56.035838+01:00"}
{"id":"beadhub-yqyx","title":"DB: add workspaces.focus_apex_* columns","description":"Add durable focus apex fields to the server workspaces table so context survives claim release.\n\nSchema proposal (server.workspaces):\n- focus_apex_bead_id TEXT NULL\n- focus_apex_repo_name TEXT NULL\n- focus_apex_branch TEXT NULL\n- focus_updated_at TIMESTAMPTZ NULL (set when focus changes)\n\nNotes:\n- We do not store title/type in the workspace row; join beads_issues at read time using (project_id, focus_apex_bead_id, focus_apex_repo_name, focus_apex_branch).\n- We have not deployed, so edit migrations directly; ensure constraints/indexes as needed.\n\nDone when:\n- Migration exists/updated.\n- DB constraint choices documented (nullable, no FK).\n- Any necessary indexes added if used in ordering/filtering.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T19:38:30.556687+01:00","updated_at":"2025-12-21T20:03:36.751507+01:00","closed_at":"2025-12-21T20:03:36.751507+01:00","close_reason":"Added focus apex columns and docs","dependencies":[{"issue_id":"beadhub-yqyx","depends_on_id":"beadhub-s35l","type":"parent-child","created_at":"2025-12-21T19:38:30.557955+01:00","created_by":"juanre"}]}
{"id":"beadhub-yslf","title":"Policy editor: useEffect resets roles/invariants on refetch","description":"EditPolicyDialog useEffect has [open, currentPolicy] dependencies. Main page has refetchInterval: 30000. If user spends \u003e30s editing, currentPolicy changes and useEffect resets roles/invariants state, wiping out newly added items. Fix: only initialize when dialog OPENS (track previous open state).","status":"closed","priority":1,"issue_type":"bug","created_at":"2026-01-04T10:47:59.59911Z","created_by":"juanre","updated_at":"2026-01-04T11:10:20.491054Z","closed_at":"2026-01-04T11:10:20.491054Z","close_reason":"Fixed in PoliciesPage.tsx"}
{"id":"beadhub-yu4o","title":"OSS config: BEADHUB_DASHBOARD_HUMAN environment variable","description":"Add configuration for dashboard human name in OSS mode. Environment variable BEADHUB_DASHBOARD_HUMAN with default 'admin'. Expose via /v1/config endpoint or similar for frontend to fetch.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T19:27:04.173833+01:00","updated_at":"2025-12-14T08:53:08.269679+01:00","closed_at":"2025-12-13T20:26:46.058925+01:00","dependencies":[{"issue_id":"beadhub-yu4o","depends_on_id":"beadhub-g9l6","type":"parent-child","created_at":"2025-12-13T19:27:52.386964+01:00","created_by":"juanre"}]}
{"id":"beadhub-yvd1","title":"Update Go client for persistent session model","description":"Update bdh/internal/commands/chat.go:\n\n1. Remove join_session call (just send message)\n2. Simplify startNewSession - always sends to find-or-create endpoint\n3. Remove replyToSession distinction (same as startNewSession)\n4. Update pending parsing for new response format (unread_count, other_alias)\n5. Add --history flag implementation\n6. Add --no-wait flag\n7. Remove --end flag (sessions don't end)\n\nKeep: SSE waiting for reply, termination signal handling","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-13T20:25:33.348149+01:00","updated_at":"2025-12-14T08:38:48.347783+01:00","closed_at":"2025-12-14T08:38:48.347783+01:00","dependencies":[{"issue_id":"beadhub-yvd1","depends_on_id":"beadhub-ixss","type":"blocks","created_at":"2025-12-13T20:26:15.019093+01:00","created_by":"juanre"},{"issue_id":"beadhub-yvd1","depends_on_id":"beadhub-6qlj","type":"blocks","created_at":"2025-12-13T20:26:15.093357+01:00","created_by":"juanre"},{"issue_id":"beadhub-yvd1","depends_on_id":"beadhub-hymw","type":"blocks","created_at":"2025-12-13T20:26:15.170554+01:00","created_by":"juanre"},{"issue_id":"beadhub-yvd1","depends_on_id":"beadhub-nflg","type":"blocks","created_at":"2025-12-13T20:28:22.499511+01:00","created_by":"juanre"}]}
{"id":"beadhub-yysg","title":"Chat: show remaining wait time in WAITING notification when urgent","description":"## Summary\n\nWhen Bob sees a WAITING notification, show how much time Alice has left â€” but only when it is urgent (\u003c 1 minute remaining). This creates appropriate urgency without being noisy.\n\n## Current Behavior\n\n```\nWAITING: alice â€” Run \"bdh :chat --open alice\"\n```\n\n## Proposed Behavior\n\nWhen Alice has \u003e 1 minute left:\n```\nWAITING: alice â€” Run \"bdh :chat --open alice\"\n```\n\nWhen Alice has \u003c 1 minute left:\n```\nWAITING: alice (45s left) â€” Run \"bdh :chat --open alice\"\n```\n\n## Design\n\n### Alice tells server her deadline\n\nWhen Alice connects to SSE, she includes her deadline:\n\n```\nGET /v1/chat/sessions/{id}/stream?deadline=2026-01-09T19:45:00Z\u0026workspace_id=...\n```\n\nServer stores this in Redis alongside the heartbeat:\n```\nHSET chat:waiting:{session_id}:{workspace_id} deadline \"2026-01-09T19:45:00Z\"\n```\n\nOr simpler: extend the ZSET to store deadline as a hash field per workspace.\n\n### Server returns time_remaining in GetPendingChats\n\n**`GET /v1/chat/pending` response:**\n```json\n{\n  \"pending\": [\n    {\n      \"session_id\": \"chat_abc123\",\n      \"participants\": [\"alice\", \"bob\"],\n      \"last_from\": \"alice\",\n      \"sender_waiting\": true,\n      \"sender_deadline\": \"2026-01-09T19:45:00Z\",  // NEW\n      \"time_remaining_seconds\": 45,                // NEW (computed)\n      ...\n    }\n  ]\n}\n```\n\n### CLI only shows time when urgent\n\n**`context.go` - `FormatWaitingNotification()`:**\n```go\nfunc FormatWaitingNotification(lastFrom string, timeRemaining int) string {\n    if timeRemaining \u003e 0 \u0026\u0026 timeRemaining \u003c 60 {\n        return fmt.Sprintf(\"WAITING: %s (%ds left) â€” Run \\\"bdh :chat --open %s\\\"\\n\", \n            lastFrom, timeRemaining, lastFrom)\n    }\n    return fmt.Sprintf(\"WAITING: %s â€” Run \\\"bdh :chat --open %s\\\"\\n\", \n        lastFrom, lastFrom)\n}\n```\n\n## Implementation\n\n### Server (Python)\n\n1. **`routes/chat.py` - `stream_chat_events()`:**\n   - Parse `deadline` query param\n   - Store in Redis: `HSET chat:deadline:{session_id} {workspace_id} {deadline_iso}`\n   - Clean up on disconnect\n\n2. **`routes/chat.py` - `get_pending_chats()`:**\n   - For each waiting sender, fetch their deadline from Redis\n   - Compute `time_remaining_seconds = deadline - now`\n   - Include in response\n\n### CLI (Go)\n\n1. **`chat.go` - `runChatWait()`:**\n   - Compute deadline based on timeout flag\n   - Pass as query param to SSE endpoint\n\n2. **`context.go`:**\n   - Update `FormatWaitingNotification()` to accept time remaining\n   - Only show seconds when \u003c 60\n\n3. **`client/client.go`:**\n   - Add `SenderDeadline` and `TimeRemainingSeconds` to `PendingConversation`\n\n## Edge Cases\n\n1. **Clock skew**: Use server time for computation, not client-provided deadline directly for display. Client sends deadline, server computes remaining.\n\n2. **Deadline passed but still connected**: Show \"expiring soon\" or just omit the time. Alice may still be connected briefly after deadline.\n\n3. **Multiple waiting senders**: Each has their own deadline, show individually.\n\n## Testing\n\n1. Unit test: deadline stored/retrieved correctly\n2. Integration test: time_remaining computed accurately\n3. CLI test: only shows time when \u003c 60s\n\n## Acceptance Criteria\n\n- [ ] Alice's CLI sends deadline when connecting to SSE\n- [ ] Server stores and returns time_remaining_seconds in GetPendingChats\n- [ ] Bob sees \"(Xs left)\" only when time_remaining \u003c 60 seconds\n- [ ] Time display is reasonably accurate (within a few seconds)","status":"closed","priority":2,"issue_type":"feature","created_at":"2026-01-09T19:43:15.72397+01:00","created_by":"juanre","updated_at":"2026-01-09T20:04:38.786162+01:00","closed_at":"2026-01-09T20:04:38.786162+01:00","close_reason":"Implemented in commit 9a27b48","dependencies":[{"issue_id":"beadhub-yysg","depends_on_id":"beadhub-5qm3","type":"related","created_at":"2026-01-09T19:45:38.43181+01:00","created_by":"juanre"}]}
{"id":"beadhub-yyu3","title":"Server: set focus apex when creating a claim","description":"On the write path (claim creation in /v1/bdh/command), update workspaces.focus_apex_* from the claim's computed apex_* fields.\n\nRules:\n- When inserting a claim (bead_claims row), set focus_apex_* to claim.apex_* and focus_updated_at=NOW().\n- Do NOT clear focus_apex_* on claim release/close; it persists until replaced by a later claim.\n- Must be in the same transaction as claim insert so focus and claim are consistent.\n\nValidation:\n- Unit/integration tests: create claim under epic A, close it, verify focus remains A even with zero claims.\n- Create claim under epic B, verify focus updates to B.\n\nCaveat:\n- If multiple claims are active under different apexes, 'WORKING ON' comes from active claims; focus is only used as fallback when there are no claims.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-21T19:38:34.943327+01:00","updated_at":"2025-12-21T20:03:40.854809+01:00","closed_at":"2025-12-21T20:03:40.854809+01:00","close_reason":"Persist focus apex on claim create and backfill","dependencies":[{"issue_id":"beadhub-yyu3","depends_on_id":"beadhub-s35l","type":"parent-child","created_at":"2025-12-21T19:38:34.945199+01:00","created_by":"juanre"}]}
{"id":"beadhub-yzx","title":"Add users table migration","description":"Add users table for SaaS auth: id, email, password_hash, subscription_tier, created_at, last_login_at. This blocks JWT auth routes.","status":"closed","priority":0,"issue_type":"task","created_at":"2025-12-03T08:09:54.000842+01:00","updated_at":"2025-12-03T08:42:37.228499+01:00","closed_at":"2025-12-03T08:42:37.228499+01:00","close_reason":"Users table is in beadhub-cloud (SaaS layer), not beadhub OSS"}
{"id":"beadhub-z4bu","title":"Fix bdh sync: remove obsolete --no-git-history flag","description":"bdh sync --from-main fails with:\n\n```\nError: unknown flag: --no-git-history\n```\n\nThe flag was removed from bd but bdh still passes it. Need to update the sync command to not use this flag.","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-20T10:31:06.4652+01:00","updated_at":"2025-12-20T11:19:22.068892+01:00","closed_at":"2025-12-20T11:19:22.068892+01:00","close_reason":"Removed --no-git-history flag from importFromJSONL in sync.go - flag was removed from bd import"}
{"id":"beadhub-z4d","title":"Phase 1: BeadHub OSS Core MVP","description":"Implement the single-tenant BeadHub OSS core as described in docs/source-of-truth/beadhub-sot-v1.0.0.md and beadhub-architecture.md: FastAPI API server, Redis for hot state, Postgres for persistent state, Beads integration, and a minimal CLI for human oversight.","status":"closed","priority":1,"issue_type":"epic","created_at":"2025-11-30T17:37:37.734844+01:00","updated_at":"2025-12-02T22:02:29.525031+01:00","closed_at":"2025-12-02T22:02:29.525031+01:00","close_reason":"Phase 1 OSS Core MVP complete. All subtasks done: FastAPI server, Redis hot state, Postgres persistence, Beads sync, MCP endpoints, CLI, pgdbm integration, real-infra testing policy."}
{"id":"beadhub-z4d.1","title":"Scaffold BeadHub OSS core service and CLI","description":"Set up the Python package structure for BeadHub Core using the existing uv project, including a FastAPI app module, configuration module, and a Typer-based CLI. Replace the current 'Hello from beadhub' stub with a CLI that exposes at least 'beadhub serve' to run the API server and forwards to uvicorn with appropriate env-driven settings (host, port, log level).","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T17:38:10.724841+01:00","updated_at":"2025-11-30T17:40:40.271094+01:00","closed_at":"2025-11-30T17:40:40.271094+01:00","close_reason":"Scaffolded FastAPI app, config settings, and Typer CLI with serve/status commands wired to Uvicorn and environment-based settings.","dependencies":[{"issue_id":"beadhub-z4d.1","depends_on_id":"beadhub-z4d","type":"parent-child","created_at":"2025-11-30T17:38:10.725427+01:00","created_by":"juanre"}]}
{"id":"beadhub-z4d.10","title":"Implement MCP /mcp endpoint for Agent Mail","description":"Implement a JSON-RPC /mcp endpoint that exposes Agent Mail tools (register_agent, file_reservation_paths, release_file_reservations, renew_file_reservations, send_message, fetch_inbox, acknowledge_message, whois, list_agents, search_messages) using BeadHub's existing Redis + pgdbm-backed implementations, following the mcp_agent_mail tool schema so MCP clients can talk to BeadHub as a drop-in Agent Mail host.","notes":"Completed MCP /mcp implementation for Agent Mail tools (register_agent, file_reservation_paths, release_file_reservations, renew_file_reservations, send_message, fetch_inbox, acknowledge_message, whois, list_agents, search_messages) plus BeadHub extensions (escalate, get_escalation, get_ready_issues, get_issue), all delegating to FastAPI routes backed by real Redis and pgdbm. Added integration tests that spin up a pgdbm-managed test database via app_with_test_db and use the real Redis fixture so MCP JSON-RPC calls exercise the full stack without mocks.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-30T19:12:07.25727+01:00","updated_at":"2025-11-30T19:58:19.473943+01:00","closed_at":"2025-11-30T19:58:19.473944+01:00","dependencies":[{"issue_id":"beadhub-z4d.10","depends_on_id":"beadhub-z4d","type":"parent-child","created_at":"2025-11-30T19:12:07.258691+01:00","created_by":"juanre"}]}
{"id":"beadhub-z4d.11","title":"Testing policy: real Redis and Postgres, no mocks","description":"Capture and enforce the testing strategy that all BeadHub integration tests use real infrastructure: Postgres via pgdbm (AsyncDatabaseManager, shared pool, and pgdbm.fixtures) and a real Redis instance for hot state, with no mocking or in-memory stand-ins. Update docs/source-of-truth to mention this policy explicitly, and review the existing test suite to ensure new tests follow the pattern (using pgdbm test fixtures or AsyncTestDatabase plus real Redis URLs) so agents and humans stay aligned on expectations.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T19:27:48.591544+01:00","updated_at":"2025-12-02T22:01:42.018281+01:00","closed_at":"2025-12-02T22:01:42.018281+01:00","close_reason":"Validated: All tests use real Redis (Redis.from_url with pytest.skip if unavailable) and real Postgres (pgdbm AsyncTestDatabase). No mocks in test suite.","dependencies":[{"issue_id":"beadhub-z4d.11","depends_on_id":"beadhub-z4d","type":"parent-child","created_at":"2025-11-30T19:27:48.592992+01:00","created_by":"juanre"}]}
{"id":"beadhub-z4d.12","title":"Redis client pattern and performance follow-up","description":"Document the current Redis client strategy (get_redis() constructing a fresh Redis client from REDIS_URL on each call) and capture reasoning around simplicity, testability, and expected performance characteristics. Track any future work to optimize connection reuse or pooling (e.g., caching per-URL clients or using connection pools) while preserving the requirement that tests can override REDIS_URL per-test without stale clients. Ensure the design aligns with BeadHub's real-Redis testing policy and SOT latency expectations (sub-100ms coordination).","status":"closed","priority":3,"issue_type":"chore","created_at":"2025-11-30T19:27:55.406613+01:00","updated_at":"2025-12-02T22:02:21.488061+01:00","closed_at":"2025-12-02T22:02:21.488061+01:00","close_reason":"Addressed: Redis now uses FastAPI lifespan pattern - single client created at startup, stored in app.state.redis, accessed via Depends(get_redis). Connection reuse is automatic.","dependencies":[{"issue_id":"beadhub-z4d.12","depends_on_id":"beadhub-z4d","type":"parent-child","created_at":"2025-11-30T19:27:55.407107+01:00","created_by":"juanre"}]}
{"id":"beadhub-z4d.13","title":"Implement /v1/status endpoint, MCP tool, and CLI status","description":"Add a /v1/status API endpoint that aggregates Redis presence, file reservations, Beads ready issues, and pgdbm-backed escalations into a single project status payload, wire the top-level 'beadhub status' CLI to call it (with human and --json output), and expose a 'status' MCP tool that delegates to the HTTP endpoint so MCP clients can fetch the same view. Ensure implementation uses real Redis and pgdbm (no mocks) and add integration tests using app_with_test_db and the existing Beads fixture to validate aggregation semantics.","notes":"Implemented /v1/status endpoint aggregating Redis presence, file reservations, Beads ready issues, and pgdbm-backed escalations; wired beadhub CLI 'status' command to call it with --project-key/--json options; added 'status' MCP tool that delegates to the HTTP handler; and added an integration test using app_with_test_db plus real Redis and the Beads issues.jsonl fixture to validate that agents, locks, escalations_pending, and ready_issues are reflected correctly.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-30T20:09:34.423256+01:00","updated_at":"2025-11-30T20:09:38.035251+01:00","closed_at":"2025-11-30T20:09:38.035252+01:00","dependencies":[{"issue_id":"beadhub-z4d.13","depends_on_id":"beadhub-z4d","type":"parent-child","created_at":"2025-11-30T20:09:34.423712+01:00","created_by":"juanre"},{"issue_id":"beadhub-z4d.13","depends_on_id":"beadhub-z4d.10","type":"discovered-from","created_at":"2025-11-30T20:09:34.424329+01:00","created_by":"juanre"}]}
{"id":"beadhub-z4d.2","title":"Implement Redis-backed file reservations API","description":"Implement the file reservation (lock) endpoints described in beadhub-specifications.md: POST /v1/reservations, POST /v1/reservations/release, POST /v1/reservations/renew, and GET /v1/reservations. Use Redis hashes keyed as reservation:{project}:{sha256(path)[:16]} with TTLs, and return granted/conflicts payloads that match the spec.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-30T17:38:17.544519+01:00","updated_at":"2025-11-30T17:44:28.632749+01:00","closed_at":"2025-11-30T17:44:28.632749+01:00","close_reason":"Implemented Redis-backed reservations endpoints (acquire, release, renew, list) in FastAPI with a shared Redis client and added integration tests using a real Redis instance via TestClient and pytest (no mocking).","dependencies":[{"issue_id":"beadhub-z4d.2","depends_on_id":"beadhub-z4d","type":"parent-child","created_at":"2025-11-30T17:38:17.545957+01:00","created_by":"juanre"}]}
{"id":"beadhub-z4d.3","title":"Implement agent registration and presence tracking","description":"Implement POST /v1/agents/register to record agent presence for a project, using Redis presence:{project}:{agent_name} hashes with a 60-second TTL as described in the architecture/spec docs. Return the agent and project info payload matching the spec.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-30T17:38:21.48963+01:00","updated_at":"2025-11-30T17:47:29.643075+01:00","closed_at":"2025-11-30T17:47:29.643075+01:00","close_reason":"Implemented POST /v1/agents/register and Redis-backed presence tracking with 60s TTL, plus integration tests hitting the real Redis instance via FastAPI TestClient (no mocking).","dependencies":[{"issue_id":"beadhub-z4d.3","depends_on_id":"beadhub-z4d","type":"parent-child","created_at":"2025-11-30T17:38:21.490151+01:00","created_by":"juanre"}]}
{"id":"beadhub-z4d.4","title":"Implement agent messaging (inbox) API","description":"Implement POST /v1/messages, GET /v1/messages/inbox, and POST /v1/messages/{message_id}/ack so agents can message each other via Redis inbox:{project}:{agent_name} lists. Support priorities, simple threading, and unread/read flags as described in beadhub-specifications.md.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-30T17:38:24.708513+01:00","updated_at":"2025-11-30T17:49:12.943096+01:00","closed_at":"2025-11-30T17:49:12.943096+01:00","close_reason":"Implemented Redis-backed messaging API (send, inbox, ack) with FastAPI routes and integration tests using a real Redis inbox per project/agent (no mocking).","dependencies":[{"issue_id":"beadhub-z4d.4","depends_on_id":"beadhub-z4d","type":"parent-child","created_at":"2025-11-30T17:38:24.70902+01:00","created_by":"juanre"}]}
{"id":"beadhub-z4d.5","title":"Add Postgres schema and migrations for core tables","description":"Introduce Postgres as the persistent store for project configuration, API keys, escalations, and audit_log as described in beadhub-architecture.md. Set up a migration mechanism (e.g., Alembic, or a simple internal migration runner) and create initial schema for project, api_keys, escalations, and audit_log tables.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T17:38:28.82597+01:00","updated_at":"2025-12-02T22:01:42.383139+01:00","closed_at":"2025-12-02T22:01:42.383139+01:00","close_reason":"Already implemented: migrations/server/ and migrations/beads/ with pgdbm AsyncMigrationManager. Tables: escalations, audit_log, beads_issues with proper indexes.","dependencies":[{"issue_id":"beadhub-z4d.5","depends_on_id":"beadhub-z4d","type":"parent-child","created_at":"2025-11-30T17:38:28.826413+01:00","created_by":"juanre"}]}
{"id":"beadhub-z4d.6","title":"Implement escalation flow and CLI support","description":"Implement the escalation endpoints and CLI flows so agents can escalate to humans and humans can respond. This includes POST /v1/escalations, GET /v1/escalations, GET /v1/escalations/{id}, and storing records in the escalations table, plus CLI commands to list, view, and respond to escalations.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-30T17:38:36.307376+01:00","updated_at":"2025-11-30T18:16:05.09756+01:00","closed_at":"2025-11-30T18:16:05.09756+01:00","close_reason":"Implemented escalation API routes (create/list/get/respond) backed by pgdbm server schema and added CLI commands (beadhub escalations list/view/respond); existing tests remain green and database integration is covered via pgdbm migration tests using real PostgreSQL.","dependencies":[{"issue_id":"beadhub-z4d.6","depends_on_id":"beadhub-z4d","type":"parent-child","created_at":"2025-11-30T17:38:36.307929+01:00","created_by":"juanre"}]}
{"id":"beadhub-z4d.7","title":"Implement Beads sync worker and ready issues API","description":"Implement a background Beads sync worker that reads the beads-metadata branch (or local .beads/issues.jsonl) and populates the beads_issues table, plus the /v1/beads/ready and /v1/beads/issues endpoints that expose issue data and ready-to-work items to agents and the CLI.","status":"closed","priority":2,"issue_type":"feature","created_at":"2025-11-30T17:38:41.068271+01:00","updated_at":"2025-11-30T18:56:56.458466+01:00","closed_at":"2025-11-30T18:56:56.458466+01:00","close_reason":"Implemented Beads sync worker that reads a configured BEADS_JSONL_PATH (.beads/issues.jsonl style JSONL) and upserts into the pgdbm-backed beads_issues table, added /v1/beads/sync,/issues,/ready endpoints and corresponding CLI commands (beadhub beads sync/issues/ready), and verified behavior with real-DB tests using a fixture issues.jsonl (including blocked_by and ready-work semantics).","dependencies":[{"issue_id":"beadhub-z4d.7","depends_on_id":"beadhub-z4d","type":"parent-child","created_at":"2025-11-30T17:38:41.068722+01:00","created_by":"juanre"}]}
{"id":"beadhub-z4d.8","title":"Adopt pgdbm for BeadHub Postgres access","description":"Replace ad-hoc SQLAlchemy/asyncpg wiring with pgdbm as the database access layer for BeadHub, following pgdbm's shared pool pattern and schema isolation. The API server should create a single shared pool from DATABASE_URL, expose schema-bound AsyncDatabaseManager instances for core modules (server, beads, future SaaS modules), and run migrations via AsyncMigrationManager.","status":"closed","priority":1,"issue_type":"feature","created_at":"2025-11-30T17:52:50.507987+01:00","updated_at":"2025-11-30T18:03:37.599915+01:00","closed_at":"2025-11-30T18:03:37.599915+01:00","close_reason":"Introduced pgdbm-based database infrastructure (shared pool + schema managers), wired FastAPI lifespan to initialize/close it, added server/beads migrations using {{tables.*}} templates, and verified migrations via pgdbm test fixtures against a real PostgreSQL database.","dependencies":[{"issue_id":"beadhub-z4d.8","depends_on_id":"beadhub-z4d","type":"parent-child","created_at":"2025-11-30T17:52:50.508483+01:00","created_by":"juanre"}]}
{"id":"beadhub-z4d.8.1","title":"Use pgdbm fixtures for database tests","description":"Update BeadHub's test suite to rely on pgdbm's testing fixtures (test_db, test_db_with_schema, test_db_with_tables, etc.) so that all database tests run against real PostgreSQL instances with automatic setup/teardown. Avoid mocks; use pgdbm.fixtures.conftest import in tests/conftest.py and ensure TEST_DB_* env vars are respected for local developer configuration.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T17:52:59.004038+01:00","updated_at":"2025-12-02T22:01:41.662393+01:00","closed_at":"2025-12-02T22:01:41.662393+01:00","close_reason":"Already implemented: tests/conftest.py imports pgdbm.fixtures.conftest, helpers_app.py uses AsyncTestDatabase and DatabaseTestConfig for real Postgres test databases.","dependencies":[{"issue_id":"beadhub-z4d.8.1","depends_on_id":"beadhub-z4d.8","type":"parent-child","created_at":"2025-11-30T17:52:59.004564+01:00","created_by":"juanre"}]}
{"id":"beadhub-z4d.8.2","title":"Update BeadHub docs for pgdbm usage","description":"Align BeadHub architecture and specification docs with pgdbm as the Postgres integration layer: document the shared pool pattern (AsyncDatabaseManager.create_shared_pool), schema-specific managers (server, beads), and pgdbm-based configuration via DATABASE_URL. Call out that all migrations and queries use {{tables.*}} templates.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T18:05:49.160248+01:00","updated_at":"2025-11-30T18:06:04.88099+01:00","closed_at":"2025-11-30T18:06:04.88099+01:00","close_reason":"Updated beadhub-architecture and beadhub-specifications docs to describe pgdbm-based Postgres usage (shared pool, schema managers, DATABASE_URL) and template-based migrations.","dependencies":[{"issue_id":"beadhub-z4d.8.2","depends_on_id":"beadhub-z4d.8","type":"parent-child","created_at":"2025-11-30T18:05:49.160736+01:00","created_by":"juanre"}]}
{"id":"beadhub-z4d.8.3","title":"Reusable pgdbm-backed app factory for tests","description":"Introduce a reusable pattern for spinning up BeadHub FastAPI apps against pgdbm-managed test databases (for HTTP-level integration tests). This should wrap pgdbm.testing.AsyncTestDatabase or pgdbm.fixtures in a helper that: (1) creates a temporary test DB, (2) sets DATABASE_URL appropriately, (3) constructs create_app() with the correct lifespan wiring, and (4) yields a FastAPI TestClient context that ensures db_infra is initialized and torn down cleanly before dropping the test database.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-11-30T18:17:32.044221+01:00","updated_at":"2025-11-30T18:43:41.432023+01:00","closed_at":"2025-11-30T18:43:41.432023+01:00","close_reason":"Added app_with_test_db helper using pgdbm.AsyncTestDatabase and DATABASE_URL wiring to spin up FastAPI TestClient instances against isolated Postgres test databases; kept current tests passing and will adopt the helper for future HTTP-level DB tests (e.g., Beads sync, escalations) as they are built out.","dependencies":[{"issue_id":"beadhub-z4d.8.3","depends_on_id":"beadhub-z4d.8","type":"parent-child","created_at":"2025-11-30T18:17:32.044769+01:00","created_by":"juanre"}]}
{"id":"beadhub-z4d.9","title":"Document Beads sync branch usage in SOT","description":"Update BeadHub source-of-truth docs to explicitly describe Beads' sync branch pattern (e.g., beads-metadata) as the preferred source of .beads/issues.jsonl for BeadHub, clarifying how BeadHub reads issue data from the configured sync branch rather than the code branch, and how this interacts with protected main branches.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-11-30T18:53:05.481938+01:00","updated_at":"2025-11-30T18:59:09.279096+01:00","closed_at":"2025-11-30T18:59:09.279096+01:00","close_reason":"Documented Beads sync-branch usage in SOT: BeadHub reads .beads/issues.jsonl from a Beads sync branch (e.g., beads-metadata) or worktree configured via BEADS_BRANCH/BEADS_JSONL_PATH, matching Beads' protected-branch workflow.","dependencies":[{"issue_id":"beadhub-z4d.9","depends_on_id":"beadhub-z4d","type":"parent-child","created_at":"2025-11-30T18:53:05.482415+01:00","created_by":"juanre"}]}
{"id":"beadhub-z6pe","title":"Add Redis tracking for SSE connections in stream_chat_events","description":"Pass workspace_id to stream_chat_events. On connect: SADD chat:waiting:{session_id} {workspace_id}. On disconnect (finally): SREM.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-14T17:07:18.127808+01:00","updated_at":"2025-12-14T17:09:36.449752+01:00","closed_at":"2025-12-14T17:09:36.449752+01:00","dependencies":[{"issue_id":"beadhub-z6pe","depends_on_id":"beadhub-2s14","type":"blocks","created_at":"2025-12-14T17:07:26.711656+01:00","created_by":"juanre"}]}
{"id":"beadhub-z6t6","title":"Project filter in IssuesPage updates UI but doesn't filter data","description":"COMPREHENSIVE FILTER BUG: Project filter updates UI (dropdown, subtitle) but does NOT filter data on ANY page.\n\nTESTED PAGES (all broken when filtering by 'beadhub'):\n\n1. IssuesPage - Shows 'Project: beadhub' subtitle but displays beadhub-cloud issues (e.g., beadhub-cloud-487, beadhub-cloud-7im, beadhub-cloud-uxa)\n\n2. WorkspacesPage - Shows 'Project: beadhub' but displays workspaces from beadhub-cloud (frank-frontend on github.com/juanre/beadhub-cloud, alice-coordinator on github.com/juanre/beadhub-cloud)\n\n3. MessagesPage - Shows 'All workspaces' in subtitle instead of 'Project: beadhub' even when filter is selected - completely ignores project filter\n\n4. ClaimsPage - Shows 'Project: beadhub' but displays beadhub-cloud-9rm claim (a beadhub-cloud issue)\n\n5. StatusPage - Shows 'Project: beadhub (3 workspaces)' but frank-frontend working on beadhub-cloud-9rm is visible\n\nROOT CAUSE HYPOTHESIS: The FilterBar state management works (UI updates), but the data fetching/filtering logic in each page component does not use the selected project_id to filter API responses or client-side data.\n\nSCOPE: This affects useStore filter state consumption across all page components. Each page needs to filter its data by selectedProjectId.\n\nTested with Playwright by alice-coordinator.","status":"closed","priority":0,"issue_type":"bug","assignee":"eve-frontend","created_at":"2026-01-04T18:53:07.036763Z","created_by":"juanre","updated_at":"2026-01-04T19:20:10.873749Z","closed_at":"2026-01-04T19:20:10.873749Z","close_reason":"Fixed MessagesPage - it was not using projectSlugFilter. Other pages (Issues, Workspaces, Claims, Status) already pass the filter correctly; any remaining issues are likely backend/data related."}
{"id":"beadhub-z8ps","title":"Show messages_waiting consistently for all server interactions","description":"Replaced by beadhub-gv2q","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T11:27:34.098131+01:00","updated_at":"2025-12-13T11:32:23.755917+01:00","closed_at":"2025-12-13T11:32:23.755917+01:00","dependencies":[{"issue_id":"beadhub-z8ps","depends_on_id":"beadhub-3r30","type":"parent-child","created_at":"2025-12-13T11:28:13.20501+01:00","created_by":"juanre"}]}
{"id":"beadhub-z8z9","title":"Handle edge cases in incremental sync","description":"Handle edge cases and conflicts:\n\n1. Concurrent modifications:\n   - Issue modified on server while client has old hash\n   - Conflict detection/resolution strategy\n\n2. Deletions:\n   - Issue deleted locally but still on server\n   - Issue deleted on server but still locally\n\n3. Recovery scenarios:\n   - Corrupt sync state file\n   - Network failure mid-sync\n   - Server-side rollback\n\n4. Git operations:\n   - Sync after git pull brings in different issues\n   - Sync after git stash/unstash\n   - Sync after branch switch\n\nDocument behavior for each case.","status":"closed","priority":3,"issue_type":"task","created_at":"2025-12-22T10:31:46.313387+01:00","updated_at":"2025-12-22T12:09:43.911823+01:00","closed_at":"2025-12-22T12:09:43.911823+01:00","close_reason":"Edge cases already handled: 1) Corrupt/missing sync state: LoadState returns empty state triggering full sync (tested in state_test.go). 2) Deletions: FindDeletedIssues detects locally deleted issues. 3) Network failure: State only saved after successful sync (passthrough.go:780-785). 4) Atomic writes: SaveState uses write-rename pattern. 5) Git operations (pull/stash/branch): Client recomputes hashes from current JSONL.","dependencies":[{"issue_id":"beadhub-z8z9","depends_on_id":"beadhub-9v3g","type":"blocks","created_at":"2025-12-22T10:34:52.566622+01:00","created_by":"juanre"},{"issue_id":"beadhub-z8z9","depends_on_id":"beadhub-1ij4","type":"blocks","created_at":"2025-12-22T10:38:13.020047+01:00","created_by":"juanre"}]}
{"id":"beadhub-zay","title":"Refactor SQL query building to use helper function instead of string concatenation","description":"Refactor dynamic SQL construction to reduce risk and improve consistency.\n\nCurrent state:\n- Several endpoints build WHERE clauses via string concatenation with parameter indices. This is mostly safe (still parameterized) but error-prone and hard to maintain.\n\nChange:\n- Introduce a small helper for building SQL with conditions + params (e.g., a builder that returns (sql, params) and manages $1..$N).\n- Apply it to at least one representative complex endpoint (e.g., list_workspaces or list_escalations) to validate approach.\n\nDecision gate:\n- If the helper does not clearly improve readability, close this as not worth it.","acceptance_criteria":"- SQL builder helper added and used in at least one endpoint\n- No behavior changes (verified by tests)\n- Code is simpler/clearer; otherwise close as not worth it","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-06T21:34:30.565642+01:00","updated_at":"2026-01-03T16:42:42.523971Z"}
{"id":"beadhub-zc53","title":"Handle Postgres write failures in chat persistence","status":"closed","priority":1,"issue_type":"bug","created_at":"2025-12-13T14:50:07.564859+01:00","updated_at":"2025-12-13T14:53:18.977689+01:00","closed_at":"2025-12-13T14:53:18.977689+01:00"}
{"id":"beadhub-zcfj","title":"Review staleTime: Infinity for dashboard config/workspace queries","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-13T20:35:18.438265+01:00","updated_at":"2026-01-03T18:38:45.129156Z","closed_at":"2026-01-03T18:38:45.129156Z","close_reason":"Reviewed: staleTime=Infinity is intentional for dashboard config/identity; workspaces lists are refreshed elsewhere."}
{"id":"beadhub-zcr","title":"Add tenant isolation tests for MCP tools and subscriptions","description":"Code review identified missing test coverage:\n1. MCP get_ready_issues/get_issue tenant isolation\n2. Subscription notifications cross-tenant leak\n3. upload-jsonl endpoint tenant isolation\n4. Cross-project blocked_by references\n5. Invalid project_id format handling\n\nAdd tests in test_tenant_isolation.py to verify these attack vectors are blocked.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-07T22:44:14.284885+01:00","updated_at":"2025-12-08T08:34:48.814906+01:00","closed_at":"2025-12-08T08:34:48.814906+01:00"}
{"id":"beadhub-zcw7","title":"N+1 query problem in alias resolution","description":"In create_session, each alias in to_aliases triggers a separate database query to resolve workspace_id. Should batch resolve all aliases in a single query using ANY($1) to avoid N+1 performance issue.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-13T22:59:08.253415+01:00","updated_at":"2025-12-13T22:59:08.253415+01:00","dependencies":[{"issue_id":"beadhub-zcw7","depends_on_id":"beadhub-ixss","type":"discovered-from","created_at":"2025-12-13T22:59:08.254843+01:00","created_by":"juanre"}]}
{"id":"beadhub-ze61","title":"Update ChatDashboard to use pagination","description":"Update frontend/src/pages/ChatDashboard.tsx:\n\n- Use new pagination component for session list\n- Fetch first page on mount\n- Load more pages on user request\n- Handle cursor state in component\n- Show loading state during fetches","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T10:31:08.652224+01:00","updated_at":"2025-12-22T13:22:38.258636+01:00","closed_at":"2025-12-22T13:22:38.258636+01:00","close_reason":"Added pagination to ChatDashboard","dependencies":[{"issue_id":"beadhub-ze61","depends_on_id":"beadhub-v9wr","type":"blocks","created_at":"2025-12-22T10:32:22.146663+01:00","created_by":"juanre"},{"issue_id":"beadhub-ze61","depends_on_id":"beadhub-i9bf","type":"blocks","created_at":"2025-12-22T10:38:07.156576+01:00","created_by":"juanre"},{"issue_id":"beadhub-ze61","depends_on_id":"beadhub-c6zq","type":"blocks","created_at":"2025-12-22T10:38:07.31551+01:00","created_by":"juanre"}]}
{"id":"beadhub-zgn5","title":"Rename Issues page to Beads","description":"The Issues page should be called Beads. Claims are claimed beads and should use the same formatting as the Beads page, including clickable bead names to open details.","status":"closed","priority":2,"issue_type":"task","created_at":"2026-01-06T18:58:11.373191Z","created_by":"juanre","updated_at":"2026-01-06T19:12:43.609757Z","closed_at":"2026-01-06T19:12:43.609757Z","close_reason":"Renamed Issues to Beads in nav, route, and page title"}
{"id":"beadhub-zjyv","title":"Policy markdown content not rendered","description":"Problem\n- Policy invariant `body_md` and role `playbook_md` are currently displayed as raw markdown in `frontend/src/pages/PoliciesPage.tsx` (`InvariantCard`/`RoleCard` use `\u003cpre\u003e`). This makes policies hard to read.\n\nChange\n- Render markdown safely for policy content (no raw HTML).\n- Add a small reusable component (e.g., `frontend/src/components/Markdown.tsx`) and use it in `InvariantCard` and `RoleCard` expanded views.\n- Prefer `react-markdown` + `remark-gfm` (if adding deps is acceptable) or reuse an existing markdown renderer if one exists.\n\nNotes\n- Keep styling consistent with the existing UI (tailwind + shadcn).\n- Ensure long content wraps and is scroll-friendly.","acceptance_criteria":"- Expanded invariant and role playbook bodies render markdown formatting (headers, lists, code blocks) instead of showing raw `##` / `-` markers.\n- Renderer does not allow unsafe HTML injection.\n- No regressions to policy page layout (content still readable and collapsible).\n- Frontend build and tests pass.","status":"closed","priority":2,"issue_type":"bug","created_at":"2026-01-02T18:45:19.756767Z","created_by":"juanre","updated_at":"2026-01-02T21:18:44.65185Z","closed_at":"2026-01-02T21:18:44.65185Z","close_reason":"Added Markdown component using react-markdown + remark-gfm. Updated InvariantCard and RoleCard to render markdown instead of raw text. Build and tests pass.","dependencies":[{"issue_id":"beadhub-zjyv","depends_on_id":"beadhub-1tqa","type":"discovered-from","created_at":"2026-01-02T18:45:19.758628Z","created_by":"juanre"}]}
{"id":"beadhub-zol","title":"Add ensure_project MCP tool","description":"Agent Mail compatibility: ensure_project tool to create/verify project existence. Currently we accept any project_key.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-02T22:19:56.81071+01:00","updated_at":"2025-12-03T19:27:16.001494+01:00","closed_at":"2025-12-03T19:27:16.001494+01:00"}
{"id":"beadhub-zp2t","title":"Enforce role format for workspace registration and init","description":"Enforce concise workspace role format (1â€“2 words, hyphen/underscore allowed) in bdh init + server validation. Align role handling with suggest-alias to avoid 422s and keep role stored in .beadhub and workspaces table. Add tests for invalid role input and doc updates in beadhub-workspace-roles.md.","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-21T18:03:16.554357+01:00","updated_at":"2025-12-21T18:34:30.994733+01:00","closed_at":"2025-12-21T18:34:30.994733+01:00","close_reason":"Implemented role validation/normalization across CLI and API with tests and docs.","dependencies":[{"issue_id":"beadhub-zp2t","depends_on_id":"beadhub-o9h7","type":"discovered-from","created_at":"2025-12-21T18:03:16.556444+01:00","created_by":"juanre"}]}
{"id":"beadhub-zs5n","title":"Add hash computation for bead issues in Go client","description":"In bdh Go client, compute SHA256 hash for each issue:\n\n- Hash the JSON representation of each issue (sorted keys for determinism)\n- Store hash alongside issue data\n- Provide function to compare current hash vs last-synced hash\n\nThis is the foundation for detecting what changed between syncs.\n\nFiles: bdh/internal/client/ or new bdh/internal/sync/","status":"closed","priority":2,"issue_type":"task","created_at":"2025-12-22T10:31:29.801503+01:00","updated_at":"2025-12-22T11:19:56.524682+01:00","closed_at":"2025-12-22T11:19:56.524682+01:00","close_reason":"Implemented hash computation package in bdh/internal/sync with SHA256 hashing, sorted keys for determinism, and comprehensive test coverage","dependencies":[{"issue_id":"beadhub-zs5n","depends_on_id":"beadhub-9v3g","type":"blocks","created_at":"2025-12-22T10:34:51.543458+01:00","created_by":"juanre"}]}
{"id":"beadhub-zta","title":"Update beads query endpoints to filter by branch","description":"Update /v1/beads/issues and /v1/beads/ready endpoints to accept optional branch query parameter. Update SQL queries to filter by branch when provided.","status":"closed","priority":1,"issue_type":"task","created_at":"2025-12-06T22:52:17.761568+01:00","updated_at":"2025-12-07T07:59:22.2564+01:00","closed_at":"2025-12-07T07:59:22.2564+01:00","dependencies":[{"issue_id":"beadhub-zta","depends_on_id":"beadhub-eng","type":"blocks","created_at":"2025-12-06T22:54:28.082805+01:00","created_by":"juanre"}]}
{"id":"beadhub-zutx","title":"Make /v1/init truly atomic","description":"# /v1/init Atomicity (DB Transaction)\n\n`POST /v1/init` is documented as â€œatomicâ€, but the current implementation performs multiple writes without a DB transaction (`src/beadhub/routes/init.py`).\n\n## Why This Matters (Even in Private Deployments)\n\n- A mid-flight error (DB exception, timeout, process crash) can leave partially created rows (project/repo/workspace/api key).\n- Partial state is hard to reason about operationally: rerunning init can behave differently depending on what succeeded.\n- It can create â€œghostâ€ projects/repos, break alias uniqueness expectations, and complicate support/debugging.\n- In Cloud-embedded deployments, the same code path can be used for provisioning and the blast radius is larger.\n\n## Desired Semantics\n\n`/v1/init` should behave as an all-or-nothing unit:\n\n- Either all required rows are created/updated consistently and the response is returned.\n- Or nothing changes (rollback) and the client receives an error.\n\nThe â€œidempotencyâ€ contract should remain:\n\n- Same `(canonical_origin, alias)` yields the same `workspace_id` (if already created), and returns a *new* API key.\n\n## Proposed Implementation\n\n- Wrap the create/restore logic for:\n  - project restore/create\n  - repo upsert\n  - workspace create (if needed)\n  - api key insert\n  in a single DB transaction.\n- Keep rate limiting outside the transaction.\n- Ensure â€œrestore soft-deleted projectâ€ + â€œupsert projectâ€ donâ€™t leak partial changes if later steps fail.\n\n## Edge Cases / Decisions\n\n- If workspace exists: decide whether to keep â€œissue new API keyâ€ inside the same transaction (recommended).\n- If inserting api key fails (unique/prefix collision): retry key generation a bounded number of times *within* the transaction.\n- If project slug conflicts with another tenant: reject (current behavior relies on `tenant_id IS NULL`; keep consistent).\n\n## Acceptance Criteria\n\n- Induce a failure after project/repo creation (e.g., by mocking a later insert): no rows are persisted.\n- Init remains idempotent for existing workspaces.\n- No â€œatomicâ€ claim in docs/code unless it is actually transactional.\n\n","acceptance_criteria":"- /v1/init wraps all writes in a single DB transaction\n- Failure mid-flow leaves no partial rows\n- Idempotency preserved (existing workspace returns same workspace_id + new key)","status":"closed","priority":2,"issue_type":"task","owner":"juan@juanreyero.com","created_at":"2026-01-17T18:22:00.140485+01:00","created_by":"Juan Reyero","updated_at":"2026-01-18T13:45:34.71642+01:00","closed_at":"2026-01-18T13:45:34.71642+01:00","close_reason":"Fixed /v1/init atomicity: use pgdbm transaction handle (tx) so all inserts share one DB transaction; added regression test ensuring rollback on later failure.","comments":[{"id":1,"issue_id":"beadhub-zutx","author":"Juan Reyero","text":"Taking this bead now (alice-coordinator). Will make /v1/init atomic with a real Postgres transaction + regression test.","created_at":"2026-01-18T12:40:32Z"}]}
{"id":"beadhub-zx0q","title":"Add Redis error handling tests for file reservations","description":"Code review of beadhub-7bgc identified missing tests for Redis error handling in file reservations:\n- Redis connection timeout behavior\n- Redis command failure mid-operation\n- Network partition during lock acquisition\n\nThese tests would verify graceful degradation when Redis is unavailable.","status":"open","priority":3,"issue_type":"task","created_at":"2025-12-16T22:58:09.523779+01:00","updated_at":"2025-12-16T22:58:09.523779+01:00","dependencies":[{"issue_id":"beadhub-zx0q","depends_on_id":"beadhub-7bgc","type":"discovered-from","created_at":"2025-12-16T22:58:09.524729+01:00","created_by":"juanre"}]}
